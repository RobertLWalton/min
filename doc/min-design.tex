% Minimal Descriptive Programming System Design
%
% File:         min-design.tex
% Author:       Bob Walton (walton@deas.harvard.edu)
% Date:		See \date below.
  
\documentclass[12pt]{article}

\usepackage{makeidx}
\usepackage{pictex}

\makeindex

\setlength{\oddsidemargin}{0in}
\setlength{\evensidemargin}{0in}
\setlength{\textwidth}{6.5in}
\raggedbottom

\setlength{\unitlength}{1in}

\pagestyle{headings}
\setlength{\parindent}{0.0in}
\setlength{\parskip}{1ex}

\setcounter{secnumdepth}{5}
\setcounter{tocdepth}{5}
\newcommand{\subsubsubsection}[1]{\paragraph[#1]{#1.}}
\newcommand{\subsubsubsubsection}[1]{\subparagraph[#1]{#1.}}

% Begin \tableofcontents surgery.

\newcount\AtCatcode
\AtCatcode=\catcode`@
\catcode `@=11	% @ is now a letter

\renewcommand{\contentsname}{}
\renewcommand\l@section{\@dottedtocline{1}{0.1em}{1.4em}}
\renewcommand\l@table{\@dottedtocline{1}{0.1em}{1.4em}}
\renewcommand\tableofcontents{%
    \begin{list}{}%
	     {\setlength{\itemsep}{0in}%
	      \setlength{\topsep}{0in}%
	      \setlength{\parsep}{1ex}%
	      \setlength{\labelwidth}{0in}%
	      \setlength{\baselineskip}{1.5ex}%
	      \setlength{\leftmargin}{0.8in}%
	      \setlength{\rightmargin}{0.8in}}%
    \item\@starttoc{toc}%
    \end{list}}
\renewcommand\listoftables{%
    \begin{list}{}%
	     {\setlength{\itemsep}{0in}%
	      \setlength{\topsep}{0in}%
	      \setlength{\parsep}{1ex}%
	      \setlength{\labelwidth}{0in}%
	      \setlength{\baselineskip}{1.5ex}%
	      \setlength{\leftmargin}{1.0in}%
	      \setlength{\rightmargin}{1.0in}%
	      }%
    \item\@starttoc{lot}%
    \end{list}}

\catcode `@=\AtCatcode	% @ is now restored

% End \tableofcontents surgery.

\newcommand{\CN}[2]%	Change Notice.
    {\hspace*{0in}\marginpar{\sloppy \raggedright \it \footnotesize
     $^{\mbox{#1}}$#2}}
    % Change notice.

\newcommand{\key}[1]{{\bf \em #1}\index{#1}}
\newcommand{\mkey}[2]{{\bf \em #1}\index{#1!#2}}
\newcommand{\skey}[2]{{\bf \em #1#2}\index{#1}}
\newcommand{\ikey}[2]{{\bf \em #1}\index{#2}}
\newcommand{\ttkey}[1]{{\tt \bf #1}\index{#1@{\tt #1}}}
% < and > do not work for \tt \bf, hence:
\newcommand{\ttnbkey}[1]{{\tt #1}\index{#1@{\tt #1}}}
\newcommand{\ttmkey}[2]{{\tt \bf #1}\index{#1@{\tt #1}!#2}}
\newcommand{\ttnbmkey}[2]{{\tt #1}\index{#1@{\tt #1}!#2}}
\newcommand{\ttfkey}[2]{{\tt \bf #1}\index{#1@{\tt #1}!for #2@for {\tt #2}}}
\newcommand{\ttakey}[2]{{\tt \bf #1}\index{#2@{\tt #1}}}
\newcommand{\ttamkey}[3]{{\tt \bf #1}\index{#2@{\tt #1}!#3}}
\newcommand{\ttindex}[1]{\index{#1@{\tt #1}}}
\newcommand{\ttmindex}[2]{\index{#1@{\tt #1}!#2}}
\newcommand{\emkey}[1]{{\bf \em #1}\index{#1@{\em #1}}}
\newcommand{\emindex}[1]{\index{#1@{\em #1}}}

\newcommand{\minkey}[1]%
           {{\tt \bf min::#1}\ttindex{min::#1}\ttindex{#1}}
\newcommand{\minnbkey}[1]%
           {{\tt min::#1}\ttindex{min::#1}\ttindex{#1}}
\newcommand{\minmkey}[2]%
           {{\tt \bf min::#1}\ttmindex{min::#1}{#2}\ttmindex{#1}{#2}}
\newcommand{\MUPkey}[1]{{\tt \bf {\tt MUP}::#1}\ttindex{MUP::#1}\ttindex{#1}}
\newcommand{\MUPmkey}[2]%
           {{\tt \bf MUP::#1}\ttmindex{MUP::#1}{#2}\ttmindex{#1}{#2}}
\newcommand{\minindex}[1]{\ttindex{min::#1}\ttindex{#1}}
\newcommand{\MUPindex}[1]{\ttindex{MUP::#1}\ttindex{#1}}


\newcommand{\secref}[1]{\ref{#1}$^{p\pageref{#1}}$}
\newcommand{\stepref}[1]{\ref{#1}$^{p\pageref{#1}}$}
\newcommand{\appref}[1]{\ref{#1}$^{p\pageref{#1}}$}
\newcommand{\pagref}[1]{p\pageref{#1}}

\newcommand{\EOL}{\penalty \exhyphenpenalty}

\newcount\TildeCatcode
\TildeCatcode=\catcode`\~
\catcode`~=12
\newcommand{\Tilde}{~}
\catcode`~=\TildeCatcode

\newcount\CircumflexCatcode
\CircumflexCatcode=\catcode`\^
\catcode`^=12
\newcommand{\Circumflex}{^}
\catcode`^=\CircumflexCatcode

\newcount\CurlyBraCatcode
\newcount\CurlyKetCatcode
\newcount\SquareBraCatcode
\newcount\SquareKetCatcode
\CurlyBraCatcode=\catcode`{
\CurlyKetCatcode=\catcode`}
\SquareBraCatcode=\catcode`[
\SquareKetCatcode=\catcode`]

\catcode`{=\SquareBraCatcode
\catcode`}=\SquareKetCatcode
\catcode`[=\CurlyBraCatcode
\catcode`]=\CurlyKetCatcode

\newcommand[\CurlyBra][{]
\newcommand[\CurlyKet][}]

\catcode`{=\CurlyBraCatcode
\catcode`}=\CurlyKetCatcode
\catcode`[=\SquareBraCatcode
\catcode`]=\SquareKetCatcode

\newcommand{\ttbrackets}{%
    \renewcommand{\{}{\CurlyBra}%
    \renewcommand{\}}{\CurlyKet}}

\newsavebox{\TILDEBOX}
\begin{lrbox}{\TILDEBOX}
\verb|~|
\end{lrbox}
\newcommand{\TILDE}{\usebox{\TILDEBOX}}

\newsavebox{\BACKSLASHBOX}
\begin{lrbox}{\BACKSLASHBOX}
\verb|\|
\end{lrbox}
\newcommand{\BACKSLASH}{\usebox{\BACKSLASHBOX}}

\newsavebox{\LEFTBRACKETBOX}
\begin{lrbox}{\LEFTBRACKETBOX}
\verb|{|
\end{lrbox}
\newcommand{\LEFTBRACKET}{\usebox{\LEFTBRACKETBOX}}

\newsavebox{\RIGHTBRACKETBOX}
\begin{lrbox}{\RIGHTBRACKETBOX}
\verb|}|
\end{lrbox}
\newcommand{\RIGHTBRACKET}{\usebox{\RIGHTBRACKETBOX}}

\newsavebox{\UNDERLINEBOX}
\begin{lrbox}{\UNDERLINEBOX}
\verb|_|
\end{lrbox}
\newcommand{\UNDERLINE}{\usebox{\UNDERLINEBOX}}

\newsavebox{\CIRCUMFLEXBOX}
\begin{lrbox}{\CIRCUMFLEXBOX}
\verb|^|
\end{lrbox}
\newcommand{\CIRCUMFLEX}{\usebox{\CIRCUMFLEXBOX}}

\newsavebox{\BARBOX}
\begin{lrbox}{\BARBOX}
\verb/|/
\end{lrbox}
\newcommand{\BAR}{\usebox{\BARBOX}}

\newsavebox{\LESSTHANBOX}
\begin{lrbox}{\LESSTHANBOX}
\verb/</
\end{lrbox}
\newcommand{\LESSTHAN}{\usebox{\LESSTHANBOX}}

\newsavebox{\GREATERTHANBOX}
\begin{lrbox}{\GREATERTHANBOX}
\verb/>/
\end{lrbox}
\newcommand{\GREATERTHAN}{\usebox{\GREATERTHANBOX}}

\newlength{\figurewidth}
\setlength{\figurewidth}{\textwidth}
\addtolength{\figurewidth}{-0.40in}

\newsavebox{\figurebox}

\newenvironment{boxedfigure}[1][!btp]%
	{\begin{figure*}[#1]
	 \begin{lrbox}{\figurebox}
	 \begin{minipage}{\figurewidth}

	 \vspace*{1ex}}%
	{
	 \vspace*{1ex}

	 \end{minipage}
	 \end{lrbox}
	 \begin{center}
	 \fbox{\hspace*{0.1in}\usebox{\figurebox}\hspace*{0.1in}}
	 \end{center}
	 \end{figure*}}

\newenvironment{indpar}[1][0.3in]%
	{\begin{list}{}%
		     {\setlength{\itemsep}{0in}%
		      \setlength{\topsep}{0in}%
		      \setlength{\parsep}{1ex}%
		      \setlength{\labelwidth}{#1}%
		      \setlength{\leftmargin}{#1}%
		      \addtolength{\leftmargin}{\labelsep}}%
	 \item}%
	{\end{list}}

\newcommand{\LABEL}[1]{\label{#1}}
\newcommand{\TTKEY}[1]{\ttkey{#1}}
\newcommand{\TTNBKEY}[1]{\ttnbkey{#1}}
\newcommand{\MINKEY}[1]{{\tt \bf #1}\minindex{#1}}
\newcommand{\MUPKEY}[1]{{\tt \bf #1}\MUPindex{#1}}

\newcommand{\REL}{$\,^R$}
\newcommand{\COMPACT}{$\,^C$}
\newcommand{\LOOSE}{$\,^L$}

\begin{document}
        
\title{Internal Design\\[2ex]of the\\[2ex]
       Minimal\\Descriptive Programming\\System\\[2ex]MIN\\[2ex]
       (Draft 1a)}

\author{Robert L. Walton}

\date{January 6, 2010}
 
\maketitle

\newpage
\begin{center}
\large \bf Table of Contents
\end{center}

\bigskip

\tableofcontents 

\newpage

\section{Introduction}

This document describes the internal design of MIN,
the Minimal Descriptive Programming System.
This document is written for readers who wish to add C++ code
to a MIN implementation, or who wish to maintain an implementation.

A programming system provides run time and compile time support
for programming languages.
A programming system, such as MIN, is
built on top of an underlying programming system provided by the
implementation language, in this case C++.
MIN consists of a data store, of the single-thread execution system
inherited from C++, and of MIN compatible threads.
Other programming language specific
programming systems can be built on top of MIN.

A small number of \skey{abbreviation}s are used throughout this document
and the corresponding code:

\begin{center}
\begin{tabular}{ll}
\ttmkey{acc}{abbreviation}	& allocator/collector/compactor
			          (\secref{ACC-INTERFACE},\secref{ACC}) \\
\ttmkey{aux}{abbreviation}	& auxiliary (\secref{AUXILIARY}) \\
\ttmkey{attr}{abbreviation}	& attribute (\secref{OBJECT-VECTOR-LEVEL}) \\
\ttmkey{gen}{abbreviation}	& general value (\secref{GENERAL-VALUES}) \\
\ttmkey{int}{abbreviation}	& signed integer (\pagref{INT}) \\
\ttmkey{lab}{abbreviation}	& label (\secref{LABELS}) \\
\ttmkey{min}{abbreviation}	& the `{\tt min}' namespace (\pagref{min::}) \\
\ttmkey{MACC}{abbreviation}	& {\tt min::acc} (\pagref{MACC}) \\
\ttmkey{MIN}{abbreviation}	& the {\tt MIN\_} macro preface
				  (\pagref{MIN_}) \\
\ttmkey{MINT}{abbreviation}	& {\tt min::internal} (\pagref{MINT}) \\
\ttmkey{MOS}{abbreviation}	& {\tt min::os} (\pagref{MOS}) \\
\ttmkey{MUP}{abbreviation}	& {\tt min::unprotected} (\pagref{MUP}) \\
\ttmkey{num}{abbreviation}	& number (\pagref{NUMBERS}) \\
\ttmkey{obj}{abbreviation}	& object (\pagref{OBJECTS}) \\
\ttmkey{str}{abbreviation}	& string (\pagref{STRINGS}) \\
\ttmkey{uns}{abbreviation}	& unsigned integer (\pagref{UNS}) \\
\ttmkey{var}{abbreviation}	& variable (\secref{OBJECT-VECTOR-LEVEL}) \\
\ttmkey{vec}{abbreviation}	& vector (\secref{OBJECT-VECTOR-LEVEL}) \\
\end{tabular}
\end{center}


\section{Interfaces}
\label{INTERFACES}

The C++ data and functions described in this document can be
accessed by C++ code that contains the following inclusion:

\begin{center}
\verb|#include  <min.h>|
\end{center}

External MIN data and functions are placed in the
\ttnbmkey{min}{namespace}\label{min::} namespace.
There are some macros that can be defined to control compilation, and
these have names beginning with \ttnbkey{MIN\_}\label{MIN_}.

MIN has two interfaces:
the \key{protected interface}, which can be used
by C++ code to access MIN while maintaining the integrity
of MIN data, and the \key{unprotected interface}, which provides
more efficient access to MIN data but requires the user to
follow certain protocols to be sure that data are not damaged.

From the syntactic point of view the
only distinction between these interfaces is that the unprotected
interface is in the with \minkey{unprotected} namespace, whereas
the protected interface is in the \ttkey{min} namespace.  User code
that accesses the unprotected interface typically abbreviates the long
`{\tt min::unprotected::}' prefix to
`\ttnbmkey{MUP}{abbreviates {\tt min::unprotected}}{\tt ::}'\label{MUP}
by including the following definition:
\begin{center}
\verb|#define  MUP  min::unprotected|
\end{center}

In this document we will use the abbreviation `\verb|MUP|' for
`\verb|min::unprotected|'.
Note that namespace definitions such as the above are \underline{not}
included in \verb|min.h| or other MIN \verb|.h| files; they must
be included explicitly in \verb|.cc| files.

Most {\tt MUP} functions `produce \key{undefined results}' when their arguments
are out of legal range.
This means that when the arguments are out of range,
function execution may lose control and crash, or may produce result
values that are wrong or out of legal range.
When documentation of a {\tt MUP} function
states that particular argument range checks are not performed,
then the {\tt MUP} function always produces undefined results when its
arguments would not pass these checks,
unless the documentation explicitly says otherwise.

Most, but not all, of the protection provided by the protected interface
is obtained by the functions of that interface using the
{\tt MIN\_ASSERT} macro:

\begin{indpar}
\begin{tabular}{lp{4.0in}}
\TTNBKEY{MIN\_ASSERT}{\tt (}$e${\tt )}
	& By default defined as `{\tt assert(}$e${\tt )}' if
	  {\tt MIN\_PROTECT} is defined to be {\tt 1} (its default),
	  and defined to be a no operation otherwise.  Alternatively
	  may be defined by the compilation before
	  \verb|#include <min.h>|.
\LABEL{MIN_ASSERT}
\end{tabular}
\end{indpar}
\begin{indpar}
\begin{tabular}{lp{4.0in}}
\TTNBKEY{MIN\_PROTECT}	& 1 (the default)
                          if {\tt MIN\_ASSERT} is to be mapped to
			  the C++ \ttkey{assert} macro if {\tt MIN\_ASSERT}
			  not otherwise defined; 0 to map {\tt MIN\_ASSERT}
			  to a no operation if it is not otherwise defined.
\LABEL{MIN_PROTECT} \\
\end{tabular}
\end{indpar}

By setting {\tt MIN\_PROTECT} to {\tt 0}, a compilation can optimize
debugged code, although this will remove the protection
provided by the protected interface.  Alternatively,
a compilation can provide its own definition for the
{\tt MIN\_ASSERT} macro,
such as a definition printing extra information
in case of an assertion failure.

The above macros ({\tt MIN\_ASSERT}, {\tt MIN\_PROTECT})
can be defined independently for each separately compiled
part of a program, but most \verb|MIN_| macros must be defined identically
for all separately compiled parts of a single program.

The following are the most commonly used compiler options that
redefine {\tt MIN\_} macros:

\begin{indpar}
\begin{tabular}{lll}
Macro Name		& Meaning	& Page Reference \\[1ex]
\verb|-DMIN_PROTECT=0|	& delete assert checks
					& \pagref{MIN_PROTECT} \\
\verb|-DMIN_IS_COMPACT=1|
			& make implementation compact
					& \pagref{MIN_IS_COMPACT} \\
\end{tabular}
\end{indpar}

The other compilation parameters involve technical details of
memory management.  For specifics see the file
\ttkey{min\_parameters.h}\ttindex{min\_parameters.h}.

Protected functions are in the \ttmkey{min}{namespace} namespace
and have names beginning with
`\ttmkey{min::}{in function name}', while
unprotected MIN functions are in the \ttmkey{min::unprotected}{namespace}
namespace and have names beginning with
`\ttnbmkey{min::unprotected::}{in function name}'.
The {\tt min} and {\tt min::unprotected} namespaces hold \underline{all}
the stable interfaces of the MIN implementation.

Code in \verb|min.h| that is not meant to be accessed
by users is in the following namespaces:

\begin{indpar}
\begin{tabular}{llp{4.0in}}
	    & Abbre- \\
Namespace   & viation   & Use
\\[1ex]
\tt min::os & \tt MOS	& Operating system independent interface to
			  operating system functions
			  not covered by C++ standards.
			  See Appendix \secref{MOS}.
\\[1ex]
\tt min::acc & \tt MACC & The part of the interface to the
			  Allocator/\EOL Collector/\EOL Compactor
			  that can be
			  changed when the acc is changed.
			  See Appendix \secref{ACC}.
\\[1ex]
\tt min::internal & \ttnbkey{MINT}\label{MINT}
		        & Interface to internal MIN code that can
			  be changed without notice at any time.
			  Not described in this document; see
			  {\tt .h} files.
\end{tabular}
\end{indpar}

\section{Data}

In defining MIN data the following number types are used to be sure
the size of each number is clear:
\begin{center}
\begin{tabular}{l@{~~~~~}l}
\minkey{uns8}	& unsigned 8-bit integer \\
\minkey{int8}	& signed 8-bit integer \\
\minkey{uns16}	& unsigned 16-bit integer \\
\minkey{int16}	& signed 16-bit integer \\
\minkey{uns32}	& unsigned 32-bit integer \\
\minkey{int32}	& signed 32-bit integer \\
\minkey{float32}	& 32-bit IEEE floating point number \\
\minkey{uns64}	& unsigned 64-bit integer \\
\minkey{int64}	& signed 64-bit integer \\
\minkey{float64}	& 64-bit IEEE floating point number \\
\end{tabular}
\end{center}%
\label{MIN::UNS8}%
\label{MIN::INT8}%
\label{MIN::UNS16}%
\label{MIN::INT16}%
\label{MIN::UNS32}%
\label{MIN::INT32}%
\label{MIN::FLOAT32}%
\label{MIN::UNS64}%
\label{MIN::INT64}%
\label{MIN::FLOAT64}%
\label{INT}%
\label{UNS}

Currently planned implementations of MIN assume a compiler that has
direct support for 64 bit integers.  It is possible, but not recommended,
to modify the implementations to use compilers without such support.

The heap data (i.e., data not in the stack)
of MIN is defined using C-compatible
\ttmkey{struct}{C compatible}'s
and \ttmkey{union}{C compatible}'s.  C++ implicitly guarantees the layout of
C-compatible \verb|struct|'s and \verb|union|'s to be C-compatible,
and C has implicit guarantees because of historical C code that
such data will not contain unnecessary unnamed padding.  Neither the
C or C++ standards guarantee the absence of unnecessary unnamed padding, but
MIN depends upon its absence, as does any code that reads and writes
binary files.

As a consequence of using only C-compatible \verb|struct|'s and
\verb|union|'s to define heap data, MIN does not use member functions
for such data.

\subsection{Stubs and Bodies}

MIN data memory consists of regions that contain stubs and regions
that contain bodies.  A region is a contiguous block
of memory, typically consisting of an integral number of hardware
pages.

\ikey{Stubs}{stub}
are small fixed size units of memory that cannot be relocated:
the usual stub size for MIN is 16 bytes.
Each object has a stub, and the address of the stub is in effect
the internal name of the object.  Some atoms (e.g., numbers, strings)
have stubs, and some (e.g., integers that are not large, and very short
strings) do not.

A stub is divided into an 8 byte \key{stub value}
and an 8 byte \key{stub control}.
The stub value can be a 64-bit IEEE floating point number,
an 8 {\tt char} string, or, as we will soon see, a pointer to a body.
It is also possible for a stub value to hold any other 8 bytes of information.

The stub control holds a 1 byte \key{type code} and other information used,
for example, by the allocator/collector/compactor (acc).

The type name of a stub is `\minkey{stub}', and a pointer to a stub
has type `\verb|min::stub *|'.\LABEL{MIN::STUB}
Protected functions can return `\verb|const min::stub *|' values,
but only unprotected functions can return `\verb|min::stub *|' values.

A \key{body} is a variable sized
\ttmkey{relocatable}{body}\label{RELOCATABLE-BODY}
block of memory
attached to a particular stub.  A stub may have a body attached to
it, in which case the stub value is a pointer to that body.
When certain functions are called,
any body can be moved and its corresponding stub value reset to
point at the new location of the body.
Functions with this property are called
`\key{relocating functions}'\label{RELOCATING-FUNCTIONS}
and are marked by {\REL} in documentation.  Included
are functions that allocate objects.
Obtaining a C++ pointer into a body is an unprotected operation, because
the pointer must be maintained if a relocating function is called.

\ikey{Interrupts}{interrupt!and relocation} can relocate bodies.
Therefore interrupts are only allowed
at specific points in the code.  The inline function

\begin{indpar}\begin{tabular}{r@{}l}
\verb|bool min::| & \MINKEY{interrupt\REL}\verb| ( void )|
\LABEL{MIN::INTERRUPT} \\
\end{tabular}\end{indpar}%
\index{interrupt!relocating}

checks an interrupt
flag, and if that is set, calls an out-of-line function to process
the interrupt.  The function returns {\tt true} if and only if
there was actually an interrupt (this should be used only
for optimization).

A body may be \mkey{deallocated}{by moving}
by moving it to unimplemented memory.  When this is done the
stub \mkey{type code}{reset on deallocation}
is reset to the value \minnbkey{DEALLOCATED}\LABEL{MIN::DEALLOCATED},
which indicates the body is deallocated.
The function that deallocates a body is:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|void min::| & \MINKEY{deallocate\REL}\verb| ( min::stub * s )|
\LABEL{MIN::DEALLOCATE} \\
\end{tabular}\end{indpar}%
\index{deallocate!relocating}

Deallocation is considered to be a variant of relocation.
Relocating functions, those marked marked by {\REL} in documentation,
may also deallocate objects.

The {\tt min::is\_deallocated} function described on
\pagref{MIN::IS_DEALLOCATED}
can be used to test whether the body of a stub has been deallocated.

Bodies are always some multiple
of 8 bytes long, and are allocated on 8 byte boundaries.

\ikey{Protected functions}{protected function!using {\tt MIN\_ASSERT}}
that take a stub pointer as argument use
\ttnbmkey{MIN\_ASSERT}{in protected function} macros
(\pagref{MIN_ASSERT}) to check
the \mkey{type code}{checked by {\tt MIN\_ASSERT}}
of the stub and various lengths.  Unprotected functions
contain no such checks.

Memory consisting of unrelocatable stubs pointing at relocatable
bodies is called a `\key{stub/\EOL body memory}'.
Thus MIN has a stub/body memory.
The main advantages of stub/body memory are that relocation of bodies
can happen independently of other program activity, and bodies can be
deallocated by program command at any time.\footnote{
Stub/body memories are certainly not new.  For example, Kyoto COMMONLISP
used a stub/body implementation of arrays, and the author has heard about
implementations that go back to the late 1950's or early 60's: see
p33 of the author's thesis, R-CODE, A Very Capable Virtual Computer.}


\subsection{General Values}
\label{GENERAL-VALUES}

A general value can store any of:

\begin{center}
\begin{tabular}{l}
a direct atom value \\
a pointer to a stub \\
an auxiliary pointer \\
an index \\
a control code \\
a special value
\end{tabular}
\end{center}

General values are used as attribute names and values in
objects and as function arguments and return values.

General values that represent numbers or character strings
are called \skey{atom}s, because they have no subcomponents.
There are two kinds of atoms: \skey{direct atom}s that
are stored completely in a general value, and
\skey{indirect atom}s that are stored in a stub or in
a body pointed at by a stub, with the stub being pointed
at by a general value.

Efficiency aside, it does not matter
whether a general value stores a direct atom value or a pointer
to a stub holding an indirect atom value,
as atom values are immutable and cannot be changed.  Of course not all
atom values will fit into a general value, and those that do not must
be stored in stubs or in bodies pointed at by stubs.

An \key{auxiliary pointer} is an integer that is used by a general value
stored inside a body to point at some part, called an
\key{auxiliary},\label{AUXILIARY} of the same body.
There are several subtypes of auxiliary pointers storable in bodies.
See~\pagref{OBJECT-BODY-AUXILIARY-POINTER}.

An \key{index} is an integer that is used to give the index of a variable
that is an element of an object body.
See~\pagref{OBJECTS}.

A \key{control code} is an integer that represents flags and codes
stored in a general value.  Control codes can have different
interpretations in different contexts.
For example, see `Attribute Flags', \pagref{ATTRIBUTE-FLAGS}.

A \key{special value} is a unique value that has some
special meaning.  \verb|min::MISSING|, for example, is a special
value that may be input or output to indicate that data is missing,
and \verb|min::NONE| is a special value used only to
indicate that a function argument or result does not exist.
See \secref{SPECIAL-VALUES}.

There are two kinds of MIN implementation: `\key{compact}' and
`\key{loose}'.\label{COMPACT}\label{LOOSE}\label{COMPACT-OR-LOOSE}
A compact implementation uses 32-bit general values, while
a loose implementation uses 64-bit general values.
An implementation cannot use both 32-bit and 64-bit general values;
the implementation must use one or the other.

Some functions and constants are defined only for compact implementations,
and some only for loose implementations.  Those defined only for
compact implementations are marked
with the superscript {\COMPACT}\index{C@{\COMPACT}}
in this document.
Those defined only for
loose implementations are similarly marked
with the superscript {\LOOSE}\index{L@{\LOOSE}}.

The value of a compact implementation is that it uses less memory%
\footnote{However, double precision floating point numbers only
use less memory if each is replicated several times.},
but there may be a speed penalty.
The value of a loose implementation is that it may run faster, but
there is a memory penalty.  It is not clear what the speed difference
between the two implementations really is, so both implementations
are offered in order to decide the issue by experiment.

Also compact implementations do not permit more than
about $2^{32}$ objects to exist in memory at one time, whereas
loose implementations permit up to about $2^{44}$ objects.

\subsubsection{General Value Subtypes}
\label{GENERAL-VALUE-SUBTYPES}

A \key{general value} has type \minkey{gen}\LABEL{MIN::GEN} and
is a 32 or 64 bit aligned value that can be of one of the following
subtypes;

\begin{indpar}[3em]
a pointer to a stub \\
a 64-bit IEEE floating point direct number atom\LOOSE \\
a 28-bit direct integer atom\COMPACT \\
a 0-5 {\tt char} direct string atom\LOOSE \\
a 0-3 {\tt char} direct string atom\COMPACT \\
a VSIZE-bit list auxiliary pointer \\
a VSIZE-bit sublist auxiliary pointer \\
a VSIZE-bit indirect auxiliary pointer \\
a VSIZE/2-bit+VSIZE/2-bit packed indirect auxiliary pointer \\
a VSIZE-bit index \\
a VSIZE-bit control code \\
a VSIZE-bit special value
\end{indpar}
\hspace*{1in}\begin{minipage}{4.5in}
where \key{VSIZE} equals 24 for a compact implementation
and 40 for a loose implementation
\end{minipage}

Here {\COMPACT} subtypes are only implemented by compact
implementations, and {\LOOSE} subtypes are only implemented by
loose implementations (\pagref{COMPACT-OR-LOOSE}).

Numbers and character strings stored inside a \verb|min::gen| value are
called `\skey{direct atom}s\,'.  Numbers and character strings
stored in stubs or stub bodies which are pointed at by a
\verb|min::gen| value are called `\skey{indirect atom}s'.  An atom is
always stored in only one way by an implementation.  If a number will fit
into a direct atom, it is stored as a direct atom, and never as an
indirect atom.  Similarly if a character string will fit into a direct atom,
it is stored as a direct atom, and never as an indirect atom.

Analogously indirect atoms are stored in only one place in memory, so
two indirect numbers are equal if and only the \verb|min::gen| values
pointing at them point at the same place, and similarly
two indirect character strings are equal if and only
the \verb|min::gen| values pointing at them point at the same place.

Therefore two atoms are equal if and only if the \verb|min::gen| values
designating them are \verb|==| as 32-bit or 64-bit values.

General values that point at stubs hold stub addresses in a
packed format.  44 bits are available to store a stub address in a
64-bit general value, and 32 bits are available to store a stub address
in a 32-bit general value, but in the latter case the packed address must be
less than $2^{32}-2^{29}$ (the $2^{29}$ other 32 bit values are used to store
direct integers, auxiliary pointers, indices, control codes, and special
values).  There are three
\skey{stub address packing scheme}s,\label{STUB-ADDRESS-PACKING} and the fastest
is selected for each type of general value.  The scheme selection is
controlled by the following `\skey{stub address packing parameter}\,'
macros:

\begin{indpar}\begin{tabular}{lp{3.0in}}
\TTNBKEY{MIN\_\EOL MAX\_\EOL ABSOLUTE\_\EOL STUB\_\EOL ADDRESS}
	& The maximum absolute address of any stub as an unsigned integer
	  constant.  See \pagref{MIN_MAX_ABSOLUTE_STUB_ADDRESS} for
	  defaults.
\end{tabular}\end{indpar}
\begin{indpar}\begin{tabular}{lp{3.0in}}
\TTNBKEY{MIN\_\EOL MAX\_\EOL RELATIVE\_\EOL STUB\_\EOL ADDRESS}
	& The maximum address of any stub relative to a constant
	  stub base address, as an unsigned integer
	  constant.  See \pagref{MIN_MAX_RELATIVE_STUB_ADDRESS} for
	  defaults.
\end{tabular}\end{indpar}

The fastest scheme is the \key{absolute stub address} scheme,
where the absolute stub
address is stored.  For 64 bit general values this is
just a matter of inserting the stub address into the low order 44 bits
of the value.  For 32 bit general values this is just a matter of
using the stub address as the general value.
This scheme can be used if
{\tt MIN\_\EOL MAX\_\EOL ABSOLUTE\_\EOL STUB\_\EOL ADDRESS}
can be stored in 44 bits for 64 bit general values, or is at most
$2^{32}-2^{29}-1$ for 32 bit general values.

The second fastest scheme is the \key{relative stub address}
\label{RELATIVE-STUB-ADDRESS} scheme, where the
stub address relative to a constant \key{stub base}
address is stored.
The relation between the absolute and relative stub addresses is:

\begin{center}
stub absolute address = stub base + stub relative address
\end{center}

where `stub base' is a constant determined when the program is
initialized.
This scheme can be used if
{\tt MIN\_\EOL MAX\_\EOL RELATIVE\_\EOL STUB\_\EOL ADDRESS}
can be stored in 44 bits for 64 bit general values, or is at most
$2^{32}-2^{29}-1$ for 32 bit general values.

The slowest scheme is the \key{stub index} scheme, where the
relative stub address divided by the stub length is stored.
The stub length is chosen to be a power of 2 so that this
scheme will be efficient.  Again, this scheme can be used
if the relative address of the stub is not too large, but since
the stub length is 16, the relative address can be 16 times larger
for the stub index packing scheme than it is for the stub relative address
packing scheme.
Thus the index scheme can be used if
{\tt MIN\_\EOL MAX\_\EOL RELATIVE\_\EOL STUB\_\EOL ADDRESS/16}
can be stored in 44 bits for 64 bit general values, or is at most
$2^{32}-2^{29}-1$ for 32 bit general values.

Note that on machines that have 32 bit addresses (e.g.,
the IA32\footnote{Intel Architecture 32-bit, a.k.a, i386 machines.}
machines), there is little to gain by either the relative stub address
or stub index packing schemes,
so only the absolute stub address scheme should be used on such machines.

A 32-bit general value direct integer consists of a high order 4-bit
subtype code and a low order 28-bit signed integer stored in offset form,
so the true integer can be derived from the {\tt min::gen} value by
subtracting the {\tt min::gen} representation of zero.
The range of such a direct integer is the same as the range of a 28-bit
two's complement integer: $-2^{27}$ to $2^{27}-1$, inclusive.

Other 32-bit general values consist of a high order
8-bit subtype code and a low order 24-bit datum.  For most auxiliary pointer
general values the datum is a 24-bit auxiliary pointer
(see~\pagref{OBJECT-BODY-AUXILIARY-POINTER}
and~\pagref{VARIABLE-VECTOR-AUXILIARY-POINTER}
for a definition of auxiliary pointers).  For packed indirect
auxiliary pointer values the datum is a 12-bit auxiliary pointer and
a 12-bit index.  For index and special
values the datum is a 24-bit index.
For control code general values the datum is 24-bits that
contains flags and codes that have different interpretations in different
contexts.  And for direct string general values the datum
holds 0 to 3 8-bit {\tt char}'s.

For 64-bit general values that point at stubs, the high order 20 bits
are used as a subtype code.  For other 64-bit general values, the high
order 24 bits are the subtype code and the low order 40 bits are the datum.
The values chosen for these subtype codes make stub pointers, direct strings,
auxiliary pointers, indices, and control codes -- that is, all non-number
{\tt min::gen} values --
into IEEE Nan (Not-a-Number)
values that are never generated by hardware instructions.

For most auxiliary pointer general values the 40-bit datum is used to hold
a 40-bit auxiliary pointer.  For
packed indirect auxiliary pointer general values
the datum holds a 20-bit auxiliary pointer
and a 20-bit index.  For index and special values the datum holds a
40-bit index.
For control code general values the datum is a 40-bit control code;
and for direct string general values the datum holds 0-5 {\tt char}'s.

The {\tt min::gen} type has the alignment
properties of either {\tt min::uns32} or {\tt min::uns64},
and in many implementations is {\tt typedef}'ed to the appropriate one
of these two types.  Therefore a function that has only
{\tt min::gen} and non-{\tt min} (e.g. number and {\tt char *}) arguments
cannot be \ikey{overloaded}{overloading!rationale}\label{OVERLOADING-RATIONALE},
and must have a name beginning with `{\tt min::}'.
To avoid confusion, all MIN function names begin with `{\tt min::}'.

Many {\tt min:gen} values, which are 32 or 64 bits, are divided into a subtype,
either 8 or 24 bits, and a datum, either 24 or 40 bits.  In this context the
datum is called the `\mkey{value}{part of a {\tt min::gen} value}'.  The
following definitions are provided in {\tt min.h} to facilitate coding:

\begin{indpar}
\begin{tabular}{r@{}l@{\hspace*{2em}}l}
\verb|min::| & \MINKEY{unsgen}
	& typedef'ed to {\tt min::uns32}\COMPACT or {\tt min::uns64}\LOOSE
\LABEL{MIN::UNSGEN} \\
\verb|const unsigned min::| & \MINKEY{TSIZE}
	& Subtype size; equal to {\tt 8}\COMPACT or {\tt 24}\LOOSE.
\LABEL{MIN::TSIZE} \\
\verb|const unsigned min::| & \MINKEY{VSIZE}
	& Value size; equal to {\tt 24}\COMPACT or {\tt 40}\LOOSE.
\LABEL{MIN::VSIZE}
\end{tabular}
\end{indpar}


\subsubsection{General Value Compilation}
\label{GENERAL-VALUE-COMPILATION}

The decisions on whether an implementation is
compact or loose (\pagref{COMPACT-OR-LOOSE})
must be made before C++ code is compiled.
Decisions must also be made determining the stub address packing
parameters (\pagref{STUB-ADDRESS-PACKING}).
The following macros, which must be defined identically
for all separately compiled parts of a single program, describe
these decisions.  These macros are in two groups, first the macros
that are set by the programmer, and then the macros which by default
are computed from the settings of the first group of macros.
All these macros are defined in
\ttkey{min\_parameters.h}\ttindex{min\_parameters.h}.

The macros set by the programmer are:

\begin{indpar}\begin{tabular}{p{2.0in}p{3.5in}}
\TTNBKEY{MIN\_IS\_COMPACT}	& 1 if compact implementation; 0 if loose;
				  defaults to 0.
\LABEL{MIN_IS_COMPACT}
\end{tabular}\end{indpar}
\begin{indpar}\begin{tabular}{p{2.0in}p{3.5in}}
\TTNBKEY{MIN\_MAX\_EPHEMERAL\_LEVELS}
				& Maximum number of garbage collector
				  ephemeral levels allowed in
				  \underline{any} execution of the
				  compiled binary; defaults to 2.
\LABEL{MIN_MAX_EPHEMERAL_LEVELS} \\
\end{tabular}\end{indpar}

The macros which are normally set to default values computed from
the above macro settings are:
\begin{indpar}
\begin{tabular}{@{}p{2.0in}p{3.5in}@{}}
\TTNBKEY{MIN\_IS\_LOOSE}	& 1 if loose implementation; 0 if compact;
				  Must equal `\verb|! MIN_IS_COMPACT|\,'.
\LABEL{MIN_IS_LOOSE}
\end{tabular}
\end{indpar}
\begin{indpar}
\begin{tabular}{@{}p{2.0in}p{3.5in}@{}}
\TTNBKEY{MIN\_MAX\_NUMBER\_OF\_STUBS}
				& The maximum number of stubs that can
				  exist in \underline{any} execution
				  of the compiled binary.  Defaults: \\
& \hspace*{1em}\begin{tabular}{ll}
if \verb|MIN_IS_COMPACT| = 1:	& $2^{28} - 2^{25}$ \\
else pointers are 32 bits:	& $2^{28}$ \\
else:				& $2^{40-4e}$ \\
\end{tabular} \\
& where \\
& ~~$e = max(0,\mbox{\tt MIN\_MAX\_EPHEMERAL\_LEVELS}-2)$.
\LABEL{MIN_MAX_NUMBER_OF_STUBS}
\end{tabular}
\end{indpar}
\begin{indpar}
\begin{tabular}{@{}p{2.0in}p{3.5in}@{}}
\TTNBKEY{MIN\_STUB\_BASE}
	& The value of the `stub base' for relative addressing
          (see \pagref{RELATIVE-STUB-ADDRESS}).  If defined
          this must be a non-negative integer constant.  Defaults to
	  \verb|0| if \verb|MIN_MAX_NUMBER_OF_STUBS| is set by
	  default, and otherwise is left undefined.
\LABEL{MIN_STUB_BASE}
\end{tabular}
\end{indpar}
\begin{indpar}
\begin{tabular}{@{}p{2.5in}p{3.0in}@{}}
\TTNBKEY{MIN\_MAX\_RELATIVE\_STUB\_ADDRESS}
	& The maximum address of any stub relative to the `stub base' (address
	  of the first stub), as an unsigned integer constant.  Default: \\
	& ~~\verb|16*MIN_MAX_NUMBER_OF_STUBS - 1|.
\LABEL{MIN_MAX_RELATIVE_STUB_ADDRESS}
\end{tabular}
\end{indpar}
\begin{indpar}
\begin{tabular}{@{}p{2.5in}p{3.0in}@{}}
\TTNBKEY{MIN\_MAX\_ABSOLUTE\_STUB\_ADDRESS}
	& The maximum absolute address of any stub.  Defaults: \\
	& ~~~~ if \verb|MIN_STUB_BASE| defined: \\
	& ~~~~~~~~ \verb|  MIN_STUB_BASE| \\
	& ~~~~~~~~ \verb|+ MIN_MAX_RELATIVE_STUB_ADDRESS| \\
	& ~~~~ else if \begin{tabular}[t]{@{}l@{}}
	               \verb|MIN_IS_COMPACT| = 1 and \\
		       pointers are 32 bits:
		       \end{tabular} \\
	& ~~~~~~~~ $2^{32}-2^{29}-1$ \\
	& ~~~~ else if pointers are 32 bits: \\
	& ~~~~~~~~ $2^{32}-1$ \\
	& ~~~~ else: \\
	& ~~~~~~~~ $2^{48}-1$
\LABEL{MIN_MAX_ABSOLUTE_STUB_ADDRESS}
\end{tabular}
\end{indpar}

\subsubsection{General Value Functions}
\label{GENERAL-VALUE-FUNCTIONS}

The following functions return {\tt true} if a {\tt min::gen} datum is of the
indicated subtype and {\tt false} otherwise:

\begin{indpar}
\verb|bool min::|\MINKEY{is\_stub}\verb| ( min::gen v )|
\LABEL{MIN::IS_STUB} \\
\verb|bool min::|\MINKEY{is\_direct\_float\LOOSE}\verb| ( min::gen v )|
\LABEL{MIN::IS_DIRECT_FLOAT} \\
\verb|bool min::|\MINKEY{is\_direct\_int\COMPACT}\verb| ( min::gen v )|
\LABEL{MIN::IS_DIRECT_INT} \\
\verb|bool min::|\MINKEY{is\_direct\_str}\verb| ( min::gen v )|
\LABEL{MIN::IS_DIRECT_STR} \\
\verb|bool min::|\MINKEY{is\_list\_aux}\verb| ( min::gen v )|
\LABEL{MIN::IS_LIST_AUX} \\
\verb|bool min::|\MINKEY{is\_sublist\_aux}\verb| ( min::gen v )|
\LABEL{MIN::IS_SUBLIST_AUX} \\
\verb|bool min::|\MINKEY{is\_indirect\_aux}\verb| ( min::gen v )|
\LABEL{MIN::IS_INDIRECT_AUX} \\
\verb|bool min::|\MINKEY{is\_packed\_aux}\verb| ( min::gen v )|
\LABEL{MIN::IS_PACKED_AUX} \\
\verb|bool min::|\MINKEY{is\_index}\verb| ( min::gen v )|
\LABEL{MIN::IS_INDEX} \\
\verb|bool min::|\MINKEY{is\_control\_code}\verb| ( min::gen v )|
\LABEL{MIN::IS_CONTROL_CODE} \\
\verb|bool min::|\MINKEY{is\_special}\verb| ( min::gen v )|
\LABEL{MIN::IS_SPECIAL_CODE}
\end{indpar}

For a 32-bit general value {\tt is\_direct\_float\LOOSE} is unimplemented.
For a 64-bit general value {\tt is\_direct\_int\COMPACT} is unimplemented.

The following protected functions return the value appropriate for a given
subtype, after checking the subtype with a {\tt MIN\_ASSERT} statement:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|const min::stub * min::| & \MINKEY{stub\_of}\verb| ( min::gen v )|
\LABEL{MIN::STUB_OF} \\
\verb|min::float64 min::|
    & \MINKEY{direct\_float\_of\LOOSE}\verb| ( min::gen v )|
\LABEL{MIN::DIRECT_FLOAT_OF} \\
\verb|min::int32 min::| & \MINKEY{direct\_int\_of\COMPACT}\verb| ( min::gen v )|
\LABEL{MIN::DIRECT_INT_OF} \\
\verb|min::uns64 min::| & \MINKEY{direct\_str\_of}\verb| ( min::gen v )|
\LABEL{MIN::DIRECT_STR_OF} \\
\verb|min::unsgen min::| & \MINKEY{list\_aux\_of}\verb| ( min::gen v )|
\LABEL{MIN::LIST_AUX_OF} \\
\verb|min::unsgen min::| & \MINKEY{sublist\_aux\_of}\verb| ( min::gen v )|
\LABEL{MIN::SUBLIST_AUX_OF} \\
\verb|min::unsgen min::|
    & \MINKEY{indirect\_aux\_of}\verb| ( min::gen v )|
\LABEL{MIN::INDIRECT_AUX_OF} \\
\verb|unsigned min::|
    & \MINKEY{packed\_aux\_of}\verb| ( min::gen v )|
\LABEL{MIN::PACKED_AUX_OF} \\
\verb|unsigned min::|
    & \MINKEY{packed\_index\_of}\verb| ( min::gen v )|
\LABEL{MIN::PACKED_INDEX_OF} \\
\verb|min::unsgen min::| & \MINKEY{index\_of}\verb| ( min::gen v )|
\LABEL{MIN::INDEX_OF} \\
\verb|min::unsgen min::| & \MINKEY{control\_code\_of}\verb| ( min::gen v )|
\LABEL{MIN::CONTROL_CODE_OF} \\
\verb|min::unsgen min::| & \MINKEY{special\_index\_of}\verb| ( min::gen v )|
\LABEL{MIN::SPECIAL_INDEX_OF} \\
\end{tabular}\end{indpar}

Here the \verb|min::uns64| value returned by \minkey{direct\_str\_of}
should be overlaid by a union with a \verb|char[]| buffer, as in
the code:

\begin{indpar}\begin{verbatim}
union { min::uns64 str; char buf[6]; } u;
min::gen v;
. . . set v to a direct string value . . .
u.str = min::direct_str_of ( v );
cout << u.buf;
\end{verbatim}\end{indpar}

The {\tt min::direct\_str\_of} function merely copies the 3 or
5 {\tt char}'s of the {\tt min::gen} direct string value and
appends a NUL character.
It does this by writing an appropriate value into \verb|u.str|.

The \verb|min::|\ldots\verb|_aux_of| other than
\verb|min::packed_aux_of|, the \verb|min::index_of| function,
the \verb|min::control_code_of| function,
and the {\tt min::\EOL spec\-ial\_\EOL index\_\EOL of} function all
return a 24-bit\COMPACT or 40-bit\LOOSE unsigned integer as a
{\tt min::unsgen} value.

The \verb|min::packed_aux_of| and \verb|min::packed_index_of| functions
both return 12-bit unsigned integers when general values are 32-bits, and
20-bit unsigned integers when general values are 64-bits.

The following unprotected functions return the value appropriate for a given
subtype, \underline{without} checking the subtype:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::stub * MUP::| & \MUPKEY{stub\_of}\verb| ( min::gen v )|
\LABEL{MUP::STUB_OF} \\
\verb|min::float64 MUP::|
    & \MUPKEY{direct\_float\_of\LOOSE}\verb| ( min::gen v )|
\LABEL{MUP::DIRECT_FLOAT_OF} \\
\verb|min::int32 MUP::| & \MUPKEY{direct\_int\_of\COMPACT}\verb| ( min::gen v )|
\LABEL{MUP::DIRECT_INT_OF} \\
\verb|min::uns64 MUP::| & \MUPKEY{direct\_str\_of}\verb| ( min::gen v )|
\LABEL{MUP::DIRECT_STR_OF} \\
\verb|min::unsgen MUP::| & \MUPKEY{list\_aux\_of}\verb| ( min::gen v )|
\LABEL{MUP::LIST_AUX_OF} \\
\verb|min::unsgen MUP::| & \MUPKEY{sublist\_aux\_of}\verb| ( min::gen v )|
\LABEL{MUP::SUBLIST_AUX_OF} \\
\verb|min::unsgen MUP::|
    & \MUPKEY{indirect\_aux\_of}\verb| ( min::gen v )|
\LABEL{MUP::INDIRECT_AUX_OF} \\
\verb|unsigned MUP::|
    & \MUPKEY{packed\_aux\_of}\verb| ( min::gen v )|
\LABEL{MUP::PACKED_AUX_OF} \\
\verb|unsigned MUP::|
    & \MUPKEY{packed\_index\_of}\verb| ( min::gen v )|
\LABEL{MUP::PACKED_INDEX_OF} \\
\verb|min::unsgen MUP::| & \MUPKEY{index\_of}\verb| ( min::gen v )|
\LABEL{MUP::INDEX_OF} \\
\verb|min::unsgen MUP::| & \MUPKEY{control\_code\_of}\verb| ( min::gen v )|
\LABEL{MUP::CONTROL_CODE_OF} \\
\verb|min::unsgen MUP::| & \MUPKEY{special\_index\_of}\verb| ( min::gen v )|
\LABEL{MUP::SPECIAL_INDEX_OF} \\
\end{tabular}\end{indpar}

Note that \verb|MUP::stub_of| returns a `\verb|min::stub *|' pointer
whereas \verb|min::stub_of| returns a `\verb|const min::stub *|' pointer.

New {\tt min::gen} values can be generated by the following protected
functions:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::gen min::| & \MINKEY{new\_gen}\verb| ( const min::stub * s )|
\LABEL{MIN::NEW_GEN_OF_STUB} \\
\verb|min::gen min::|
    & \MINKEY{new\_direct\_float\_gen\LOOSE}\verb| ( min::float64 v )|
\LABEL{MIN::NEW_DIRECT_FLOAT_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_direct\_int\_gen\COMPACT}\verb| ( int v )|
\LABEL{MIN::NEW_DIRECT_INT_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_direct\_str\_gen}\verb| ( const char * p )|
\LABEL{MIN::NEW_DIRECT_STR_GEN} \\
\verb|min::gen min::|
    & \MINKEY{new\_direct\_str\_gen}\verb| ( const char * p, unsigned n )|
\LABEL{MIN::NEW_DIRECT_STR_GEN_WITH_N} \\
\verb|min::gen min::| & \MINKEY{new\_list\_aux\_gen}\verb| ( min::unsgen p )|
\LABEL{MIN::NEW_LIST_AUX_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_sublist\_aux\_gen}\verb| ( min::unsgen p )|
\LABEL{MIN::NEW_SUBLIST_AUX_GEN} \\
\verb|min::gen min::|
    & \MINKEY{new\_indirect\_aux\_gen}\verb| ( min::unsgen p )|
\LABEL{MIN::NEW_INDIRECT_AUX_GEN} \\
\verb|min::gen min::|
    & \MINKEY{new\_packed\_aux\_gen}%
      \verb| ( unsigned p, unsigned i )|
\LABEL{MIN::NEW_PACKED_AUX_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_index\_gen}\verb| ( min::unsgen i )|
\LABEL{MIN::NEW_INDEX_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_control\_code\_gen}\verb| ( min::unsgen c )|
\LABEL{MIN::NEW_CONTROL_CODE_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_special\_gen}\verb| ( min::unsgen i )|
\LABEL{MIN::NEW_SPECIAL_GEN} \\
\end{tabular}\end{indpar}

These protected functions check for argument range errors.  Stubs are
\underline{not} allocated by these functions, so an {\tt int}
argument to {\tt min::new\_direct\_int\_gen\COMPACT} must fit in 28 bits,
and the {\tt const char *} strings must be short enough to
fit into a direct string.  For {\tt min::new\_\EOL direct\_\EOL str\_\EOL gen}
with a second argument \verb|n|, a string longer than \verb|n| characters
is shortened to \verb|n| characters (analogously to \verb|strncpy| and
\verb|strncmp|).
The {\tt min::unsgen} arguments used to make auxiliary pointers, indices,
control codes, and special values must fit within {\tt min::VSIZE} bits.
The {\tt unsigned} arguments used to make {\tt min::new\_packed\_aux\_gen}
values must fit within {\tt min::VSIZE/2} bits.

The subtype codes used for 64-bit {\tt min::gen} direct string, stub pointer,
auxiliary pointer, index, control code, and special values
-- that is, all the non-numeric \verb|min::gen| values --
are chosen to avoid being the same as the high order bits of any
IEEE floating point number normally generated by the compiler,
run-time system, or program execution.  A {\tt min::float64}
input to {\tt min::new\_direct\_\EOL float\_\EOL gen} is assumed not to have
these subtype
codes, and no check is made for such, even by range-checking protected
functions.

The following unprotected functions are analogous but do not check for
range errors.

\begin{indpar}
\verb|min::gen MUP::|\MUPKEY{new\_gen}\verb| ( min::stub * s )|
\LABEL{MUP::NEW_GEN_OF_STUB} \\
\verb|min::gen MUP::|\MUPKEY{new\_direct\_float\_gen\LOOSE}%
    \verb| ( min::float64 v )|
\LABEL{MUP::NEW_DIRECT_FLOAT_GEN} \\
\verb|min::gen MUP::|\MUPKEY{new\_direct\_int\_gen\COMPACT}\verb| ( int v )|
\LABEL{MUP::NEW_DIRECT_INT_GEN} \\
\verb|min::gen MUP::|\MUPKEY{new\_direct\_str\_gen}\verb| ( const char * p )|
\LABEL{MUP::NEW_DIRECT_STR_GEN} \\
\verb|min::gen MUP::|\MUPKEY{new\_direct\_str\_gen}%
    \verb| ( const char * p, unsigned n )|
\LABEL{MUP::NEW_DIRECT_STR_GEN_WITH_N} \\
\verb|min::gen MUP::|\MUPKEY{new\_list\_aux\_gen}\verb| ( min::unsgen p )|
\LABEL{MUP::NEW_LIST_AUX_GEN} \\
\verb|min::gen MUP::|\MUPKEY{new\_sublist\_aux\_gen}\verb| ( min::unsgen p )|
\LABEL{MUP::NEW_SUBLIST_AUX_GEN} \\
\verb|min::gen MUP::|\MUPKEY{new\_indirect\_aux\_gen}\verb| ( min::unsgen p )|
\LABEL{MUP::NEW_INDIRECT_AUX_GEN} \\
\verb|min::gen MUP::|\MUPKEY{new\_packed\_aux\_gen}%
      \verb| ( unsigned p, unsigned i )|
\LABEL{MUP::NEW_PACKED_AUX_GEN} \\
\verb|min::gen MUP::|\MUPKEY{new\_index\_gen}\verb| ( min::unsgen i )|
\LABEL{MUP::NEW_INDEX_GEN} \\
\verb|min::gen MUP::|\MUPKEY{new\_control\_code\_gen}\verb| ( min::unsgen c )|
\LABEL{MUP::NEW_CONTROL_CODE_GEN} \\
\verb|min::gen MUP::|\MUPKEY{new\_special\_gen}\verb| ( min::unsgen i )|
\LABEL{MUP::NEW_SPECIAL_GEN}
\end{indpar}

The following unprotected functions can be used to replace the data
(non-subtype) part of a \verb|min::gen| value that is \underline{not}
a pointer to a stub or a number (direct float or direct integer).
The intended use is for changing the value of an auxiliary pointer
in a general value, or the flags in a condition code.

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::gen MUP::|
    & \MUPKEY{renew\_gen}\verb| ( min::gen v, min::unsgen p )|
\LABEL{MUP::RENEW_GEN} \\
\verb|min::gen MUP::|
    & \MUPKEY{renew\_packed\_aux\_gen}\verb| ( min::gen v, unsigned p )|
\LABEL{MUP::RENEW_PACKED_AUX_GEN}
\end{tabular}\end{indpar}

The second function replaces just the auxiliary pointer in a packed
indirect auxiliary pointer \verb|min::gen| value.

The actual direct atom, stub pointer, auxiliary pointer, index,
and control code
{\tt min::gen} subtype codes
are implementation dependent.  The following constants equal these
subtype codes:

\begin{indpar}
\verb|const unsigned min::|\MINKEY{GEN\_STUB}
\LABEL{MIN::GEN_STUB} \\
\verb|const unsigned min::|\MINKEY{GEN\_DIRECT\_FLOAT\LOOSE}
\LABEL{MIN::GEN_DIRECT_FLOAT} \\
\verb|const unsigned min::|\MINKEY{GEN\_DIRECT\_INT\COMPACT}
\LABEL{MIN::GEN_DIRECT_INT} \\
\verb|const unsigned min::|\MINKEY{GEN\_DIRECT\_STR}
\LABEL{MIN::GEN_DIRECT_STR} \\
\verb|const unsigned min::|\MINKEY{GEN\_LIST\_AUX}
\LABEL{MIN::GEN_LIST_AUX} \\
\verb|const unsigned min::|\MINKEY{GEN\_SUBLIST\_AUX}
\LABEL{MIN::GEN_SUBLIST_AUX} \\
\verb|const unsigned min::|\MINKEY{GEN\_INDIRECT\_AUX}
\LABEL{MIN::GEN_INDIRECT_AUX} \\
\verb|const unsigned min::|\MINKEY{GEN\_PACKED\_AUX}
\LABEL{MIN::GEN_PACKED_AUX} \\
\verb|const unsigned min::|\MINKEY{GEN\_INDEX}
\LABEL{MIN::GEN_INDEX} \\
\verb|const unsigned min::|\MINKEY{GEN\_CONTROL\_CODE}
\LABEL{MIN::GEN_CONTROL_CODE} \\
\verb|const unsigned min::|\MINKEY{GEN\_SPECIAL}
\LABEL{MIN::GEN_SPECIAL} \\
\verb|const unsigned min::|\MINKEY{GEN\_ILLEGAL}
\LABEL{MIN::GEN_ILLEGAL}
\end{indpar}

\verb|min::GEN_ILLEGAL| is actually illegal as a subtype code but may
be returned by the following function which be used to retrieve
the subtype code field:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|unsigned min::| & \MINKEY{gen\_subtype\_of}\verb| ( min::gen v )|
\LABEL{MIN::GEN_SUBTYPE_OF} \\
\end{tabular}\end{indpar}

For 64-bit \verb|min::gen| values, this retrieves the high order
24 bits of the value, and then zeros any low order bits that are not
part of the subtype code (that is, the 64-bits are right shifted by
40 bits and then bits of the result that are not part of the
subtype, such as bits in a number, are zeroed).
For 32-bit \verb|min::gen| values, this retrieves
the high order 8 bits, and then zeros any low order bits that are not
part of the subtype code (similarly the 32-bits are right shifted by
24 bits, etc.).
\verb|min::GEN_ILLEGAL| is returned by this function if the \verb|min::gen|
value is not a legal general value.

There are a few more general value functions that accept any \verb|min::gen|
value:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|bool min::| & \MINKEY{is\_name}\verb| ( min::gen v )|
\LABEL{MIN::IS_NAME} \\
\verb|min::uns32 min::| & \MINKEY{hash}\verb| ( min::gen v )|
\LABEL{MIN::HASH} \\
\end{tabular}\end{indpar}

The \verb|min::is_name| function returns true if and only if its argument is
an immutable value that has a hash value and therefore can be used as
a \key{name component}.  More specifically,
\verb|min::is_name| returns true if and only if its argument is
a number (\secref{NUMBERS}),
a string (\secref{STRINGS}),
or a label (\secref{LABELS}), i.e., is an atom or a label.
The \verb|min::hash| function returns a non-zero
\key{hash value}\label{HASH-VALUE} if its argument
is usable as a name component, and returns zero otherwise.

\subsection{Special Values}
\label{SPECIAL-VALUES}

Special general values are \verb|min::gen| values that are unique
and not equal to any value that can be generated during
program execution.  Special general values are C/C++ {\tt const}
values, and are never to be used unless documentation specifies
a specific use.  They are used as return or argument
values by some functions.

The special values defined by MIN are:

\begin{indpar}
\begin{list}{}{}
\item[{\tt const min::gen min::}\MINKEY{MISSING}]~%
	\LABEL{MIN::MISSING}\\
Denotes a missing value or an empty set of values, and may be input
or output and used as an attribute value.
\item[{\tt const min::gen min::}\MINKEY{NONE}]~%
	\LABEL{MIN::NONE}\\
Denotes a non-existent function value or result, and may not be
input or output or used as an attribute value or label.
\item[{\tt const min::gen min::}\MINKEY{ANY}]~%
	\LABEL{MIN::ANY}\\
Denotes any value from a set of values.
\item[{\tt const min::gen min::}\MINKEY{MULTI\_VALUED}]~%
	\LABEL{MIN::MULTI_VALUED}\\
Indicates a set of values has more than one element.
\item[{\tt const min::gen min::}\MINKEY{UNDEFINED}]~%
	\LABEL{MIN::UNDEFINED}\\
A value given to an object variable vector element
(\secref{OBJECT-INDIRECT-POINTERS}) that has no value and can be indirected.
\item[{\tt const min::gen min::}\MINKEY{SUCCESS}]~%
	\LABEL{MIN::SUCCESS}\\
A value returned to indicate a function has succeeded.
\item[{\tt const min::gen min::}\MINKEY{FAILURE}]~%
	\LABEL{MIN::FAILURE}\\
A value returned to indicate a function has failed.
\end{list}
\end{indpar}

Special general values each have a unique \ikey{index}{of special value}
that identifies them relative to other special values.  These
indices are in the range $0$ through $2^{24}-1$.  The last 256 indices of this
range, $2^{24}-256$ through $2^{24}-1$ are reserved for use by the MIN
system.  Other special values can be created by other systems,
and indices near 0 are reserved for non-system users.

For efficiency reasons it is desirable for special values to be
compile time constants.  Because compilers generally do not run
inline functions at compile time, a macro is needed to compute special
values.  This macro is

\begin{indpar}\begin{tabular}{r@{}l}
\verb|(macro) min::gen |
	& \TTNBKEY{MIN\_NEW\_SPECIAL\_GEN}\verb| ( i )|
\LABEL{MIN_NEW_SPECIAL_GEN} \\
\end{tabular}\end{indpar}

where \verb|i| is the index of the special value to be
created, and must be an unsigned integer compile time constant
expression.  This macro does \underline{not} check the range
of the index, and is unprotected in this sense.  A typical usage
would be

\begin{indpar}\begin{verbatim}
const min::gen MISSING = MIN_NEW_SPECIAL_GEN ( 0xFFFFFF );
\end{verbatim}\end{indpar}


\subsection{Stubs}
\label{STUBS}

General values may point at object stubs, which are 16 byte structures
that are \underline{not} relocated during execution.
Some stubs have pointers to object bodies, which can be
relocated during execution, either
because the object is being expanded or contracted, or because
memory is being compacted.

A stub contains an 8 byte stub value and an 8 byte stub control.

If the stub control is viewed as a 64 bit integer, its high order byte
is the type code.  The high order bit of this type code,
which is the high order
bit of the 64 bit stub control integer, is off if the stub is managed by
the allocator/collector/compactor (acc, of which the garbage collector is
a part).  In this case the stub is said to be `\key{collectible}'.
In the other case, where the bit is on, the stub is
said to be `\key{uncollectible}', and the stub is allocated and freed
by explicit calls to the acc, but is not garbage collected or compacted by the
acc.

If an stub has a body, its stub value is a pointer at that body.
Any pointer into a body is called a `body pointer'.

\subsubsection{Stub Type Codes}
\label{STUB-TYPE-CODES}

The \key{type code} of a stub may be returned by

\begin{indpar}\begin{tabular}{r@{}l}
\verb|int min::| & \MINKEY{type\_of}\verb| ( const min::stub * s )|
\LABEL{MIN::TYPE_OF}
\end{tabular}\end{indpar}

A determination of whether or not a stub is collectible may be made
by applying the function

\begin{indpar}\begin{tabular}{r@{}l}
\verb|bool min::| & \MINKEY{is\_collectible}\verb| ( int type )|
\LABEL{MIN::IS_COLLECTIBLE}
\end{tabular}\end{indpar}

to the type code of the stub.  Notice that type codes are \underline{signed}
integers, so that negative type codes are uncollectible and positive type codes
are collectible.

A partial list of stub type codes is:

\begin{indpar}
\begin{list}{}{}
\item[{\tt const int min::NUMBER}]~\\
Stub value is an IEEE 64-bit floating point number.
\item[{\tt const int min::SHORT\_STR}]~\\
Stub value is 0-8 \verb|const char| string, NUL padded.
\item[{\tt const int min::LONG\_STR}]~\\
Stub value is a pointer at a body of type {\tt min::long\_\EOL string}
that contains a \verb|const char| vector and its size. 
\item[{\tt const int min::DEALLOCATED}]~\\
Stub has a deallocated body.
\end{list}
\end{indpar}

A full list of stub type codes complete with page references
is given on \pagref{STUB-TYPE-CODE-LIST}.

\subsubsection{Stub Values}
\label{STUB-VALUES}

A stub contains a 64-bit \key{stub value}.  If the stub is collectible
(as determined by its type), the type of this value
is determined by the stub type code (\secref{STUB-TYPE-CODES}).
Otherwise the stub is typically attached to an object and the type of the stub
value is determined by how it is attached; in this case the type of the
stub value is most often just \verb|min::gen|.

Many stubs are immutable
and their stub values cannot be written after the stub has been created;
nevertheless we describe unprotected functions
below (\secref{UNPROTECTED-STUB-FUNCTIONS}) that
write these values.  Unprotected functions are also provided to obtain
body pointers from stubs when these are the stub values of the stubs.
This cannot be done by protected
functions as body pointers are relocatable and require special
programming be sure they are up-to-date (\secref{BODY-POINTERS}).

\subsubsection{Stub Control}
\label{STUB-CONTROL}

A stub contains a 64-bit \key{stub control}.  The high order 8 bits
of this is the stub type code, and the high order bit of this type
code determines whether the stub is collectible (bit is off)
or uncollectible (bit is on).

If the stub is collectible,
the stub control is used exclusively by the acc,
except for the type code, which is shared between the acc
and the rest of the system.  Such a control word is called
an `\key{acc control}\,'.  A typical (but not required)
organization of an acc control is:

\begin{center}
\begin{tabular}{ll}
high order 8 bits:	& type code \\
next 12-24 bits:	& acc flags \\
low order 44-32 bits:	& chain pointer \\
\end{tabular}
\end{center}

Here the chain pointer is a packed stub address
(see \pagref{STUB-ADDRESS-PACKING})
that is used to build lists of allocated stubs which
the acc manages.

If a stub is uncollectible, its stub control, which is called
a `\key{non-acc control}\,', can be organized in different
ways according to the type code value.  The standard way of organizing
a non-acc control is:

\begin{center}
\begin{tabular}{ll}
high order 8 bits:	& type code \\
next 8 bits:		& subtype code \\
low order 48 bits:	& chain pointer \\
\end{tabular}
\end{center}

Again the chain pointer is a packed stub address
(see \pagref{STUB-ADDRESS-PACKING}),
but now it has enough bits to be packed with the fastest packing scheme.

The main use of uncollectible stubs is as auxiliary stubs.
An `\key{auxiliary stub}' is an uncollectible stub attached to an object.
When the object is garbage collected, the auxiliary stub is freed.  Auxiliary
stubs are a means of adding memory to an object without relocating the object.
For example, if the object stores 64-bit IEEE floating point numbers,
a chain of auxiliary stubs can be used to add memory to the object
for additional numbers.  Note that the auxiliary stub itself does not
contain information that tells the type of the value it stores;
one has to trace the reference from the object pointing at the
auxiliary stub to determine this type.  Usually auxiliary stub
values are \verb|min::gen| values.  See \secref{UNPROTECTED-STUB-FUNCTIONS}
for functions that can read and write auxiliary stubs.

\subsection{Body Pointers}
\label{BODY-POINTERS}

Object bodies are relocatable
(\pagref{RELOCATABLE-BODY}) and and pointers into object bodies,
called \skey{body pointer}s,
require special handling to
ensure that they are up-to-date.  There are two ways of managing
this: the protected way and the unprotected way.

Note also that deallocation of a body is treated as
reallocation of the body to inaccessible virtual memory.

\subsubsection{Protected Body Pointers}
\label{PROTECTED-BODY-POINTERS}

The protected way of handling body pointers
uses special pointer data that is adapted to
the type of datum being pointed at.  For example, the following
code can access any string:
\begin{indpar}\begin{verbatim}
min::gen x = . . .  // set x to some string
assert ( min::is_str ( x ) );
min::str_pointer xp ( x );
int length = min::strlen ( xp );
for ( int i = 0; i < length; ++ i )
{
    . . . xp[i] . . .
}
\end{verbatim}\end{indpar}

Here the \verb|str_pointer| datum is a \key{protected body pointer}.
For strings that are long enough to have a body, the
\verb|str_pointer| stores a pointer to the stub of the string,
and `\verb|xp[i]|' is an inline function that expands to
code that reads the body pointer from the stub and adds both
an appropriate constant offset and then the index `\verb|i|'
to that pointer in order to get the address of the character.

It might be thought that this is inefficient as the body pointer
is re-read from the stub for every different iteration of the `\verb|for|'
loop.  However, if no out-of-line functions are called in the
loop, an optimizing compiler will very often be able to eliminate
the excess reads and load the body pointer plus constant offset
into a register before the loop begins.  The key here is to
avoid out-of-line function calls, as for each such call the
optimizer must assume that the body pointer in the stub might
change.

Protected pointer types are provided for each type of object
that has a body.

\subsubsection{Unprotected Body Pointers}
\label{UNPROTECTED-BODY-POINTERS}

\ikey{Unprotected body pointers}{unprotected body pointer}%
\index{pointer!unprotected body}\index{body pointer!unprotected}
are C/C++ pointers that point directly into a body.
Functions that obtain body unprotected
pointers from stubs are unprotected (\verb|MUP|) functions because
the unprotected body pointers they return are invalidated
if the body pointed at
is relocated.

In order to track possible relocation,
names of functions that might relocate bodies are marked
with the superscript {\REL} in this document.
Relocation can only happen inside such \skey{relocating function}s
(\pagref{RELOCATING-FUNCTIONS}).

The following uses unprotected body pointers to point at a character
string stored in a body:
\begin{indpar}\begin{verbatim}
min::gen x = . . .  // set x to some long string
assert ( min::is_stub ( x ) );
const min::stub * xstub = min::stub_of ( x );
assert ( min::type_of ( xstub ) == min::LONG_STR );
MUP::long_str * xstr = MUP::long_str_of ( xstub );
const char * xp = MUP::str_of ( xstr );
int length = MUP::length_of ( xstr );
for ( int i = 0; i < length; ++ i )
{
    // Relocating functions must NOT be called in this loop.
    . . . xp[i] . . .
}
\end{verbatim}\end{indpar}

Strings are in fact of three types, `direct' which stores characters
in the general value, `short' which stores up to 8 characters in the stub
value, and `long' which stores more than 8 characters in the body.  The
above code only works for long strings (\pagref{LONG-STRING-STUB}).


When relocation happens inside a relocating function,
the `\key{relocated flag}\,'\label{RELOCATED-FLAG},
which is one of the execution flags
described in~\secref{EXECUTION-FLAGS}, is set.
Functions that use unprotected pointers must obey the following
protocol:

\begin{indpar}
save the relocated flag \\
\ldots\ldots \\
compute local variables containing unprotected body pointers \\
use these local varibles \\
\ldots\ldots \\
to call a relocating function: \\
\hspace*{3em}\begin{tabular}{l}
    clear the relocated flag and call the relocating function \\
    if the relocated flag is now set: \\
    \hspace*{3em}\begin{tabular}{l}
	optionally check that object bodies pointed at \\
	\hspace*{3em}have not been deallocated (see \secref{DEALLOCATION}) \\
	set the saved relocated flag \\
	recompute all local variables containing unprotected body pointers \\
    \end{tabular} \\
\end{tabular} \\
\ldots\ldots \\
restore the saved relocated flag
\end{indpar}

When a function that calls relocating functions returns to its caller,
it must set the relocated
flag if that flag was set when the function started or if the
flag was set during function execution.

Relocating functions update body pointers that are not stored
in local variables, in particular those stored in stubs.
The local variables must then be recomputed from the pointers stored in
the stubs.

If a stub body is deallocated by a relocating function,
the stub's type will be changed to
\verb|min::DEALLOCATED|, and the body will be relocated to inaccessible
virtual memory so references to it will cause program terminating
memory fault.  For many stubs, this is the only possible 
type change.  However some bodies may not only be relocated, but
may be reorganized, causing their stub to change type.  An example
is objects, which can have stub type \verb|min::SHORT_OBJ| or
\verb|min::LONG_OBJ|, and may be reorganized during relocation to
become more compact.  Usually such stubs are marked when they
are in use by a function that calls relocating functions so that
they will not change type (except for deallocation) and their
bodies will not be reorganized.  For example, objects have a state
which indicates if protected object pointers are pointing at the
object.

If the example above is modified to call a relocating function
in its loop, the resulting code would be:
\begin{indpar}\begin{verbatim}
min::gen x = . . .  // set x to some long string
assert ( min::is_stub ( x ) );
const min::stub * xstub = min::stub_of ( x );
assert ( min::type_of ( xstub ) == min::LONG_STR );
MUP::long_str * xstr = MUP::long_str_of ( xstub );
const char * xp = MUP::str_of ( xstr );
int length = MUP::length_of ( xstr );
bool relocated = min::set_relocated_flag ( false );
for ( int i = 0; i < length; ++ i )
{
    . . . xp[i] . . .
    some_relocating_function ( . . . );
    if ( min::set_relocated_flag( false ) )
    {
        relocated = true;
        assert ( ! is_deallocated ( xstub ) );
        xstr = MUP::long_str_of ( xstub );
        xp = MUP::str_of ( xstr );
    }
    . . . xp[i] . . .
}
min::set_relocated_flag ( relocated );
\end{verbatim}\end{indpar}

The following functions get and set the relocated flag:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|bool min::| & \MINKEY{relocated\_flag}\verb| ( void )|
\LABEL{MIN::RELOCATED_FLAG} \\
\verb|bool min::| & \MINKEY{set\_relocated\_flag}\verb| ( bool value )|
\LABEL{MIN::SET_RELOCATED_FLAG}
\end{tabular}\end{indpar}

The function to set the flag returns the flag's previous value.

A function that computes an unprotected pointer into a stub body does not
check the type code of the stub pointing at the body.  The type
code must be checked separately before the pointer is computed.  If the
pointer is being recomputed after possible relocation, the stub type
code may have to be checked.  For most stub types, the only check
required relates to the possibility that the boty has been deallocated.

Code to handle relocating function calls and unprotected body
pointers has the general form:

\begin{indpar}\begin{verbatim}
... some_function ( ... )
{
    bool relocated = min::set_relocated_flag ( false );
    . . . . .
    const min::stub * s = min::stub_of ( ... );
    . . . . .
    assert ( ... == type_of ( s ) );
    MUP::some_body_type * p =
        MUP::some_function_returning_a_body_pointer ( s );
    . . . . . use p . . . . .
    some_relocating_function ( ... );
    if ( min::set_relocated_flag( false ) )
    {
        relocated = true;
        assert ( ! is_deallocated ( s ) );
        p = MUP::some_function_returning_a_body_pointer ( s );
    }
    . . . . . use p . . . . .
    min::set_relocated_flag ( relocated );
    return ...;
}
\end{verbatim}\end{indpar}

To simplify this code, the following is defined:

\begin{indpar}\begin{verbatim}
class min::relocated
{
public:
    bool relocated_flag;
    relocated ( void )
    {
        relocated_flag = min::set_relocated_flag ( false );
    }
    ~ relocated ( void )
    {
        min::set_relocated_flag ( relocated_flag );
    }
    operator bool ()
    {
        if ( min::set_relocated_flag ( false ) )
            return relocated_flag = true;
        else
            return false;
    }
}
\end{verbatim}\end{indpar}

which permits the general code given above to be rewritten more conveniently
as:

\begin{indpar}\begin{verbatim}
... some_function ( ... )
{
    // relocated constructor saves the relocated flag.
    min::relocated relocated;
    . . . . .
    const min::stub * s = min::stub_of ( ... );
    . . . . .
    assert ( ... == type_of ( s ) );
    MUP::some_body_type * p =
        MUP::some_function_returning_a_body_pointer ( s );
    . . . . . use p . . . . .
    some_relocating_function ( ... );
    if ( relocated )
    {
        assert ( ! is_deallocated ( s ) );
        p = MUP::some_function_returning_a_body_pointer ( s );
    }
    . . . . . use p . . . . .
    return ...;
    // relocated deconstructor restores relocated flag.
}
\end{verbatim}\end{indpar}

\subsubsection{Deallocation}
\label{DEALLOCATION}

The operation of \ikey{deallocating a body}{deallocate!body}\index{deallocation}
is considered to be a relocation of the body.  The body pointer in the
stub is pointed at inaccessible virtual memory, and the type code in the stub
is set to {\tt min::DEALLOCATED} (\pagref{MIN::DEALLOCATED}).

The following function tests whether a stub
has a deallocated body:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|bool min::| & \MINKEY{is\_deallocated}\verb| ( const min::stub * s )|
\LABEL{MIN::IS_DEALLOCATED}
\end{tabular}\end{indpar}

This function just checks the stub type code to see if it equals
{\tt min::DEALLOCATED} (\pagref{MIN::DEALLOCATED}).

A check that a body has not been deallocated may be needed before
a pointer into the body is recomputed after a relocating function has
been called.  Using a deallocated body is
considered to be a fatal programming error, so often no check is necessary,
as a program that uses a deallocated body simply
crashes when it tries to access the inaccessible
virtual memory.

In some implementations there is a limit to the size of inaccessible memory.
These implementations define the macro:

\begin{indpar}\begin{tabular}{r@{}l}
(unsigned integer macro)~~ & \TTNBKEY{MIN\_DEALLOCATED\_LIMIT}
\LABEL{MIN_DEALLOCATED_LIMIT}
\end{tabular}\end{indpar}

to be the maximum size of inaccessible memory to which the stub of
a deallocated object is pointed.  If this macro is undefined, there
is no limit.  If the macro is defined, an attempt to
access any part of a deallocated body beyond the specified limit
will give undefined results.

The \verb|MIN_DEALLOCATED_LIMIT|
macro is generally left undefined for implementations
with 64 bit addresses, but may be defined for implementations with
32 bit addresses in order to conserve virtual memory.

\subsection{Allocator/Collector/Compactor Interface}
\label{ACC-INTERFACE}

If you are implementing a new type of stub and maybe bodies
associated with that stub type, you need to use the unprotected
interface described in this section and its subsections.
You need to be able to allocate stubs, read and write stub values,
and read and write stub types.  If you are allocating non-acc
stubs (i.e., stubs that are not garbage collected), then you
also need to be able to read and write the entire stub control
and to free the stubs.
If your stubs have bodies, you need to be able to allocate,
relocate, and deallocate the bodies.  When you write general
values into stubs or bodies, you need to call an acc function
to update garbage collection flags associated with stubs.

\subsubsection{Unprotected Stub Functions}
\label{UNPROTECTED-STUB-FUNCTIONS}

There are unprotected functions to allocate and free stubs, 
read and write stub values, and read, write, and modify
stub controls.


\subsubsubsection{Stub Allocation Functions}
\label{STUB-ALLOCATION-FUNCTIONS}

The following functions are used to allocate stubs:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::stub * MUP::| & \MUPKEY{new\_acc\_stub}\verb| ( void )|
\LABEL{MUP::NEW_ACC_STUB} \\
\verb|min::stub * MUP::| & \MUPKEY{new\_aux\_stub}\verb| ( void )|
\LABEL{MUP::NEW_AUX_STUB} \\
\end{tabular}\end{indpar}

The \verb|min::new_acc_stub| function returns a garbage collectable (acc)
stub with its type set to \minkey{ACC\_FREE}.  This kind of stub is
automatically freed by the garbage collector.  Its address must be
stored in a \verb|min::gen| value that is protected from garbage
collection by being accessible from a \verb|min::gen_stack|
or \verb|min::gen_root| location.

The \verb|min::new_aux_stub| function returns a non-acc (i.e.,
not garbage collectable)
stub with its type set to \minkey{AUX\_FREE}.  This kind of stub is
is \underline{not} freed by the garbage collector.  It must be
freed only by calling:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|void MUP::| & \MUPKEY{new\_aux\_stub}\verb| ( min::stub * s )|
\LABEL{MUP::FREE_AUX_STUB} \\
\end{tabular}\end{indpar}

A non-acc stub is most often attached to an acc stub in such a way
that when the acc stub is garbage collected, the non-acc stub is
freed.  Such a non-acc stub is called an \key{auxiliary stub}, and
because most non-acc stubs are of this kind, functions dealing with
non-acc stubs have names containing `\ttkey{aux}' instead of
`\verb|non_acc|'.

\subsubsubsection{Stub Value Read/Write Functions}
\label{STUB-VALUE-READ-WRITE-FUNCTIONS}

The following functions read or write the stub value part of a stub:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::uns64 MUP::| & \MUPKEY{value\_of}\verb| ( const min::stub * s )|
\LABEL{MUP::VALUE_OF} \\
\verb|min::float64 MUP::| & \MUPKEY{float\_of}\verb| ( const min::stub * s )|
\LABEL{MUP::FLOAT_OF} \\
\verb|min::gen MUP::| & \MUPKEY{gen\_of}\verb| ( const min::stub * s )|
\LABEL{MUP::GEN_OF} \\
\verb|void * MUP::| & \MUPKEY{pointer\_of}\verb| ( const min::stub * s )|
\LABEL{MUP::POINTER_OF} \\
\verb|void MUP::|
    & \MUPKEY{set\_value\_of}\verb| ( min::stub * s, min::uns64 v )|
\LABEL{MUP::SET_VALUE_OF} \\
\verb|void MUP::|
    & \MUPKEY{set\_float\_of}\verb| ( min::stub * s, min::float64 f )|
\LABEL{MUP::SET_FLOAT_OF} \\
\verb|void MUP::|
    & \MUPKEY{set\_gen\_of}\verb| ( min::stub * s, min::gen v )|
\LABEL{MUP::SET_GEN_OF} \\
\verb|void MUP::|
    & \MUPKEY{set\_pointer\_of}\verb| ( min::stub * s, void * p )|
\LABEL{MUP::SET_POINTER_OF} \\
\end{tabular}\end{indpar}

Thus the stub value can be taken to be of type \verb|min::uns64|,
\verb|min::float64|, \verb|min::gen|, or
of some pointer type.

These functions do \underline{not} check type codes, nor do they check
that values read or written are within legal range for a particular
stub.  Thus a stub value that is not a floating point number can be
read by \verb|MUP::float_of| with undefined results.

\subsubsubsection{Stub Control Functions}
\label{STUB-CONTROL-FUNCTIONS}

The following functions read or write the stub control part of a stub:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::uns64 MUP::| & \MUPKEY{control\_of}\verb| ( const min::stub * s )|
\LABEL{MUP::CONTROL_OF} \\
\verb|int min::| & \MINKEY{type\_of}\verb| ( const min::stub * s )| \\
\verb|bool MUP::|
    & \MUPKEY{test\_flags\_of}%
      \begin{tabular}[t]{@{}l@{}}
      \verb| ( const min::stub * s,| \\
      \verb|   min::uns64 flags )|
      \end{tabular}
\LABEL{MUP::TEST_FLAGS_OF} \\
\verb|void MUP::|
    & \MUPKEY{set\_control\_of}\verb| ( min::stub * s, min::uns64 c )|
\LABEL{MUP::SET_CONTROL_OF} \\
\verb|void MUP::|
    & \MUPKEY{set\_type\_of}\verb| ( min::stub * s, int type )|
\LABEL{MUP::SET_TYPE_OF} \\
\verb|void MUP::|
    & \MUPKEY{set\_flags\_of}\verb| ( min::stub * s, min::uns64 flags )|
\LABEL{MUP::SET_FLAGS_OF} \\
\verb|void MUP::|
    & \MUPKEY{clear\_flags\_of}\verb| ( min::stub * s, min::uns64 flags )|
\LABEL{MUP::CLEAR_FLAGS_OF} \\
\end{tabular}\end{indpar}

The \verb|MUP::control_of| and \verb|MUP::set_control_of| functions
deal with the entire 64 bit stub control value of a stub.  The other
functions deal only with parts.

For acc stubs, only the type part of the control should be read or
written.  The other parts of the control are for use by the
acc, and should not be accessed, in order to be sure that the acc is
independent of other code.

The stub control in a stub is an example of a MIN \key{control value}.
A MIN control value holds a stub address or an unsigned integer
in its low order bits.  It may hold an 8 bit type code in its highest order
bits.  Any bits left over are flag bits.  Control values have type
\verb|min::uns64|.  Control values are used as stub controls, and
may be use in other places, e.g., by the acc to hold pointers from
a block that holds a body back to the stub pointing at the body.

Thus control values contain an address/value low order field, and optional
type code high order field, and flag bits.  There are two kinds of
control values: (ordinary) control values and acc control values.
Ordinary control values
have 48 bits for the address/value field, 8 bits for the type,
and 8 bits for flags.
acc control values have 56 - G bits for a stub address, 8 bits
for the type, and G bits for the acc flags, where G is some value from 8
through 24.  The larger G, the more acc flags, which may permit the
garbage collector to be more efficient.

Addresses stored in a control value must be stub addresses, as only they
can be packed into less than 64 bits.

The control values used as stub controls do have a type code field which
can be read by \verb|min::type_of| (which is protected) and
written by \verb|MUP::set_type_of|.  For stub controls,
acc control values are used with
garbage collectible types, and ordinary control values with
non-garbage-collectible types.

The flag bits are set, cleared, and tested individually.  They are
defined by constants of type \verb|min::uns64|, such as

\begin{indpar}
\begin{list}{}{}
\item[{\tt const min::uns64 MUP::}\MUPKEY{STUB\_ADDRESS}]~%
	\LABEL{MIN::STUB_ADDRESS}\\
Indicates that the address/value field of an ordinary (non-acc)
control holds a stub address.
\end{list}
\end{indpar}

These flag constants are defined by expressions of the form

\begin{center}
\verb|( min::uns64(1) << |$K$\verb| )|
\end{center}

where

\begin{center}
\begin{tabular}{l@{~~~~~}l}
$M\leq K\leq 63$ & if there is no type code field \\
		 & (does not apply to stub controls) \\
$M\leq K\leq 55$ & if there is a type code field \\
\\
\multicolumn{2}{l}{$M$ is the size of the address/value field} \\
\\
$32\leq M\leq 48$ & depending on hardware \\
\end{tabular}
\end{center}

The above functions assume that any flag constants select bits
in a control value that are not inside the address/value field
or inside the type code field.

The flags in the stub control value of a stub can be tested, set, or
cleared by some of the above functions.
The \verb|MUP::test_flags_of| function
returns true if and only if the logical AND of the \verb|flags| arguments
and the flags in the stub's control is non-zero.  The \verb|MUP::set_flags_of|
function sets one or more individual flags by logically ORing its
argument into the stub's control, and the
\verb|MUP::clear_flags_of| function clears flags by logically ANDing
the complement of its argument into the stub's control.

The above functions do \underline{not} check type codes, nor do they check
that values read or written are within legal range for a particular
stub.  Thus a stub control value
can be written by \verb|MUP::set_control_of| even if the written
control datum is incompatible with the garbage collector implementation,
and may produce undefined results when the garbage collector
next executes.  Flag bits must not be inside the address/value field
or inside the type code field.

The high order byte of any control written by \verb|MUP::set_control_of|
is the type code, and the high order bit is clear if the stub is collectible
and set if the stub is uncollectible (\secref{STUB-CONTROL}).
Changing a stub from collectible to uncollectible or vice versa requires
removing or adding the stub to garbage collector lists that are threaded
through the pointer field of the stub control.  So one cannot simply
change the type code field of a stub from collectible to uncollectible
or vice versa.

Ordinary (non-acc) control values can be manipulated by the following functions:

\begin{indpar}\begin{tabular}{@{}r@{}l@{}}
\verb|min::uns64 MUP::|
    & \MUPKEY{new\_control} \\
    & \verb|    ( int type_code, min::uns64 v,| \\
    & \verb|                     min::uns64 flags = 0 )|
\LABEL{MUP::NEW_CONTROL_OF_VALUE} \\
\verb|min::uns64 MUP::|
    & \MUPKEY{new\_control} \\
    & \verb|    ( int type_code, const min::stub * s,| \\
    & \verb|                     min::uns64 flags = 0 )|
\LABEL{MUP::NEW_CONTROL_OF_STUB} \\
\verb|min::uns64 MUP::|
    & \MUPKEY{renew\_control\_value}\verb| ( min::uns64 c, min::uns64 v )|
\LABEL{MUP::RENEW_CONTROL_VALUE} \\
\verb|min::uns64 MUP::|
    & \MUPKEY{renew\_control\_stub} \\
    & \verb|    ( min::uns64 c, const min::stub * s )|
\LABEL{MUP::RENEW_CONTROL_STUB} \\
\verb|min::uns64 MUP::| & \MUPKEY{value\_of\_control}\verb| ( min::uns64 c )|
\LABEL{MUP::VALUE_OF_CONTROL} \\
\verb|min::stub * MUP::| & \MUPKEY{stub\_of\_control}\verb| ( min::uns64 c )|
\LABEL{MUP::STUB_OF_CONTROL} \\
\end{tabular}\end{indpar}

Acc control values can be manipulated by the following functions
(this is only done by acc code):

\begin{indpar}\begin{tabular}{@{}r@{}l@{}}
\verb|min::uns64 MUP::|
    & \MUPKEY{new\_acc\_control} \\
    & \verb|    ( int type_code, const min::stub * s,| \\
    & \verb|                     min::uns64 flags = 0 )|
\LABEL{MUP::NEW_ACC_CONTROL_OF_STUB} \\
\verb|min::uns64 MUP::|
    & \MUPKEY{renew\_acc\_control\_stub} \\
    & \verb|    ( min::uns64 c, const min::stub * s )|
\LABEL{MUP::RENEW_ACC_CONTROL_STUB} \\
\verb|min::stub * MUP::|
    & \MUPKEY{stub\_of\_acc\_control}\verb| ( min::uns64 c )|
\LABEL{MUP::STUB_OF_ACC_CONTROL} \\
\end{tabular}\end{indpar}

Either ordinary or acc control values can be
manipulated by the following functions:

\begin{indpar}\begin{tabular}{@{}r@{}l@{}}
\verb|min::uns64 MUP::|
    & \MUPKEY{renew\_control\_type}\verb| ( min::uns64 c, int type )|
\LABEL{MUP::RENEW_CONTROL_TYPE} \\
\verb|int MUP::| & \MUPKEY{type\_of\_control}\verb| ( min::uns64 c )|
\LABEL{MUP::TYPE_OF_CONTROL} \\
\end{tabular}\end{indpar}

Here the 8-bit type code is represented as an {\tt int} in
the range from $-128$ through $127$.
The `{\tt new}' functions compute a control value,
the `{\tt renew}' functions modify control values
by inserting a new type, value, or stub address, and
the other functions return the parts of a control value.
None of these functions check the ranges of their arguments.

\subsubsection{Unprotected Body Functions}
\label{UNPROTECTED-BODY-FUNCTIONS}

The following functions allocate and free bodies:

\begin{indpar}\begin{tabular}{@{}r@{}l@{}}
\verb|void MUP::|
    & \MUPKEY{new\_body}\verb| ( min::stub * s, unsigned n )|
\LABEL{MUP::NEW_BODY} \\
\end{tabular}\end{indpar}

\begin{indpar}\begin{tabular}{@{}r@{}l@{}}
\verb|void MUP::|
    & \MUPKEY{free\_body}\verb| ( min::stub * s, unsigned n )|
\LABEL{MUP::FREE_BODY} \\
\end{tabular}\end{indpar}

\subsection{Numbers}
\label{NUMBERS}

A \key{number stub} is collectible, has \minnbkey{NUMBER}\LABEL{MIN::NUMBER}
stub type code, and has
an immutable \verb|min::float64| stub value that can be read by

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::float64 min::|
    & \MINKEY{float\_of\COMPACT}\verb| ( const min::stub * s )|
\LABEL{MIN::FLOAT_OF} \\
\end{tabular}\end{indpar}

Number stubs exist only in compact implementations;
in loose implementations number atoms are stored exclusively
in direct number general values
(\secref{GENERAL-VALUE-SUBTYPES}).

General values that are numbers can be tested, created, and read
by the following protected functions:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|bool min::| & \MINKEY{is\_num}\verb| ( min::gen v )|
\LABEL{MIN::IS_NUM} \\[1ex]
\verb|min::gen min::|
    & \MINKEY{new\_num\_gen\REL} \verb| ( int v )|
\LABEL{MIN::NEW_NUM_GEN_OF_INT} \\
\verb|min::gen min::|
    & \MINKEY{new\_num\_gen\REL} \verb| ( min::float64 v )|
\LABEL{MIN::NEW_NUM_GEN_OF_FLOAT64} \\[1ex]
\verb|int min::| & \MINKEY{int\_of}\verb| ( min::gen v )|
\LABEL{MIN::INT_OF_GEN} \\
\verb|min::float64 min::| & \MINKEY{float\_of}\verb| ( min::gen v )|
\LABEL{MIN::FLOAT_OF_GEN} \\[1ex]
\verb|min::uns32 min::| & \MINKEY{numhash}\verb| ( min::gen v )|
\LABEL{MIN::NUMHASH_OF_GEN} \\
\end{tabular}\end{indpar}

The \verb|min::is_num| function for a loose 64-bit \verb|min::gen| argument
is just another name for the \verb|min::is_direct_float| function of the same
argument.  For a compact 32-bit \verb|min::gen| argument the function returns
true if the argument is a direct integer or a stub pointer
pointing at a number stub.

The \verb|min::new_num_gen| function with \verb|min::float64| argument
and loose 64-bit \verb|min::gen| value
is just another name for {\tt min::new\_\EOL direct\_\EOL gen}, which
simply changes the type of its argument.
The \verb|min::new_num_gen| function with \verb|min::float64| argument
and compact 32-bit \verb|min::gen| value creates a direct integer
if the argument is an integer in the
require range; otherwise the function returns a \verb|min::gen| value
that is a pointer to a number stub.  If a pointer to a number stub is
to be returned and a number stub containing the argument value already exists,
a pointer to the existing stub is returned;
otherwise a new number stub is created and a pointer to it returned.
Therefore two 32-bit \verb|min::gen| values that represent equal numbers are
themselves \verb|==|.

The \verb|min::new_num_gen| function with an \verb|int| argument does the
same thing as it would with its argument converted to a \verb|min::float64|
value, but is more efficient in the case where \verb|min::gen| values
are 32 bits and the argument is in the range of a direct integer general
value.

The \verb|min::float_of| function for a loose 64-bit \verb|min::gen|
argument is just another name for the \verb|min::direct_float_of| function
of the same argument, which after checking the subtype of the argument,
simply changes the type of the argument.
For a compact 32-bit \verb|min::gen| argument the
function returns any integer stored directly
in the argument converted to a 64-bit IEEE floating point number, or
returns the stub value for any number stub pointed at by the argument.
In this last case the stub type code is checked by a \verb|MIN_ASSERT|
statement to be sure the stub is a number stub.

The \verb|min::int_of| function does the same thing as the
\verb|min::float_of| followed by conversion to an \verb|int| value,
except that \verb|min::int_of| includes a check that the result
is a pure integer, without any fractional part, and is within the
range of the \verb|int| type, and
\verb|min::int_of| is more efficient when given a 32-bit direct integer
\verb|min::gen| argument.

Lastly, the \verb|min::numhash| function
returns the hash value of a \verb|min::gen|
value that is a number.  This value is computed by considering
the \verb|min::float_of| value of the number
to be a \underline{big endian} string of 8 characters and using the algorithm
on \pagref{HASH-ALGORITHM} to compute the hash value of this string.%
\label{NUMBER-HASH-ALGORITHM}

To permit hash values of arbitrary floating point numbers to be computed,
the following function is provided:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::uns32 min::| & \MINKEY{floathash}\verb| ( min::float64 f )|
\LABEL{MIN::FLOATHASH} \\
\end{tabular}\end{indpar}

The above \verb|min::float_of|, \verb|min::int_of|, and \verb|min::numhash|
functions of a \verb|min::gen| argument apply \verb|MIN_ASSERT| to check
that their argument is a number.  The following unprotected function assumes
that its argument is a number without doing any \verb|MIN_ASSERT| check:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::float64 MUP::| & \MUPKEY{float\_of}\verb| ( min::gen v )|
\LABEL{MUP::FLOAT_OF_GEN}
\end{tabular}\end{indpar}

\subsection{Strings}
\label{STRINGS}

In MIN all \verb|char| \skey{string}s\index{char strings@{\tt char} strings}
are NUL terminated UTF-8 encoded UNICODE character strings.
\key{UTF-8} encodes 32-bit UNICODE characters in 1 to 6 \verb|char|'s.

All ASCII characters are encoded as themselves in
the UTF-8 encoding.  This implies that
all ASCII character strings are UTF-8 encoded character
strings with the same characters as their ASCII representation indicates.%
\footnote{ASCII character codes range from 0 through 127.  UTF-8 extends
this by assigning meaning to codes from 128 to 255.}

It is possible for a \verb|char| string to be miscoded UTF-8.  None
of the functions given below, including the protected functions,
check for this.

A MIN string value cannot store the NUL character as legal UTF-8.
But it is possible to use the `\key{modified UTF-8}' encoding instead of
strict UTF-8.  The difference is that strict UTF-8 encodes the NUL
character in a single byte as an ASCII NUL, whereas modified UTF-8
encodes the NUL character as the 2-byte string `\verb|0xC0,0x80|'
(which is not legal in strict UTF-8 because it is not the shortest
possible encoding of NUL in UTF-8).

There are two kinds of string stubs: short strings and long strings.
In addition, a string of up to 3 {\tt char}'s can be stored within a 32-bit
\verb|min::gen| value, and a string of up to 5 {\tt char}'s can be stored
within a 64-bit \verb|min::gen| value,
without using a stub
(see \secref{GENERAL-VALUE-SUBTYPES} and
\secref{GENERAL-VALUE-FUNCTIONS}).
Such strings are called \skey{direct string}s, while strings stored in
stubs or stub bodies which are pointed at by \verb|min::gen| values,
the short and long strings, are called \skey{indirect string}s.
A short string holds up to 8 characters inside the string stub
(there must be more characters than a direct string will hold).
A long string has an string body that holds the string characters
(there must be more than 8)
along with the string length and hash value.

All three kinds of strings, direct, short, and long, are immutable
and have hash values (\pagref{HASH-VALUE}).

There are protected functions accessing general values that denote
strings of any kind without distinction, and these are described next.
Unprotected functions that apply only to particular
types of string are described later in this section.

The following functions create new general string values:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::gen min::|
    & \MINKEY{new\_str\_gen\REL} \verb| ( const char * p )|
\LABEL{MIN::NEW_STR_GEN} \\
\verb|min::gen min::|
    & \MINKEY{new\_str\_gen\REL} \verb| ( const char * p, unsigned n )|
\LABEL{MIN::NEW_STR_GEN_WITH_N} \\
\end{tabular}\end{indpar}

The \verb|min::new_str_gen| functions copy the input string after the
manner of \verb|strcpy| and \verb|strncpy|, respectively.  That is,
they copy from \verb|p|
until a NUL is copied or \verb|n| characters have been copied, whichever
comes first.

When a string general value
is created, if the input string is short enough for the general value
to hold the string itself, a direct string general value is created.
Otherwise \verb|min::new_str_gen| searches to see if any equal string
exists.  If such a string exists, a pointer to the stub of the existing
string is returned in the new \verb|min::gen| value, and no new stub
is created.  Otherwise, if the input string is 8 or fewer {\tt char}'s,
a short string stub is created, and if the input string has more
than 8 {\tt char}'s, a long string stub and body are created.

Thus if two string \verb|min::gen| values are equal as
strings, they have \verb|==| \verb|min::gen| values.

The following functions test a \verb|min::gen| value to see if it
is a string and obtain information from
a string \verb|min::gen| value.

\begin{indpar}\begin{tabular}{r@{}l}
\verb|int min::| & \MINKEY{is\_str}\verb| ( min::gen v )|
\LABEL{MIN::IS_STR_OF_GEN} \\[1ex]
\verb|unsigned min::| & \MINKEY{strlen}\verb| ( min::gen v )|
\LABEL{MIN::STRLEN_OF_GEN} \\
\verb|unsigned min::| & \MINKEY{strhash}\verb| ( min::gen v )|
\LABEL{MIN::STRHASH_OF_GEN} \\[1ex]
\verb|char * min::| & \MINKEY{strcpy}\verb| ( char * p, min::gen v )|
\LABEL{MIN::STRCPY_OF_GEN} \\
\verb|char * min::|
    & \MINKEY{strncpy}\verb| ( char * p, min::gen v, unsigned n )|
\LABEL{MIN::STRNCPY_OF_GEN} \\[1ex]
\verb|int min::| & \MINKEY{strcmp}\verb| ( const char * p, min::gen v )|
\LABEL{MIN::STRCMP_OF_GEN} \\
\verb|int min::|
    & \MINKEY{strncmp}\verb| ( const char * p, min::gen v, unsigned n )|
\LABEL{MIN::STRNCMP_OF_GEN} \\
\end{tabular}\end{indpar}

Five of these functions correspond to the standard C/C++
{\tt strlen}, {\tt strcpy}, {\tt strncpy}, {\tt strcmp},
and {\tt strncmp} functions, and differ
from these only in that instead of taking a {\tt char *} source string
argument, these functions take a {\tt min::gen} source argument.

To permit hash values of arbitrary strings to be computed,
without creating {\tt min::gen} values from them first,
the following functions are provided:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::uns32 min::| & \MINKEY{strhash}\verb| ( const char * p )|
\LABEL{MIN::STRHASH} \\
\verb|min::uns32 min::|
    & \MINKEY{strnhash}\verb| ( const char * p, unsigned n )|
\LABEL{MIN::STRNHASH} \\
\end{tabular}\end{indpar}

Both \verb|strhash| and \verb|strnhash| accept NUL terminated strings, but
\verb|strnhash| stops reading the string after the first \verb|n| characters
if none of these characters is NUL.

A string hash value is computed according to the following machine
independent algorithm:\label{HASH-ALGORITHM}

\begin{indpar}\begin{verbatim}
hash = 0
n = length of string
for i = 1 through n:
    c = i'th char of string as unsigned 8 bit integer
    hash = ( hash * 65599 ) + c
if hash = 0, then hash = 2**32 - 1
\end{verbatim}\end{indpar}

where the final result is truncated to 32 bits.  The constant
is a prime such that multiplication by it may be turned into
shifts and adds by compilers: $65599=2^{16}+2^6-1$.
A hash value is never zero (so zero can be used to denote a missing hash value).

The low order bits of the hash value are random, so it can be
truncated to provide a random hash.

A read-only pointer to the characters of a string {\tt min::gen} value can
be obtained using the following functions to create and use
a \key{string pointer}:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|(constructor) min::| & \MINKEY{str\_pointer}\verb| ( min::gen v )|
\LABEL{MIN::STR_POINTER_OF_GEN} \\
\verb|void min::|
    & \MINKEY{initialize}\verb| ( min::str_pointer & sp, min::gen v )|
\LABEL{MIN::INIT_OF_STR_POINTER} \\[1ex]
\verb|unsigned min::| & \MINKEY{strlen}\verb| ( min::str_pointer & sp )|
\LABEL{MIN::STRLEN_OF_STR_POINTER} \\
\verb|unsigned min::| & \MINKEY{strhash}\verb| ( min::str_pointer & sp )|
\LABEL{MIN::STRHASH_OF_STR_POINTER} \\[1ex]
\verb|char * min::| & \MINKEY{strcpy}\verb| ( char * p, min::str_pointer & sp )|
\LABEL{MIN::STRCPY_OF_STR_POINTER} \\
\verb|char * min::|
    & \MINKEY{strncpy}%
      \begin{tabular}[t]{@{}l@{}}
      \verb| ( char * p,| \\
      \verb|   min::str_pointer & sp, unsigned n )| \\[1ex]
      \end{tabular}
\LABEL{MIN::STRNCPY_OF_STR_POINTER} \\[1ex]
\verb|int min::|
    & \MINKEY{strcmp}\verb| ( const char * p, min::str_pointer & sp )|
\LABEL{MIN::STRCMP_OF_STR_POINTER} \\
\verb|int min::|
    & \MINKEY{strncmp}%
      \begin{tabular}[t]{@{}l@{}}
      \verb|( const char * p,| \\
      \verb|  min::str_pointer & sp, unsigned n )| \\[1ex]
      \end{tabular}
\LABEL{MIN::STRNCMP_OF_STR_POINTER} \\[1ex]
\verb|const char      |
    & \ttkey{operator [ ]}\verb| ( min::str_pointer & sp, int index )|
\LABEL{MUP::[]_OF_STR_POINTER} \\
\verb|const char * MUP::| & \MUPKEY{str\_of}\verb| ( min::str_pointer & sp )|
\LABEL{MUP::STR_OF_STR_POINTER} \\
\end{tabular}\end{indpar}

The constructor creates a string pointer pointing to the {\tt char}'s
of the string specified by the \verb|min::gen| argument.  This argument
must be a direct string or a pointer to a short or long string stub.
The {\tt min::initialize} function can reset the string
pointer to point at a different \verb|min::gen| value.

The \verb|strlen|, \verb|strhash|, \verb|strcpy|, \verb|strncpy|,
\verb|strcmp|, and \verb|strncmp| functions retrieve the same information
about the string pointed at by a string pointer as they retrieve about
the string {\tt min::gen} value the pointer points at.

The {\tt MUP::str\_of} function returns a standard C++ pointer to the string,
taking care to ensure the vector of {\tt char}'s is NUL-terminated.
The value of {\tt min::str\_of} will become obsolete if the string is
relocated, and in particular, may become obsolete if a relocating
function is called.

The \verb|[ ]| operator can be used to access individual characters
in a string.  If {\tt sp} is a string pointer, `\verb|sp[i]|' is
shorthand for `\verb|MUP::str_of(sp)[i]|'.

For direct and short strings the string pointer, when it is created,
copies the string {\tt char}'s into a buffer internal to the string pointer,
in order to save the {\tt char}'s in a direct string value, or to
add a missing NUL to the end of the short string {\tt char} vector.
In long string cases no copying is done, and the string pointer
is essentially just a pointer to the string stub, which in turn points
at the string proper inside a relocatable string body.

The rest of this section describes unprotected functions that access the
internals of short and long strings.

A \key{short string stub}\label{SHORT-STRING-STUB} is collectible, has
\minnbkey{SHORT\_STR}\LABEL{MIN::SHORT_STR} stub type code, and has
an immutable {\tt min::\EOL uns64} stub value that holds a NUL padded
8 \verb|char| vector and can be read by

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::uns64 MUP::|
    & \MUPKEY{short\_str\_of}\verb| ( const min::stub * s )|
\LABEL{MUP::SHORT_STR_OF}
\end{tabular}\end{indpar}

Here the \verb|min::uns64| value returned by \MUPkey{short\_str\_of}
should be overlaid by a union with a \verb|char[ ]| buffer, as in

\begin{indpar}\begin{verbatim}
union { min::uns64 str; char buf[9]; } u;
min::stub * s1;
. . . set s1 to point at a short string stub . . .
u.str = MUP::short_str_of ( s1 );
u.buf[8] = 0;	// Be sure result is NUL terminated.
cout << u.buf;
\end{verbatim}\end{indpar}

Short string values are NUL (zero) padded 0 to 8 \verb|char|
strings.  To be sure any value read is NUL terminated, a NUL (zero)
must be stored after the value read, as is done by \verb|u.buf[8] = 0|
in the example.

A \key{long string stub}\label{LONG-STRING-STUB} is collectible, has
\minnbkey{LONG\_STR}\LABEL{MIN::LONG_STR} stub type code, and has
a value that is a pointer to a \MUPkey{long\_str} type body
which holds an arbitrary length NUL terminated \verb|char| string.

The long string body consists of the 32-bit length and 32-bit hash value
of the string, followed by a \verb|char|
vector containing the string proper with the terminating NUL.  The
\verb|char| vector is padded to a multiple of 8 bytes with NUL
bytes, but the terminating NUL and the padding are not included
in the length.

The following are unprotected functions to return a relocatable pointer to the
long string body, a relocatable pointer to the string itself,
and the length and hash of the string.

\begin{indpar}\begin{tabular}{r@{}l}
\verb|MUP::long_str * MUP::|
    & \MUPKEY{long\_str\_of}\verb| ( const min::stub * s )|
\LABEL{MUP::LONG_STR_OF} \\
\verb|const char * MUP::| & \MUPKEY{str\_of}\verb| ( MUP::long_str * str )|
\LABEL{MUP::STR_OF_LONG_STR} \\
\verb|unsigned MUP::| & \MUPKEY{length\_of}\verb| ( MUP::long_str * str )|
\LABEL{MUP::LENGTH_OF_LONG_STR} \\
\verb|unsigned MUP::| & \MUPKEY{hash\_of}\verb| ( MUP::long_str * str )|
\LABEL{MUP::HASH_OF_LONG_STR} \\
\end{tabular}\end{indpar}

These functions are unprotected because \verb|long_str *| pointers
are relocatable.


\subsection{Labels}
\label{LABELS}

Attribute labels are often atoms, i.e., single strings or numbers.
But they may be sequences of atoms.  Such sequences are represented by
\skey{label}s.\footnote{Labels could also be represented by
sublists stored inside objects (\pagref{LIST-LEVEL}), but each label tends to
be reused by many objects, and storing it inside each using object
would be inefficient.  In addition labels are useful as function arguments.}
Labels may also be elements of other labels.

A label is essentially just a vector of name components, where a name
component is an atom or a label.  However, labels are immutable and
have the property that no two distinct label stubs can have equal vectors of
name components.  

A label vector may be stored in a chain of stubs,
and not in a body.  The exact manner in which the vector is stored is
hidden from the user.  

Note that a label of one element
is distinct from the element itself and has a different
hash code.  Also note that labels can be elements of labels.  A programming
language may wish to require that the elements of labels be numbers or
strings, that numbers and strings be treated as labels of one element,
and that proper labels with one element not be created.  But the
\verb|min.h| code does not do this.

A \key{label stub}\label{LABEL-STUB} is collectible,
has \minnbkey{LABEL}\LABEL{MIN::LABEL} stub type code,
and has an immutable value.
The label value may be read by the protected functions:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|unsigned min::| & \MINKEY{lab\_of}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::gen * p, unsigned n,| \\
	  \verb|   const min::stub * s )|
	  \end{tabular}
\LABEL{MIN::LAB_OF} \\
\verb|unsigned min::| & \MINKEY{lab\_of}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::gen * p, unsigned n,| \\
	  \verb|   min::gen v )|
	  \end{tabular}
\LABEL{MIN::LAB_OF_GEN} \\
\end{tabular}\end{indpar}

These read an initial segment of the label vector into the location
addressed by {\tt p}.  If the label vector has {\tt n} or more elements,
the first {\tt n} elements are read.  Otherwise, as many elements as
the label vector has are read.  The number of elements read is returned
in any case.  The label can be denoted by either its stub address or
by a general value pointing at its stub address.

The length of a label is the number of elements (general values) in the label.
Usually this is found my just reading the label, as labels tend to be
short.  For example, a convention might be adopted that
attribute labels have at most 10 elements.  Then providing output vectors
to the above functions with 11 elements would not only allow all legal
attribute labels, but would detect illegally long ones.

The length of a label may be read by the following functions:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|unsigned min::| & \MINKEY{lablen}\verb| ( const min::stub * s )|
\LABEL{MIN::LABLEN} \\
\verb|unsigned min::| & \MINKEY{lablen}\verb| ( min::gen v )|
\LABEL{MIN::LABLEN_OF_GEN} \\
\end{tabular}\end{indpar}

The hash value of a label may be computed by the following functions:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::uns32 min::| & \MINKEY{labhash}\verb| ( const min::stub * s )|
\LABEL{MIN::LABHASH} \\
\verb|min::uns32 min::| & \MINKEY{labhash}\verb| ( min::gen v )|
\LABEL{MIN::LABHASH_OF_GEN} \\
\verb|min::uns32 min::| & \MINKEY{labhash}%
    \verb| ( const min::gen * p, unsigned n )|
\LABEL{MIN::LABHASH_OF_GEN_VECTOR} \\
\end{tabular}\end{indpar}

The last function computes the hash value for a label that could be created
from the given vector {\tt p} of {\tt n} general values, where each
general value is a name component.  The hash of a label is computed from
the hash of each of its elements using the following
machine independent algorithm:\label{LABEL-HASH-ALGORITHM}

\begin{indpar}\begin{verbatim}
hash = 1009
n = length of label
for i = 1 through n:
    h = hash of i'th element of label
    hash = ( hash * ( 65599 ** 10 ) ) + h
if hash = 0, then hash = 2**32 - 1
\end{verbatim}\end{indpar}

Comparing this with the hash algorithm for strings
on \pagref{HASH-ALGORITHM}, one sees that as long as
label elements are numbers and strings of fewer than 10 characters,
the hash of a label is equivalent to the hash of the
string made by concatenating a prefix and then the label elements, where each
string of fewer than 10 characters is padded to 10 characters
by prefacing it with NUL characters.  Note that
numbers are treated as 8 character strings; see
\pagref{NUMBER-HASH-ALGORITHM}.  The prefix is any 10 character string with
hash value {\tt 1009}.

A label may be created by the following protected function:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::gen min::| & \MINKEY{new\_lab\_gen}%
    \verb| ( const min::gen * p, unsigned n )|
\LABEL{MIN::NEW_LAB_GEN} \\
\end{tabular}\end{indpar}

Here {\tt p} must point to a vector of {\tt n} \verb|min::gen|
values that becomes the value vector of the label.  Each
\verb|min::gen| value must be a name component.
This function returns any existing label with elements equal to
those given by the function arguments, in preference to creating a new
label.  Thus two \verb|min::gen| label values with equal elements are
\verb|==|.

The following function returns true if and only if its argument is
a label:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|bool min::| & \MINKEY{is\_lab}\verb| ( min::gen v )|
\LABEL{MIN::IS_LAB_OF_GEN} \\
\end{tabular}\end{indpar}



\subsection{Objects}
\label{OBJECTS}

An \key{object} is conceptually a hash table that maps
\skey{attribute name}s to \skey{attribute value}s.
The part of the hash table that maps small
unsigned integer attribute names is actually a vector.

Each map of an attribute name to an attribute value represents an
arrow in the data base.
If the arrow is a double arrow,
a reverse direction label, called the \key{reverse attribute name}
is attached to the arrow.
There can be several arrows with the same attribute name.
There can be several double arrows with the same attribute name and
the same reverse attribute name.

Several arrows can have both the same attribute name and the
same value.  Several double arrows can have the same
attribute and reverse attribute names and the same value.

Therefore an attribute name and reverse attribute name together name a
multi-set of values, where the reverse attribute name can be missing to
indicate that only single arrows are to be considered, and is present to
indicate that only double arrows are to be considered.
It is possible to add a value to this multi-set or delete a value from the
multi-set.  It is possible to delete the entire multi-set.
It is possible to treat the multi-set as a set, by adding a value
to it only if the value does not already occur in the multi-set.
When testing for value equality, {\tt ==} is used, as this tests for
equality of both name components and objects.

Flags, called \key{attribute flags}, can be attached to an attribute name.
Note that flags are attached to object attribute names, and not to arrows,
values, or reverse attribute names.

An object can also hold a vector of \skey{variable}s.  An attribute
value may be an indirect pointer at an object variable, either in the
same or a different object.  A variable can hold a value, or can hold
an indirect pointer to another variable in the same or in a different
object, or can hold the special value \verb|min::UNDEFINED| indicating
the value is not yet specified.

In addition to indirect pointers, attribute and variable values may be
`\skey{typed object pointer}s', which point at a pair of objects,
X, the `\key{typed object}', and T, the `\key{type object}'.
Given a typed object pointer X:T, the attribute values in T
may be indirect pointers to variables in X without T itself containing
any pointer to X.  Thus T provides a mapping of attribute labels to variables
in X, and therefore T is like a type of X.  A typical usage is for
the first variable of X to point at the root of a tree of type objects
that form a labelled graph some of whose leaves map to variables of X,
so that the typed object X is just a vector of variables,
while the type objects hold
all the attribute labels and graph connections.  Then the same graph of
type objects may be used with many different typed objects that have
the same graph structure.

An object has a body that consists of the following 6 parts in
the order given:

\begin{center}
\begin{tabular}{l}
header \\
variable vector \\
hash table \\
attribute vector \\
unused area\\
auxiliary area
\end{tabular}
\end{center}

The \mkey{header}{of object} contains the sizes of the other 5 parts.
The \mkey{variable vector}{of object} stores the object's variables.
The \mkey{hash table}{of object}
stores attribute name/value pairs, for attributes whose names do not
begin with small unsigned integers.
The \mkey{attribute vector}{of object} stores attribute values
for attributes whose names begin with small unsigned integers.
The \mkey{auxiliary area}{of object}
stores various overflow data from the hash table and attribute vector.
The \mkey{unused area}{of object}
provides for growth of the attribute vector and auxiliary area.

The variable vector and hash table are of fixed size;
their size can only be changed by relocating
the object body.  The attribute vector
grows up from the end of the hash table into the unused
area, and the auxiliary storage grows down from the end of the body into
the unused area.

An object may be grown or compacted by relocating its body.  It may be
grown to expand its unused area or hash table, or less commonly,
its variable vector.  An object may be compacted to eliminate, or less
commonly to shrink, its unused area.

There are two kinds of objects: short and long.  A \key{short object}
has a header that stores 8 bit and 16 bit unsigned sizes.  A \key{long object}
has a header that stores 16 bit and 32 bit unsigned sizes.  Otherwise there is
no essential difference between a short and a long object.  The functions
that create attributes convert automatically from short to
long objects when required.  Conversion in either direction, and compaction
of objects, may occur whenever object bodies are relocated, as they
may be during garbage collection.

The data structure of an object body can be viewed at any of three levels:
vector level (\secref{OBJECT-VECTOR-LEVEL}),
list level (\secref{OBJECT-LIST-LEVEL}),
and attribute level (\secref{OBJECT-ATTRIBUTE-LEVEL}).
The interfaces to all of these levels is protected.  In addition
there is an unprotected vector level interface
(\secref{OBJECT-UNPROTECTED-VECTOR-LEVEL}).

\subsubsection{Object Indirect Pointers}
\label{OBJECT-INDIRECT-POINTERS}

TBD

There are two kinds of special pointers that can be used with objects:
indirect pointers and typed pointers.  An object element can contain
either kind of pointer, but because most values of these special pointers
are larger than a single \verb|min::gen| value, the object element
usually has to contain an auxiliary special pointer that points at two
auxiliary elements of the object that hold the value of the special
pointer.  The goal of both kinds of special pointer is to permit
an object element to hold an indirect pointer to a variable in some
other object.  Indirect special pointers are just such indirectly pointers
in a straight forward way, but typed pointers
are more complex and permit a constant object called the type to
have an element indirectly pointing at variable in a second object called
the typed object.

An \key{indirect pointer} consists of an unsigned integer index $I$ and
a pointer to the stub of an object $O$.  The indirect pointer specifies
that the element containing it is to be treated as if its value were
the value of the variable with index $I$ in object $O$.
There are two formats of indirect pointer: unpacked and packed.

An \key{unpacked indirect pointer} consists of an auxiliary special pointer
pointing at two consecutive auxiliary elements of the object containing
the auxiliary special pointer (\underline{not} the object $O$).
The first of these holds an index \verb|min::gen| value containing $I$.
The second holds a \verb|min::gen| value containing a pointer to the
stub of $O$.

A \key{packed indirect pointer} is a \verb|min::gen| value that contains
the index $I$ and an auxiliary pointer to a single auxiliary element
of the object containing the packed indirect pointer
(\underline{not} the object $O$).  This auxiliary element
holds a \verb|min::gen| value containing a pointer to the
stub of $O$.  Packed indirect pointers can be very efficient if
one object $O'$ holds many indirect pointers targeting variables
in the same object $O$.

A \key{typed pointer} consists of two pointers to object stubs.
One of these objects, $O$, is the \key{typed object}, and the other,
$T$, is the \key{type object}.


TBD

value of the element to be stored in a variable in another object.  Variables
can themselves contain indirect pointers.  Variables can also be set
to the \minnbkey{UNDEFINED} special value to indicate that the values of
elements indirected to the variable has not yet been determined.

Indirect pointers are standardly used only at the object list
and attribute levels, but can in theory be used with non-standard
object organizations.

\subsubsection{Objects and Threads}
\label{OBJECTS-AND-THREADS}

[Objects have state:

\begin{center}
\begin{tabular}{lp{4.0in}}
NONE	& No list pointers. \\
PRIVATE  & Single thread. \\
PUBLIC & Multi-thread, insert pointers prohibited forever, all other
            pointers allowed.
\end{tabular}
\end{center}

A list pointer applied to an object in NONE state changes the
state to PRIVATE and makes it impossible to open any other list
pointer, except as a subpointer of the given list pointer (i.e.,
construct a new list pointer from the existing one and not from
just the object).  Subpointers can have reduced permissions:
insert > update > readonly.  Destructing a list pointer in 
PRIVATE state changes the state to NONE.

There is an operation to change from NONE to PUBLIC state.
Once in PUBLIC state the state cannot be changed.  In PUBLIC
state insert pointers cannot be opened on the object.

There are separate operations read\_sync, write\_sync, readwrite\_sync
to synchronize caches.

]

\subsubsection{Object Vector Level}
\label{OBJECT-VECTOR-LEVEL}

At the \key{vector level}, the body is viewed as
a \key{body vector} of \verb|min::gen| values.
A \minkey{vec\_\EOL pointer}
to the body vector is managed by the following protected functions:

\begin{indpar}[0.2in]\begin{tabular}{r@{}l}
\verb|(constructor) min::| & \MINKEY{vec\_pointer}\verb| ( min::gen v )|
\LABEL{MIN::VEC_POINTER_OF_GEN} \\
\verb|(constructor) min::| & \MINKEY{vec\_pointer}%
       \verb| ( const min::stub * s )|
\LABEL{MIN::VEC_POINTER_OF_STUB} \\

\end{tabular}\end{indpar}

\begin{indpar}[0.2in]\begin{tabular}{r@{}l}

\verb|void min::|
    & \MINKEY{initialize}%
      \begin{tabular}[t]{@{}l@{}}
      \verb| ( min::vec_pointer & vp,| \\
      \verb|   min::gen v )| \\
      \end{tabular}
\LABEL{MIN::INIT_OF_VEC_POINTER_OF_GEN} \\
\verb|void min::|
    & \MINKEY{initialize}%
      \begin{tabular}[t]{@{}l@{}}
      \verb| ( min::vec_pointer & vp,| \\
      \verb|   const min::stub * s )| \\
      \end{tabular}
\LABEL{MIN::INIT_OF_VEC_POINTER_OF_STUB} \\[1ex]

\end{tabular}\end{indpar}

The following protected functions may be used to discover information
about the object pointed at by a {\tt min::vec\_pointer}:

\begin{indpar}[0.2in]\begin{tabular}{r@{}l}

\verb|const min::| & \MINKEY{stub\_of}\verb| ( min::vec_pointer & vp )|
\LABEL{MIN::STUB_OF_VEC_POINTER} \\
\verb|unsigned | & \MINKEY{var\_size\_of}\verb| ( min::vec_pointer & vp )|
\LABEL{MIN::VAR_SIZE_OF_VEC_POINTER} \\
\verb|unsigned | & \MINKEY{hash\_size\_of}\verb| ( min::vec_pointer & vp )|
\LABEL{MIN::HASH_SIZE_OF_VEC_POINTER} \\
\verb|unsigned | & \MINKEY{attr\_size\_of}\verb| ( min::vec_pointer & vp )|
\LABEL{MIN::ATTR_SIZE_OF_VEC_POINTER} \\
\verb|unsigned | & \MINKEY{unused\_size\_of}\verb| ( min::vec_pointer & vp )|
\LABEL{MIN::UNUSED_SIZE_OF_VEC_POINTER} \\
\verb|unsigned | & \MINKEY{aux\_size\_of}\verb| ( min::vec_pointer & vp )|
\LABEL{MIN::AUX_SIZE_OF_VEC_POINTER} \\
\verb|unsigned | & \MINKEY{total\_size\_of}\verb| ( min::vec_pointer & vp )|
\LABEL{MIN::TOTAL_SIZE_OF_VEC_POINTER} \\
\verb|unsigned | & \MINKEY{var\_offset\_of}\verb| ( min::vec_pointer & vp )|
\LABEL{MIN::VAR_OFFSET_OF_VEC_POINTER} \\
\verb|unsigned | & \MINKEY{attr\_offset\_of}\verb| ( min::vec_pointer & vp )|
\LABEL{MIN::ATTR_OFFSET_OF_VEC_POINTER} \\
\verb|unsigned | & \MINKEY{unused\_offset\_of}\verb| ( min::vec_pointer & vp )|
\LABEL{MIN::UNUSED_OFFSET_OF_VEC_POINTER} \\
\verb|unsigned | & \MINKEY{aux\_offset\_of}\verb| ( min::vec_pointer & vp )|
\LABEL{MIN::AUX_OFFSET_OF_VEC_POINTER} \\

\end{tabular}\end{indpar}

The size and offset values returned by the above are those of the
variable vector({\tt var}), hash table({\tt hash}),
attribute vector({\tt attr}), unused area ({\tt unused}), 
and auxiliary area({\tt aux}).  These are related by

\begin{center}
\begin{tabular}{rcl}
variable vector offset	& = & header size \\
hash table offset       & = & variable vector offset + variable vector size \\
attribute vector offset & = & hash table offset + hash table size \\
unused area offset      & = & attribute vector offset + attribute vector size \\
auxiliary area offset   & = & unused area offset + unused area size \\
total size              & = & auxiliary area offset + auxiliary area size \\
\end{tabular}
\end{center}

Note that when an object is expanded or compacted, all these values may
change, including the header size.

The following functions can be used for \underline{read-only}
access to object elements:

\begin{indpar}[0.2in]\begin{tabular}{r@{}l}

\verb|const min::gen & | & \MINKEY{var}%
    \verb| ( min::vec_pointer & vp, unsigned index )|
\LABEL{MIN::VAR_OF_VEC_POINTER} \\
\verb|const min::gen & | & \MINKEY{hash}%
    \verb| ( min::vec_pointer & vp, unsigned index )|
\LABEL{MIN::HASH_OF_VEC_POINTER} \\
\verb|const min::gen & | & \MINKEY{attr}%
    \verb| ( min::vec_pointer & vp, unsigned index )|
\LABEL{MIN::ATTR_OF_VEC_POINTER} \\
\verb|const min::gen & | & \MINKEY{aux}%
    \verb| ( min::vec_pointer & vp, unsigned aux_pointer )|
\LABEL{MIN::AUX_OF_VEC_POINTER} \\

\end{tabular}\end{indpar}

Given a vector pointer \verb|vp|, \verb|min::var(vp,i)| can be used
to access the \verb|i+1|'st variable in the object pointed at
by \verb|vp|, for $0\leq i<\mbox{\tt min::var\_size\_of(vp)}$.
Similarly, \verb|min::hash(vp,i)| can be used
to access the \verb|i+1|'st hash table entry
for $0\leq i<\mbox{\tt min::hash\_size\_of(vp)}$,
and \verb|min::attr(vp,i)| can be used
to access the \verb|i+1|'st attribute vector entry
for $0\leq i<\mbox{\tt min::attr\_size\_of(vp)}$.
\verb|min::aux(vp,p)| differs in that it accesses
the auxilary area element pointed at by the auxilary
pointer \verb|p|, where
\begin{center}
$\mbox{\tt min::aux\_offset\_of(vp)}\leq p<\mbox{\tt min::total\_size\_of(vp)}$
\end{center}

A \minkey{updatable\_vec\_pointer} is like a \verb|min::vec_pointer|
but has additional functions which support writting object body vector
elements.  The additional functions for this type of pointer are:

\begin{indpar}[0.2in]\begin{tabular}{r@{}l}
\verb|(constructor) min::| & \MINKEY{updatable\_vec\_pointer}%
    \verb| ( min::gen v )|
\LABEL{MIN::UPDATABLE_VEC_POINTER_OF_GEN} \\
\verb|(constructor) min::| & \MINKEY{updatable\_vec\_pointer}%
    \verb| ( const min::stub * s )|
\LABEL{MIN::UPDATABLE_VEC_POINTER_OF_STUB} \\

\end{tabular}\end{indpar}

\begin{indpar}[0.2in]\begin{tabular}{r@{}l}

\verb|void min::| & \MINKEY{set\_var}%
      \begin{tabular}[t]{@{}l@{}}
      \verb| ( min::updatable_vec_pointer & vp,| \\
      \verb|   unsigned index,| \\
      \verb|   min::gen value )| \\
      \end{tabular}
\LABEL{MIN::SET_VAR_OF_UPDATABLE_VEC_POINTER} \\
\verb|void min::| & \MINKEY{set\_hash}%
      \begin{tabular}[t]{@{}l@{}}
      \verb| ( min::updatable_vec_pointer & vp,| \\
      \verb|   unsigned index,| \\
      \verb|   min::gen value )| \\
      \end{tabular}
\LABEL{MIN::SET_HASH_OF_UPDATABLE_VEC_POINTER} \\
\verb|void min::| & \MINKEY{set\_attr}%
      \begin{tabular}[t]{@{}l@{}}
      \verb| ( min::updatable_vec_pointer & vp,| \\
      \verb|   unsigned index,| \\
      \verb|   min::gen value )| \\
      \end{tabular}
\LABEL{MIN::SET_ATTR_OF_UPDATABLE_VEC_POINTER} \\
\verb|void min::| & \MINKEY{set\_aux}%
      \begin{tabular}[t]{@{}l@{}}
      \verb| ( min::updatable_vec_pointer & vp,| \\
      \verb|   unsigned aux_pointer,| \\
      \verb|   min::gen value )| \\
      \end{tabular}
\LABEL{MIN::SET_AUX_OF_UPDATABLE_VEC_POINTER} \\

\end{tabular}\end{indpar}

All the non-constructor functions applicable to
{\tt min::\EOL vec\_\EOL pointer}'s
are applicable to
{\tt min::\EOL updatable\_\EOL vec\_\EOL pointer}'s, including the
{\tt min::\EOL initialize} functions.
The {\tt min::set\_}\,\ldots{} functions here invoke the
Accumulator/\EOL Collector/\EOL Compactor function that must
be called when a \verb|min::gen| value is written into an object.
The need to do this is why it is not possible to have versions
of the {\tt min::var}, \ldots, {\tt min::aux} that return
writable non-{\tt const} references to object body vector elements.

A \minkey{insertable\_vec\_pointer} is like a
{\tt min::updatable\_\EOL vec\_\EOL pointer}
but has additional functions which support pushing or popping elements
from the end of the object body attribute vector or the beginning
of the object body auxiliary area.
The additional functions for this type of pointer are:

\begin{indpar}[0.2in]\begin{tabular}{r@{}l}
\verb|(constructor) min::| & \MINKEY{insertable\_vec\_pointer}%
    \verb| ( min::gen v )|
\LABEL{MIN::INSERTABLE_VEC_POINTER_OF_GEN} \\
\verb|(constructor) min::| & \MINKEY{insertable\_vec\_pointer}%
    \verb| ( const min::stub * s )|
\LABEL{MIN::INSERTABLE_VEC_POINTER_OF_STUB} \\

\end{tabular}\end{indpar}

\begin{indpar}[0.2in]\begin{tabular}{r@{}l}

\verb|void min::| & \MINKEY{attr\_push}%
      \begin{tabular}[t]{@{}l@{}}
      \verb| ( min::insertable_vec_pointer & vp,| \\
      \verb|   min::gen value )| \\
      \end{tabular}
\LABEL{MIN::ATTR_PUSH_OF_INSERTABLE_VEC_POINTER} \\
\verb|void min::| & \MINKEY{attr\_push}%
      \begin{tabular}[t]{@{}l@{}}
      \verb| ( min::insertable_vec_pointer & vp,| \\
      \verb|   const min::gen * p, unsigned n )| \\
      \end{tabular}
\LABEL{MIN::ATTR_PUSH_MULTIPLE_OF_INSERTABLE_VEC_POINTER} \\

\verb|void min::| & \MINKEY{aux\_push}%
      \begin{tabular}[t]{@{}l@{}}
      \verb| ( min::insertable_vec_pointer & vp,| \\
      \verb|   min::gen value )| \\
      \end{tabular}
\LABEL{MIN::AUX_PUSH_OF_INSERTABLE_VEC_POINTER} \\
\verb|void min::| & \MINKEY{aux\_push}%
      \begin{tabular}[t]{@{}l@{}}
      \verb| ( min::insertable_vec_pointer & vp,| \\
      \verb|   const min::gen * p, unsigned n )| \\
      \end{tabular}
\LABEL{MIN::AUX_PUSH_MULTIPLE_OF_INSERTABLE_VEC_POINTER} \\

\end{tabular}\end{indpar}

\begin{indpar}[0.2in]\begin{tabular}{r@{}l}

\verb|void min::| & \MINKEY{attr\_pop}%
      \begin{tabular}[t]{@{}l@{}}
      \verb| ( min::insertable_vec_pointer & vp,| \\
      \verb|   min::gen & value )| \\
      \end{tabular}
\LABEL{MIN::ATTR_POP_OF_INSERTABLE_VEC_POINTER} \\
\verb|void min::| & \MINKEY{attr\_pop}%
      \begin{tabular}[t]{@{}l@{}}
      \verb| ( min::insertable_vec_pointer & vp,| \\
      \verb|   min::gen * p, unsigned n )| \\
      \end{tabular}
\LABEL{MIN::ATTR_POP_MULTIPLE_OF_INSERTABLE_VEC_POINTER} \\

\verb|void min::| & \MINKEY{aux\_pop}%
      \begin{tabular}[t]{@{}l@{}}
      \verb| ( min::insertable_vec_pointer & vp,| \\
      \verb|   min::gen & value )| \\
      \end{tabular}
\LABEL{MIN::AUX_POP_OF_INSERTABLE_VEC_POINTER} \\
\verb|void min::| & \MINKEY{aux\_pop}%
      \begin{tabular}[t]{@{}l@{}}
      \verb| ( min::insertable_vec_pointer & vp,| \\
      \verb|   min::gen * p, unsigned n )| \\
      \end{tabular}
\LABEL{MIN::AUX_POP_MULTIPLE_OF_INSERTABLE_VEC_POINTER} \\

\end{tabular}\end{indpar}

Here there are two versions of each push or pop: one that
handles a single {\tt min::gen} value, and one that handles
{\tt n} values stored in a C/C++ vector pointed at by {\tt p}.
The order of the elements of {\tt p} in memory is the same
as the order of the elements in the object body.  For the
attribute vector this means the {\tt min::attr\_\EOL push}
function pushes elements starting at the beginning of the {\tt p}
vector, while {\tt min::attr\_\EOL pop} pops elements starting
at the \underline{end} of the {\tt p} vector.  But for the auxiliary
area, the push starts at the end of the {\tt p} vector and the
pop at the beginning.

The push functions fail (via \verb|MIN_ASSERT|) if the unused
area size is smaller
than the number of {\tt min::gen} values being pushed.

All the non-constructor functions applicable to
{\tt min::updatable\_\EOL \EOL vec\_\EOL pointer}'s
are applicable to
{\tt min::\EOL insertable\_\EOL vec\_\EOL pointer}'s, including the
{\tt min::\EOL initialize} functions.
The {\tt min::}\,\ldots{\tt \_push} functions here invoke the
Accumulator/\EOL Collector/\EOL Compactor function that must
be called when a \verb|min::gen| value is written into an object.

\subsubsubsection{Unprotected Object Vector Level}
\label{OBJECT-UNPROTECTED-VECTOR-LEVEL}

Using unprotected functions, an object body can be treated
as a simple C/C++ vector of {\tt min::gen} values.  The
required functions are:

\begin{indpar}[0.2in]\begin{tabular}{r@{}l}

\verb|const min::gen * & MUP::| & \MUPKEY{base}%
    \verb| ( min::vec_pointer & v )|
\LABEL{MUP::BASE_OF_VEC_POINTER} \\
\verb|min::gen * & MUP::| & \MUPKEY{base}%
    \verb| ( min::updatable_vec_pointer & v )|
\LABEL{MUP::BASE_OF_UPDATABLE_VEC_POINTER} \\

\end{tabular}\end{indpar}

A \key{short object stub}\label{SHORT-OBJECT-STUB} is collectible, has
\minnbkey{SHORT\_OBJ}\LABEL{MIN::SHORT_OBJ} stub type code, and has
a value that is a pointer to a \MUPkey{short\_obj} type body
which holds the 5 parts of the object.
The header encodes 4 16-bit unsigned integers, which are, in order:

\begin{center}
\begin{tabular}{lllllllll}
header size & + & hash table size \\
header size & + & hash table size & + & attribute vector size \\
header size & + & hash table size & + & attribute vector size
	& + & unused area size \\
header size & + & hash table size & + & attribute vector size
	& + & unused area size \\
        & + & auxiliary area size \\
	& = & total size
\end{tabular}
\end{center}

Here all sizes are in \verb|min::gen| units.  Thus the header size,
which is 64 bits, is {\tt 1} for a loose implementation and {\tt 2}
for a compact implementation (\pagref{COMPACT-OR-LOOSE}).

The header may contain other implementation dependent information used
for optimization.  Most implementations do not
contain the above sizes directly.  For example, an
implementation may permit only particular hash table sizes,
and use 8 bits to encode a reference to a table
of hash table sizes, freeing up at least 8 bits in the header for
use as flags.  These flags may be used to optimize garbage collection.
For example, objects which have auxiliary stubs
(\pagref{OBJECT-AUXILIARY-STUBS})
may be flagged, thereby identifying objects that need extra work
when deallocated or relocated.

An implementation is not required to support all possible sizes of
hash table or all possible total sizes, but should support
sizes that permit objects that are read-only to be efficiently compacted.
Within the limits set by the total and hash table sizes, arbitrary sizes
of the vector, unused, and auxiliary areas should be supported.

\underline{All sizes are in units of {\tt min::gen} values}.
Aside from its header,
the object body is just a vector of \verb|min::gen| values.  The total
size \underline{includes} the header.

A \key{long object stub}\label{LONG-OBJECT-STUB} is collectible, has
\minnbkey{LONG\_OBJ}\LABEL{MIN::LONG_OBJ} stub type code, and has
a value that is a pointer to a \MUPkey{long\_obj} type body
which holds the 5 parts of the object.  A long object body is
the same as a short object body except the 4 area sizes
are 32-bit unsigned integers instead of 16-bit unsigned integers,
and extra implementation dependent information in the header may be
different.

A pointer to the body and the sizes can be obtained by the following
functions:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|MUP::short_obj * MUP::|
    & \MUPKEY{short\_obj\_of}\verb| ( min::stub * s )|
\LABEL{MUP::SHORT_OBJ_OF} \\
\verb|MUP::long_obj * MUP::|
    & \MUPKEY{long\_obj\_of}\verb| ( min::stub * s )|
\LABEL{MUP::LONG_OBJ_OF} \\
\verb|unsigned min::|
    & \MINKEY{hash\_size\_of}\verb| ( MUP::short_obj * so )|
\LABEL{MIN::HASH_TABLE_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned min::|
    & \MINKEY{hash\_size\_of}\verb| ( MUP::long_obj * lo )|
\LABEL{MIN::HASH_TABLE_SIZE_OF_LONG_OBJ} \\
\verb|unsigned min::| &
    \MINKEY{attr\_size\_of}\verb| ( MUP::short_obj * so )|
\LABEL{MIN::ATTR_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned min::|
    & \MINKEY{attr\_size\_of}\verb| ( MUP::long_obj * lo )|
\LABEL{MIN::ATTR_SIZE_OF_LONG_OBJ} \\
\verb|unsigned min::|
    & \MINKEY{aux\_size\_of}\verb| ( MUP::short_obj * so )|
\LABEL{MIN::AUX_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned min::|
    & \MINKEY{aux\_size\_of}\verb| ( MUP::long_obj * lo )|
\LABEL{MIN::AUX_SIZE_OF_LONG_OBJ} \\
\verb|unsigned min::|
    & \MINKEY{unused\_size\_of}\verb| ( MUP::short_obj * so )|
\LABEL{MIN::UNUSED_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned min::|
    & \MINKEY{unused\_size\_of}\verb| ( MUP::long_obj * lo )|
\LABEL{MIN::UNUSED_SIZE_OF_LONG_OBJ} \\
\verb|unsigned min::| & \MINKEY{header\_size\_of}\verb| ( MUP::short_obj * so )|
\LABEL{MIN::HEADER_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned min::| & \MINKEY{header\_size\_of}\verb| ( MUP::long_obj * lo )|
\LABEL{MIN::HEADER_SIZE_OF_LONG_OBJ} \\
\verb|unsigned min::| & \MINKEY{total\_size\_of}\verb| ( MUP::short_obj * so )|
\LABEL{MIN::TOTAL_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned min::| & \MINKEY{total\_size\_of}\verb| ( MUP::long_obj * lo )|
\LABEL{MIN::TOTAL_SIZE_OF_LONG_OBJ} \\
\end{tabular}\end{indpar}

Here the functions that return pointers do \underline{not} check the type
of the stub, and the pointers returned will become obsolete if the body of
the object is relocated (\secref{BODY-POINTERS}).

In order to create an object it is necessary to determine possible
hash table and total sizes.  The following functions return the smallest
possible size equal to or greater than the function argument,
\underline{unless} all possible sizes are less than the function argument,
in which case the largest possible size is returned.  The caller of
one of these functions must check the returned value to be sure it is
as large as the function argument.

\begin{indpar}\begin{tabular}{r@{}l}
\verb|unsigned min::|
    & \MINKEY{short\_obj\_hash\_size}\verb| ( unsigned u )|
\LABEL{MIN::SHORT_OBJ_HASH_TABLE_SIZE} \\
\verb|unsigned min::|
    & \MINKEY{short\_obj\_total\_size}\verb| ( unsigned u )|
\LABEL{MIN::SHORT_OBJ_TOTAL_SIZE} \\
\verb|unsigned min::|
    & \MINKEY{long\_obj\_hash\_size}\verb| ( unsigned u )|
\LABEL{MIN::LONG_OBJ_HASH_TABLE_SIZE} \\
\verb|unsigned min::|
    & \MINKEY{long\_obj\_total\_size}\verb| ( unsigned u )|
\LABEL{MIN::LONG_OBJ_TOTAL_SIZE} \\
\end{tabular}\end{indpar}

Maximum possible total and hash table size values can be determined
by presenting these functions with the \verb|u| argument value
`\verb|unsigned(-1)|'.

An object can be created by the protected function:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::gen min::| & \MINKEY{new\_obj\_gen\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( unsigned hash_size,| \\
    \verb|   unsigned unused_size )| \\
    \end{tabular}
\LABEL{MIN::NEW_OBJ_GEN} \\
\end{tabular}\end{indpar}

The hash table size of the returned object is the smallest possible
hash table size that is at least as large as that given.  The total
size of the returned object is the smallest possible total size
that is at least as large as the sum of the actual hash table size,
the unused area size given, and the header size.
The returned object is short if this total size is less than
$2^{16}$, and long otherwise.
It is a fatal programming error if no possible hash table or total size
is large enough, but this is unlikely, given the large sizes allowed
by a long object.

The hash table of the returned object is filled with \verb|min::LIST_END|
values (\pagref{MIN::LIST_END}), and is therefore an empty hash table.
The attribute vector and auxiliary areas of the returned object are
zero length, and all space not used by the header and hash table is
allocated to the unused area.  The attribute vector and auxiliary area can be
filled by `push' instructions described below (\pagref{OBJECT_PUSH_FUNCTIONS}).

At the \key{unprotected vector level}, the body is viewed as
a \key{body vector} of \verb|min::gen| values.  A pointer to the
body vector is returned by the following unprotected functions:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|const min::gen * MUP::|
	& \MUPKEY{body\_vector\_of}\verb| ( MUP::short_obj * so )|
\LABEL{MUP::BODY_VECTOR_OF_SHORT_OBJ} \\
\verb|const min::gen * MUP::|
	& \MUPKEY{body\_vector\_of}\verb| ( MUP::long_obj * lo )|
\LABEL{MUP::BODY_VECTOR_OF_LONG_OBJ} \\
\verb|min::gen * MUP::|
	& \MUPKEY{writable\_body\_vector\_of}\verb| ( MUP::short_obj * so )|
\LABEL{MUP::WRITABLE_BODY_VECTOR_OF_SHORT_OBJ} \\
\verb|min::gen * MUP::|
	& \MUPKEY{writable\_body\_vector\_of}\verb| ( MUP::long_obj * lo )|
\LABEL{MUP::WRITABLE_BODY_VECTOR_OF_LONG_OBJ} \\
\end{tabular}\end{indpar}

The {\tt MUP::body\_vector\_of} function allows only reading of elements.
The {\tt MUP::\EOL writable\_\EOL body\_\EOL vector\_\EOL of}
function allows reading and writing of elements.

The body vector is divided into 5 parts,
which are, in order, the body header,
hash table, attribute vector,
unused area, and auxiliary area.
The header and unused area are not actually \verb|min::gen| values,
and should not be accessed using a body vector pointer.

The value of an \key{auxiliary pointer}\label{OBJECT-BODY-AUXILIARY-POINTER}
stored in an object body (or in an object auxiliary stub attached to
the object: see~\secref{OBJECT-AUXILIARY-STUBS}) is an unsigned integer
that is the index of a \verb|min::gen|
value in the object body vector.
Auxiliary pointers with zero value do not address a body vector
element, since they point into the header, and these are given
special meanings.

The indices of the beginning of the hash table, beginning of the
attribute vector, and beginning of the auxiliary area can be
obtained by the following protected functions:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|unsigned min::|
	& \MINKEY{hash\_offset\_of}\verb| ( MUP::short_obj * so )|
\LABEL{MIN::HASH_OFFSET_OF_SHORT_OBJ} \\
\verb|unsigned min::|
	& \MINKEY{hash\_offset\_of}\verb| ( MUP::long_obj * lo )|
\LABEL{MIN::HASH_OFFSET_OF_LONG_OBJ} \\
\verb|unsigned min::|
	& \MINKEY{attr\_offset\_of}\verb| ( MUP::short_obj * so )|
\LABEL{MIN::ATTR_OFFSET_OF_SHORT_OBJ} \\
\verb|unsigned min::|
	& \MINKEY{attr\_offset\_of}\verb| ( MUP::long_obj * lo )|
\LABEL{MIN::ATTR_OFFSET_OF_LONG_OBJ} \\
\verb|unsigned min::|
	& \MINKEY{aux\_offset\_of}\verb| ( MUP::short_obj * so )|
\LABEL{MIN::AUX_OFFSET_OF_SHORT_OBJ} \\
\verb|unsigned min::|
	& \MINKEY{aux\_offset\_of}\verb| ( MUP::long_obj * lo )|
\LABEL{MIN::AUX_OFFSET_OF_LONG_OBJ} \\
\end{tabular}\end{indpar}

The attribute vector can be grown by pushing values onto its end.
The auxiliary area can be grown by pushing values onto its beginning;
\verb|aux_offset_of| returns the index of the last value pushed into
the auxiliary area.
In both cases, unused area is consumed.  The values pushed are
\verb|min::gen| values, and all sizes are calculated in units of
\verb|min::gen| values.  The following protected functions are
provided:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|unsigned min::|
	& \MINKEY{attr\_push} \\
	& \verb|    ( MUP::short_obj * so, min::gen value )|
\LABEL{MIN::SHORT_ATTR_PUSH_OF_GEN} \\
\verb|unsigned min::|
	& \MINKEY{attr\_push} \\
	& \verb|    ( MUP::short_obj * so, min::gen * p, unsigned n )|
\LABEL{MIN::SHORT_ATTR_PUSH_OF_GENS} \\
\verb|unsigned min::|
	& \MINKEY{aux\_push} \\
	& \verb|    ( MUP::short_obj * so, min::gen value )|
\LABEL{MIN::SHORT_AUX_PUSH_OF_GEN} \\
\verb|unsigned min::|
	& \MINKEY{aux\_push} \\
	& \verb|    ( MUP::short_obj * so, min::gen * p, unsigned n )|
\LABEL{MIN::SHORT_AUX_PUSH_OF_GENS} \\
\verb|unsigned min::|
	& \MINKEY{attr\_push} \\
	& \verb|    ( MUP::long_obj * lo, min::gen value )|
\LABEL{MIN::LONG_ATTR_PUSH_OF_GEN} \\
\verb|unsigned min::|
	& \MINKEY{attr\_push} \\
	& \verb|    ( MUP::long_obj * lo, min::gen * p, unsigned n )|
\LABEL{MIN::LONG_ATTR_PUSH_OF_GENS} \\
\verb|unsigned min::|
	& \MINKEY{aux\_push} \\
	& \verb|    ( MUP::long_obj * lo, min::gen value )|
\LABEL{MIN::LONG_AUX_PUSH_OF_GEN} \\
\verb|unsigned min::|
	& \MINKEY{aux\_push} \\
	& \verb|    ( MUP::long_obj * lo, min::gen * p, unsigned n )|
\LABEL{MIN::LONG_AUX_PUSH_OF_GENS} \\
\end{tabular}\end{indpar}\label{OBJECT_PUSH_FUNCTIONS}

Here the attribute vector push functions add to the end of the attribute
vector, and the auxiliary area push functions add to the beginning of
the auxiliary area.  Thus if values $V_1$ and $V_2$ are consecutively
pushed into the attribute vector, $V_1$ will be immediately before $V_2$
in the body vector,
but if they are consecutively pushed into the auxiliary area, $V_1$
will be immediately after $V_2$ in the body vector.

Four of the above functions push multiple values given by a vector
\verb|p| of \verb|n| \verb|min::gen| values.  These functions
preserve the order of the values in memory, so \verb|p[0]| is pushed
into a body vector location immediately before the location into which
\verb|p[1]| is pushed, etc.
Thus the attribute vector push function pushes
in the order \verb|p[0]|, \verb|p[1]|, \verb|p[2]|, \ldots; while the
auxiliary vector push function pushes
in the order \verb|p[n-1]|, \verb|p[n-2]|, \verb|p[n-3]|, \ldots.

All these functions return the index of the value pushed that is first
in memory (e.g., the index of the location into which \verb|p[0]| is
pushed).

All these functions check that the unused area has sufficient space for
the pushes, and signal a fatal program error if it does not.  The number
of values that can be pushed without signaling this error is just
the size of the unused area, which can be determined by the
\verb|min::unused_size_of| function
(\pagref{MIN::UNUSED_SIZE_OF_SHORT_OBJ}).

The following unprotected push functions are identical to the
similarly named protected functions, but include no check on the unused
area size:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|unsigned MUP::|
	& \MUPKEY{attr\_push} \\
	& \verb|    ( MUP::short_obj * so, min::gen value )|
\LABEL{MUP::SHORT_ATTR_PUSH_OF_GEN} \\
\verb|unsigned MUP::|
	& \MUPKEY{attr\_push} \\
	& \verb|    ( MUP::short_obj * so, min::gen * p, unsigned n )|
\LABEL{MUP::SHORT_ATTR_PUSH_OF_GENS} \\
\verb|unsigned MUP::|
	& \MUPKEY{aux\_push} \\
	& \verb|    ( MUP::short_obj * so, min::gen value )|
\LABEL{MUP::SHORT_AUX_PUSH_OF_GEN} \\
\verb|unsigned MUP::|
	& \MUPKEY{aux\_push} \\
	& \verb|    ( MUP::short_obj * so, min::gen * p, unsigned n )|
\LABEL{MUP::SHORT_AUX_PUSH_OF_GENS} \\
\verb|unsigned MUP::|
	& \MUPKEY{attr\_push} \\
	& \verb|    ( MUP::long_obj * lo, min::gen value )|
\LABEL{MUP::LONG_ATTR_PUSH_OF_GEN} \\
\verb|unsigned MUP::|
	& \MUPKEY{attr\_push} \\
	& \verb|    ( MUP::long_obj * lo, min::gen * p, unsigned n )|
\LABEL{MUP::LONG_ATTR_PUSH_OF_GENS} \\
\verb|unsigned MUP::|
	& \MUPKEY{aux\_push} \\
	& \verb|    ( MUP::long_obj * lo, min::gen value )|
\LABEL{MUP::LONG_AUX_PUSH_OF_GEN} \\
\verb|unsigned MUP::|
	& \MUPKEY{aux\_push} \\
	& \verb|    ( MUP::long_obj * lo, min::gen * p, unsigned n )|
\LABEL{MUP::LONG_AUX_PUSH_OF_GENS} \\
\end{tabular}\end{indpar}

The following (little used) pop
functions are the inverse of the above push functions:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|unsigned min::|
	& \MINKEY{attr\_pop} \\
	& \verb|    ( MUP::short_obj * so, min::gen & value )|
\LABEL{MIN::SHORT_ATTR_POP_OF_GEN} \\
\verb|unsigned min::|
	& \MINKEY{attr\_pop} \\
	& \verb|    ( MUP::short_obj * so, min::gen * p, unsigned n )|
\LABEL{MIN::SHORT_ATTR_POP_OF_GENS} \\
\verb|unsigned min::|
	& \MINKEY{aux\_pop} \\
	& \verb|    ( MUP::short_obj * so, min::gen & value )|
\LABEL{MIN::SHORT_AUX_POP_OF_GEN} \\
\verb|unsigned min::|
	& \MINKEY{aux\_pop} \\
	& \verb|    ( MUP::short_obj * so, min::gen * p, unsigned n )|
\LABEL{MIN::SHORT_AUX_POP_OF_GENS} \\
\verb|unsigned min::|
	& \MINKEY{attr\_pop} \\
	& \verb|    ( MUP::long_obj * lo, min::gen & value )|
\LABEL{MIN::LONG_ATTR_POP_OF_GEN} \\
\verb|unsigned min::|
	& \MINKEY{attr\_pop} \\
	& \verb|    ( MUP::long_obj * lo, min::gen * p, unsigned n )|
\LABEL{MIN::LONG_ATTR_POP_OF_GENS} \\
\verb|unsigned min::|
	& \MINKEY{aux\_pop} \\
	& \verb|    ( MUP::long_obj * lo, min::gen & value )|
\LABEL{MIN::LONG_AUX_POP_OF_GEN} \\
\verb|unsigned min::|
	& \MINKEY{aux\_pop} \\
	& \verb|    ( MUP::long_obj * lo, min::gen * p, unsigned n )|
\LABEL{MIN::LONG_AUX_POP_OF_GENS} \\
\end{tabular}\end{indpar}\label{OBJECT_POP_FUNCTIONS}

These functions undo the effects of the corresponding push functions,
and copy data in the reverse direction.
They respectively return the index of the
first body element after the attribute vector
(same value as {\tt min::attribute\_\EOL vector\_\EOL of\_\EOL ()
+ min::attribute\_\EOL vector\_\EOL size\_\EOL of()})
and the first auxiliary area element
(same value as {\tt min::aux\_\EOL area\_\EOL of\_\EOL ()}).

These functions check that there are enough elements left to pop,
and signal a fatal program error if not.
The following unprotected functions are identical to the above
functions but do not include this check.

\begin{indpar}\begin{tabular}{r@{}l}
\verb|unsigned MUP::|
	& \MUPKEY{attr\_pop} \\
	& \verb|    ( MUP::short_obj * so, min::gen value )|
\LABEL{MUP::SHORT_ATTR_POP_OF_GEN} \\
\verb|unsigned MUP::|
	& \MUPKEY{attr\_pop} \\
	& \verb|    ( MUP::short_obj * so, min::gen * p, unsigned n )|
\LABEL{MUP::SHORT_ATTR_POP_OF_GENS} \\
\verb|unsigned MUP::|
	& \MUPKEY{aux\_pop} \\
	& \verb|    ( MUP::short_obj * so, min::gen value )|
\LABEL{MUP::SHORT_AUX_POP_OF_GEN} \\
\verb|unsigned MUP::|
	& \MUPKEY{aux\_pop} \\
	& \verb|    ( MUP::short_obj * so, min::gen * p, unsigned n )|
\LABEL{MUP::SHORT_AUX_POP_OF_GENS} \\
\verb|unsigned MUP::|
	& \MUPKEY{attr\_pop} \\
	& \verb|    ( MUP::long_obj * lo, min::gen value )|
\LABEL{MUP::LONG_ATTR_POP_OF_GEN} \\
\verb|unsigned MUP::|
	& \MUPKEY{attr\_pop} \\
	& \verb|    ( MUP::long_obj * lo, min::gen * p, unsigned n )|
\LABEL{MUP::LONG_ATTR_POP_OF_GENS} \\
\verb|unsigned MUP::|
	& \MUPKEY{aux\_pop} \\
	& \verb|    ( MUP::long_obj * lo, min::gen value )|
\LABEL{MUP::LONG_AUX_POP_OF_GEN} \\
\verb|unsigned MUP::|
	& \MUPKEY{aux\_pop} \\
	& \verb|    ( MUP::long_obj * lo, min::gen * p, unsigned n )|
\LABEL{MUP::LONG_AUX_POP_OF_GENS} \\
\end{tabular}\end{indpar}


\subsubsection{Object List Level}
\label{OBJECT-LIST-LEVEL}

At the \key{list level},\label{LIST-LEVEL}
the body consists of two vectors whose
elements are lists.  The two vectors are the hash table, and the
attribute vector.  The elements of the lists are
\verb|min::gen| values other than the list or sublist auxiliary
pointers, and sublists.  The lists are constructed with
the help of the list and sublist auxiliary pointers:

\begin{center}
\begin{tabular}{lp{3in}}
\key{list auxiliary pointer} &
The list is continued at the target of the list auxiliary pointer.
\\[2ex]
\key{sublist auxiliary pointer}	&
A sublist starts at the target of the sublist auxiliary pointer.
\end{tabular}
\end{center}

Each auxiliary pointer contains the object body vector element index
of the auxiliary area element that is the target of the auxiliary pointer.

Lists also make use of two constant values:

\begin{indpar}
\begin{list}{}{}
\item[{\tt const min::gen min::}\MINKEY{LIST\_END}]~\LABEL{MIN::LIST_END}\\
The list ends here.
This actually equals a list auxiliary pointer with zero index.
\item[{\tt const min::gen min::}\MINKEY{EMPTY\_SUBLIST}]~%
	\LABEL{MIN::EMPTY_SUBLIST}\\
A list element value that represents an empty sublist.
This actually equals a sublist auxiliary pointer with zero index.
\end{list}
\end{indpar}

Each hash table or attribute vector element is a \key{list head}.
Each list head is a \key{list continuation}, which is an element of the
body vector that has a particular interpretation, described below.
However, not all list continuations are list heads.

A list continuation represents a final segment of a list.
If it has the value \verb|min::LIST_END|, the final segment is empty.
If the list continuation has a list auxiliary pointer value,
that pointer points at another list continuation that continues the list.
Otherwise the list continuation represents an element of the list,
and is called a \key{list element}.

A list element is an element of the list, and cannot be a list auxiliary
pointer or the special value \verb|min::LIST_END|.  But it can be
a sublist auxiliary pointer, or the special value \verb|min::EMPTY_SUBLIST|,
both of which denote a list element that is a sublist.

Given a list element, the rest of the list after the element begins with
a list continuation that has an index one less than that of the list
element within the object body vector, unless the list element is a
list head, in which case there is no next element, and the list has only
one element.  All list heads lie in the hash table or attribute vector,
so testing whether a list element is a list head can be done if just the
index of the list element in the body vector is known.

A list element
that is a sublist auxiliary pointer or the value \verb|min::EMPTY_SUBLIST|
represents a sublist, and is the \key{sublist head} of that sublist.  A
sublist head is a list element of the list containing a sublist,
but cannot be a list element of the sublist.
If it is a sublist auxiliary pointer,
it points at a list continuation of the sublist.  If it is the
value \verb|min::EMPTY_SUBLIST|, it represents an empty sublist.

There are several rules that the list level obeys that lead to
some efficiencies:

\begin{indpar}
{\bf No Superfluous {\tt \bf min::LIST\_END}'s}.%
\index{superfluous LIST_END@superfluous {\tt LIST\_END}}%
\label{NO-SUPERFLUOUS-LIST}
A list or sublist auxiliary pointer may not point at an auxiliary
area element containing a \verb|min::LIST_END| value.

{\bf No Superfluous List Auxiliary Pointers}.%
\index{superfluous list auxiliary pointers}
A list or sublist auxiliary pointer may not point at an auxiliary
area element containing a list auxiliary pointer.

{\bf No List Sharing}.%
\index{list sharing}
Parts of lists may not be shared with other lists.  In other words,
there is only one way to reach any element of the auxiliary area.

Or more specifically, list and sublist
auxiliary pointers must point at elements of the auxiliary area,
two list or sublist auxiliary pointers are not permitted to point
at the same auxiliary
area element, and an auxiliary area element that is followed
in the auxiliary area by a list element may not be pointed at by
a list or sublist auxiliary pointer (because the list element
in effect points at the auxiliary area element as being the
continuation of the list containing the list element).
\end{indpar}

Thus if the one way to reach an element of
the auxiliary area is deleted, the element may be put on a list of
free elements for the auxiliary area.  As an optimization,
an implementation may use the unused area or space in the object's header
to hold the head of a list of free elements of the auxiliary
area.

As an optimization, \skey{auxiliary stub}s can be used in place of object
auxiliary area elements.  When this is done, the description of this
section must be modified as explained in \secref{OBJECT-AUXILIARY-STUBS}.

\subsubsubsection{List Pointers}
\label{LIST-POINTERS}

A \MUPkey{list\_pointer} can be used to move around in a object at
the list level.  The functions for using a list pointer to do this
are:

\begin{indpar}\begin{tabular}{r@{}l}
(constructor)~\verb|MUP::|
	& \MUPKEY{list\_pointer}\verb| ( min::stub * s )|
\LABEL{MUP::LIST_POINTER_OF_STUB} \\
(constructor)~\verb|MUP::|
	& \MUPKEY{list\_pointer}\verb| ( min::gen obj )|
\LABEL{MUP::LIST_POINTER_OF_GEN} \\
\verb|min::gen min::|
	& \MINKEY{start\_hash}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::list_pointer & lp,| \\
	  \verb|   unsigned index )|
	  \end{tabular}
\LABEL{MIN::START_HASH} \\
\verb|min::gen min::|
	& \MINKEY{start\_vector}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::list_pointer & lp,| \\
	  \verb|   unsigned index )|
	  \end{tabular}
\LABEL{MIN::START_VECTOR} \\
\verb|min::gen min::|
	& \MINKEY{start\_copy}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::list_pointer & lp,| \\
	  \verb|   const min::list_pointer & lp2 )|
	  \end{tabular}
\LABEL{MIN::START_COPY} \\
\verb|min::gen min::|
	& \MINKEY{next}\verb| ( min::list_pointer & lp )|
\LABEL{MIN::NEXT_OF_LIST_POINTER} \\
\verb|min::gen min::|
	& \MINKEY{current}\verb| ( min::list_pointer & lp )|
\LABEL{MIN::CURRENT_OF_LIST_POINTER} \\
\verb|min::gen min::|
	& \MINKEY{start\_sublist}\verb| ( min::list_pointer & lp )|
\LABEL{MIN::START_SUBLIST} \\
\verb|bool min::|
	& \MINKEY{is\_list\_end}\verb| ( min::gen v )|
\LABEL{MIN::IS_LIST_END} \\
\verb|bool min::|
	& \MINKEY{is\_sublist}\verb| ( min::gen v )|
\LABEL{MIN::IS_SUBLIST} \\
\verb|bool min::|
	& \MINKEY{is\_empty\_sublist}\verb| ( min::gen v )|
\LABEL{MIN::IS_EMPTY_SUBLIST} \\
\end{tabular}\end{indpar}

A list pointer is created to move around in a particular object.
Once created it can be started on a new list by one of the
list \skey{start list function}s,
{\tt start\_hash}, {\tt start\_vector}, or {\tt start\_copy}
(note {\tt start\_sublist} is \underline{not} a start list function).
If the object is relocated,
the list pointer must be reinitialized by re-calling
a start list function.  Relocating an object
can also reorganize the object, in which case body vector indices pointing
into the attribute vector or auxiliary area may change,
invalidating positioning information
contained in any list pointer pointing into the object.

\begin{quote}
\key{Hash Table Reorganization Note}:\label{HASH-TABLE-REORGANIZATION-NOTE}
A hash table is reorganized in order to change its size and make it
either larger and more efficient or smaller and more compact.  However,
to reorganized a hash table one needs more information than is provided by
the object list level.  The object attribute level
(\secref{OBJECT-ATTRIBUTE-LEVEL}) provides such
information, so a hash table organized according to the rules of the
object attribute level can be reorganized according to those rules.
\end{quote}

The {\tt start\_hash} function positions a list pointer at the beginning of the
list whose head is at the given index within the hash table, treating the
hash table as a vector.  This function returns the value of the first
element of the list, or returns {\tt min::LIST\_END} if the list is empty.
The index is usually the hash value of a name component
(number, string, or label),
modulo the size of the hash table,
but exactly how the index is computed is not determined by the object
list level.  Index 0 refers to the first element of the
hash table, and the maximum index is the size of the hash table minus 1.
The index is \underline{not} a body vector index.

The {\tt start\_vector} function is analogous except it is given
an index within the object attribute vector and positions the list pointer
at the beginning of the list whose head is the attribute vector element
at that index.  Index 0 refers to the first element of the attribute vector,
and the maximum index is the size of the attribute vector minus 1.
The index is \underline{not} a body vector index.

The {\tt start\_copy} function positions a list pointer ({\tt lp})
to the same place as another list pointer ({\tt lp2}).
The two list pointers must have been constructed to reference the same object.

The {\tt next} function moves the list pointer to the next list element of the
list the pointer points at, and returns the value of that
list element.  It returns {\tt min::LIST\_END} if there is
no next list element because the end of the list has been reached.
Thus after the end of a list has been reached, additional
calls to {\tt next} will do nothing but return {\tt min::LIST\_END}.

The {\tt current} function just returns the value of the list
element the list pointer currently points at, or returns {\tt min::LIST\_END}
if there is no such element because the pointer is at the end of a list.

The value of a list element can represent a sublist.  When a list pointer
points at a list element representing a sublist, the
{\tt start\_sublist} function can be called to position the
list pointer at the first element of the sublist.
This function returns the value of the first element of
the sublist, or returns {\tt min::LIST\_END} if the sublist is empty.

It is an error to call {\tt start\_sublist} if the list pointer points at an
element E that is not a sublist, or if the list pointer
points at the end of a list.

Determining whether a list pointer current element value
represents a sublist requires
the {\tt min::is\_sublist} function, which must check whether the
value is a sublist auxiliary pointer, is the value {\tt min::EMPTY\_SUBLIST},
or is a pointer to a sublist auxiliary stub as described in
\secref{OBJECT-AUXILIARY-STUBS}.  The {\tt min::is\_empty\_sublist}
function, on the other hand, merely checks whether the value is
{\tt min::EMPTY\_SUBLIST}.

Determining whether a list pointer current element value
represents the end of a list can be done by
simply checking whether the value equals {\tt min::LIST\_END},
or can be done equivalently
with the {\tt min::is\_list\_end} function.

Often it is necessary to discover the size of an object's hash table
or attribute vector before calling {\tt start\_hash} or
{\tt start\_vector}.  While this can be done independently of list
pointers, it is most efficiently done by using the following unprotected
functions:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|void MUP::|
	& \MUPKEY{start}\verb| ( min::list_pointer & lp )|
\LABEL{MUP::START_LIST_POINTER} \\
\verb|unsigned MUP::|
	& \MUPKEY{hash\_size\_of}\verb| ( min::list_pointer & lp )|
\LABEL{MUP::HASH_SIZE_OF_LIST_POINTER} \\[1ex]
\verb|unsigned MUP::|
	& \MUPKEY{vector\_size\_of}\verb| ( min::list_pointer & lp )|
\LABEL{MUP::VECTOR_SIZE_OF_LIST_POINTER} \\
\verb|min::gen MUP::|
	& \MUPKEY{start\_hash}%
	  \verb| ( min::list_pointer & lp, unsigned index )|
\LABEL{MUP::START_HASH} \\
\verb|min::gen MUP::|
	& \MUPKEY{start\_vector}%
	  \verb| ( min::list_pointer & lp, unsigned index )|
\LABEL{MUP::START_VECTOR} \\
\end{tabular}\end{indpar}

The {\tt MUP::start} function \underline{must} be called before
any of the other functions.  Then the {\tt MUP::hash\_size\_of}
and {\tt MUP::attr\_size\_of} functions can be called to
discover the hash table and attribute vector sizes, followed
by the {\tt MUP::start\_hash} or {\tt MUP::start\_vector} functions.
The {\tt min::start\_hash} function described above simply calls
{\tt MUP::start} followed by {\tt MUP::start\_hash}, and
{\tt min::start\_vector} similarly calls
{\tt MUP::\EOL start} followed by {\tt MUP::\EOL start\_vector}.

The {\tt MUP::start} function can also be used just to put a list
pointer in a state where {\tt min::current} always returns
{\tt min::LIST\_END} and {\tt min::next} as no effect.

A {\tt MUP::list\_pointer} cannot be used to modify a list.  If the
only modifications desired are changing existing list elements, you can
use a {\tt MUP::updat\-able\_\EOL list\_\EOL pointer}.
All the functions
defined for {\tt MUP::list\_\EOL pointer}'s are also defined for
{\tt MUP::updat\-able\_\EOL list\_\EOL pointer}'s:

\begin{indpar}\begin{tabular}{r@{}l}
(constructor)~\verb|MUP::|
	& \MUPKEY{updatable\_list\_pointer}\verb| ( min::stub * s )|
\LABEL{MUP::UPDATABLE_LIST_POINTER_OF_STUB} \\
(constructor)~\verb|MUP::|
	& \MUPKEY{updatable\_list\_pointer}\verb| ( min::gen obj )|
\LABEL{MUP::UPDATABLE_LIST_POINTER_OF_GEN} \\
\verb|min::gen min::|
	& \MINKEY{start\_hash}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::updatable_list_pointer & lp,| \\
	  \verb|   unsigned index )|
	  \end{tabular}
\LABEL{MIN::START_HASH_OF_UPDATABLE} \\
\verb|min::gen min::|
	& \MINKEY{start\_vector}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::updatable_list_pointer & lp,| \\
	  \verb|   unsigned index )|
	  \end{tabular}
\LABEL{MIN::START_VECTOR_OF_UPDATABLE} \\
\verb|min::gen min::|
	& \MINKEY{start\_copy} \\
	& \verb|    ( min::updatable_list_pointer & lp,| \\
	& \verb|      const min::updatable_list_pointer & lp2 )|
\LABEL{MIN::START_COPY_OF_UPDATABLE} \\
\verb|min::gen min::|
	& \MINKEY{next}\verb| ( min::updatable_list_pointer & lp )|
\LABEL{MIN::NEXT_OF_LIST_POINTER_OF_UPDATABLE} \\
\verb|min::gen min::|
	& \MINKEY{current}\verb| ( min::updatable_list_pointer & lp )|
\LABEL{MIN::CURRENT_OF_LIST_POINTER_OF_UPDATABLE} \\
\verb|min::gen min::|
	& \MINKEY{start\_sublist}\verb| ( min::updatable_list_pointer & lp )|
\LABEL{MIN::START_SUBLIST_OF_UPDATABLE} \\
\end{tabular}\end{indpar}

\begin{indpar}\begin{tabular}{r@{}l}
\verb|void MUP::|
	& \MUPKEY{start}\verb| ( min::updatable_list_pointer & lp )|
\LABEL{MUP::START_LIST_POINTER_OF_UPDATABLE} \\
\verb|unsigned MUP::|
	& \MUPKEY{hash\_size\_of}\verb| ( min::updatable_list_pointer & lp )|
\LABEL{MUP::HASH_SIZE_OF_LIST_POINTER_OF_UPDATABLE} \\[1ex]
\verb|unsigned MUP::|
	& \MUPKEY{vector\_size\_of}\verb| ( min::updatable_list_pointer & lp )|
\LABEL{MUP::VECTOR_SIZE_OF_LIST_POINTER_OF_UPDATABLE} \\
\verb|min::gen MUP::|
	& \MUPKEY{start\_hash}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::updatable_list_pointer & lp,| \\
	  \verb|   unsigned index )| \\
	  \end{tabular}
\LABEL{MUP::START_HASH_OF_UPDATABLE} \\
\verb|min::gen MUP::|
	& \MUPKEY{start\_vector}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::updatable_list_pointer & lp,| \\
	  \verb|   unsigned index )| \\
	  \end{tabular}
\LABEL{MUP::START_VECTOR_OF_UPDATABLE} \\
\end{tabular}\end{indpar}

In addition the following function can be used to change the
current element:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|void min::|
	& \MINKEY{update}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::updatable_list_pointer & lp,| \\
	  \verb|   min::gen value )| \\
	  \end{tabular}
\LABEL{MIN::SET_OF_UPDATABLE} \\
\end{tabular}\end{indpar}

Neither the previous value of the element nor the
new value of the element may be {\tt min::LIST\_\EOL END}.

The previous value of the element may be a sublist head, in which
case setting the element will make the sublist elements inaccessible,
and will make any list pointers pointing at the sublist or at other
sublists accessible only through the sublist invalid.
The new value of the element may be {\tt min::EMPTY\_SUBLIST},
but cannot be any other kind of sublist.

If an element is set in this way, any other list pointer pointing at
that element will likely become invalid, because list pointers
cache the current element they are pointing at.  However list
pointers that have been made invalid in this way
can be quickly made valid again by the following function that
refreshes the cache and returns the current element:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min:gen min::|
	& \MINKEY{refresh}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::list_pointer & lp )| \\
	  \end{tabular}
\LABEL{MIN::REFRESH_OF_LIST_POINTER} \\
\verb|min:gen min::|
	& \MINKEY{refresh}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::updatable_list_pointer & lp )| \\
	  \end{tabular}
\LABEL{MIN::REFRESH_OF_LIST_POINTER_OF_UPDATABLE} \\
\end{tabular}\end{indpar}

Inserting and removing elements from a list requires yet another
kind of list pointer, a {\tt MUP::insert\-able\_\EOL list\_\EOL pointer}.
All functions
defined for {\tt MUP::updat\-able\_list\_\EOL point\-er}'s are also defined for
{\tt MUP::insert\-able\_\EOL list\_\EOL pointer}'s:

\begin{indpar}\begin{tabular}{r@{}l}
(constructor)~\verb|MUP::|
	& \MUPKEY{insertable\_list\_pointer}\verb| ( min::stub * s )|
\LABEL{MUP::INSERTABLE_LIST_POINTER_OF_STUB} \\
(constructor)~\verb|MUP::|
	& \MUPKEY{insertable\_list\_pointer}\verb| ( min::gen obj )|
\LABEL{MUP::INSERTABLE_LIST_POINTER_OF_GEN} \\
\verb|min::gen min::|
	& \MINKEY{start\_hash}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::insertable_list_pointer & lp,| \\
	  \verb|   unsigned index )|
	  \end{tabular}
\LABEL{MIN::START_HASH_OF_INSERTABLE} \\
\verb|min::gen min::|
	& \MINKEY{start\_vector}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::insertable_list_pointer & lp,| \\
	  \verb|   unsigned index )|
	  \end{tabular}
\LABEL{MIN::START_VECTOR_OF_INSERTABLE} \\
\verb|min::gen min::|
	& \MINKEY{start\_copy} \\
	& \verb|    ( min::insertable_list_pointer & lp,| \\
	& \verb|      const min::insertable_list_pointer & lp2 )|
\LABEL{MIN::START_COPY_OF_INSERTABLE} \\
\verb|min::gen min::|
	& \MINKEY{next}\verb| ( min::insertable_list_pointer & lp )|
\LABEL{MIN::NEXT_OF_LIST_POINTER_OF_INSERTABLE} \\
\verb|min::gen min::|
	& \MINKEY{current}\verb| ( min::insertable_list_pointer & lp )|
\LABEL{MIN::CURRENT_OF_LIST_POINTER_OF_INSERTABLE} \\
\verb|min::gen min::|
	& \MINKEY{start\_sublist}\verb| ( min::insertable_list_pointer & lp )|
\LABEL{MIN::START_SUBLIST_OF_INSERTABLE} \\
\verb|void min::|
	& \MINKEY{update}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::insertable_list_pointer & lp,| \\
	  \verb|   min::gen value )| \\
	  \end{tabular}
\LABEL{MIN::SET_OF_INSERTABLE} \\
\verb|min:gen min::|
	& \MINKEY{refresh}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::insertable_list_pointer & lp )| \\
	  \end{tabular}
\LABEL{MIN::REFRESH_OF_LIST_POINTER_OF_INSERTABLE} \\
\end{tabular}\end{indpar}

\begin{indpar}\begin{tabular}{r@{}l}
\verb|void MUP::|
	& \MUPKEY{start}\verb| ( min::insertable_list_pointer & lp )|
\LABEL{MUP::START_LIST_POINTER_OF_INSERTABLE} \\
\verb|unsigned MUP::|
	& \MUPKEY{hash\_size\_of}\verb| ( min::insertable_list_pointer & lp )|
\LABEL{MUP::HASH_SIZE_OF_LIST_POINTER_OF_INSERTABLE} \\[1ex]
\verb|unsigned MUP::|
	& \MUPKEY{vector\_size\_of}\verb| ( min::insertable_list_pointer & lp )|
\LABEL{MUP::VECTOR_SIZE_OF_LIST_POINTER_OF_INSERTABLE} \\
\verb|min::gen MUP::|
	& \MUPKEY{start\_hash}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::insertable_list_pointer & lp,| \\
	  \verb|   unsigned index )| \\
	  \end{tabular}
\LABEL{MUP::START_HASH_OF_INSERTABLE} \\
\verb|min::gen MUP::|
	& \MUPKEY{start\_vector}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::insertable_list_pointer & lp,| \\
	  \verb|   unsigned index )| \\
	  \end{tabular}
\LABEL{MUP::START_VECTOR_OF_INSERTABLE} \\
\end{tabular}\end{indpar}

Making insertions in object lists requires reservation of the necessary
space first, in order to be sure that a sequence of insertions will
all succeed.  The functions used are:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|void min::|
	& \MINKEY{insert\_reserve\REL}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::insertable_list_pointer & lp,| \\
	  \verb|   unsigned insertions,| \\
	  \verb|   unsigned elements = 0,| \\
	  \verb|   bool use_object_aux_stubs =| \\
	  \verb|       min::use_object_aux_stubs )| \\
	  \end{tabular}
\LABEL{MIN::INSERT_RESERVE} \\
\verb|void min::|
	& \MINKEY{insert\_before}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::insertable_list_pointer & lp,| \\
	  \verb|   min::gen * p, unsigned n )| \\
	  \end{tabular}
\LABEL{MIN::INSERT_BEFORE} \\
\verb|void min::|
	& \MINKEY{insert\_after}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::insertable_list_pointer & lp,| \\
	  \verb|   min::gen * p, unsigned n )| \\
	  \end{tabular}
\LABEL{MIN::INSERT_AFTER} \\
\end{tabular}\end{indpar}

The {\tt min::insert\_reserve} function reserves space for the given number
of insertion function calls and the given total number of list elements
to be inserted.  If the later is {\tt 0}, the default, it is taken to
be equal to the number of insertion function calls.  If space is not
reserved for insertion function calls in this way, the calls will be
in error.

The {\tt min::insert\_reserve} function may \underline{not}
be called for a pointer before any {\tt start}
function is called to set the pointer (but \verb|MUP::start| will do).
However, calling a {\tt start} function after {\tt min::insert\_reserve}
does \underline{not} cancel or alter the reservation made by
{\tt min::insert\_\EOL reserve}.

Only one pointer at a time for a given object may have an effective reservation.
Each call to {\tt min::insert\_reserve} for a list pointer
to an object invalidates
all previous calls to {\tt min::insert\_reserve} for any list pointer
to the same object.  Errors in this regard involving two different
list pointers are not detected.

Note that {\tt min::insert\_reserve} is the only list pointer
function that may cause a relocation, and if a relocation occurs,
all list pointers become invalid and must be restarted.

The {\tt min::insert\_reserve} function can increase the size of the object
if it is insufficient, or instead it can depend upon using
object auxiliary stubs (\secref{OBJECT-AUXILIARY-STUBS}) if the object
runs out of space, in which case {\tt min::insert\_reserve} must be sure
there are sufficient free stubs to satisfy the insertion calls.  The
last argument to {\tt min::insert\_reserve} determines which strategy is
used.  It defaults to the value of \minkey{use\_object\_aux\_stubs}.%
\footnote{But if the auxiliary stub code is not compiled in, the last
argument is treated as if it was always {\tt false}:
see {\tt MIN\_\EOL USES\_\EOL OBJECT\_\EOL AUX\_\EOL STUBS} on
\pagref{MIN_USES_OBJECT_AUX_STUBS}.}


The {\tt min::insert\_before} function inserts list elements
just before the current position of a list pointer.
The {\tt min::insert\_after} function inserts list elements just after the
current position.  If the list pointer is at the end of list,
{\tt min::insert\_before} inserts the elements at the end of the list, and
{\tt min::insert\_after} is in error.  The list pointer continues to point
at the list element it pointed at before elements were inserted.
The elements are specified by a length {\tt n}
vector {\tt p} of {\tt min::gen} values.

To insert a sublist, first insert {\tt min::EMPTY\_SUBLIST}, then
position the pointer to the sublist and use
{\tt min::start\_sublist} to enter the sublist, and then use
{\tt min::insert\_before} to insert the elements of the sublist.

A sequence of instructions that begins with a
call to {\tt min::insert\_reserve} and ends with the last
list insertion function for which the beginning call made a reservation
is called a `\key{list insertion sequence}'.  A list insertion sequence
must not contain any call to
a relocating (\REL) function (\pagref{RELOCATING-FUNCTIONS}), aside from
the beginning call to {\tt min::insert\_reserve}.  In particular, there can
be no call to {\tt min::interrupt\REL} (\pagref{MIN::INTERRUPT}) and no
second call to {\tt min::insert\_reserve\REL}.  There can be calls to
create and position list pointers.

The following function can be used to remove {\tt n} consecutive elements
of a list, the first of which is the element currently pointed at by
the list pointer:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|unsigned min::|
	& \MINKEY{remove}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::insertable_list_pointer & lp,| \\
	  \verb|   unsigned n = 1 )|
	  \end{tabular}
\LABEL{MIN::REMOVE_FROM_LIST} \\
\end{tabular}\end{indpar}

After removal, the list pointer points at the first element after the
elements removed, or at the end of the list if there is no such element.
If there are fewer than {\tt n} elements in the list at and after
the list pointer current element, then there is no error, but all the
elements at and after the current element are removed, and the list
pointer is pointed at the end of the list.  The returned value is the
number of elements actually removed (and is less than {\tt n} if the
list was too short).  Element removal requires no reservation.

If there are two list pointers, $P_1$ and $P_2$, pointing at list
elements in the same object, and $P_1$
is used to insert or remove elements from the list it points at,
then $P_2$ will be invalidated if:

\begin{enumerate}
\item
$P_2$ points at a removed element.  This includes elements explicitly
removed by the operation on $P_1$, and also elements reachable via
sublists from these elements.  The list structure of an object is a tree
(and \underline{not} a more general acyclic directed graph), and removing
any element removes all descendants of that element.

\item
The $P_1$ operation does an {\tt insert\_before} element $e$
or an {\tt insert\_after} element
$e$, and:
\begin{enumerate}
\item $P_2$ pointed at $e$.
\item $e$ is a sublist and $P_2$ is an insertable pointer that
pointed at $e$'s first element.
\item $e$ is an empty sublist and $P_2$ is an insertable pointer that
pointed at $e$'s end.
\end{enumerate}

\end{enumerate}

The effects can be subtle
and not obvious: for example, using $P_1$ to insert before or after
a list element that is an empty sublist can invalidate $P_2$
if it points at the end of that sublist.

The invalidation of $P_2$ in the above situations
is \underline{not} a detectable error
(just as the invalidation of list pointers by relocation is not
detectable).

\begin{quote}
\key{List Implementation Note}:\label{LIST-IMPLEMENTATION-NOTE}
In order to enforce the `No Superfluous' rules on 
\pagref{NO-SUPERFLUOUS-LIST}, {\tt MUP::insertable\_list\_pointer}'s keep
track of any auxiliary value
(or equivalent as per \secref{OBJECT-AUXILIARY-STUBS})
pointing a the current
element.  Insertions before or after the current element may change
this auxiliary value, and may move the current element to another
location.  Otherwise insertions replace the current element
by an auxiliary value (or equivalent)
pointing at a vector of elements (or equivalent),
one of which is a copy of the replaced element.
This last is done for insertions after the single element of a one
element list headed in the hash table or attribute vector.
Any insertion before the end of a list of such a single element list
is transformed into an insertion after the list's single element.
\end{quote}

The {\tt min::start\_copy} function can be used to downgrade the
kind of a list pointer, e.g., going from an insertable to a writable
list pointer:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::gen min::|
	& \MINKEY{start\_copy}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::|$xx$\verb|list_pointer & lp,| \\
	  \verb|   const min::|$yy$\verb|list_pointer & lp2 )|
	  \end{tabular}
\LABEL{MIN::START_COPY_XX_YY} \\
\end{tabular}

where the permitted values of the list pointer `kinds', $xx$ and $yy$, are:

\begin{tabular}{ll}
$xx$ & $yy$ \\[1ex]
`'				& `' \\
`'				& `\verb|writable_|' \\
`'				& `\verb|insertable_|' \\
`\verb|writable_|'		& `\verb|writable_|' \\
`\verb|writable_|'		& `\verb|insertable_|' \\
`\verb|insertable_|'		& `\verb|insertable_|' \\
\end{tabular}

\end{indpar}

The two argument {\tt min::start\_sublist} function is equivalent
to {\tt start\_copy} followed by {\tt start\_sublist} on just the
first argument of {\tt start\_copy}, except the kind of the list
pointer can be either downgraded or upgraded,
e.g., going from an ordinary (read-only) list
pointer to an insertable list pointer or vice versa:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::gen min::|
	& \MINKEY{start\_sublist}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::|$xx$\verb|list_pointer & lp,| \\
	  \verb|   const min::|$yy$\verb|list_pointer & lp2 )|
	  \end{tabular}
\LABEL{MIN::START_SUBLIST_XX_YY} \\
\end{tabular}

where $xx$ is one of `', `\verb|writable_|', or `\verb|insertable_|', \\
and $yy$ is independently
one of `', `\verb|writable_|', or `\verb|insertable_|'.

\end{indpar}

As a matter of convenience, the pointer to the stub of the object
that a list pointer is associated with can be retrieved
by the {\tt min::stub\_of} function:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::stub * min::|
	& \MINKEY{stub\_of}\verb| ( min::|$xx$\verb|list_pointer & lp )|
\LABEL{MIN::STUB_OF_LIST_POINTER_XX} \\
\end{tabular}

where $xx$ is one of `', `\verb|writable_|', or `\verb|insertable_|'.

\end{indpar}

\subsubsubsection{Object Auxiliary Stubs}
\label{OBJECT-AUXILIARY-STUBS}

As an optimization, \skey{object auxiliary stub}s\index{auxiliary stub!object}
can be used instead of object
auxiliary area elements.  Object auxiliary stubs are a way of adding
list elements to
an object whose unused area has been exhausted, without relocating the
object, and are considered to be \skey{extension}s of the object.
If the object is later relocated, it can be reorganized to
eliminate the use of any object auxiliary stubs that extend the object
by moving information from these into a new larger object auxiliary area.

The code implementing object auxiliary stubs can be compiled into a program
or left out of a program according to the setting of the macro:


\begin{indpar}
\begin{tabular}{l}
\TTNBKEY{MIN\_USES\_OBJECT\_AUX\_STUBS} \\
~~~~~ 1 if code to use object auxiliary stubs is to be compiled; \\
~~~~~ 0 if this code is not to be compiled.
\LABEL{MIN_USES_OBJECT_AUX_STUBS} \\
\end{tabular}
\end{indpar}

The value of an object
auxiliary stub is treated like an auxiliary area element value that is
always a list element, and is never a list auxiliary pointer
or a \verb|min::LIST_END| value.  However, as a list element,
the value may be a sublist auxiliary pointer (or equivalent, see below)
or a \verb|min::EMPTY_SUBLIST| value.

The control of an object auxiliary stub is treated like an auxiliary
area element value that is always a list auxiliary pointer
or a \verb|min::LIST_END| value, and is never a list element.

The value and control of an object auxiliary stub are treated like
consecutive elements of the object auxiliary area, with the control
preceding the value in the area, and therefore
following the value in list order.

An object auxiliary stub has one of the following two uncollectible stub type
codes:

\begin{indpar}
\begin{list}{}{}
\item[{\tt const int min::}\MINKEY{LIST\_AUX}]~%
	\LABEL{MIN::LIST_AUX}\\
A \verb|min::gen| value or stub control
pointing at this stub behaves like a list pointer.
\item[{\tt const int min::}\MINKEY{SUBLIST\_AUX}]~%
	\LABEL{MIN::SUBLIST_AUX}\\
A \verb|min::gen| value pointing at this stub behaves like a sublist pointer.
\end{list}
\end{indpar}

Any stub pointer to an object auxiliary stub of type \minnbkey{LIST\_AUX}
is treated as a list auxiliary pointer.  Such stub pointers may be stored in
auxiliary area \verb|min::gen| values or in auxiliary stub controls.

Any stub pointer to an object auxiliary stub of type \minnbkey{SUBLIST\_AUX}
is treated as a sublist auxiliary pointer.  Such stub pointers may be stored in
auxiliary area \verb|min::gen| values or in auxiliary stub \verb|min::gen|
values.

Thus the following rules are obeyed:

\begin{indpar}

{\bf \minnbkey{LIST\_AUX} stubs}.
An auxiliary area element
holding a \verb|min::gen| value that points at a stub $S$
of type \verb|min::LIST_AUX| is the equivalent of a list auxiliary
pointer pointing at the list element that is stub $S$'s value.

If the control of an object auxiliary stub holds a stub pointer, that pointer
must point at an object auxiliary stub $S$ of type \verb|min::LIST_AUX| and the
control is the equivalent of a list auxiliary pointer pointing at
the list element that is stub $S$'s value.

{\bf \minnbkey{SUBLIST\_AUX} stubs}.
An auxiliary area element holding a \verb|min::gen| value that points at
a stub $S$
of type \verb|min::SUBLIST_AUX| is the equivalent of a sublist auxiliary
pointer pointing at the list element that is stub $S$'s value.

An object auxiliary stub \verb|min::gen| value that points at
a stub $S$ of type {\tt min::\EOL SUBLIST\_\EOL AUX}
is the equivalent of a sublist auxiliary
pointer pointing at the list element that is stub $S$'s value.

{\bf Values of Object Auxiliary Stubs}.%
\index{value!of object auxiliary stub}
An object auxiliary stub value is always a list element, and can never
be a list auxiliary pointer value, a \verb|min::gen| value pointing at
a stub of type \verb|min::LIST_AUX|, or a \verb|min::LIST_END| value.

However, it can be a sublist auxiliary pointer value, a \verb|min::gen|
value pointing at a stub of type \verb|min::SUBLIST_AUX|, or a
\verb|min::EMPTY_SUBLIST| value.

{\bf Controls of Object Auxiliary Stubs}.%
\index{control!of object auxiliary stub}
An object auxiliary stub control is never a list element, and must
be a list auxiliary pointer value, a stub pointer value pointing at
a stub of type \verb|min::LIST_AUX|, or a \verb|min::LIST_END| value.

{\bf Pointers to Object Auxiliary Stubs}.%
\index{pointer!to object auxiliary stub}
Every object auxiliary stub is pointed at by a \verb|min::gen|
value or by the control of another object auxiliary stub.  There is
only one such pointer pointing at each object auxiliary stub.
A \verb|min::gen| value pointing at an object auxiliary stub $S$
must the the value of an auxiliary area element or the value of
an object auxiliary stub, and in this latter case $S$ must be of type
\verb|min::SUBLIST_AUX|.

\end{indpar}

If the auxiliary area of an object has enough space, these rules
by themselves may be used to relocate all the information in the
object's auxiliary stubs to the object's auxiliary area.  The result
must obey the object list level rules of \secref{OBJECT-LIST-LEVEL}.
This means, for example, that a list auxiliary pointer cannot point
at an auxiliary area element that holds a \verb|min::gen| value
pointing at an object auxiliary stub of type \verb|min::LIST_AUX|,
as this would be equivalent to a list auxiliary pointer pointing at an
element holding another list auxiliary pointer.

The use of object auxiliary stubs by an implementation is hidden from
the user of MIN by object list level functions.  There are no functions
for dealing explicitly with object auxiliary stubs.  There are, however,
functions to read and write stubs of all kinds in
\secref{UNPROTECTED-STUB-FUNCTIONS}, though the only use of these functions on
object auxiliary stubs would be for debugging.

\subsubsection{Object Attribute Level}
\label{OBJECT-ATTRIBUTE-LEVEL}

At the \key{attribute level}\,, the object is a map from attribute-names to
flags and multi-sets of values and from attribute-name/reverse-attribute-name
pairs to multi-sets of values.
Here names are sequences of name components, which are
numbers, strings, or labels.  The object map is stored in a set of lists which
are entries in the hash table or attribute vector.  These lists have
one of two syntaxes depending upon the setting of the following macro:

\begin{indpar}
\begin{tabular}{l}
\TTNBKEY{MIN\_ALLOW\_PARTIAL\_ATTRIBUTE\_LABELS} \\
~~~~~ 1 if partial attribute labels are supported; \\
~~~~~ 0 if partial attribute labels are not supported.
\LABEL{MIN_ALLOW_PARTIAL_ATTRIBUTE_LABELS} \\
\end{tabular}
\end{indpar}

If partial attribute labels are supported, the attribute name given to
a function that locates an attribute may be too long,
and the function will use only an initial segment of that name,
returning the length of that segment.

If partial attribute names are \underline{not} supported
the object lists have the syntax:

\begin{indpar}
\emkey{hash-table-entry} ::= {\em hash-list}
\\[1ex]
\emkey{attribute-vector-entry} ::= {\em vector-list}
\\[1ex]
\emkey{hash-list} ::= {\em attribute-name-descriptor-pair}$\,^\star$
\\[1ex]
\emkey{vector-list} ::= {\em attribute-descriptor}
\\[1ex]
\emkey{attribute-name-descriptor-pair} ::=
    {\em attribute-name } {\em attribute-descriptor}
\\[1ex]
\emkey{attribute-name} ::= {\em atom } $|$ {\em label}
\\[1ex]
\emkey{attribute-descriptor} ::= {\em value} $|$ {\em attribute-sublist}
\\[1ex]
\emkey{attribute-sublist} ::=
    {\em double-arrow-sublist-option} {\em flag-set} {\em value}$\,^\star$
\\[1ex]
\emkey{double-arrow-sublist} ::=
    {\em double-arrow-name-descriptor-pair}$\,^\star$
\\[1ex]
\emkey{double-arrow-name-descriptor-pair} ::=
    {\em reverse-attribute-name } {\em value-set}
\\[1ex]
\emkey{reverse-attribute-name} ::= {\em atom } $|$ {\em label}
\\[1ex]
\emkey{value-set} ::= {\em value} $|$ {\em value-sublist}
\\[1ex]
\emkey{value-sublist} ::= {\em value}$\,^\star$
\\[1ex]
\emkey{flag-set} ::= {\em control-code}$\,^\star$
\\[1ex]
\emkey{value} ::= {\em atom} $|$ {\em label} $|$ {\em object} $|$ {\em index}
\end{indpar}

Here the syntactic categories represent \verb|min::gen| values
or lists or sublists
of \verb|min::gen| values in the sense of the object list level.

An {\em X-list} is a list, in the sense of the object list level.  Thus
a {\em hash-list} and {\em vector-list} are lists.

An {\em X-sublist} is a sublist, in the sense of the object list level, which
is to say it is a list that is an element of another list.  Thus
{\em attribute-sublists} and {\em double-arrow-sublists} are sublists.

An {\em X-option} is an optional element of a list that is an {\em X} if
it is not omitted.

Everything else is a single list element or
a sequence of elements in some list or sublist.
{\em Map-pairs} are sequences of two elements.
{\em Flag-sets} are sequences of {\em control-codes}.

An {\em atom} is a \verb|min::gen| number or string.
An {\em object} is a \verb|min::gen| value pointing at an object stub.
A {\em control-code} is a \verb|min::gen| control code value.
An {\em index} is a \verb|min::gen| index value.

The above form of object map maps an {\em attribute-name} to a set of
values, a set of flags, and a optional
{\em double-arrow-sublist}.  This last maps {\em reverse-attribute-names}
to sets of values.

A {\em hash-list} is simply a list of alternating {\em attribute-names}
and {\em attribute-descriptors}.
The long form of an {\em attribute-descriptor} is an
{\em attribute-sublist} that gives a list of flags, a list of {\em values},
and an optional {\em double-arrow-sublist}.  If the
{\em attribute-sublist} would be nothing but a one element list containing
a single {\em value}, a common case, the {\em attribute-sublist}
may be replaced by this single
{\em value}, in the interests of optimizing memory.

A {\em vector-list} always has exactly one element that is
the {\em attribute-descriptor} which is associated with the
{\em attribute-name} that equals the vector index of the
attribute vector element in which the {\em vector-list} is stored.
This {\em attribute-descriptor} will be an empty sublist
if the vector index has no associated attribute.

{\em Attribute-names} can be either {\em atoms} or {\em labels}.
If an {\em attribute-name} is an integer {\em atom}
that is in the range of a legal
attribute vector index then a {\em vector-list} with one element that is
an {\em attribute-descriptor}
is put in the attribute vector element
indexed by the integer.
Otherwise an {\em attribute-name-descriptor-pair} containing
the {\em attribute-name} is put
in the {\em hash-list} of the object's hash table entry whose index
in the hash table
equals the hash of the {\em attribute-name} modulo the length of the
hash table.

A {\em double-arrow-sublist} is 
simply a sublist of alternating {\em reverse-attribute-names}
and {\em value-sets}.  The former are just like {\em attribute-names}
and the latter are just like {\em attribute-descriptors} that have no
flags or {\em double-arrow-sublists}.

In the interests of compatibility with the case where partial attribute
names are supported, {\em attribute-names} and {\em reverse-attribute-names}
that are {\em labels} whose sole element is an {\em atom} are not
permitted in the object data lists, and when functions are presented with
such names, the functions replace them with their sole element, namely the
{\em atom}.  In addition, {\em attribute-names} that have no elements
are forbidden, for reasons of compatibility.

If partial attribute names \underline{are} supported
the object lists have the following alternative syntax:

\begin{indpar}
\emkey{hash-table-entry} ::= {\em node-list}
\\[1ex]
\emkey{attribute-vector-entry} ::= {\em vector-list}
\\[1ex]
\emkey{node-list} ::= {\em node-name-descriptor-pair}$\,^\star$
\\[1ex]
\emkey{vector-list} ::= {\em node-descriptor}
\\[1ex]
\emkey{node-name-descriptor-pair} ::=
    {\em attribute-name-component } {\em node-descriptor}
\\[1ex]
\emkey{attribute-name-component} ::= {\em atom } $|$ {\em label}
\\[1ex]
\emkey{node-descriptor} ::= {\em value} $|$ {\em node-sublist}
\\[1ex]
\emkey{node-sublist}
    \begin{tabular}[t]{@{}r@{~}l@{}}
    ::= & {\em flag-set}
	  {\em value}$\,^\star$ \\
    $|$ & {\em child-sublist}
	  \begin{tabular}[t]{@{}l@{}}
	  {\em double-arrow-sublist-option} \\
	  {\em flag-set} {\em value}$\,^\star$
	  \end{tabular}
    \end{tabular}
\\[1ex]
\emkey{child-sublist} ::= {\em node-name-descriptor-pair}$\,^\star$
\\[1ex]
\emkey{double-arrow-sublist} ::=
    {\em double-arrow-name-descriptor-pair}$\,^\star$
\\[1ex]
\emkey{double-arrow-name-descriptor-pair} ::=
    {\em reverse-attribute-name } {\em value-set}
\\[1ex]
\emkey{reverse-attribute-name} ::= {\em atom } $|$ {\em label}
\\[1ex]
\emkey{value-set} ::= {\em value} $|$ {\em value-sublist}
\\[1ex]
\emkey{value-sublist} ::= {\em value}$\,^\star$
\\[1ex]
\emkey{flag-set} ::= {\em control-code}$\,^\star$
\\[1ex]
\emkey{value} ::= {\em atom} $|$ {\em label} $|$ {\em object} $|$ {\em index}
\end{indpar}

This differs from the previous representation in that the object map
is represented by a tree of nodes,
where each node is labeled by an {\em attribute-name-component}.
An {\em attribute-name} is viewed as a sequence of
{\em attribute-name-components}, so the {\em attribute-name}
defines a path in the tree from the root to a node.
Each node has an associated {\em node-descriptor} that
contains the node {\em values}, flags,
and optional {\em double-arrow-sublist} which are associated
with the {\em attribute-name} that names the path from the root to the
node.  The {\em node-descriptor} also may contain
an optional {\em child-sublist}
which describes the children of the node in the tree.

A {\em hash-table-entry} is a {\em node-list} that gives alternating
{\em attribute-name-component}/\EOL {\em node-\EOL de\-scrip\-tor} pairs for
children of the object root node.  A {\em attribute-vector-entry}
just describes one node that is a child of the root, namely the node
whose {\em attribute-name-component} equals the vector index of the
{\em attribute-vector-entry} in the object's attribute vector.
For a child of the object root,
if the child nodes's {\em attribute-name-component} is an integer in the legal
range of the object's attribute vector indices, then the nodes's
{\em node-descriptor} is stored in the {\em vector-list}
that is stored in the object's attribute vector element.
A {\em vector-list} is always a one element list whose element is a
{\em node-descriptor} that may be an empty sublist.
For a child of the root whose name component is not a legal attribute
vector index, its {\em attribute-name-component} and
{\em node-descriptor} is placed in the {\em hash-table-entry}
whose index in the object's hash table equals the hash of the
{\em attribute-name-component} modulo the length of the hash table.

A {\em node-descriptor} that consists of nothing but a single {\em value}
can be represented by just that {\em value}; otherwise it is represented
by a {\em node-sublist}.  If this last begins with a sublist, that must
be the {\em child-sublist}, which has the same structure as a {\em node-list}
and describes the children of the node.  Otherwise neither the
{\em child-sublist} nor the {\em double-arrow-sublist} can be present.
Note that to avoid ambiguity it is not permitted to omit the
{\em child-sublist} without also omitting
the {\em double-arrow-sublist}.  Except for these details
the {\em node-descriptor} structure is the same was as that of the
{\em attribute-descriptor} in the case where partial attribute names are
not allowed.  The {\em double-arrow-sublist} structure is exactly
the same.

In this data structure attribute names must be sequences and cannot be
atoms.  Functions that access this structure convert any atom attribute name
to a label whose sole component is the atom.  Furthermore, attribute names
that are labels with no elements, and therefore would produce zero length
sequences, are forbidden.

\ikey{Attribute flags}{attribute flag!representation}\label{ATTRIBUTE-FLAGS}
are represented by a {\em flag-set} in an {\em attribute-sublist} or
{\em node-sublist}.
The {\em flag-set} is a sequence of \verb|min::gen|
control codes.

The flags are numbered 0, 1, 2, \ldots.  Flag $N$ corresponds to
the bit in the $I+1$'st control code
selected by the mask $2^K$ where $I=\mbox{floor}(N/B)$,
$K=N~\mbox{mod}~B$, and $B$ is the
number of bits in a control code integer.  $B$ is 24 if \verb|min::gen|
values are 32-bits, and 40 if \verb|min::gen| values are 64-bits.
A flag is set for an attribute name if and only if its corresponding
bit is present and set and in the attribute's {\em flag-set}.

\subsubsubsection{Attribute Functions}
\label{ATTRIBUTE-FUNCTIONS}

The functions that access attributes are of two kinds: locator functions
that find attributes within an object, and accessor functions
that read or write attribute flags and values.  The locator functions set an
{\em attribute\_pointer} that the accessor functions
use to identify the attribute being read or written.

An \key{attribute pointer} can be thought of as storing an attribute name
and a reverse attribute name.  The latter can take the special
values {\tt min::NONE} and {\tt min::ANY}.  The attribute name designates
the object attribute pointed at.  The flag set pointed at is always
the flag set of this attribute, regardless of the setting of the
reverse attribute name.  The attribute name and
reverse attribute name together designate the
value set pointed at.  If the reverse attribute name
is {\tt min::NONE}, the value set pointed at is the set of all values
\underline{not} associated with any particular reverse attribute name.  If the
reverse attribute name is {\tt min::ANY},
the value set is the set of all
values that are associated with reverse attribute names.  Otherwise the value
set pointed at is the set of values
associated with the particular reverse attribute
name stored in the pointer.

The \skey{attribute locator function}s\index{locator function!attribute} are:

\begin{indpar}\begin{tabular}{r@{}l}
(constructor)~\verb|MUP::|
	& \MUPKEY{attribute\_pointer}\verb| ( min::stub * s )|
\LABEL{MUP::ATTRIBUTE_POINTER_OF_STUB} \\
(constructor)~\verb|MUP::|
	& \MUPKEY{attribute\_pointer}\verb| ( min::gen obj )|
\LABEL{MUP::ATTRIBUTE_POINTER_OF_GEN} \\
\verb|min::gen min::|
	& \MINKEY{locate}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::attribute_pointer & ap,| \\
	  \verb|   min::gen name )|
	  \end{tabular}
\LABEL{MIN::LOCATE_ATTRIBUTE} \\
\verb|min::gen min::|
	& \MINKEY{locatei}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::attribute_pointer & ap, int name )|
	  \end{tabular}
\LABEL{MIN::LOCATEI_ATTRIBUTE} \\
\verb|min::gen min::|
	& \MINKEY{locate}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::attribute_pointer & ap,| \\
	  \verb|   unsigned & length, min::gen name )|
	  \end{tabular}
\LABEL{MIN::LOCATE_PARTIAL} \\
\verb|min::gen min::|
	& \MINKEY{locate\_reverse}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::attribute_pointer & ap,| \\
	  \verb|   min::gen reverse_name )|
	  \end{tabular}
\LABEL{MIN::LOCATE_REVERSE} \\
\verb|min::gen min::|
	& \MINKEY{relocate}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::attribute_pointer & ap )| \\
	  \end{tabular}
\LABEL{MIN::RELOCATE_ATTRIBUTE} \\
\end{tabular}\end{indpar}

\begin{indpar}\begin{tabular}{r@{}l}
(constructor)~\verb|MUP::|
	& \MUPKEY{writable\_attribute\_pointer}\verb| ( min::stub * s )|
\LABEL{MUP::WRITABLE_ATTRIBUTE_POINTER_OF_STUB} \\
(constructor)~\verb|MUP::|
	& \MUPKEY{writable\_attribute\_pointer}\verb| ( min::gen obj )|
\LABEL{MUP::WRITABLE_ATTRIBUTE_POINTER_OF_GEN} \\
\verb|min::gen min::|
	& \MINKEY{locate}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::writable_attribute_pointer & wap,| \\
	  \verb|   min::gen name )|
	  \end{tabular}
\LABEL{MIN::LOCATE_ATTRIBUTE_WRITABLE} \\
\verb|min::gen min::|
	& \MINKEY{locatei}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::writable_attribute_pointer & wap,| \\
	  \verb|   int name )|
	  \end{tabular}
\LABEL{MIN::LOCATEI_ATTRIBUTE_WRITABLE} \\
\verb|min::gen min::|
	& \MINKEY{locate}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::writable_attribute_pointer & wap,| \\
	  \verb|   unsigned & length, min::gen name )|
	  \end{tabular}
\LABEL{MIN::LOCATE_PARTIAL_WRITABLE} \\
\verb|min::gen min::|
	& \MINKEY{locate\_reverse} \\
	& \verb|    ( min::writable_attribute_pointer & wap,| \\
	& \verb|      min::gen reverse_name )|
\LABEL{MIN::LOCATE_REVERSE_WRITABLE} \\
\verb|min::gen min::|
	& \MINKEY{relocate}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::writable_attribute_pointer & wap )| \\
	  \end{tabular}
\LABEL{MIN::RELOCATE_ATTRIBUTE_WRITABLE} \\
\end{tabular}\end{indpar}

\newpage

There are two kinds of attribute pointers.  A {\tt min::attribute\_pointer}
can be used to read attribute values and flags, but not write them.
A {\tt min::writable\_attribute\_pointer}
can be used to read or write attribute values and flags.  The locator
functions for the two kinds of pointer are the same.

Attribute pointers are tied to an object, which may be specified by
giving either the object's stub or a \verb|min::gen| value pointing
at the object's stub.

The {\tt locate} function sets the attribute name of the pointer.
If the `{\tt length}' argument is \underline{not} given, {\tt locate}
uses the complete attribute name.  The {\tt locatei} function does the
same thing as {\tt locate} but is optimized for the case where the attribute
name is a sequence consisting of a single integer.\footnote{
In some implementations {\tt min::gen} is defined to be {\tt min::uns64},
and in these implementation {\tt int} is incorrectly convertible to
{\tt min::gen} by a C++ implicit conversion.  As a consequence of this
the {\tt locatei} function must have a different name from the
{\tt locate} function.}

The form of the {\tt locate} function that takes a `{\tt length}'
argument exists only if the
{\tt MIN\_\EOL ALLOW\_\EOL PARTIAL\_\EOL ATTRIBUTE\_\EOL LABELS}
(\pagref{MIN_ALLOW_PARTIAL_ATTRIBUTE_LABELS}) macro is set to {\tt 1}.
This form of {\tt locate} uses the longest initial segment of the
attribute name that locates an attribute which has either a non-empty
set of values, or at least one set flag, or at least one value
associated with a reverse attribute name.  The
length of this initial segment is returned in the `\verb|length|'
argument.  If \verb|0| is returned in `\verb|length|',
no initial segment meeting the requirements was found.

The {\tt locate\_reverse} function sets the reverse attribute name of
a pointer.  This can take the special value {\tt min::NONE} or
{\tt min::ANY}, as noted above.  A call to {\tt locate} sets the
reverse attribute name to {\tt min::NONE}.

Both the {\tt locate} and {\tt locate\_reverse} functions take name
arguments that are labels (\secref{LABELS}).  If an atom (number or
string) is given instead, this is treated as an abbreviation for the
label whose only element is the atom.

If the object is reorganized or relocated as per Section~\secref{BODY-POINTERS},
the attribute pointers of the object
will become obsolete, and must be be reset either by calling the
{\tt locate} and if necessary {\tt locate\_reverse} functions, or by
calling the {\tt relocate} function.  This last function uses the
attribute and reverse attribute names stored in the pointer to
restore the pointer.

The \skey{attribute accessor function}s\index{accessor function!attribute} that
can be used for reading attribute values and flags are:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|unsigned min::| & \MINKEY{count}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::attribute_pointer ap )| \\
    \end{tabular}
\LABEL{MIN::COUNT_OF_ATTRIBUTE_POINTER} \\
\verb|unsigned min::| & \MINKEY{get}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::gen * out, unsigned n,| \\
    \verb|   min::attribute_pointer ap )| \\
    \end{tabular}
\LABEL{MIN::GET_OF_ATTRIBUTE_POINTER} \\
\verb|unsigned min::| & \MINKEY{count\_flags}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::attribute_pointer ap )| \\
    \end{tabular}
\LABEL{MIN::COUNT_FLAGS_OF_ATTRIBUTE_POINTER} \\
\verb|unsigned min::| & \MINKEY{get\_flags}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::gen * out, unsigned n,| \\
    \verb|   min::attribute_pointer ap )| \\
    \end{tabular}
\LABEL{MIN::GET_FLAGS_OF_ATTRIBUTE_POINTER} \\
\end{tabular}\end{indpar}

\begin{indpar}\begin{tabular}{r@{}l}
\verb|unsigned min::| & \MINKEY{count}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::writable_attribute_pointer wap )| \\
    \end{tabular}
\LABEL{MIN::COUNT_OF_WRITABLE_ATTRIBUTE_POINTER} \\
\verb|unsigned min::| & \MINKEY{get}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::gen * out, unsigned n,| \\
    \verb|   min::writable_attribute_pointer wap )| \\
    \end{tabular}
\LABEL{MIN::GET_OF_WRITABLE_ATTRIBUTE_POINTER} \\
\verb|unsigned min::| & \MINKEY{count\_flags}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::writable_attribute_pointer wap )| \\
    \end{tabular}
\LABEL{MIN::COUNT_FLAGS_OF_WRITABLE_ATTRIBUTE_POINTER} \\
\verb|unsigned min::| & \MINKEY{get\_flags}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::gen * out, unsigned n,| \\
    \verb|   min::writable_attribute_pointer wap )| \\
    \end{tabular}
\LABEL{MIN::GET_FLAGS_OF_WRITABLE_ATTRIBUTE_POINTER} \\
\end{tabular}\end{indpar}

The {\tt count} function returns the number of values in the value
set pointed at.
The {\tt get} function gets these values and stores them
in the {\tt out} vector.  The number of values
stored is the {\tt get} return value.  The argument {\tt n} is the
maximum number of values that may be returned, the length of {\tt out}.
If there are more then {\tt n} values, only {\tt n} values are returned.

The {\tt count\_flags} function returns the length of the smallest
\verb|min::gen| vector required to store all the flags in the flag
set pointed at as \verb|min:gen| control code values.
It returns {\tt 0} if no flags are set.
The {\tt get\_flags} function returns these flags in the \verb|min::gen|
vector {\tt out}.  The argument {\tt n} is the maximum number of
vector elements that may be written, the length of {\tt out}.
The return value is the same as that of {\tt count\_flags} if this is
not greater than {\tt n}, or is {\tt n} otherwise, and is in any case
the number of elements of the {\tt out} vector written.
In the {\tt out} vector, flag $N$ is the bit selected by mask $2^K$
in the vector element with index $I$, where $K=N~\mbox{mod}~\mbox{\tt VSIZE}$
and $I=\mbox{floor}(N/\mbox{\tt VSIZE})$.

The \skey{attribute accessor function}s\index{accessor function!attribute} that
can be used for writing attribute values and flags are:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|void min::| & \MINKEY{set\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::writable_attribute_pointer wap,| \\
    \verb|   const min::gen * in, unsigned n )| \\
    \end{tabular}
\LABEL{MIN::SET_OF_WRITABLE_ATTRIBUTE_POINTER} \\
\verb|void min::| & \MINKEY{set\_flags\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::writable_attribute_pointer wap,| \\
    \verb|   const min::gen * in, unsigned n )| \\
    \end{tabular}
\LABEL{MIN::SET_FLAGS_OF_WRITABLE_ATTRIBUTE_POINTER} \\
\end{tabular}\end{indpar}

The {\tt set} function sets all the values in the value set the
attribute pointer is pointing at, deleting any previous values.
The values are given in the {\tt in} vector, and
the number of values is given in {\tt n}.  If {\tt n} is zero, all
values are deleted.

If the attribute pointer is pointing at values associated with
a reverse attribute name, the values set or deleted represent double arrows.
In this case, let the object being pointed at by the attribute pointer be $O_1$,
the pointer attribute name be $N$, and the pointer reverse
attribute name be $R$.
If a double arrow value pointing at object $O_2$ is set (or deleted), the value
pointing at $O_1$ will also be set (or deleted) from the attribute named
$R$ with
reverse attribute name $N$ of the object $O_2$.  That is, the other end of
the double arrow will also be set (or deleted).  Recall that the value
associated with a reverse name must consist only of values that point at
other objects.

For the {\tt set} function the
pointer's reverse attribute name can be \verb|min::NONE|
but cannot be \verb|min::ANY|.

The {\tt set\_flags} function sets the flags of the flag set the attribute
pointer points at.
The flags are given in the {\tt in} vector which
has length {\tt n}.  All flags are zeroed before the new set of flags
is written.  If {\tt n} is zero, all flags are zeroed.

The following functions are more optimized versions of the above
functions for the special case that the attribute has, or should
have, only one value:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::gen min::| & \MINKEY{get}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::attribute_pointer ap )| \\
    \end{tabular}
\LABEL{MIN::GET1_OF_ATTRIBUTE_POINTER} \\
\verb|min::gen min::| & \MINKEY{get}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::writable_attribute_pointer wap )| \\
    \end{tabular}
\LABEL{MIN::GET1_OF_WRITABLE_ATTRIBUTE_POINTER} \\
\verb|void min::| & \MINKEY{set\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::writable_attribute_pointer wap,| \\
    \verb|   const min::gen v )|
    \end{tabular}
\LABEL{MIN::SET1_OF_WRITABLE_ATTRIBUTE_POINTER} \\
\end{tabular}\end{indpar}

This version of the {\tt get} function returns the single value $V$ if
the set of values pointed at
consists of a single value $V$.  If the set is empty, the special value
\verb|min::NONE| (\pagref{MIN::NONE}) is returned,
and if the set has more than one value, the special value
\verb|min::MULTI_VALUED| (\pagref{MIN::MULTI_VALUED}) is returned.

This version of the {\tt set} function deletes any previous values of
the value set pointed at
and makes the one value {\tt v} the only value of the value set.
But if {\tt v} is
\verb|min::NONE|, all previous values are deleted and no values
are added.
For the {\tt set} function the
pointer's reverse attribute name can be \verb|min::NONE|
but cannot be \verb|min::ANY|.


The following functions may be used to add values to the set of values
pointed at:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|void min::| & \MINKEY{add\_to\_set\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::writable_attribute_pointer wap,| \\
    \verb|   const min::gen * in, unsigned n )| \\
    \end{tabular}
\LABEL{MIN::ADD_TO_SET} \\
\verb|void min::| & \MINKEY{add\_to\_multiset\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::writable_attribute_pointer wap,| \\
    \verb|   const min::gen * in, unsigned n )| \\
    \end{tabular}
\LABEL{MIN::ADD_TO_MULTISET} \\
\end{tabular}\end{indpar}

The {\tt add\_to\_set} function adds a value to the set of
values if and only if the value is not already in the set,
using {\tt ==} to compare values for equality.
The {\tt add\_to\_multiset} function adds a value even if the
value is already in the set.
For these functions pointer's reverse attribute name can be \verb|min::NONE|
but cannot be \verb|min::ANY|.

The following functions may be used to set, or clear, or flip
the flags turned on in the {\tt in} vector:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|void min::| & \MINKEY{set\_some\_flags\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::writable_attribute_pointer wap,| \\
    \verb|   const min::gen * in, unsigned n )| \\
    \end{tabular}
\LABEL{MIN::SET_SOME_FLAGS} \\
\verb|void min::| & \MINKEY{clear\_some\_flags\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::writable_attribute_pointer wap,| \\
    \verb|   const min::gen * in, unsigned n )| \\
    \end{tabular}
\LABEL{MIN::CLEAR_SOME_FLAGS} \\
\verb|void min::| & \MINKEY{flip\_some\_flags\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::writable_attribute_pointer wap,| \\
    \verb|   const min::gen * in, unsigned n )| \\
    \end{tabular}
\LABEL{MIN::FLIP_SOME_FLAGS} \\
\end{tabular}\end{indpar}

The following functions may be used to test, set, or clear, or flip
individual flag number {\tt n}:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|bool min::| & \MINKEY{test\_flag}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::attribute_pointer wap, unsigned n )| \\
    \end{tabular}
\LABEL{MIN::TEST_FLAG} \\
\verb|bool min::| & \MINKEY{test\_flag}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::writable_attribute_pointer wap,| \\
    \verb|   unsigned n )| \\
    \end{tabular}
\LABEL{MIN::TEST_FLAG_OF_WRITABLE} \\
\verb|void min::| & \MINKEY{set\_flag\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::writable_attribute_pointer wap,| \\
    \verb|   unsigned n )| \\
    \end{tabular}
\LABEL{MIN::SET_FLAG} \\
\verb|void min::| & \MINKEY{clear\_flag\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::writable_attribute_pointer wap,| \\
    \verb|   unsigned n )| \\
    \end{tabular}
\LABEL{MIN::CLEAR_FLAG} \\
\verb|void min::| & \MINKEY{flip\_flag\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::writable_attribute_pointer wap,| \\
    \verb|   unsigned n )| \\
    \end{tabular}
\LABEL{MIN::FLIP_FLAG} \\
\end{tabular}\end{indpar}

It is possible to discover all the attribute names associated with
an object, and all the reverse attribute names associated with an
attribute of an object.  This can be done with the following
functions:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|unsigned min::| & \MINKEY{get\_attributes}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::gen * out, unsigned n,| \\
    \verb|   min::attribute_pointer ap )| \\
    \end{tabular}
\LABEL{MIN::GET_ATTRIBUTES} \\
\verb|void min::| & \MINKEY{rewind\_attributes}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::attribute_pointer ap )| \\
    \end{tabular}
\LABEL{MIN::REWIND_ATTRIBUTES} \\
\verb|unsigned min::| & \MINKEY{get\_reverse\_attributes}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::gen * out, unsigned n,| \\
    \verb|   min::attribute_pointer ap )| \\
    \end{tabular}
\LABEL{MIN::GET_REVERSE_ATTRIBUTES} \\
\verb|void min::| & \MINKEY{rewind\_reverse\_attributes}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::attribute_pointer ap )| \\
    \end{tabular}
\LABEL{MIN::REWIND_REVERSE_ATTRIBUTES} \\
\end{tabular}\end{indpar}

The {\tt get\_attributes} function gets up to {\tt n} attribute
names of the object associated with the {\tt attribute\_pointer},
and returns the number of names gotten.  If called multiple times,
it gets successive names until all the names are returned.  To be
sure all names have been returned, it should be called repeatedly
until it returns fewer than {\tt n} names (if there are no names
left {\tt 0} will be returned).  An attribute name is returned
only if the attribute has a non-empty value set, or has a non-zero flag,
or has an attribute value associated with a reverse attribute name.

If you want to restart at the
beginning, {\tt rewind\_attributes} can be called.  If
the object is reorganized or relocated as per Section~\secref{BODY-POINTERS},
the attribute pointers of the object will become obsolete,
and either the {\tt relocate} function (\pagref{MIN::RELOCATE_ATTRIBUTE})
should be called before continuing, or the {\tt rewind\_attributes}
function should be called to start over.

The {\tt get\_reverse\_attributes} and {\tt rewind\_reverse\_attribute}
functions are analogous but return reverse attribute names associated
with a particular object and the attribute name stored in the attribute
pointer.  A reverse attribute name is returned
only if its value set is non-empty.

\subsection{Variable Vectors}
\label{VARIABLE-VECTORS}

A variable vector is used to represent a set of objects whose structure
is fixed but whose attribute values are variable.  The vector elements
are variables.  By convention each vector has an associated set of constant
objects whose attribute values are indirect pointers to the variables in
the vector.

Thus a vector represents a labeled graph.  There is one variable for
each node of the graph.  That variable may point at an object that
defines the labeled arrows sourced at the node.  Or the variable may be
set to a number or string that is the value of a leaf node that sources
no arrows.  Or the variable may be set to the special value
\minnbkey{UNDEFINED} that indicates the node is not yet defined, and might
later become either a source of arrows or a leaf.

When a variable $X$
points at an object, and $N$ is the name of an attribute of the object,
values for attribute $N$ of the object
can be \skey{index general value}s that hold indices of variables
in the vector that represent nodes one gets to when one starts at
$X$ and follows arrows labeled $N$.

Typically the vector variable with index {\tt 0} points at the object which
is the root of the labeled graph represented by a variable vector.

As the objects are constant, and the same objects
may be used with many different variable vectors.  Thus
one can think of the variable vector as a structure and the objects as the
type of the structure.

Variable vectors must be initialized with values for each variable.  If a
vector represents a graph some of whose nodes source no arrows and have
no string or number associated with them, the variables of these nodes are
given the initial value \minnbkey{UNDEFINED},
which signifies a node that is not defined
yet.  These variables can be set later to define their nodes.

A primary use of variable vectors is with graphs that are to be unified.
In the process of unification some graph nodes are set to indirect pointers
to other graph nodes, so every reference to nodes so set is forwarded to
the target of the indirect pointers.  Therefore, since variables represent
graph nodes, a variable in a variable
vector can store an indirect pointer at another variable in another variable
vector, so that all references to the variable storing the indirect pointer
are forwarded to the pointer's target variable.

Objects associated with a variable vector can have attribute values that
are not indices, but are instead numbers, strings, or pointers other
objects associated with the vector.  Such attribute values are
not variable and cannot be indirected by unification algorithms.

Thus in summary, a variable vector is a vector whose elements are variables,
and whose element indices are unsigned integers beginning at {\tt 0}.  Each
variable can store either a \verb|min::gen| value, or an indirect pointer
at some variable in some variable vector.

A variable vector is structured somewhat like an object (\secref{OBJECTS}).
It has a body that consists of the following 4 parts in the order given:

\begin{center}
\begin{tabular}{l}
header \\
variable vector \\
unused area\\
auxiliary area
\end{tabular}
\end{center}

The header contains the sizes of the other 3 parts.
The \key{variable vector} stores the variables.  The \key{auxiliary area}
stores overflow data from the variable vector.

The variable vector
grows up from the end of the header into the unused
area, and the auxiliary storage grows down from the end of the body into
the unused area.

The header of a variable vector stores 32 bit sizes; variable vectors are
all like long objects in this respect, and there is no variable vector
analogue of short objects.

A \key{variable vector stub}\label{VARIABLE-VECTOR-STUB} is collectible, has
\minnbkey{VARIABLE\_VECTOR}\LABEL{MIN::VARIABLE_VECTOR} stub type code, and has
a value that is a pointer to a \minkey{variable\_vector} type body
which holds the 4 parts of the object.
The header consists of 3 32-bit unsigned integers which are, in order:

\begin{center}
\begin{tabular}{lllllllll}
header size & + & variable vector size \\
header size & + & variable vector size
	& + & unused area size \\
header size & +  & variable vector size
	& + & unused area size \\
        & + & auxiliary area size \\
	& = & header size & + & total size
\end{tabular}
\end{center}

The header may contain other implementation dependent information used
for optimization.

All sizes are in units of \verb|min::gen| values.  Aside from its header,
the variable vector body is just a vector of \verb|min::gen| values.  The total
size does \underline{not} include the header.

A pointer to the body and the sizes can be obtained by the following
functions:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::variable_vector * MUP::|
    & \MUPKEY{variable\_vector\_of}\verb| ( min::stub * s )|
\LABEL{MUP::VARIABLE_VECTOR_OF} \\
\verb|unsigned | &
    \TTKEY{variable\_vector\_size\_of} \\
    & \verb|    ( min::variable_vector * vv )|
\LABEL{VARIABLE_VECTOR_SIZE_OF_VARIABLE_VECTOR} \\
\verb|unsigned |
    & \TTKEY{aux\_size\_of} \\
    & \verb|    ( min::variable_vector * vv )|
\LABEL{AUX_SIZE_OF_VARIABLE_VECTOR} \\
\verb|unsigned |
    & \TTKEY{unused\_size\_of} \\
    & \verb|    ( min::variable_vector * vv )|
\LABEL{UNUSED_SIZE_OF_VARIABLE_VECTOR} \\
\verb|unsigned | & \TTKEY{total\_size\_of} \\
    & \verb|    ( min::variable_vector * vv )|
\LABEL{TOTAL_SIZE_OF_VARIABLE_VECTOR} \\
\end{tabular}\end{indpar}

Here the function that returns a pointer does \underline{not} check the type
of the stub, and the total size is exactly the sum of the other three sizes.

The data structure of a variable vector body can be viewed at any of
two levels:
vector level (\secref{VARIABLE-VECTOR-VECTOR-LEVEL})
and variable level (\secref{VARIABLE-VECTOR-VARIABLE-LEVEL}).

\subsubsection{Variable Vector Vector Level}
\label{VARIABLE-VECTOR-VECTOR-LEVEL}

At the \key{vector level}\,, the variable vector body is viewed as
a \key{body vector} of \verb|min::gen| values.  A pointer to the
body vector is returned by the following unprotected functions:

\begin{indpar}\begin{tabular}{@{}r@{}l@{}}
\verb|const min::gen * MUP::|
	& \MUPKEY{body\_vector\_of} \\
	& \verb|    ( min::variable_vector * vv )|
\LABEL{MUP::BODY_VECTOR_OF_VARIABLE_VECTOR} \\
\verb|min::gen * MUP::|
	& \MUPKEY{writable\_body\_vector\_of} \\
	& \verb|    ( min::variable_vector * vv )|
\LABEL{MUP::WRITABLE_BODY_VECTOR_OF_VARIABLE_VECTOR} \\
\end{tabular}\end{indpar}

The {\tt MUP::body\_vector\_of} function allows only reading of elements.
The {\tt MUP::\EOL writable\_\EOL body\_\EOL vector\_\EOL of}
function allows reading and writing of elements.

The body vector is divided into 4 parts,
which are, in order, the body header,
variable vector, unused area, and auxiliary area.
The header and unused area are not actually \verb|min::gen| values,
and should not be accessed using a body vector pointer.

The value of an auxiliary pointer
is an unsigned integer of which part is the index of a \verb|min::gen|
value in the body vector.  This is distinct from the use of
auxiliary pointers in objects, as in that case the entire auxiliary pointer
integer is the index.
Details are below in \secref{VARIABLE-VECTOR-VARIABLE-LEVEL}.

The index of the beginning of the variable vector part of a variable vector
can be obtained by the following protected function:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|unsigned |
	& \TTKEY{variable\_vector\_of}\verb| ( min::variable_vector * vv )|
\LABEL{VARIABLE_VECTOR_OF_VARIABLE_VECTOR} \\
\end{tabular}\end{indpar}

\subsubsection{Variable Vector Variable Level}
\label{VARIABLE-VECTOR-VARIABLE-LEVEL}

At the \key{variable level},\label{VARIABLE-LEVEL}
the body of a variable vector consists of a vector of variables.
Each variable stores a \verb|min::gen| value, or an auxiliary pointer
that represents an indirect pointer to another variable in the same
variable vector or in some other variable vector.  An indirect pointer
is a pair consisting of a pointer to a variable vector and an index
of a variable in that vector.  Variable vectors use two kinds
\skey{auxiliary pointer}s to represent indirect pointers:%
\label{VARIABLE-VECTOR-AUXILIARY-POINTER}

\begin{indpar}
\key{indirect auxiliary pointer} ~~~
This is an auxiliary pointer that points at an \key{indirect pair},
which is a pair of \verb|min::gen| values the first of which points at
a variable vector and the second of which is an
\ikey{index}{index general value} \verb|min::gen| value
that is the index of a variable in the vector pointed at.
The indirect pair is stored in auxiliary memory, and the entire indirect
pair pointer integer value is the index in auxiliary memory
of the first \verb|min::gen| value of the indirect pair.

\key{packed indirect auxiliary pointer} ~~~
The integer value of this auxiliary value is
split evenly into two parts.  For 32-bit general values each part is
12 bits, whereas for 64-bit general values each part is 20 bits.  The high
order part is the index in auxiliary memory of a \verb|min::gen| value that
is the pointer to the variable vector.  The low order part is the index of
a variable in that vector.  As a special case, if the high order part
is zero, the variable vector is that same as the variable vector containing
the auxiliary pointer.
\end{indpar}

Packed indirect pointers are used when the integers that must be stored
will fit into them.  Otherwise indirect pointers are used.  An
implementation typically allocates enough auxiliary memory to a new variable
vector to permit every variable to efficiently store an indirect pointer.
After the variable vector has aged, it may be reorganized during garbage
collection to minimize use of auxiliary memory.

\subsubsubsection{Variable Pointers}
\label{VARIABLE-POINTERS}

Variable vectors are accessed at the variable letter
by using \skey{variable pointer}s.

A \MUPkey{variable\_pointer} is used to move around in objects at
the variable level, and get or set the values of variables.  A variable
pointer points at a variable in a variable vector.
The functions for using a variable pointer are:

\begin{indpar}\begin{tabular}{r@{}l}
(constructor)~\verb|MUP::|
	& \MUPKEY{variable\_pointer}\verb| ( )|
\LABEL{MUP::VARIABLE_POINTER} \\
\end{tabular}\end{indpar}
\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::gen min::| & \MINKEY{point}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::variable_pointer & vp,| \\
    \verb|   min::gen vector, unsigned index )|
    \end{tabular}
\LABEL{POINT_VARIABLE_POINTER} \\
\verb|void min::|
	& \TTKEY{clear}\verb| ( min::variable_pointer & vp )|
\LABEL{CLEAR_VARIABLE_POINTER} \\
\verb|void min::|
	& \MINKEY{relocate}\verb| ( min::variable_pointer & vp )|
\LABEL{MIN::RELOCATE_VARIABLE_POINTER} \\
\end{tabular}\end{indpar}
\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::gen min::|
	& \TTKEY{get}\verb| ( min::variable_pointer & vp )|
\LABEL{GET_VARIABLE_POINTER} \\
\verb|void min::|
	& \TTKEY{set}\verb| ( min::variable_pointer & vp, min::gen value )|
\LABEL{SET_VARIABLE_POINTER} \\
\verb|min::gen min::| & \MINKEY{indirect\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::variable_pointer & vp1,| \\
    \verb|   min::variable_pointer & vp2 )|
    \end{tabular}
\LABEL{MIN::INDIRECT_VARIABLE_POINTER} \\
\end{tabular}\end{indpar}
\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::gen min::| & \MINKEY{moveg}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::variable_pointer & vp,| \\
    \verb|   min::gen name )|
    \end{tabular}
\LABEL{MIN::MOVEG_VARIABLE_POINTER} \\
\verb|min::gen min::| & \MINKEY{move}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::variable_pointer & vp,| \\
    \verb|   unsigned index )|
    \end{tabular}
\LABEL{MOVE_VARIABLE_POINTER} \\
\verb|unsigned min::| & \MINKEY{countg}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::variable_pointer & vp,| \\
    \verb|   min::gen name, min::gen reverse_name )|
    \end{tabular}
\LABEL{MIN::COUNTG_OF_VARIABLE_POINTER} \\
\end{tabular}\end{indpar}
\begin{indpar}\begin{tabular}{r@{}l}
\verb|unsigned min::| & \MINKEY{getg}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::gen * out, unsigned n,| \\
    \verb|   min::variable_pointer & vp,| \\
    \verb|   min::gen name, min::gen reverse_name )|
    \end{tabular}
\LABEL{MIN::GETG_OF_VARIABLE_POINTER} \\
\verb|min::gen min::| & \MINKEY{getg}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::variable_pointer & vp,| \\
    \verb|   min::gen name, min::gen reverse_name )|
    \end{tabular}
\LABEL{MIN::GETG1_OF_VARIABLE_POINTER} \\
\end{tabular}\end{indpar}

The {\tt point} function points a variable pointer at a particular
variable in a given variable vector.  The variable is determined by
its index as a vector element.

The {\tt clear} function clears a variable pointer so that it does
not point at any variable.  This is the state the pointer is in
just after it is constructed.
It is an undefined operation to access a variable pointer that
is cleared.

In order to optimize things,
a {\tt MUP::variable\_pointer} contains an internal pointer that points
directly at a variable in the body of a variable vector.  As this pointer
is relocatable, it must be adjusted if the relocated flag is raised
(\pagref{RELOCATED-FLAG}).  This is done by applying the {\tt min::relocate}
function to the pointer.  Because this is necessary, the constructor for
a variable pointer is unprotected.

The {\tt get} function returns the value of the variable pointed at,
after following all indirections.  That is, if the variable pointer
points at $X$ and the value of $X$ is an indirect pointer to another
variable $Y$, the {\tt get} function proceeds as if the variable pointer pointed
at $Y$.

The {\tt set} function sets the value of the variable pointed at,
after following all indirections.  That is, if the variable pointer
points at $X$ and the value of $X$ is an indirect pointer to
another variable $Y$, the {\tt set} function proceeds as if the variable pointer
pointed at $Y$.

The {\tt indirect} function sets the value of the variable pointed at by
the first variable pointer (\verb|vp1|),
after following all indirections,
to point indirectly at the variable pointed at by the second variable
pointer (\verb|vp2|).
If \verb|vp1| points at $X$ and the value of $X$ is an indirect pointer to
another variable $Y$, the {\tt indirect} function proceeds as if \verb|vp1|
pointed at $Y$.

The {\tt moveg} function works if {\tt get} returns a pointer to an object
stub.  In this case, {\tt moveg} finds the values of the attribute of the
object with the given attribute name
and no reverse attribute name, and proceeds as follows:
\begin{indpar}
If there are no values, \verb|min::MISSING| is returned and the variable
pointer is left unchanged.

If there is only one value and that is an index, the variable pointer is
re-pointed at the variable with that index in the variable vector the
variable pointer is currently pointing at, and \verb|min::SUCCESS|
is returned.

If there is only one value and that is \underline{not} an index,
that value is returned, and the variable pointer is left unchanged.

If there is more than one value, \verb|min::MULTI_VALUED|
is returned, and the variable pointer is left unchanged.
\end{indpar}

Note that the variable pointer is changed only if the attribute has
a single index value.

The {\tt countg} and {\tt getg} functions applied to a variable pointer
work the same way the would if they were applied to result of applying
{\tt get} to the variable pointer.  These functions will \underline{not}
change the variable pointer no matter what the attribute value is, and
will return any index attribute value as a \verb|min::gen| result.

The {\tt move} function can be used with any index value returned to
point the variable pointer at the variable referred to by the index,
without changing the variable vector referenced by the variable pointer.
Thus for an attribute with a single index value, {\tt moveg} is equivalent
to applying {\tt getg} to retrieve the index value, and then applying
{\tt move} to that value.

The {\tt moveg}, {\tt countg}, and {\tt getg} functions have associates
named \minmkey{movei}{of variable pointer},
\minmkey{counti}{of variable pointer},
and \minmkey{geti}{of variable pointer} that are identical except their
attribute name argument is of type {\tt int} instead of \verb|min::gen|.

The \key{variable forward optimization}\index{forward!variable optimization}
system control parameter effects
the operation of functions that trace indirect pointers stored in
variables.  If set, the optimization applies to the {\tt get}, {\tt set}, and
{\tt indirect} functions, and to other functions that implicitly use {\tt get}.
Whenever one of these functions discovers a variable $X$ that
points indirectly at a variable $Y$ that points indirectly at a variable $Z$,
the function resets $X$ to point at $Z$.  The
variable forward optimization control parameter can itself
be gotten or set by the functions:

\begin{indpar}\begin{tabular}{r@{}l}
\verb|bool min::|
	& \TTKEY{variable\_forward\_optimization}\verb| ( )|
\\
\verb|bool min::|
	& \TTKEY{variable\_forward\_optimization}\verb| ( bool value )|
\LABEL{VARIABLE_FORWARD_OPTIMIZATION} \\
\end{tabular}\end{indpar}

The {\tt variable\_forward\_optimization} function with no argument gets
the value of the control parameter, while the function with an argument
sets the value and returns the previous value.  By default the parameter
is on (value is {\tt true}), so optimizations are performed unless turned
off.



\clearpage

\section{Code and Execution}

\subsection{Execution Flags}
\label{EXECUTION-FLAGS}

TBD: relocation flag

\section{TBD Implementation Ideas}


\subsection{Stack and not Ephemeral}

Instead of ephemeral, we use stack objects.  A stack stub is a stub that
is only reachable from pointers in the stack.   When a stack stub
pointer (as a general value) is stored in a non-stack object, the price
of tracing what it points at to make its target non-stack is paid.
This is a logical time to pay this cost.

\section{To Do}

\clearpage

\appendix

\centerline{\Large \bf Appendices}

\section{C/C++ Interface}
\label{C/C++-Interface}

The declarations here differ from legal C/C++ code in that
we write

\begin{indpar}\begin{verbatim}
struct min::stub;
bool min::is_collectible ( int type );
\end{verbatim}\end{indpar}

which is not legal C or C++ when what we mean is

\begin{indpar}\begin{verbatim}
struct min
{
    struct stub;
    bool is_collectible ( int type );
};
\end{verbatim}\end{indpar}

{
\renewcommand{\LABEL}[1]{\dotfill~\pagref{#1}}
\renewcommand{\TTKEY}[1]{{\tt ~~#1~~}}
\renewcommand{\TTNBKEY}[1]{{\tt ~~#1~~}}
\renewcommand{\MINKEY}[1]{{\tt ~~#1~~}}
\renewcommand{\MUPKEY}[1]{{\tt ~~#1~~}}
\renewcommand{\ttkey}[1]{{\tt ~~#1~~}}
\newcommand{\ARGBREAK}{\\&{\tt ~~~~~}}
\newcommand{\INDEXHEADER}[1]{{\bf #1}:\vspace{1ex}}
\newlength{\TABULARLEN}
\newenvironment{TABULAR}[1]%
  {\setlength{\TABULARLEN}{6.2in}
   \addtolength{\TABULARLEN}{-#1}
   \begin{tabular}{@{}r@{}l@{}}
   \hspace*{#1} & \hspace*{\TABULARLEN} \\[-4ex]}%
  {\end{tabular}}

\INDEXHEADER{Compilation Macros}

\begin{indpar}[0.2in]

\begin{tabular}{@{}p{6.2in}@{}}
\TTNBKEY{MIN\_IS\_COMPACT}
\LABEL{MIN_IS_COMPACT} \\
\TTNBKEY{MIN\_MAX\_EPHEMERAL\_LEVELS}
\LABEL{MIN_MAX_EPHEMERAL_LEVELS} \\
\TTNBKEY{MIN\_IS\_LOOSE}
\LABEL{MIN_IS_LOOSE}	 \\
\TTNBKEY{MIN\_MAX\_NUMBER\_OF\_STUBS}
\LABEL{MIN_MAX_NUMBER_OF_STUBS} \\
\TTNBKEY{MIN\_STUB\_BASE}
\LABEL{MIN_STUB_BASE} \\
\TTNBKEY{MIN\_MAX\_RELATIVE\_STUB\_ADDRESS}
\LABEL{MIN_MAX_RELATIVE_STUB_ADDRESS} \\
\TTNBKEY{MIN\_MAX\_ABSOLUTE\_STUB\_ADDRESS}
\LABEL{MIN_MAX_ABSOLUTE_STUB_ADDRESS} \\
\TTNBKEY{MIN\_DEALLOCATED\_LIMIT}
\LABEL{MIN_DEALLOCATED_LIMIT} \\
\TTNBKEY{MIN\_PROTECT}
\LABEL{MIN_PROTECT} \\
\TTNBKEY{MIN\_ASSERT($e$)}
\LABEL{MIN_ASSERT} \\
\TTNBKEY{MIN\_USES\_OBJECT\_AUX\_STUBS}
\LABEL{MIN_USES_OBJECT_AUX_STUBS} \\
\TTNBKEY{MIN\_ALLOW\_PARTIAL\_ATTRIBUTE\_LABELS}
\LABEL{MIN_ALLOW_PARTIAL_ATTRIBUTE_LABELS} \\
\end{tabular}

\end{indpar}

\INDEXHEADER{Data Declarations}

\begin{indpar}[0.2in]

\begin{TABULAR}{2.0in}
\verb|min::| & \MINKEY{stub}
\LABEL{MIN::STUB} \\
\verb|min::| & \MINKEY{gen}
\LABEL{MIN::GEN} \\
\verb|min::| & \MINKEY{unsgen}
\LABEL{MIN::UNSGEN} \\
\verb|const unsigned min::| & \MINKEY{TSIZE}
\LABEL{MIN::TSIZE} \\
\verb|const unsigned min::| & \MINKEY{VSIZE}
\LABEL{MIN::VSIZE}
\end{TABULAR}

\end{indpar}

\newpage

\INDEXHEADER{Stub Type Codes}\label{STUB-TYPE-CODE-LIST}

\begin{indpar}[0.2in]

\begin{TABULAR}{1.4in}
\verb|const int min::| & \MINKEY{DEALLOCATED}
\LABEL{MIN::DEALLOCATED} \\
\verb|const int min::| & \MINKEY{NUMBER}
\LABEL{MIN::NUMBER} \\
\verb|const int min::| & \MINKEY{SHORT\_STR}
\LABEL{MIN::SHORT_STR} \\
\verb|const int min::| & \MINKEY{LONG\_STR}
\LABEL{MIN::LONG_STR} \\
\verb|const int min::| & \MINKEY{LABEL}
\LABEL{MIN::LABEL} \\
\verb|const int min::| & \MINKEY{SHORT\_OBJ}
\LABEL{MIN::SHORT_OBJ} \\
\verb|const int min::| & \MINKEY{LONG\_OBJ}
\LABEL{MIN::LONG_OBJ} \\
\verb|const int min::| & \MINKEY{LIST\_AUX}
\LABEL{MIN::LIST_AUX} \\
\verb|const int min::| & \MINKEY{SUBLIST\_AUX}
\LABEL{MIN::SUBLIST_AUX} \\
\verb|const int min::| & \MINKEY{VARIABLE\_VECTOR}
\LABEL{MIN::VARIABLE_VECTOR} 
\end{TABULAR}
\end{indpar}

\INDEXHEADER{Stub Related Declarations}

\begin{indpar}[0.2in]

\begin{TABULAR}{1.2in}
\verb|int min::| & \MINKEY{type\_of}\verb| ( const min::stub * s )|
\LABEL{MIN::TYPE_OF} \\[1ex]
\verb|bool min::| & \MINKEY{is\_collectible}\verb| ( int type )|
\LABEL{MIN::IS_COLLECTIBLE} \\[1ex]
\verb|bool min::| & \MINKEY{relocated\_flag}\verb| ( void )|
\LABEL{MIN::RELOCATED_FLAG} \\
\verb|bool min::| & \MINKEY{set\_relocated\_flag}\verb| ( bool value )|
\LABEL{MIN::SET_RELOCATED_FLAG} \\
\verb|void min::| & \MINKEY{interrupt\REL}\verb| ( void )|
\LABEL{MIN::INTERRUPT} \\
\verb|void min::| & \MINKEY{deallocate\REL}\verb| ( min::stub * s )|
\LABEL{MIN::DEALLOCATE} \\
\verb|bool min::| & \MINKEY{is\_deallocated}\verb| ( const min::stub * s )|
\LABEL{MIN::IS_DEALLOCATED} \\
\end{TABULAR}

\end{indpar}

\INDEXHEADER{Gen Value Protected Declarations}

\begin{indpar}[0.2in]

\begin{TABULAR}{1.6in}
\verb|bool min::| & \MINKEY{is\_stub}\verb| ( min::gen v )|
\LABEL{MIN::IS_STUB} \\
\verb|bool min::| & \MINKEY{is\_direct\_float\LOOSE}\verb| ( min::gen v )|
\LABEL{MIN::IS_DIRECT_FLOAT} \\
\verb|bool min::| & \MINKEY{is\_direct\_int\COMPACT}\verb| ( min::gen v )|
\LABEL{MIN::IS_DIRECT_INT} \\
\verb|bool min::| & \MINKEY{is\_direct\_str}\verb| ( min::gen v )|
\LABEL{MIN::IS_DIRECT_STR} \\
\verb|bool min::| & \MINKEY{is\_list\_aux}\verb| ( min::gen v )|
\LABEL{MIN::IS_LIST_AUX} \\
\verb|bool min::| & \MINKEY{is\_sublist\_aux}\verb| ( min::gen v )|
\LABEL{MIN::IS_SUBLIST_AUX} \\
\verb|bool min::| & \MINKEY{is\_indirect\_pair\_aux}\verb| ( min::gen v )|
\LABEL{MIN::IS_INDIRECT_AUX} \\
\verb|bool min::| & \MINKEY{is\_packed\_aux}\verb| ( min::gen v )|
\LABEL{MIN::IS_PACKED_AUX} \\
\verb|bool min::| & \MINKEY{is\_index}\verb| ( min::gen v )|
\LABEL{MIN::IS_INDEX} \\
\verb|bool min::| & \MINKEY{is\_control\_code}\verb| ( min::gen v )|
\LABEL{MIN::IS_CONTROL_CODE} \\
\verb|bool min::| & \MINKEY{is\_special}\verb| ( min::gen v )|
\LABEL{MIN::IS_SPECIAL_CODE} \\
\end{TABULAR}

\begin{TABULAR}{2.4in}
\verb|const min::stub * min::| & \MINKEY{stub\_of}\ARGBREAK
                        \verb| ( min::gen v )|
\LABEL{MIN::STUB_OF} \\
\verb|min::float64 min::|
    & \MINKEY{direct\_float\_of\LOOSE}\verb| ( min::gen v )|
\LABEL{MIN::DIRECT_FLOAT_OF} \\
\verb|min::int32 min::| & \MINKEY{direct\_int\_of\COMPACT}\verb| ( min::gen v )|
\LABEL{MIN::DIRECT_INT_OF} \\
\verb|min::uns64 min::| & \MINKEY{direct\_str\_of}\verb| ( min::gen v )|
\LABEL{MIN::DIRECT_STR_OF} \\
\verb|min::unsgen min::| & \MINKEY{list\_aux\_of}\verb| ( min::gen v )|
\LABEL{MIN::LIST_AUX_OF} \\
\verb|min::unsgen min::| & \MINKEY{sublist\_aux\_of}\verb| ( min::gen v )|
\LABEL{MIN::SUBLIST_AUX_OF} \\
\verb|min::unsgen min::|
    & \MINKEY{indirect\_pair\_aux\_of}\verb| ( min::gen v )|
\LABEL{MIN::INDIRECT_AUX_OF} \\
\verb|min::unsgen min::|
    & \MINKEY{packed\_aux\_of}\verb| ( min::gen v )|
\LABEL{MIN::PACKED_AUX_OF} \\
\verb|unsigned min::|
    & \MINKEY{packed\_index\_of}\verb| ( min::gen v )|
\LABEL{MIN::PACKED_INDEX_OF} \\
\verb|unsigned min::| & \MINKEY{index\_of}\verb| ( min::gen v )|
\LABEL{MIN::INDEX_OF} \\
\verb|min::unsgen min::| & \MINKEY{control\_code\_of}\verb| ( min::gen v )|
\LABEL{MIN::CONTROL_CODE_OF} \\
\verb|min::unsgen min::| & \MINKEY{special\_index\_of}\verb| ( min::gen v )|
\LABEL{MIN::SPECIAL_INDEX_OF} \\[1ex]
\end{TABULAR}

\begin{TABULAR}{1.6in}
\verb|min::gen min::| & \MINKEY{new\_gen}\verb| ( min::stub * s )|
\LABEL{MIN::NEW_GEN_OF_STUB} \\
\verb|min::gen min::|
    & \MINKEY{new\_direct\_float\_gen\LOOSE}\verb| ( min::float64 v )|
\LABEL{MIN::NEW_DIRECT_FLOAT_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_direct\_int\_gen}\verb| ( int v )|
\LABEL{MIN::NEW_DIRECT_INT_GEN} \\
\verb|min::gen min::|
    & \MINKEY{new\_direct\_str\_gen\COMPACT}\verb| ( const char * p )|
\LABEL{MIN::NEW_DIRECT_STR_GEN} \\
\verb|min::gen min::|
    & \MINKEY{new\_direct\_str\_gen}\ARGBREAK
      \verb| ( const char * p, unsigned n )|
\LABEL{MIN::NEW_DIRECT_STR_GEN_WITH_N} \\
\verb|min::gen min::| & \MINKEY{new\_list\_aux\_gen}\verb| ( min::unsgen p )|
\LABEL{MIN::NEW_LIST_AUX_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_sublist\_aux\_gen}\verb| ( min::unsgen p )|
\LABEL{MIN::NEW_SUBLIST_AUX_GEN} \\
\verb|min::gen min::|
    & \MINKEY{new\_indirect\_pair\_aux\_gen}\verb| ( min::unsgen p )|
\LABEL{MIN::NEW_INDIRECT_AUX_GEN} \\
\verb|min::gen min::|
    & \MINKEY{new\_packed\_aux\_gen}\ARGBREAK
      \verb| ( unsigned p, unsigned i )|
\LABEL{MIN::NEW_PACKED_AUX_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_index\_gen}\verb| ( min::unsgen i )|
\LABEL{MIN::NEW_INDEX_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_control\_code\_gen}\verb| ( min::unsgen c )|
\LABEL{MIN::NEW_CONTROL_CODE_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_special\_gen}\verb| ( min::unsgen i )|
\LABEL{MIN::NEW_SPECIAL_GEN} \\
\end{TABULAR}

\begin{TABULAR}{1.6in}
\verb|int min::| & \MINKEY{gen\_subtype\_of}\verb| ( min::gen v )|
\LABEL{MIN::GEN_SUBTYPE_OF} \\
\end{TABULAR}

\begin{TABULAR}{1.6in}
\verb|bool min::| & \MINKEY{is\_name}\verb| ( min::gen v )|
\LABEL{MIN::IS_NAME} \\
\verb|min::uns32 min::| & \MINKEY{hash}\verb| ( min::gen v )|
\LABEL{MIN::HASH} \\
\end{TABULAR}

\end{indpar}

\newpage

\INDEXHEADER{Gen Value Unprotected Declarations}

\begin{indpar}[0.2in]

\begin{TABULAR}{1.6in}
\verb|min::stub * MUP::| & \MUPKEY{stub\_of}\verb| ( min::gen v )|
\LABEL{MUP::STUB_OF} \\
\verb|min::float64 MUP::|
    & \MUPKEY{direct\_float\_of\LOOSE}\verb| ( min::gen v )|
\LABEL{MUP::DIRECT_FLOAT_OF} \\
\verb|min::int32 MUP::|
    & \MUPKEY{direct\_int\_of\COMPACT}\verb| ( min::gen v )|
\LABEL{MUP::DIRECT_INT_OF} \\
\verb|min::uns64 MUP::| & \MUPKEY{direct\_str\_of}\verb| ( min::gen v )|
\LABEL{MUP::DIRECT_STR_OF} \\
\verb|min::unsgen MUP::| & \MUPKEY{list\_aux\_of}\verb| ( min::gen v )|
\LABEL{MUP::LIST_AUX_OF} \\
\verb|min::unsgen MUP::| & \MUPKEY{sublist\_aux\_of}\verb| ( min::gen v )|
\LABEL{MUP::SUBLIST_AUX_OF} \\
\verb|min::unsgen MUP::|
    & \MUPKEY{indirect\_pair\_aux\_of}\verb| ( min::gen v )|
\LABEL{MUP::INDIRECT_AUX_OF} \\
\verb|unsigned MUP::|
    & \MUPKEY{packed\_aux\_of}\verb| ( min::gen v )|
\LABEL{MUP::PACKED_AUX_OF} \\
\verb|unsigned MUP::|
    & \MUPKEY{packed\_index\_of}\verb| ( min::gen v )|
\LABEL{MUP::PACKED_INDEX_OF} \\
\verb|min::unsgen MUP::| & \MUPKEY{index\_of}\verb| ( min::gen v )|
\LABEL{MUP::INDEX_OF} \\
\verb|min::unsgen MUP::| & \MUPKEY{control\_code\_of}\verb| ( min::gen v )|
\LABEL{MUP::CONTROL_CODE_OF} \\
\verb|min::unsgen MUP::| & \MUPKEY{special\_index\_of}\verb| ( min::gen v )|
\LABEL{MUP::SPECIAL_INDEX_OF} \\
\end{TABULAR}

\begin{TABULAR}{1.6in}
\verb|min::gen MUP::| & \MUPKEY{new\_gen}\verb| ( min::stub * s )|
\LABEL{MUP::NEW_GEN_OF_STUB} \\
\verb|min::gen MUP::|
    & \MUPKEY{new\_direct\_float\_gen\LOOSE}\verb| ( min::float64 v )|
\LABEL{MUP::NEW_DIRECT_FLOAT_GEN} \\
\verb|min::gen MUP::|
    & \MUPKEY{new\_direct\_int\_gen\COMPACT}\verb| ( int v )|
\LABEL{MUP::NEW_DIRECT_INT_GEN} \\
\verb|min::gen MUP::| & \MUPKEY{new\_direct\_str\_gen}\verb| ( const char * p )|
\LABEL{MUP::NEW_DIRECT_STR_GEN} \\
\verb|min::gen MUP::|
    & \MUPKEY{new\_direct\_str\_gen}\ARGBREAK
      \verb| ( const char * p, unsigned n )|
\LABEL{MUP::NEW_DIRECT_STR_GEN_WITH_N} \\
\verb|min::gen MUP::| & \MUPKEY{new\_list\_aux\_gen}\verb| ( min::unsgen p )|
\LABEL{MUP::NEW_LIST_AUX_GEN} \\
\verb|min::gen MUP::| & \MUPKEY{new\_sublist\_aux\_gen}\verb| ( min::unsgen p )|
\LABEL{MUP::NEW_SUBLIST_AUX_GEN} \\
\verb|min::gen MUP::|
    & \MUPKEY{new\_indirect\_pair\_aux\_gen}\verb| ( min::unsgen p )|
\LABEL{MUP::NEW_INDIRECT_AUX_GEN} \\
\verb|min::gen MUP::|
    & \MUPKEY{new\_packed\_aux\_gen}\ARGBREAK
      \verb| ( unsigned p, unsigned i )|
\LABEL{MUP::NEW_PACKED_AUX_GEN} \\
\verb|min::gen MUP::| & \MUPKEY{new\_index\_gen}\verb| ( min::unsgen i )|
\LABEL{MUP::NEW_INDEX_GEN} \\
\verb|min::gen MUP::| & \MUPKEY{new\_control\_code\_gen}\verb| ( min::unsgen c )|
\LABEL{MUP::NEW_CONTROL_CODE_GEN} \\
\verb|min::gen MUP::| & \MUPKEY{new\_special\_gen}\verb| ( min::unsgen i )|
\LABEL{MUP::NEW_SPECIAL_GEN} \\
\end{TABULAR}

\begin{TABULAR}{1.6in}
\verb|min::gen MUP::|
    & \MUPKEY{renew\_gen}\verb| ( min::gen v, min::unsgen p )|
\LABEL{MUP::RENEW_GEN} \\

\end{TABULAR}

\begin{TABULAR}{1.6in}
\verb|(macro) min::gen|
	& \TTNBKEY{MIN\_NEW\_SPECIAL\_GEN}\verb| ( i )|
\LABEL{MIN_NEW_SPECIAL_GEN} \\
\end{TABULAR}

\end{indpar}

\newpage

\INDEXHEADER{Gen Value Subtype Codes}

\begin{indpar}[0.2in]

\begin{TABULAR}{1.8in}
\verb|const unsigned min::| & \MINKEY{GEN\_DIRECT\_INT}
\LABEL{MIN::GEN_DIRECT_INT} \\
\verb|const unsigned min::| & \MINKEY{GEN\_DIRECT\_FLOAT}
\LABEL{MIN::GEN_DIRECT_FLOAT} \\
\verb|const unsigned min::| & \MINKEY{GEN\_DIRECT\_STR}
\LABEL{MIN::GEN_DIRECT_STR} \\
\verb|const unsigned min::| & \MINKEY{GEN\_STUB}
\LABEL{MIN::GEN_STUB} \\
\verb|const unsigned min::| & \MINKEY{GEN\_LIST\_AUX}
\LABEL{MIN::GEN_LIST_AUX} \\
\verb|const unsigned min::| & \MINKEY{GEN\_SUBLIST\_AUX}
\LABEL{MIN::GEN_SUBLIST_AUX} \\
\verb|const unsigned min::| & \MINKEY{GEN\_INDIRECT\_AUX}
\LABEL{MIN::GEN_INDIRECT_AUX} \\
\verb|const unsigned min::| & \MINKEY{GEN\_PACKED\_AUX}
\LABEL{MIN::GEN_PACKED_AUX} \\
\verb|const unsigned min::| & \MINKEY{GEN\_INDEX}
\LABEL{MIN::GEN_INDEX} \\
\verb|const unsigned min::| & \MINKEY{GEN\_CONTROL\_CODE}
\LABEL{MIN::GEN_CONTROL_CODE} \\
\verb|const unsigned min::| & \MINKEY{GEN\_SPECIAL}
\LABEL{MIN::GEN_SPECIAL} \\
\verb|const unsigned min::| & \MINKEY{GEN\_ILLEGAL}
\LABEL{MIN::GEN_ILLEGAL} \\
\end{TABULAR}

\end{indpar}

\INDEXHEADER{Special Values}

\begin{indpar}[0.2in]

\begin{TABULAR}{1.2in}
\verb|min::gen min::| & \MINKEY{MISSING}
\LABEL{MIN::MISSING} \\
\verb|min::gen min::| & \MINKEY{NONE}
\LABEL{MIN::NONE} \\
\verb|min::gen min::| & \MINKEY{ANY}
\LABEL{MIN::ANY} \\
\verb|min::gen min::| & \MINKEY{MULTI\_VALUED}
\LABEL{MIN::MULTI_VALUED} \\
\verb|min::gen min::| & \MINKEY{UNDEFINED}
\LABEL{MIN::UNDEFINED} \\
\verb|min::gen min::| & \MINKEY{SUCCESS}
\LABEL{MIN::SUCCESS} \\
\verb|min::gen min::| & \MINKEY{FAILURE}
\LABEL{MIN::FAILURE} \\
\end{TABULAR}

\end{indpar}

\INDEXHEADER{Unprotected Stub Declarations}

\begin{indpar}[0.2in]

\begin{TABULAR}{1.6in}
\verb|min::uns64 MUP::| & \MUPKEY{value\_of}\verb| ( const min::stub * s )|
\LABEL{MUP::VALUE_OF} \\
\verb|min::float64 MUP::| & \MUPKEY{float\_of}\verb| ( const min::stub * s )|
\LABEL{MUP::FLOAT_OF} \\
\verb|min::gen MUP::| & \MUPKEY{gen\_of}\verb| ( const min::stub * s )|
\LABEL{MUP::GEN_OF} \\
\verb|void * MUP::| & \MUPKEY{pointer\_of}\verb| ( const min::stub * s )|
\LABEL{MUP::POINTER_OF} \\
\end{TABULAR}

\begin{TABULAR}{1.6in}
\verb|void MUP::|
    & \MUPKEY{set\_value\_of}\ARGBREAK
      \verb| ( min::stub * s, min::uns64 v )|
\LABEL{MUP::SET_VALUE_OF} \\
\verb|void MUP::|
    & \MUPKEY{set\_float\_of}\ARGBREAK
      \verb| ( min::stub * s, min::float64 f )|
\LABEL{MUP::SET_FLOAT_OF} \\
\verb|void MUP::|
    & \MUPKEY{set\_gen\_of}\ARGBREAK
      \verb| ( min::stub * s, min::gen v )|
\LABEL{MUP::SET_GEN_OF} \\
\verb|void MUP::|
    & \MUPKEY{set\_pointer\_of}\ARGBREAK
      \verb| ( min::stub * s, void * p )|
\LABEL{MUP::SET_POINTER_OF} \\
\end{TABULAR}

\begin{TABULAR}{1.6in}
\verb|min::uns64 MUP::| & \MUPKEY{control\_of}\verb| ( const min::stub * s )|
\LABEL{MUP::CONTROL_OF} \\
\verb|bool MUP::|
    & \MUPKEY{test\_flags\_of}\ARGBREAK
      \verb| ( const min::stub * s, min::uns64 flags )|
\LABEL{MUP::TEST_FLAGS_OF} \\
\end{TABULAR}

\begin{TABULAR}{1.6in}
\verb|void MUP::|
    & \MUPKEY{set\_control\_of}\ARGBREAK
      \verb| ( min::stub * s, min::uns64 c )|
\LABEL{MUP::SET_CONTROL_OF} \\
\verb|void MUP::|
    & \MUPKEY{set\_type\_of}\ARGBREAK
      \verb| ( min::stub * s, int type )|
\LABEL{MUP::SET_TYPE_OF} \\
\verb|void MUP::|
    & \MUPKEY{set\_flags\_of}\ARGBREAK
      \verb| ( min::stub * s, min::uns64 flags )|
\LABEL{MUP::SET_FLAGS_OF} \\
\verb|void MUP::|
    & \MUPKEY{clear\_flags\_of}\ARGBREAK
      \verb| ( min::stub * s, min::uns64 flags )|
\LABEL{MUP::CLEAR_FLAGS_OF} \\
\end{TABULAR}

\end{indpar}

\INDEXHEADER{Control Value Declarations (Unprotected)}

\begin{indpar}[0.2in]

\begin{TABULAR}{1.6in}
\verb|min::uns64 MUP::|
    & \MUPKEY{new\_control} \\
    & \verb|    ( int type_code, min::uns64 v,|\ARGBREAK
      \verb|      min::uns64 flags = 0 )|
\LABEL{MUP::NEW_CONTROL_OF_VALUE} \\
\verb|min::uns64 MUP::|
    & \MUPKEY{new\_control} \\
    & \verb|    ( int type_code, const min::stub * s,|\ARGBREAK
      \verb|      min::uns64 flags = 0 )|
\LABEL{MUP::NEW_CONTROL_OF_STUB} \\
\verb|min::uns64 MUP::|
    & \MUPKEY{renew\_control\_value}\ARGBREAK
      \verb| ( min::uns64 c, min::uns64 v )|
\LABEL{MUP::RENEW_CONTROL_VALUE} \\
\verb|min::uns64 MUP::|
    & \MUPKEY{renew\_control\_stub}\ARGBREAK
      \verb| ( min::uns64 c, const min::stub * s )|
\LABEL{MUP::RENEW_CONTROL_STUB} \\
\verb|min::uns64 MUP::| & \MUPKEY{value\_of\_control}\verb| ( min::uns64 c )|
\LABEL{MUP::VALUE_OF_CONTROL} \\
\verb|min::stub * MUP::| & \MUPKEY{stub\_of\_control}\verb| ( min::uns64 c )|
\LABEL{MUP::STUB_OF_CONTROL} \\
\end{TABULAR}

\begin{TABULAR}{1.6in}
\verb|min::uns64 MUP::|
    & \MUPKEY{new\_acc\_control} \\
    & \verb|    ( int type_code, const min::stub * s,|\ARGBREAK
      \verb|      min::uns64 flags = 0 )|
\LABEL{MUP::NEW_ACC_CONTROL_OF_STUB} \\
\verb|min::uns64 MUP::|
    & \MUPKEY{renew\_acc\_control\_stub}\ARGBREAK
      \verb| ( min::uns64 c, const min::stub * s )|
\LABEL{MUP::RENEW_ACC_CONTROL_STUB} \\
\verb|min::stub * MUP::|
    & \MUPKEY{stub\_of\_acc\_control}\verb| ( min::uns64 c )|
\LABEL{MUP::STUB_OF_ACC_CONTROL} \\
[1ex]
\verb|min::uns64 MUP::|
    & \MUPKEY{renew\_control\_type}\ARGBREAK
      \verb| ( min::uns64 c, int type )|
\LABEL{MUP::RENEW_CONTROL_TYPE} \\
\verb|int MUP::| & \MUPKEY{type\_of\_control}\verb| ( min::uns64 c )|
\LABEL{MUP::TYPE_OF_CONTROL} \\
\end{TABULAR}

\end{indpar}

\INDEXHEADER{Control Flags}

\begin{indpar}[0.2in]

\begin{TABULAR}{2.0in}
\verb|const min::uns64 MUP::| & \MUPKEY{STUB\_ADDRESS}
\LABEL{MIN::STUB_ADDRESS}\\
\end{TABULAR}

\end{indpar}

\INDEXHEADER{Number Protected Declarations}

\begin{indpar}[0.2in]

\begin{TABULAR}{1.8in}
\verb|min::float64 min::|
    & \MINKEY{float\_of\COMPACT}\verb| ( const min::stub * s )|
\LABEL{MIN::FLOAT_OF} \\
\end{TABULAR}

\begin{TABULAR}{1.8in}
\verb|bool min::| & \MINKEY{is\_num}\verb| ( min::gen v )|
\LABEL{MIN::IS_NUM} \\[1ex]
\verb|min::gen min::|
    & \MINKEY{new\_num\_gen\REL} \verb| ( int v )|
\LABEL{MIN::NEW_NUM_GEN_OF_INT} \\
\verb|min::gen min::|
    & \MINKEY{new\_num\_gen\REL} \verb| ( min::float64 v )|
\LABEL{MIN::NEW_NUM_GEN_OF_FLOAT64} \\[1ex]
\verb|int min::| & \MINKEY{int\_of}\verb| ( min::gen v )|
\LABEL{MIN::INT_OF_GEN} \\
\verb|min::float64 min::| & \MINKEY{float\_of}\verb| ( min::gen v )|
\LABEL{MIN::FLOAT_OF_GEN} \\[1ex]
\verb|min::uns32 min::| & \MINKEY{numhash}\verb| ( min::gen v )|
\LABEL{MIN::NUMHASH_OF_GEN} \\
\verb|min::uns32 min::| & \MINKEY{floathash}\verb| ( min::float64 f )|
\LABEL{MIN::FLOATHASH} \\
\end{TABULAR}

\end{indpar}

\INDEXHEADER{Number Unprotected Declarations}

\begin{indpar}[0.2in]

\begin{TABULAR}{1.8in}
\verb|min::float64 MUP::| & \MUPKEY{float\_of}\verb| ( min::gen v )|
\LABEL{MUP::FLOAT_OF_GEN} \\
\end{TABULAR}

\end{indpar}


\INDEXHEADER{String Protected Declarations}

\begin{indpar}[0.2in]

\begin{TABULAR}{1.8in}
\verb|min::gen min::|
    & \MINKEY{new\_str\_gen\REL} \verb| ( const char * p )|
\LABEL{MIN::NEW_STR_GEN} \\
\verb|min::gen min::|
    & \MINKEY{new\_str\_gen\REL}\ARGBREAK
      \verb| ( const char * p, unsigned n )|
\LABEL{MIN::NEW_STR_GEN_WITH_N} \\
\end{TABULAR}

\begin{TABULAR}{1.8in}
\verb|int min::| & \MINKEY{is\_str}\verb| ( min::gen v )|
\LABEL{MIN::IS_STR_OF_GEN} \\
\end{TABULAR}

\begin{TABULAR}{1.8in}
\verb|unsigned min::| & \MINKEY{strlen}\verb| ( min::gen v )|
\LABEL{MIN::STRLEN_OF_GEN} \\
\verb|unsigned min::| & \MINKEY{strhash}\verb| ( min::gen v )|
\LABEL{MIN::STRHASH_OF_GEN} \\
\verb|char * min::| & \MINKEY{strcpy}\verb| ( char * p, min::gen v )|
\LABEL{MIN::STRCPY_OF_GEN} \\
\verb|char * min::| & \MINKEY{strncpy}\ARGBREAK
                      \verb| ( char * p,|\ARGBREAK
		      \verb|   min::gen v, unsigned n )|
\LABEL{MIN::STRNCPY_OF_GEN} \\
\verb|int min::| & \MINKEY{strcmp}\verb| ( const char * p, min::gen v )|
\LABEL{MIN::STRCMP_OF_GEN} \\
\verb|int min::| & \MINKEY{strncmp}\ARGBREAK
                   \verb| ( const char * p,|\ARGBREAK
		   \verb|   min::gen v, unsigned n )|
\LABEL{MIN::STRNCMP_OF_GEN} \\
\end{TABULAR}

\begin{TABULAR}{1.8in}
\verb|min::uns32 min::| & \MINKEY{strhash}\verb| ( const char * p )|
\LABEL{MIN::STRHASH} \\
\verb|min::uns32 min::|
    & \MINKEY{strnhash}\verb| ( const char * p, unsigned n )|
\LABEL{MIN::STRNHASH} \\
\end{TABULAR}

\end{indpar}

\INDEXHEADER{String Pointer Declarations}

\begin{indpar}[0.2in]

\begin{TABULAR}{1.8in}
\verb|(constructor) min::| & \MINKEY{str\_pointer}\verb| ( min::gen v )|
\LABEL{MIN::STR_POINTER_OF_GEN} \\
\verb|void min::|
    & \MINKEY{initialize}\ARGBREAK
      \verb| ( min::str_pointer & sp, min::gen v )|
\LABEL{MIN::INIT_OF_STR_POINTER} \\[1ex]
\verb|unsigned min::| & \MINKEY{strlen}\verb| ( min::str_pointer & sp )|
\LABEL{MIN::STRLEN_OF_STR_POINTER} \\
\verb|unsigned min::| & \MINKEY{strhash}\verb| ( min::str_pointer & sp )|
\LABEL{MIN::STRHASH_OF_STR_POINTER} \\[1ex]
\verb|char * min::| & \MINKEY{strcpy}\ARGBREAK
      \verb| ( char * p, min::str_pointer & sp )|
\LABEL{MIN::STRCPY_OF_STR_POINTER} \\
\verb|char * min::|
    & \MINKEY{strncpy}\ARGBREAK
      \verb| ( char * p,|\ARGBREAK
      \verb|   min::str_pointer & sp, unsigned n )|
\LABEL{MIN::STRNCPY_OF_STR_POINTER} \\[1ex]
\verb|int min::|
    & \MINKEY{strcmp}\ARGBREAK
      \verb| ( const char * p,|\ARGBREAK
      \verb|   min::str_pointer & sp )|
\LABEL{MIN::STRCMP_OF_STR_POINTER} \\
\verb|int min::|
    & \MINKEY{strncmp}\ARGBREAK
      \verb|( const char * p,|\ARGBREAK
      \verb|  min::str_pointer & sp, unsigned n )|
\LABEL{MIN::STRNCMP_OF_STR_POINTER} \\[1ex]
\verb|const char      |
    & \ttkey{operator [ ]}\ARGBREAK
      \verb| ( min::str_pointer & sp, int index )|
\LABEL{MUP::[]_OF_STR_POINTER} \\
\verb|const char * MUP::| & \MUPKEY{str\_of}\verb| ( min::str_pointer & sp )|
\LABEL{MUP::STR_OF_STR_POINTER} \\
\end{TABULAR}

\end{indpar}

\INDEXHEADER{String Unprotected Declarations}

\begin{indpar}[0.2in]

\begin{TABULAR}{1.8in}
\verb|min::uns64 MUP::|
    & \MUPKEY{short\_str\_of}\verb| ( const min::stub * s )|
\LABEL{MUP::SHORT_STR_OF} \\
\end{TABULAR}

\begin{TABULAR}{1.8in}
\verb|MUP::long_str * MUP::|
    & \MUPKEY{long\_str\_of}\verb| ( const min::stub * s )|
\LABEL{MUP::LONG_STR_OF} \\
\verb|const char * MUP::| & \MUPKEY{str\_of}\verb| ( MUP::long_str * str )|
\LABEL{MUP::STR_OF_LONG_STR} \\
\verb|unsigned MUP::| & \MUPKEY{length\_of}\verb| ( MUP::long_str * str )|
\LABEL{MUP::LENGTH_OF_LONG_STR} \\
\verb|unsigned MUP::| & \MUPKEY{hash\_of}\verb| ( MUP::long_str * str )|
\LABEL{MUP::HASH_OF_LONG_STR} \\
\end{TABULAR}

\end{indpar}

\INDEXHEADER{Label Declarations}

\begin{indpar}[0.2in]

\begin{TABULAR}{1.8in}
\verb|unsigned min::| & \MINKEY{lab\_of}\ARGBREAK
    \verb| ( min::gen * p, unsigned n,|\ARGBREAK
    \verb|   const min::stub * s )|
\LABEL{MIN::LAB_OF} \\
\verb|unsigned min::| & \MINKEY{lab\_of}\ARGBREAK
    \verb| ( min::gen * p, unsigned n,|\ARGBREAK\verb|   min::gen v )|
\LABEL{MIN::LAB_OF_GEN} \\
\end{TABULAR}

\begin{TABULAR}{1.8in}
\verb|unsigned min::| & \MINKEY{lablen}\verb| ( const min::stub * s )|
\LABEL{MIN::LABLEN} \\
\verb|unsigned min::| & \MINKEY{lablen}\verb| ( min::gen v )|
\LABEL{MIN::LABLEN_OF_GEN} \\
\end{TABULAR}

\begin{TABULAR}{1.8in}
\verb|min::uns32 min::| & \MINKEY{labhash}\verb| ( const min::stub * s )|
\LABEL{MIN::LABHASH} \\
\verb|min::uns32 min::| & \MINKEY{labhash}\verb| ( min::gen v )|
\LABEL{MIN::LABHASH_OF_GEN} \\
\verb|min::uns32 min::| & \MINKEY{labhash}\ARGBREAK
    \verb| ( const min::gen * p, unsigned n )|
\LABEL{MIN::LABHASH_OF_GEN_VECTOR} \\
\end{TABULAR}

\begin{TABULAR}{1.8in}
\verb|min::gen min::| & \MINKEY{new\_lab\_gen}\ARGBREAK
    \verb| ( const min::gen * p, unsigned n )|
\LABEL{MIN::NEW_LAB_GEN} \\
\end{TABULAR}

\begin{TABULAR}{1.8in}
\verb|bool min::| & \MINKEY{is\_lab}\verb| ( min::gen v )|
\LABEL{MIN::IS_LAB_OF_GEN} \\
\end{TABULAR}

\end{indpar}

\INDEXHEADER{Object Declarations}

\begin{indpar}[0.2in]

\begin{TABULAR}{2.0in}
\verb|MUP::short_obj * MUP::|
    & \MUPKEY{short\_obj\_of}\verb| ( min::stub * s )|
\LABEL{MUP::SHORT_OBJ_OF} \\
\verb|MUP::long_obj * MUP::|
    & \MUPKEY{long\_obj\_of}\verb| ( min::stub * s )|
\LABEL{MUP::LONG_OBJ_OF} \\
\end{TABULAR}

\end{indpar}

\medskip

\begin{indpar}[0.2in]

\begin{TABULAR}{1.4in}
\verb|unsigned min::|
    & \MINKEY{hash\_size\_of}\verb| ( MUP::short_obj * so )|
\LABEL{MIN::HASH_TABLE_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned min::|
    & \MINKEY{hash\_size\_of}\verb| ( MUP::long_obj * lo )|
\LABEL{MIN::HASH_TABLE_SIZE_OF_LONG_OBJ} \\
\verb|unsigned min::|
    & \MINKEY{attr\_size\_of}\ARGBREAK
    		\verb| ( MUP::short_obj * so )|
\LABEL{MIN::ATTR_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned min::|
    & \MINKEY{attr\_size\_of}\ARGBREAK
    		\verb| ( MUP::long_obj * lo )|
\LABEL{MIN::ATTR_SIZE_OF_LONG_OBJ} \\
\verb|unsigned min::|
    & \MINKEY{aux\_size\_of}\verb| ( MUP::short_obj * so )|
\LABEL{MIN::AUX_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned min::|
    & \MINKEY{aux\_size\_of}\verb| ( MUP::long_obj * lo )|
\LABEL{MIN::AUX_SIZE_OF_LONG_OBJ} \\
\verb|unsigned min::|
    & \MINKEY{unused\_size\_of}\verb| ( MUP::short_obj * so )|
\LABEL{MIN::UNUSED_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned min::|
    & \MINKEY{unused\_size\_of}\verb| ( MUP::long_obj * lo )|
\LABEL{MIN::UNUSED_SIZE_OF_LONG_OBJ} \\
\verb|unsigned min::| & \MINKEY{header\_size\_of}\verb| ( MUP::short_obj * so )|
\LABEL{MIN::HEADER_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned min::| & \MINKEY{header\_size\_of}\verb| ( MUP::long_obj * lo )|
\LABEL{MIN::HEADER_SIZE_OF_LONG_OBJ} \\
\verb|unsigned min::| & \MINKEY{total\_size\_of}\verb| ( MUP::short_obj * so )|
\LABEL{MIN::TOTAL_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned min::| & \MINKEY{total\_size\_of}\verb| ( MUP::long_obj * lo )|
\LABEL{MIN::TOTAL_SIZE_OF_LONG_OBJ} \\
\end{TABULAR}

\end{indpar}

\medskip

\begin{indpar}[0.2in]

\begin{TABULAR}{1.4in}
\verb|unsigned min::|
    & \MINKEY{short\_obj\_hash\_size}\verb| ( unsigned u )|
\LABEL{MIN::SHORT_OBJ_HASH_TABLE_SIZE} \\
\verb|unsigned min::|
    & \MINKEY{short\_obj\_total\_size}\verb| ( unsigned u )|
\LABEL{MIN::SHORT_OBJ_TOTAL_SIZE} \\
\verb|unsigned min::|
    & \MINKEY{long\_obj\_hash\_size}\verb| ( unsigned u )|
\LABEL{MIN::LONG_OBJ_HASH_TABLE_SIZE} \\
\verb|unsigned min::|
    & \MINKEY{long\_obj\_total\_size}\verb| ( unsigned u )|
\LABEL{MIN::LONG_OBJ_TOTAL_SIZE} \\
\end{TABULAR}

\end{indpar}

\medskip

\begin{indpar}[0.2in]

\begin{TABULAR}{1.4in}
\verb|min::gen min::| & \MINKEY{new\_obj\_gen\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( unsigned hash_size,| \\
    \verb|   unsigned unused_size )| \\
    \end{tabular}
\LABEL{MIN::NEW_OBJ_GEN} \\
\end{TABULAR}

\end{indpar}

\newpage

\INDEXHEADER{Object Vector Level Declarations}

\begin{indpar}[0.2in]

\begin{TABULAR}{2.0in}
\verb|const min::gen * MUP::|
	& \MUPKEY{body\_vector\_of}\ARGBREAK
		\verb| ( MUP::short_obj * so )|
\LABEL{MUP::BODY_VECTOR_OF_SHORT_OBJ} \\
\verb|const min::gen * MUP::|
	& \MUPKEY{body\_vector\_of}\ARGBREAK
		\verb| ( MUP::long_obj * lo )|
\LABEL{MUP::BODY_VECTOR_OF_LONG_OBJ} \\
\verb|min::gen * MUP::|
	& \MUPKEY{writable\_body\_vector\_of}\ARGBREAK
		\verb| ( MUP::short_obj * so )|
\LABEL{MUP::WRITABLE_BODY_VECTOR_OF_SHORT_OBJ} \\
\verb|min::gen * MUP::|
	& \MUPKEY{writable\_body\_vector\_of}\ARGBREAK
		\verb| ( MUP::long_obj * lo )|
\LABEL{MUP::WRITABLE_BODY_VECTOR_OF_LONG_OBJ} \\
\end{TABULAR}

\medskip

\begin{TABULAR}{1.4in}
\verb|unsigned min::|
	& \MINKEY{hash\_offset\_of}\verb| ( MUP::short_obj * so )|
\LABEL{MIN::HASH_OFFSET_OF_SHORT_OBJ} \\
\verb|unsigned min::|
	& \MINKEY{hash\_offset\_of}\verb| ( MUP::long_obj * lo )|
\LABEL{MIN::HASH_OFFSET_OF_LONG_OBJ} \\
\verb|unsigned min::|
	& \MINKEY{attr\_offset\_of}\verb| ( MUP::short_obj * so )|
\LABEL{MIN::ATTR_OFFSET_OF_SHORT_OBJ} \\
\verb|unsigned min::|
	& \MINKEY{attr\_offset\_of}\verb| ( MUP::long_obj * lo )|
\LABEL{MIN::ATTR_OFFSET_OF_LONG_OBJ} \\
\verb|unsigned min::|
	& \MINKEY{aux\_offset\_of}\verb| ( MUP::short_obj * so )|
\LABEL{MIN::AUX_OFFSET_OF_SHORT_OBJ} \\
\verb|unsigned min::|
	& \MINKEY{aux\_offset\_of}\verb| ( MUP::long_obj * lo )|
\LABEL{MIN::AUX_OFFSET_OF_LONG_OBJ} \\
\end{TABULAR}

\medskip

\begin{TABULAR}{1.4in}
\verb|unsigned min::|
	& \MINKEY{attr\_push}\ARGBREAK
	  \verb|    ( MUP::short_obj * so, min::gen value )|
\LABEL{MIN::SHORT_ATTR_PUSH_OF_GEN} \\
\verb|unsigned min::|
	& \MINKEY{attr\_push} \\
	& \verb|    ( MUP::short_obj * so,|\ARGBREAK
	  \verb|      min::gen * p, unsigned n )|
\LABEL{MIN::SHORT_ATTR_PUSH_OF_GENS} \\
\verb|unsigned min::|
	& \MINKEY{aux\_push}\ARGBREAK
	  \verb|    ( MUP::short_obj * so, min::gen value )|
\LABEL{MIN::SHORT_AUX_PUSH_OF_GEN} \\
\verb|unsigned min::|
	& \MINKEY{aux\_push}\ARGBREAK
	  \verb|    ( MUP::short_obj * so,|\ARGBREAK
	  \verb|      min::gen * p, unsigned n )|
\LABEL{MIN::SHORT_AUX_PUSH_OF_GENS} \\
\end{TABULAR}

\begin{TABULAR}{1.4in}
\verb|unsigned min::|
	& \MINKEY{attr\_push}\ARGBREAK
	  \verb|    ( MUP::long_obj * lo, min::gen value )|
\LABEL{MIN::LONG_ATTR_PUSH_OF_GEN} \\
\verb|unsigned min::|
	& \MINKEY{attr\_push}\ARGBREAK
	  \verb|    ( MUP::long_obj * lo,|\ARGBREAK
	  \verb|      min::gen * p, unsigned n )|
\LABEL{MIN::LONG_ATTR_PUSH_OF_GENS} \\
\verb|unsigned min::|
	& \MINKEY{aux\_push}\ARGBREAK
	  \verb|    ( MUP::long_obj * lo, min::gen value )|
\LABEL{MIN::LONG_AUX_PUSH_OF_GEN} \\
\verb|unsigned min::|
	& \MINKEY{aux\_push}\ARGBREAK
	  \verb|    ( MUP::long_obj * lo,|\ARGBREAK
	  \verb|      min::gen * p, unsigned n )|
\LABEL{MIN::LONG_AUX_PUSH_OF_GENS} \\
\end{TABULAR}

\medskip

\begin{TABULAR}{1.4in}
\verb|unsigned MUP::|
	& \MUPKEY{attr\_push}\ARGBREAK
	  \verb|    ( MUP::short_obj * so, min::gen value )|
\LABEL{MUP::SHORT_ATTR_PUSH_OF_GEN} \\
\verb|unsigned MUP::|
	& \MUPKEY{attr\_push} \\
	& \verb|    ( MUP::short_obj * so,|\ARGBREAK
	  \verb|      min::gen * p, unsigned n )|
\LABEL{MUP::SHORT_ATTR_PUSH_OF_GENS} \\
\verb|unsigned MUP::|
	& \MUPKEY{aux\_push}\ARGBREAK
	  \verb|    ( MUP::short_obj * so, min::gen value )|
\LABEL{MUP::SHORT_AUX_PUSH_OF_GEN} \\
\verb|unsigned MUP::|
	& \MUPKEY{aux\_push}\ARGBREAK
	  \verb|    ( MUP::short_obj * so,|\ARGBREAK
	  \verb|      min::gen * p, unsigned n )|
\LABEL{MUP::SHORT_AUX_PUSH_OF_GENS} \\
\end{TABULAR}

\begin{TABULAR}{1.4in}
\verb|unsigned MUP::|
	& \MUPKEY{attr\_push}\ARGBREAK
	  \verb|    ( MUP::long_obj * lo, min::gen value )|
\LABEL{MUP::LONG_ATTR_PUSH_OF_GEN} \\
\verb|unsigned MUP::|
	& \MUPKEY{attr\_push}\ARGBREAK
	  \verb|    ( MUP::long_obj * lo,|\ARGBREAK
	  \verb|      min::gen * p, unsigned n )|
\LABEL{MUP::LONG_ATTR_PUSH_OF_GENS} \\
\verb|unsigned MUP::|
	& \MUPKEY{aux\_push}\ARGBREAK
	  \verb|    ( MUP::long_obj * lo, min::gen value )|
\LABEL{MUP::LONG_AUX_PUSH_OF_GEN} \\
\verb|unsigned MUP::|
	& \MUPKEY{aux\_push}\ARGBREAK
	  \verb|    ( MUP::long_obj * lo,|\ARGBREAK
	  \verb|      min::gen * p, unsigned n )|
\LABEL{MUP::LONG_AUX_PUSH_OF_GENS} \\
\end{TABULAR}

\medskip

\begin{TABULAR}{1.4in}
\verb|unsigned min::|
	& \MINKEY{attr\_pop}\ARGBREAK
	  \verb|    ( MUP::short_obj * so, min::gen & value )|
\LABEL{MIN::SHORT_ATTR_POP_OF_GEN} \\
\verb|unsigned min::|
	& \MINKEY{attr\_pop} \\
	& \verb|    ( MUP::short_obj * so,|\ARGBREAK
	  \verb|      min::gen * p, unsigned n )|
\LABEL{MIN::SHORT_ATTR_POP_OF_GENS} \\
\verb|unsigned min::|
	& \MINKEY{aux\_pop}\ARGBREAK
	  \verb|    ( MUP::short_obj * so, min::gen & value )|
\LABEL{MIN::SHORT_AUX_POP_OF_GEN} \\
\verb|unsigned min::|
	& \MINKEY{aux\_pop}\ARGBREAK
	  \verb|    ( MUP::short_obj * so,|\ARGBREAK
	  \verb|      min::gen * p, unsigned n )|
\LABEL{MIN::SHORT_AUX_POP_OF_GENS} \\
\end{TABULAR}

\begin{TABULAR}{1.4in}
\verb|unsigned min::|
	& \MINKEY{attr\_pop}\ARGBREAK
	  \verb|    ( MUP::long_obj * lo, min::gen & value )|
\LABEL{MIN::LONG_ATTR_POP_OF_GEN} \\
\verb|unsigned min::|
	& \MINKEY{attr\_pop}\ARGBREAK
	  \verb|    ( MUP::long_obj * lo,|\ARGBREAK
	  \verb|      min::gen * p, unsigned n )|
\LABEL{MIN::LONG_ATTR_POP_OF_GENS} \\
\verb|unsigned min::|
	& \MINKEY{aux\_pop}\ARGBREAK
	  \verb|    ( MUP::long_obj * lo, min::gen & value )|
\LABEL{MIN::LONG_AUX_POP_OF_GEN} \\
\verb|unsigned min::|
	& \MINKEY{aux\_pop}\ARGBREAK
	  \verb|    ( MUP::long_obj * lo,|\ARGBREAK
	  \verb|      min::gen * p, unsigned n )|
\LABEL{MIN::LONG_AUX_POP_OF_GENS} \\
\end{TABULAR}

\medskip

\begin{TABULAR}{1.4in}
\verb|unsigned MUP::|
	& \MUPKEY{attr\_pop}\ARGBREAK
	  \verb|    ( MUP::short_obj * so, min::gen & value )|
\LABEL{MUP::SHORT_ATTR_POP_OF_GEN} \\
\verb|unsigned MUP::|
	& \MUPKEY{attr\_pop} \\
	& \verb|    ( MUP::short_obj * so,|\ARGBREAK
	  \verb|      min::gen * p, unsigned n )|
\LABEL{MUP::SHORT_ATTR_POP_OF_GENS} \\
\verb|unsigned MUP::|
	& \MUPKEY{aux\_pop}\ARGBREAK
	  \verb|    ( MUP::short_obj * so, min::gen & value )|
\LABEL{MUP::SHORT_AUX_POP_OF_GEN} \\
\verb|unsigned MUP::|
	& \MUPKEY{aux\_pop}\ARGBREAK
	  \verb|    ( MUP::short_obj * so,|\ARGBREAK
	  \verb|      min::gen * p, unsigned n )|
\LABEL{MUP::SHORT_AUX_POP_OF_GENS} \\
\end{TABULAR}

\begin{TABULAR}{1.4in}
\verb|unsigned MUP::|
	& \MUPKEY{attr\_pop}\ARGBREAK
	  \verb|    ( MUP::long_obj * lo, min::gen & value )|
\LABEL{MUP::LONG_ATTR_POP_OF_GEN} \\
\verb|unsigned MUP::|
	& \MUPKEY{attr\_pop}\ARGBREAK
	  \verb|    ( MUP::long_obj * lo,|\ARGBREAK
	  \verb|      min::gen * p, unsigned n )|
\LABEL{MUP::LONG_ATTR_POP_OF_GENS} \\
\verb|unsigned MUP::|
	& \MUPKEY{aux\_pop}\ARGBREAK
	  \verb|    ( MUP::long_obj * lo, min::gen & value )|
\LABEL{MUP::LONG_AUX_POP_OF_GEN} \\
\verb|unsigned MUP::|
	& \MUPKEY{aux\_pop}\ARGBREAK
	  \verb|    ( MUP::long_obj * lo,|\ARGBREAK
	  \verb|      min::gen * p, unsigned n )|
\LABEL{MUP::LONG_AUX_POP_OF_GENS} \\
\end{TABULAR}

\end{indpar}

\INDEXHEADER{Object List Level Declarations}

\begin{indpar}[0.2in]
\begin{tabular}{@{}p{6.2in}@{}}
\TTNBKEY{MIN\_USES\_OBJECT\_AUX\_STUBS}
\LABEL{MIN_USES_OBJECT_AUX_STUBS}
\end{tabular}
\end{indpar}

\begin{indpar}[0.2in]

\begin{TABULAR}{1.8in}
\verb|const min::gen min::| & \MINKEY{LIST\_END}
\LABEL{MIN::LIST_END} \\
\verb|const min::gen min::|
    & \MINKEY{EMPTY\_SUBLIST}
\LABEL{MIN::EMPTY_SUBLIST} \\
\end{TABULAR}

\end{indpar}

\begin{indpar}[0.2in]

\begin{TABULAR}{1.8in}
(constructor)~\verb|MUP::|
	& \MUPKEY{list\_pointer}\verb| ( min::stub * s )|
\LABEL{MUP::LIST_POINTER_OF_STUB} \\
(constructor)~\verb|MUP::|
	& \MUPKEY{list\_pointer}\verb| ( min::gen obj )|
\LABEL{MUP::LIST_POINTER_OF_GEN} \\
\end{TABULAR}

\bigskip

\begin{TABULAR}{1.2in}
\verb|min::gen min::|
	& \MINKEY{start\_hash}\ARGBREAK
	  \verb| ( min::list_pointer & lp, unsigned index )|
\LABEL{MIN::START_HASH} \\
\verb|min::gen min::|
	& \MINKEY{start\_vector}\ARGBREAK
	  \verb| ( min::list_pointer & lp, unsigned index )|
\LABEL{MIN::START_VECTOR} \\
\verb|min::gen min::|
	& \MINKEY{start\_copy}\ARGBREAK
	  \verb| ( min::list_pointer & lp,|\ARGBREAK
	  \verb|   const min::list_pointer & lp2 )|
\LABEL{MIN::START_COPY} \\
\verb|unsigned min::|
	& \MINKEY{next}\verb| ( min::list_pointer & lp )|
\LABEL{MIN::NEXT_OF_LIST_POINTER} \\
\verb|unsigned min::|
	& \MINKEY{current}\verb| ( min::list_pointer & lp )|
\LABEL{MIN::CURRENT_OF_LIST_POINTER} \\
\verb|min::gen min::|
	& \MINKEY{start\_sublist}\verb| ( min::list_pointer & lp )|
\LABEL{MIN::START_SUBLIST} \\
\verb|bool min::|
	& \MINKEY{is\_list\_end}\verb| ( min::gen v )|
\LABEL{MIN::IS_LIST_END} \\
\verb|bool min::|
	& \MINKEY{is\_sublist}\verb| ( min::gen v )|
\LABEL{MIN::IS_SUBLIST} \\
\verb|bool min::|
	& \MINKEY{is\_empty\_sublist}\verb| ( min::gen v )|
\LABEL{MIN::IS_EMPTY_SUBLIST} \\
\verb|min:gen min::|
	& \MINKEY{refresh}\ARGBREAK
	  \verb| ( min::list_pointer & lp )|
\LABEL{MIN::REFRESH_OF_LIST_POINTER} \\
\end{TABULAR}

\bigskip

\begin{TABULAR}{1.2in}
\verb|void MUP::|
	& \MUPKEY{start}\verb| ( min::list_pointer & lp )|
\LABEL{MUP::START_LIST_POINTER} \\
\verb|unsigned MUP::|
	& \MUPKEY{hash\_size\_of}\verb| ( min::list_pointer & lp )|
\LABEL{MUP::HASH_SIZE_OF_LIST_POINTER} \\
\verb|unsigned MUP::|
	& \MUPKEY{vector\_size\_of}\verb| ( min::list_pointer & lp )|
\LABEL{MUP::VECTOR_SIZE_OF_LIST_POINTER} \\
\verb|min::gen MUP::|
	& \MUPKEY{start\_hash}\ARGBREAK
	  \verb| ( min::list_pointer & lp,|\ARGBREAK
	  \verb|   unsigned index )|
\LABEL{MUP::START_HASH} \\
\verb|min::gen MUP::|
	& \MUPKEY{start\_vector}\ARGBREAK
	  \verb| ( min::list_pointer & lp,|\ARGBREAK
	  \verb|   unsigned index )|
\LABEL{MUP::START_VECTOR} \\
\end{TABULAR}

\bigskip

\begin{TABULAR}{1.8in}
(constructor)~\verb|MUP::|
	& \MUPKEY{updatable\_list\_pointer}\verb| ( min::stub * s )|
\LABEL{MUP::UPDATABLE_LIST_POINTER_OF_STUB} \\
(constructor)~\verb|MUP::|
	& \MUPKEY{updatable\_list\_pointer}\verb| ( min::gen obj )|
\LABEL{MUP::UPDATABLE_LIST_POINTER_OF_GEN} \\
\end{TABULAR}

\bigskip

\begin{TABULAR}{1.2in}
\verb|min::gen min::|
	& \MINKEY{start\_hash}\ARGBREAK
	  \verb| ( min::updatable_list_pointer & lp,|\ARGBREAK
	  \verb|   unsigned index )|
\LABEL{MIN::START_HASH_OF_UPDATABLE} \\
\verb|min::gen min::|
	& \MINKEY{start\_vector}\ARGBREAK
	  \verb| ( min::updatable_list_pointer & lp,|\ARGBREAK
	  \verb|   unsigned index )|
\LABEL{MIN::START_VECTOR_OF_UPDATABLE} \\
\verb|min::gen min::|
	& \MINKEY{start\_copy}\ARGBREAK
	  \verb| ( min::updatable_list_pointer & lp,|\ARGBREAK
	  \verb|   const min::updatable_list_pointer & lp2 )|
\LABEL{MIN::START_COPY_OF_UPDATABLE} \\
\verb|min::gen min::|
	& \MINKEY{next}\verb| ( min::updatable_list_pointer & lp )|
\LABEL{MIN::NEXT_OF_LIST_POINTER_OF_UPDATABLE} \\
\verb|min::gen min::|
	& \MINKEY{current}\verb| ( min::updatable_list_pointer & lp )|
\LABEL{MIN::CURRENT_OF_LIST_POINTER_OF_UPDATABLE} \\
\verb|min::gen min::|
	& \MINKEY{start\_sublist}\ARGBREAK
	  \verb| ( min::updatable_list_pointer & lp )|
\LABEL{MIN::START_SUBLIST_OF_UPDATABLE} \\
\verb|void min::|
	& \MINKEY{update}\ARGBREAK
	  \verb| ( min::updatable_list_pointer & lp,|\ARGBREAK
	  \verb|   min::gen value )|
\LABEL{MIN::SET_OF_UPDATABLE} \\
\verb|min:gen min::|
	& \MINKEY{refresh}\ARGBREAK
	  \verb| ( min::updatable_list_pointer & lp )|
\LABEL{MIN::REFRESH_OF_LIST_POINTER_OF_UPDATABLE} \\
\end{TABULAR}

\bigskip

\begin{TABULAR}{1.2in}
\verb|void MUP::|
	& \MUPKEY{start}\verb| ( min::updatable_list_pointer & lp )|
\LABEL{MUP::START_LIST_POINTER_OF_UPDATABLE} \\
\verb|unsigned MUP::|
	& \MUPKEY{hash\_size\_of}\verb| ( min::updatable_list_pointer & lp )|
\LABEL{MUP::HASH_SIZE_OF_LIST_POINTER_OF_UPDATABLE} \\[1ex]
\verb|unsigned MUP::|
	& \MUPKEY{vector\_size\_of}\verb| ( min::updatable_list_pointer & lp )|
\LABEL{MUP::VECTOR_SIZE_OF_LIST_POINTER_OF_UPDATABLE} \\
\verb|min::gen MUP::|
	& \MUPKEY{start\_hash}\ARGBREAK
	  \verb| ( min::updatable_list_pointer & lp,|\ARGBREAK
	  \verb|   unsigned index )|
\LABEL{MUP::START_HASH_OF_UPDATABLE} \\
\verb|min::gen MUP::|
	& \MUPKEY{start\_vector}\ARGBREAK
	  \verb| ( min::updatable_list_pointer & lp,|\ARGBREAK
	  \verb|   unsigned index )|
\LABEL{MUP::START_VECTOR_OF_UPDATABLE} \\
\end{TABULAR}

\bigskip

\begin{TABULAR}{1.8in}
(constructor)~\verb|MUP::|
	& \MUPKEY{insertable\_list\_pointer}\verb| ( min::stub * s )|
\LABEL{MUP::INSERTABLE_LIST_POINTER_OF_STUB} \\
(constructor)~\verb|MUP::|
	& \MUPKEY{insertable\_list\_pointer}\verb| ( min::gen obj )|
\LABEL{MUP::INSERTABLE_LIST_POINTER_OF_GEN} \\
\end{TABULAR}

\bigskip

\begin{TABULAR}{1.2in}
\verb|min::gen min::|
	& \MINKEY{start\_hash}\ARGBREAK
	  \verb| ( min::insertable_list_pointer & lp,|\ARGBREAK
	  \verb|   unsigned index )|
\LABEL{MIN::START_HASH_OF_INSERTABLE} \\
\verb|min::gen min::|
	& \MINKEY{start\_vector}\ARGBREAK
	  \verb| ( min::insertable_list_pointer & lp,|\ARGBREAK
	  \verb|   unsigned index )|
\LABEL{MIN::START_VECTOR_OF_INSERTABLE} \\
\verb|min::gen min::|
	& \MINKEY{start\_copy}\ARGBREAK
	  \verb| ( min::insertable_list_pointer & lp,|\ARGBREAK
	  \verb|   const min::insertable_list_pointer & lp2 )|
\LABEL{MIN::START_COPY_OF_INSERTABLE} \\
\verb|min::gen min::|
	& \MINKEY{next}\verb| ( min::insertable_list_pointer & lp )|
\LABEL{MIN::NEXT_OF_LIST_POINTER_OF_INSERTABLE} \\
\verb|min::gen min::|
	& \MINKEY{current}\ARGBREAK
	  \verb| ( min::insertable_list_pointer & lp )|
\LABEL{MIN::CURRENT_OF_LIST_POINTER_OF_INSERTABLE} \\
\verb|min::gen min::|
	& \MINKEY{start\_sublist}\ARGBREAK
	  \verb| ( min::insertable_list_pointer & lp )|
\LABEL{MIN::START_SUBLIST_OF_INSERTABLE} \\
\verb|void min::|
	& \MINKEY{update}\ARGBREAK
	  \verb| ( min::insertable_list_pointer & lp,|\ARGBREAK
	  \verb|   min::gen value )|
\LABEL{MIN::SET_OF_INSERTABLE} \\
\verb|min:gen min::|
	& \MINKEY{refresh}\ARGBREAK
	  \verb| ( min::insertable_list_pointer & lp )|
\LABEL{MIN::REFRESH_OF_LIST_POINTER_OF_INSERTABLE} \\
\end{TABULAR}

\bigskip

\begin{TABULAR}{1.2in}
\verb|void MUP::|
	& \MUPKEY{start}\verb| ( min::insertable_list_pointer & lp )|
\LABEL{MUP::START_LIST_POINTER_OF_INSERTABLE} \\
\verb|unsigned MUP::|
	& \MUPKEY{hash\_size\_of}\ARGBREAK
	  \verb| ( min::insertable_list_pointer & lp )|
\LABEL{MUP::HASH_SIZE_OF_LIST_POINTER_OF_INSERTABLE} \\[1ex]
\verb|unsigned MUP::|
	& \MUPKEY{vector\_size\_of}\ARGBREAK
	  \verb| ( min::insertable_list_pointer & lp )|
\LABEL{MUP::VECTOR_SIZE_OF_LIST_POINTER_OF_INSERTABLE} \\
\verb|min::gen MUP::|
	& \MUPKEY{start\_hash}\ARGBREAK
	  \verb| ( min::insertable_list_pointer & lp,|\ARGBREAK
	  \verb|   unsigned index )|
\LABEL{MUP::START_HASH_OF_INSERTABLE} \\
\verb|min::gen MUP::|
	& \MUPKEY{start\_vector}\ARGBREAK
	  \verb| ( min::insertable_list_pointer & lp,|\ARGBREAK
	  \verb|   unsigned index )|
\LABEL{MUP::START_VECTOR_OF_INSERTABLE} \\
\end{TABULAR}

\bigskip

\begin{TABULAR}{1.2in}
\verb|void min::|
	& \MINKEY{insert\_reserve\REL}\ARGBREAK
	  \verb| ( min::insertable_list_pointer & lp,|\ARGBREAK
	  \verb|   unsigned insertions, unsigned elements = 0,|\ARGBREAK
	  \verb|   bool use_object_aux_stubs =|\ARGBREAK
	  \verb|       min::use_object_aux_stubs )|
\LABEL{MIN::INSERT_RESERVE} \\
\verb|void min::|
	& \MINKEY{insert\_before}\ARGBREAK
	  \verb| ( min::insertable_list_pointer & lp,|\ARGBREAK
	  \verb|   min::gen * p, unsigned n )|
\LABEL{MIN::INSERT_BEFORE} \\
\verb|void min::|
	& \MINKEY{insert\_after}\ARGBREAK
	  \verb| ( min::insertable_list_pointer & lp,|\ARGBREAK
	  \verb|   min::gen * p, unsigned n )|
\LABEL{MIN::INSERT_AFTER} \\
\verb|unsigned min::|
	& \MINKEY{remove}\ARGBREAK
	  \verb| ( min::insertable_list_pointer & lp,|\ARGBREAK
	  \verb|   unsigned n = 1 )|
\LABEL{MIN::REMOVE_FROM_LIST} \\
\end{TABULAR}

\bigskip

\begin{TABULAR}{1.5in}
\verb|min::gen min::|
	& \MINKEY{start\_copy}\ARGBREAK
	  \verb| ( min::|$xx$\verb|list_pointer & lp,|\ARGBREAK
	  \verb|   const min::|$yy$\verb|list_pointer & lp2 )|
\LABEL{MIN::START_COPY_XX_YY} \\
\verb|min::gen min::|
	& \MINKEY{start\_sublist}\ARGBREAK
	  \verb| ( min::|$xx$\verb|list_pointer & lp,|\ARGBREAK
	  \verb|   const min::|$yy$\verb|list_pointer & lp2 )|
\LABEL{MIN::START_SUBLIST_XX_YY} \\
\verb|min::stub * min::|
	& \MINKEY{stub\_of}\verb| ( min::|$xx$\verb|list_pointer & lp )|
\LABEL{MIN::STUB_OF_LIST_POINTER_XX} \\[2ex]
\multicolumn{2}{c}{
where $xx$ and $yy$ may be `', `{\tt writable\_}', or `{\tt insertable\_}'}
\end{TABULAR}

\end{indpar}

\newpage

\INDEXHEADER{Object Attribute Level Declarations}

\begin{indpar}[0.2in]

\begin{TABULAR}{1.8in}
(constructor)~\verb|MUP::|
	& \MUPKEY{attribute\_pointer}\verb| ( min::stub * s )|
\LABEL{MUP::ATTRIBUTE_POINTER_OF_STUB} \\
(constructor)~\verb|MUP::|
	& \MUPKEY{attribute\_pointer}\verb| ( min::gen obj )|
\LABEL{MUP::ATTRIBUTE_POINTER_OF_GEN} \\
\verb|min::gen min::|
	& \MINKEY{locate}\ARGBREAK
	  \verb| ( min::attribute_pointer & ap,|\ARGBREAK
	  \verb|   min::gen name )|
\LABEL{MIN::LOCATE_ATTRIBUTE} \\
\verb|min::gen min::|
	& \MINKEY{locatei}\ARGBREAK
	  \verb| ( min::attribute_pointer & ap,|\ARGBREAK
	  \verb|   int name )|
\LABEL{MIN::LOCATEI_ATTRIBUTE} \\
\verb|min::gen min::|
	& \MINKEY{locate}\ARGBREAK
	  \verb| ( min::attribute_pointer & ap,|\ARGBREAK
	  \verb|   unsigned & length, min::gen name )|
\LABEL{MIN::LOCATE_PARTIAL} \\
\verb|min::gen min::|
	& \MINKEY{locate\_reverse}\ARGBREAK
	  \verb| ( min::attribute_pointer & ap,|\ARGBREAK
	  \verb|   min::gen reverse_name )|
\LABEL{MIN::LOCATE_REVERSE} \\
\verb|min::gen min::|
	& \MINKEY{relocate}%
	  \verb| ( min::attribute_pointer & ap )|
\LABEL{MIN::RELOCATE_ATTRIBUTE} \\
\end{TABULAR}

\bigskip

\begin{TABULAR}{1.8in}
(constructor)~\verb|MUP::|
	& \MUPKEY{writable\_attribute\_pointer}\ARGBREAK
	  \verb| ( min::stub * s )|
\LABEL{MUP::WRITABLE_ATTRIBUTE_POINTER_OF_STUB} \\
(constructor)~\verb|MUP::|
	& \MUPKEY{writable\_attribute\_pointer}\ARGBREAK
	  \verb| ( min::gen obj )|
\LABEL{MUP::WRITABLE_ATTRIBUTE_POINTER_OF_GEN} \\
\verb|min::gen min::|
	& \MINKEY{locate}\ARGBREAK
	  \verb| ( min::writable_attribute_pointer & wap,|\ARGBREAK
	  \verb|   min::gen name )|
\LABEL{MIN::LOCATE_ATTRIBUTE_WRITABLE} \\
\verb|min::gen min::|
	& \MINKEY{locatei}\ARGBREAK
	  \verb| ( min::writable_attribute_pointer & wap,|\ARGBREAK
	  \verb|   int name )|
\LABEL{MIN::LOCATEI_ATTRIBUTE_WRITABLE} \\
\verb|min::gen min::|
	& \MINKEY{locate}\ARGBREAK
	  \verb| ( min::writable_attribute_pointer & wap,|\ARGBREAK
	  \verb|   unsigned & length, min::gen name )|
\LABEL{MIN::LOCATE_PARTIAL_WRITABLE} \\
\verb|min::gen min::|
	& \MINKEY{locate\_reverse}\ARGBREAK
	  \verb| ( min::writable_attribute_pointer & wap,|\ARGBREAK
	  \verb|   min::gen reverse_name )|
\LABEL{MIN::LOCATE_REVERSE_WRITABLE} \\
\verb|min::gen min::|
	& \MINKEY{relocate}\ARGBREAK
	  \verb| ( min::writable_attribute_pointer & wap )|
\LABEL{MIN::RELOCATE_ATTRIBUTE_WRITABLE} \\
\end{TABULAR}

\bigskip

\begin{TABULAR}{1.2in}
\verb|unsigned min::| & \MINKEY{count}%
    \verb| ( min::attribute_pointer ap )|
\LABEL{MIN::COUNT_OF_ATTRIBUTE_POINTER} \\
\verb|unsigned min::| & \MINKEY{get}\ARGBREAK
    \verb| ( min::gen * out, unsigned n,|\ARGBREAK
    \verb|   min::attribute_pointer ap )|
\LABEL{MIN::GET_OF_ATTRIBUTE_POINTER} \\
\verb|unsigned min::| & \MINKEY{count\_flags}%
    \verb| ( min::attribute_pointer ap )|
\LABEL{MIN::COUNT_FLAGS_OF_ATTRIBUTE_POINTER} \\
\verb|unsigned min::| & \MINKEY{get\_flags}\ARGBREAK
    \verb| ( min::gen * out, unsigned n,|\ARGBREAK
    \verb|   min::attribute_pointer ap )|
\LABEL{MIN::GET_FLAGS_OF_ATTRIBUTE_POINTER} \\
\end{TABULAR}

\bigskip

\begin{TABULAR}{1.2in}
\verb|unsigned min::| & \MINKEY{count}%
    \verb| ( min::writable_attribute_pointer wap )|
\LABEL{MIN::COUNT_OF_WRITABLE_ATTRIBUTE_POINTER} \\
\verb|unsigned min::| & \MINKEY{get}\ARGBREAK
    \verb| ( min::gen * out, unsigned n,|\ARGBREAK
    \verb|   min::writable_attribute_pointer wap )|
\LABEL{MIN::GET_OF_WRITABLE_ATTRIBUTE_POINTER} \\
\verb|unsigned min::| & \MINKEY{count\_flags}\ARGBREAK
    \verb| ( min::writable_attribute_pointer wap )|
\LABEL{MIN::COUNT_FLAGS_OF_WRITABLE_ATTRIBUTE_POINTER} \\
\verb|unsigned min::| & \MINKEY{get\_flags}\ARGBREAK
    \verb| ( min::gen * out, unsigned n,|\ARGBREAK
    \verb|   min::writable_attribute_pointer wap )|
\LABEL{MIN::GET_FLAGS_OF_WRITABLE_ATTRIBUTE_POINTER} \\
\end{TABULAR}

\bigskip

\begin{TABULAR}{1.2in}
\verb|void min::| & \MINKEY{set\REL}\ARGBREAK
    \verb| ( min::writable_attribute_pointer wap,|\ARGBREAK
    \verb|   const min::gen * in, unsigned n )|
\LABEL{MIN::SET_OF_WRITABLE_ATTRIBUTE_POINTER} \\
\verb|void min::| & \MINKEY{set\_flags\REL}\ARGBREAK
    \verb| ( min::writable_attribute_pointer wap,|\ARGBREAK
    \verb|   const min::gen * in, unsigned n )|
\LABEL{MIN::SET_FLAGS_OF_WRITABLE_ATTRIBUTE_POINTER} \\
\end{TABULAR}

\bigskip

\begin{TABULAR}{1.2in}
\verb|min::gen min::| & \MINKEY{get}%
    \verb| ( min::attribute_pointer ap )|
\LABEL{MIN::GET1_OF_ATTRIBUTE_POINTER} \\
\verb|min::gen min::| & \MINKEY{get}%
    \verb| ( min::writable_attribute_pointer wap )|
\LABEL{MIN::GET1_OF_WRITABLE_ATTRIBUTE_POINTER} \\
\verb|void min::| & \MINKEY{set\REL}\ARGBREAK
    \verb| ( min::writable_attribute_pointer wap,|\ARGBREAK
    \verb|   const min::gen v )|
\LABEL{MIN::SET1_OF_WRITABLE_ATTRIBUTE_POINTER} \\
\end{TABULAR}

\bigskip

\begin{TABULAR}{1.2in}
\verb|void min::| & \MINKEY{add\_to\_set\REL}\ARGBREAK
    \verb| ( min::writable_attribute_pointer wap,|\ARGBREAK
    \verb|   const min::gen * in, unsigned n )|
\LABEL{MIN::ADD_TO_SET} \\
\verb|void min::| & \MINKEY{add\_to\_multiset\REL}\ARGBREAK
    \verb| ( min::writable_attribute_pointer wap,|\ARGBREAK
    \verb|   const min::gen * in, unsigned n )|
\LABEL{MIN::ADD_TO_MULTISET} \\
\end{TABULAR}

\bigskip

\begin{TABULAR}{1.2in}
\verb|void min::| & \MINKEY{set\_some\_flags\REL}\ARGBREAK
    \verb| ( min::writable_attribute_pointer wap,|\ARGBREAK
    \verb|   const min::gen * in, unsigned n )|
\LABEL{MIN::SET_SOME_FLAGS} \\
\verb|void min::| & \MINKEY{clear\_some\_flags\REL}\ARGBREAK
    \verb| ( min::writable_attribute_pointer wap,|\ARGBREAK
    \verb|   const min::gen * in, unsigned n )|
\LABEL{MIN::CLEAR_SOME_FLAGS} \\
\verb|void min::| & \MINKEY{flip\_some\_flags\REL}\ARGBREAK
    \verb| ( min::writable_attribute_pointer wap,|\ARGBREAK
    \verb|   const min::gen * in, unsigned n )|
\LABEL{MIN::FLIP_SOME_FLAGS} \\
\end{TABULAR}

\bigskip

\begin{TABULAR}{1.2in}
\verb|bool min::| & \MINKEY{test\_flag}\ARGBREAK
    \verb| ( min::attribute_pointer ap, unsigned n )|
\LABEL{MIN::TEST_FLAG} \\
\verb|bool min::| & \MINKEY{test\_flag}\ARGBREAK
    \verb| ( min::writable_attribute_pointer wap,|\ARGBREAK
    \verb|   unsigned n )|
\LABEL{MIN::TEST_FLAG_OF_WRITABLE} \\
\verb|void min::| & \MINKEY{set\_flag\REL}\ARGBREAK
    \verb| ( min::writable_attribute_pointer wap,|\ARGBREAK
    \verb|   unsigned n )|
\LABEL{MIN::SET_FLAG} \\
\verb|void min::| & \MINKEY{clear\_flag\REL}\ARGBREAK
    \verb| ( min::writable_attribute_pointer wap,|\ARGBREAK
    \verb|   unsigned n )|
\LABEL{MIN::CLEAR_FLAG} \\
\verb|void min::| & \MINKEY{flip\_flag\REL}\ARGBREAK
    \verb| ( min::writable_attribute_pointer wap,|\ARGBREAK
    \verb|   unsigned n )|
\LABEL{MIN::FLIP_FLAG} \\
\end{TABULAR}

\bigskip

\begin{TABULAR}{1.2in}
\verb|unsigned min::| & \MINKEY{get\_attributes}\ARGBREAK
    \verb| ( min::gen * out, unsigned n,|\ARGBREAK
    \verb|   min::attribute_pointer ap )|
\LABEL{MIN::GET_ATTRIBUTES} \\
\verb|void min::| & \MINKEY{rewind\_attributes}\ARGBREAK
    \verb| ( min::attribute_pointer ap )|
\LABEL{MIN::REWIND_ATTRIBUTES} \\
\verb|unsigned min::| & \MINKEY{get\_reverse\_attributes}\ARGBREAK
    \verb| ( min::gen * out, unsigned n,|\ARGBREAK
    \verb|   min::attribute_pointer ap )|
\LABEL{MIN::GET_REVERSE_ATTRIBUTES} \\
\verb|void min::| & \MINKEY{rewind\_reverse\_attributes}\ARGBREAK
    \verb| ( min::attribute_pointer ap )|
\LABEL{MIN::REWIND_REVERSE_ATTRIBUTES} \\
\end{TABULAR}

\end{indpar}

\newpage

\INDEXHEADER{Variable Vector Variable Level Declarations}

\begin{indpar}[0.2in]

\begin{TABULAR}{1.4in}
(constructor)~\verb|MUP::|
	& \MUPKEY{variable\_pointer}\verb| ( )|
\LABEL{MUP::VARIABLE_POINTER} \\
\verb|min::gen min::| & \MINKEY{point}\ARGBREAK
    \verb| ( min::variable_pointer & vp,|\ARGBREAK
    \verb|   min::gen vector, unsigned index )|
\LABEL{POINT_VARIABLE_POINTER} \\
\verb|void min::|
	& \TTKEY{clear}\verb| ( min::variable_pointer & vp )|
\LABEL{CLEAR_VARIABLE_POINTER} \\
\verb|void min::|
	& \MINKEY{relocate}\verb| ( min::variable_pointer & vp )|
\LABEL{MIN::RELOCATE_VARIABLE_POINTER} \\
\end{TABULAR}

\begin{TABULAR}{1.4in}
\verb|min::gen min::|
	& \TTKEY{get}\verb| ( min::variable_pointer & vp )|
\LABEL{GET_VARIABLE_POINTER} \\
\verb|void min::|
	& \TTKEY{set}\ARGBREAK
    \verb| ( min::variable_pointer & vp,|\ARGBREAK
    \verb|   min::gen value )|
\LABEL{SET_VARIABLE_POINTER} \\
\verb|min::gen min::| & \MINKEY{indirect\REL}\ARGBREAK
    \verb| ( min::variable_pointer & vp1,|\ARGBREAK
    \verb|   min::variable_pointer & vp2 )|
\LABEL{MIN::INDIRECT_VARIABLE_POINTER} \\
\verb|min::gen min::| & \MINKEY{moveg}\ARGBREAK
    \verb| ( min::variable_pointer & vp,|\ARGBREAK
    \verb|   min::gen name )|
\LABEL{MIN::MOVEG_VARIABLE_POINTER} \\
\end{TABULAR}

\begin{TABULAR}{1.4in}
\verb|min::gen min::| & \MINKEY{move}\ARGBREAK
    \verb| ( min::variable_pointer & vp,|\ARGBREAK
    \verb|   unsigned index )|
\LABEL{MOVE_VARIABLE_POINTER} \\
\verb|unsigned min::| & \MINKEY{countg}\ARGBREAK
    \verb| ( min::variable_pointer & vp,|\ARGBREAK
    \verb|   min::gen name, min::gen reverse_name )|
\LABEL{MIN::COUNTG_OF_VARIABLE_POINTER} \\
\end{TABULAR}

\begin{TABULAR}{1.4in}
\verb|unsigned min::| & \MINKEY{getg}\ARGBREAK
    \verb| ( min::gen * out, unsigned n,|\ARGBREAK
    \verb|   min::variable_pointer & vp,|\ARGBREAK
    \verb|   min::gen name, min::gen reverse_name )|
\LABEL{MIN::GETG_OF_VARIABLE_POINTER} \\
\verb|min::gen min::| & \MINKEY{getg}\ARGBREAK
    \verb| ( min::variable_pointer & vp,|\ARGBREAK
    \verb|   min::gen name, min::gen reverse_name )|
\LABEL{MIN::GETG1_OF_VARIABLE_POINTER} \\
\verb|bool min::|
	& \TTKEY{variable\_forward\_optimization}\verb| ( )|
\LABEL{VARIABLE_FORWARD_OPTIMIZATION} \\
\verb|bool min::|
	& \TTKEY{variable\_forward\_optimization}\verb| ( bool value )|
\LABEL{VARIABLE_FORWARD_OPTIMIZATION} \\
\end{TABULAR}

\end{indpar}


} % end of renewcommand for \LABEL, \{TT,MIN,MUP}KEY.

\section{Operating System Interface}
\label{OPERATING-SYSTEM-INTERFACE}

The interface between MIN implementation code and the operating system
consists of standard C++/C functions available on all operating
systems, such as \verb|iostreams|, plus \ttkey{min::os}
namespace interface functions that are
declared in \verb|min_os.h| and defined in \verb|src/min_os.cc|.
This code division is intended to make it easy to port MIN to different
operating systems by placing all the code that must be
changed in the small \verb|src/min_os.cc| file.
\verb|min::os| is commonly abbreviated to
`\ttnbmkey{MOS}{abbreviates {\tt min::os}}'\label{MOS}
by including the following definition in code that accesses
the interface:

\begin{center}
\verb|#define  MOS  min::os|
\end{center}

Details of the \verb|min::os| interface are in \verb|min_os.h|.  The
following is an overview.

\subsection{Configuration Parameters}
\label{CONFIGURATION-PARAMETERS}

In UNIX the \ttnbkey{MIN\_CONFIG} environment variable value consists
of whitespace separated entries of the form `{\em name}\verb|=|{\em value}'
that specify configuration parameters, most of which control the
Allocator/Collector/Compactor.

\subsection{Memory Pools}

A memory pool is a contiguous block of pages of \underline{virtual}
memory.  Memory pools may be allocated, and it is possible to
specify that a pool being allocated has its starting address in
a particular range (e.g., so stub addresses can be limited to
44 bits).  Segments of memory pools may be freed, may be made
into inaccessible virtual memory, and may be made reaccessible.
Segments of memory pools may be moved by copying page table entries,
which is faster than copying bytes.

\section{Allocator/Collector/Compactor}
\label{ALLOCATOR/COLLECTOR/COMPACTOR}\label{ACC}

The \key{Allocator/Collector/Compactor}, or \ttnbkey{acc}, 
is a replaceable component of the MIN code, which should not
normally be accessed directly.  It can be controlled by parameters
passed to the program (see Configuration Parameters,
\pagref{CONFIGURATION-PARAMETERS}), or by defaults for these
provided at compile time in \verb|min_acc_parameters.h|.
Documentation for these parameters is in this last file.
The acc code is in the 
\verb|min::acc| namespace which is abbreviated to
`\ttnbmkey{MACC}{abbreviates {\tt min::acc}}'\label{MACC}
by including the following definition in acc code:

\begin{center}
\verb|#define  MACC  min::acc|
\end{center}

Details of the acc code are in \verb|min_acc.h|.  The
following is an overview.

TBD

\bibliographystyle{plain}
\bibliography{min}

\printindex

\end{document}
