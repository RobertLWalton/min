% Minimal Descriptive Programming Language Design
%
% File:         min-design.tex
% Author:       Bob Walton (walton@deas.harvard.edu)
% Date:		See \date below.
  
\documentclass[12pt]{article}

\usepackage{makeidx}
\usepackage{pictex}

\makeindex

\setlength{\oddsidemargin}{0in}
\setlength{\evensidemargin}{0in}
\setlength{\textwidth}{6.5in}
\raggedbottom

\setlength{\unitlength}{1in}

\pagestyle{headings}
\setlength{\parindent}{0.0in}
\setlength{\parskip}{1ex}

\setcounter{secnumdepth}{5}
\setcounter{tocdepth}{5}
\newcommand{\subsubsubsection}[1]{\paragraph[#1]{#1.}}
\newcommand{\subsubsubsubsection}[1]{\subparagraph[#1]{#1.}}

% Begin \tableofcontents surgery.

\newcount\AtCatcode
\AtCatcode=\catcode`@
\catcode `@=11	% @ is now a letter

\renewcommand{\contentsname}{}
\renewcommand\l@section{\@dottedtocline{1}{0.1em}{1.4em}}
\renewcommand\l@table{\@dottedtocline{1}{0.1em}{1.4em}}
\renewcommand\tableofcontents{%
    \begin{list}{}%
	     {\setlength{\itemsep}{0in}%
	      \setlength{\topsep}{0in}%
	      \setlength{\parsep}{1ex}%
	      \setlength{\labelwidth}{0in}%
	      \setlength{\baselineskip}{1.5ex}%
	      \setlength{\leftmargin}{1.0in}%
	      \setlength{\rightmargin}{1.0in}}%
    \item\@starttoc{toc}%
    \end{list}}
\renewcommand\listoftables{%
    \begin{list}{}%
	     {\setlength{\itemsep}{0in}%
	      \setlength{\topsep}{0in}%
	      \setlength{\parsep}{1ex}%
	      \setlength{\labelwidth}{0in}%
	      \setlength{\baselineskip}{1.5ex}%
	      \setlength{\leftmargin}{1.0in}%
	      \setlength{\rightmargin}{1.0in}%
	      }%
    \item\@starttoc{lot}%
    \end{list}}

\catcode `@=\AtCatcode	% @ is now restored

% End \tableofcontents surgery.

\newcommand{\CN}[2]%	Change Notice.
    {\hspace*{0in}\marginpar{\sloppy \raggedright \it \footnotesize
     $^{\mbox{#1}}$#2}}
    % Change notice.

\newcommand{\key}[1]{{\bf \em #1}\index{#1}}
\newcommand{\mkey}[2]{{\bf \em #1}\index{#1!#2}}
\newcommand{\skey}[2]{{\bf \em #1#2}\index{#1}}
\newcommand{\ikey}[2]{{\bf \em #1}\index{#2}}
\newcommand{\ttkey}[1]{{\tt \bf #1}\index{#1@{\tt #1}}}
% < and > do not work for \tt \bf, hence:
\newcommand{\ttnbkey}[1]{{\tt #1}\index{#1@{\tt #1}}}
\newcommand{\ttmkey}[2]{{\tt \bf #1}\index{#1@{\tt #1}!#2}}
\newcommand{\ttfkey}[2]{{\tt \bf #1}\index{#1@{\tt #1}!for #2@for {\tt #2}}}
\newcommand{\ttakey}[2]{{\tt \bf #1}\index{#2@{\tt #1}}}
\newcommand{\ttamkey}[3]{{\tt \bf #1}\index{#2@{\tt #1}!#3}}
\newcommand{\ttindex}[1]{\index{#1@{\tt #1}}}
\newcommand{\ttmindex}[2]{\index{#1@{\tt #1}!#2}}
\newcommand{\emkey}[1]{{\bf \em #1}\index{#1@{\em #1}}}
\newcommand{\emindex}[1]{\index{#1@{\em #1}}}

\newcommand{\minkey}[1]%
           {{\tt \bf min::#1}\ttindex{min::#1}\ttindex{#1}}
\newcommand{\minmkey}[2]%
           {{\tt \bf min::#1}\ttmindex{min::#1}{#2}\ttmindex{#1}{#2}}
\newcommand{\MUPkey}[1]{{\tt \bf MUP::#1}\ttindex{MUP::#1}\ttindex{#1}}
\newcommand{\MUPmkey}[2]%
           {{\tt \bf MUP::#1}\ttmindex{MUP::#1}{#2}\ttmindex{#1}{#2}}
\newcommand{\minindex}[1]{\ttindex{min::#1}\ttindex{#1}}
\newcommand{\MUPindex}[1]{\ttindex{MUP::#1}\ttindex{#1}}


\newcommand{\secref}[1]{\ref{#1}$^{p\pageref{#1}}$}
\newcommand{\stepref}[1]{\ref{#1}$^{p\pageref{#1}}$}
\newcommand{\appref}[1]{\ref{#1}$^{p\pageref{#1}}$}
\newcommand{\pagref}[1]{p\pageref{#1}}

\newcommand{\EOL}{\penalty \exhyphenpenalty}

\newcount\TildeCatcode
\TildeCatcode=\catcode`\~
\catcode`~=12
\newcommand{\Tilde}{~}
\catcode`~=\TildeCatcode

\newcount\CircumflexCatcode
\CircumflexCatcode=\catcode`\^
\catcode`^=12
\newcommand{\Circumflex}{^}
\catcode`^=\CircumflexCatcode

\newcount\CurlyBraCatcode
\newcount\CurlyKetCatcode
\newcount\SquareBraCatcode
\newcount\SquareKetCatcode
\CurlyBraCatcode=\catcode`{
\CurlyKetCatcode=\catcode`}
\SquareBraCatcode=\catcode`[
\SquareKetCatcode=\catcode`]

\catcode`{=\SquareBraCatcode
\catcode`}=\SquareKetCatcode
\catcode`[=\CurlyBraCatcode
\catcode`]=\CurlyKetCatcode

\newcommand[\CurlyBra][{]
\newcommand[\CurlyKet][}]

\catcode`{=\CurlyBraCatcode
\catcode`}=\CurlyKetCatcode
\catcode`[=\SquareBraCatcode
\catcode`]=\SquareKetCatcode

\newcommand{\ttbrackets}{%
    \renewcommand{\{}{\CurlyBra}%
    \renewcommand{\}}{\CurlyKet}}

\newsavebox{\TILDEBOX}
\begin{lrbox}{\TILDEBOX}
\verb|~|
\end{lrbox}
\newcommand{\TILDE}{\usebox{\TILDEBOX}}

\newsavebox{\BACKSLASHBOX}
\begin{lrbox}{\BACKSLASHBOX}
\verb|\|
\end{lrbox}
\newcommand{\BACKSLASH}{\usebox{\BACKSLASHBOX}}

\newsavebox{\LEFTBRACKETBOX}
\begin{lrbox}{\LEFTBRACKETBOX}
\verb|{|
\end{lrbox}
\newcommand{\LEFTBRACKET}{\usebox{\LEFTBRACKETBOX}}

\newsavebox{\RIGHTBRACKETBOX}
\begin{lrbox}{\RIGHTBRACKETBOX}
\verb|}|
\end{lrbox}
\newcommand{\RIGHTBRACKET}{\usebox{\RIGHTBRACKETBOX}}

\newsavebox{\UNDERLINEBOX}
\begin{lrbox}{\UNDERLINEBOX}
\verb|_|
\end{lrbox}
\newcommand{\UNDERLINE}{\usebox{\UNDERLINEBOX}}

\newsavebox{\CIRCUMFLEXBOX}
\begin{lrbox}{\CIRCUMFLEXBOX}
\verb|^|
\end{lrbox}
\newcommand{\CIRCUMFLEX}{\usebox{\CIRCUMFLEXBOX}}

\newsavebox{\BARBOX}
\begin{lrbox}{\BARBOX}
\verb/|/
\end{lrbox}
\newcommand{\BAR}{\usebox{\BARBOX}}

\newsavebox{\LESSTHANBOX}
\begin{lrbox}{\LESSTHANBOX}
\verb/</
\end{lrbox}
\newcommand{\LESSTHAN}{\usebox{\LESSTHANBOX}}

\newsavebox{\GREATERTHANBOX}
\begin{lrbox}{\GREATERTHANBOX}
\verb/>/
\end{lrbox}
\newcommand{\GREATERTHAN}{\usebox{\GREATERTHANBOX}}

\newlength{\figurewidth}
\setlength{\figurewidth}{\textwidth}
\addtolength{\figurewidth}{-0.40in}

\newsavebox{\figurebox}

\newenvironment{boxedfigure}[1][!btp]%
	{\begin{figure*}[#1]
	 \begin{lrbox}{\figurebox}
	 \begin{minipage}{\figurewidth}

	 \vspace*{1ex}}%
	{
	 \vspace*{1ex}

	 \end{minipage}
	 \end{lrbox}
	 \begin{center}
	 \fbox{\hspace*{0.1in}\usebox{\figurebox}\hspace*{0.1in}}
	 \end{center}
	 \end{figure*}}

\newenvironment{indpar}[1][0.3in]%
	{\begin{list}{}%
		     {\setlength{\itemsep}{0in}%
		      \setlength{\topsep}{0in}%
		      \setlength{\parsep}{1ex}%
		      \setlength{\labelwidth}{#1}%
		      \setlength{\leftmargin}{#1}%
		      \addtolength{\leftmargin}{\labelsep}}%
	 \item}%
	{\end{list}}

\newcommand{\LABEL}[1]{\label{#1}}
\newcommand{\TTKEY}[1]{\ttkey{#1}}
\newcommand{\MINKEY}[1]{{\tt \bf #1}\minindex{#1}}
\newcommand{\MUPKEY}[1]{{\tt \bf #1}\MUPindex{#1}}

\newcommand{\REL}{$\,^R$}
\newcommand{\COMPACT}{$\,^C$}
\newcommand{\LOOSE}{$\,^L$}

\begin{document}
        
\title{Internal Design\\[2ex]of the\\[2ex]
       Minimal\\Descriptive Programming\\Language\\[2ex]MIN\\[2ex]
       (Draft 1a)}

\author{Robert L. Walton}

\date{November 5, 2005}
 
\maketitle

\newpage
\begin{center}
\large \bf Table of Contents
\end{center}

\bigskip

\tableofcontents 

\newpage

\section{Introduction}

This document describes the internal design of MIN,
the Minimal Descriptive Programming Language.
This document is written for readers who wish to add C++ code
to a MIN implementation, or who wish to maintain an implementation.

A small number of \skey{abbreviation}s are used throughout this document
and the corresponding code:

\begin{center}
\begin{tabular}{ll}
\ttmkey{aux}{abbreviation}	& auxiliary (\secref{AUXILIARY}) \\
\ttmkey{gen}{abbreviation}	& general value (\secref{GENERAL-VALUES}) \\
\ttmkey{int}{abbreviation}	& signed integer (\pagref{INT}) \\
\ttmkey{lab}{abbreviation}	& label (\pagref{LABELS}) \\
\ttmkey{min}{abbreviation}	& the MIN system \\
\ttmkey{MUP}{abbreviation}	& {\tt min::unprotected} (\pagref{MUP}) \\
\ttmkey{num}{abbreviation}	& number (\pagref{NUMBERS}) \\
\ttmkey{obj}{abbreviation}	& object (\pagref{OBJECTS}) \\
\ttmkey{str}{abbreviation}	& string (\pagref{STRINGS}) \\
\ttmkey{uns}{abbreviation}	& unsigned integer (\pagref{UNS}) \\
\end{tabular}
\end{center}

The C++ data and functions described in this document can be
accessed by C++ code that contains the following inclusion:

\begin{center}
\verb|#include  <min.h>|
\end{center}


\section{Data}

We first describe MIN data memory.

We give two interfaces to MIN data memory:
the \key{protected interface}, which can be used
by C++ code to access MIN data memory while maintaining the integrity
of that memory, and the \key{unprotected interface}, which provides
more efficient access to MIN data memory but requires the user to
follow certain protocols to be sure the memory is not damaged.

From the syntactic point of view the
only distinction between these interfaces is that all unprotected
interface names begin with `\minkey{unprotected::}'.  Code
that uses the unprotected interface typically abbreviates this long
prefix to `\ttmkey{MUP::}{abbreviates {\tt min::unprotected::}}'\label{MUP}
by including the following definition:

\begin{center}
\verb|#define  MUP  min::unprotected|
\end{center}

In this document we will use the abbreviation `\verb|MUP|' for
`\verb|min::unprotected|'.

Some {\tt MUP} functions `produce \key{undefined results}' when their arguments
are out of legal range.
This means that when the arguments are out of range,
function execution may lose control and crash, or may produce result
values that are wrong or out of legal range.
When documentation of a {\tt MUP} function
states that particular argument range checks are not performed,
then the {\tt MUP} function always produces undefined results when its
arguments would not pass these checks,
unless the documentation explicitly says otherwise.

The data of MIN is defined using C-compatible \ttmkey{struct}{C compatible}'s
and \ttmkey{union}{C compatible}'s.  C++ implicitly guarantees the layout of
C-compatible \verb|struct|'s and \verb|union|'s to be C-compatible,
and C has implicit guarantees because of historical C code that
such data will not contain unnecessary unnamed padding.  Neither the
C or C++ standards guarantee the absence of unnecessary unnamed padding, but
MIN depends upon its absence, as does any code that reads and writes
binary files.

As a consequence of using only C-compatible \verb|struct|'s and
\verb|union|'s to define data, MIN does not use member functions.
Protected functions are in the \ttmkey{min}{namespace} namespace
and have names beginning with
`\ttmkey{min::}{in function name}', while
unprotected MIN functions are in the \ttmkey{MUP}{namespace} namespace
and have names beginning with `\ttmkey{MUP::}{in function name}'.

In defining MIN data the following number types are used to be sure
the size of each number is clear:

\begin{center}
\begin{tabular}{l@{~~~~~}l}
\minkey{uns8}	& unsigned 8-bit integer \\
\minkey{int8}	& signed 8-bit integer \\
\minkey{uns16}	& unsigned 16-bit integer \\
\minkey{int16}	& signed 16-bit integer \\
\minkey{uns32}	& unsigned 32-bit integer \\
\minkey{int32}	& signed 32-bit integer \\
\minkey{float32}	& 32-bit IEEE floating point number \\
\minkey{uns64}	& unsigned 64-bit integer \\
\minkey{int64}	& signed 64-bit integer \\
\minkey{float64}	& 64-bit IEEE floating point number \\
\end{tabular}
\end{center}%
\label{MIN::UNS8}%
\label{MIN::INT8}%
\label{MIN::UNS16}%
\label{MIN::INT16}%
\label{MIN::UNS32}%
\label{MIN::INT32}%
\label{MIN::FLOAT32}%
\label{MIN::UNS64}%
\label{MIN::INT64}%
\label{MIN::FLOAT64}%
\label{INT}%
\label{UNS}

Currently planned implementations of MIN assume a compiler that has
direct support for 64 bit integers.  However, use of 64 bit integer
types in these implementations is minimized to make it possible to
modify the implementations to use compilers without such support.

\subsection{Stubs and Bodies}

MIN data memory consists of regions that contain stubs and regions
that contain bodies.  A region is a contiguous block
of memory, typically consisting of an integral number of hardware
pages.

\ikey{Stubs}{stub}
are small fixed size units of memory that cannot be relocated:
the usual stub size for MIN is 16 bytes.
Each object has a stub, and the address of the stub is in effect
the internal name of the object.  Some or all atoms, depending
on implementation, have stubs.

A stub is divided into an 8 byte \key{stub value}
and an 8 byte \key{stub control}.
The stub value can be a 64-bit IEEE floating point number,
an 8 {\tt char} string, or, as we will soon see, a pointer to a body.
It is also possible for a stub value to hold any other 8 bytes of information.

The stub control holds a 1 byte \key{type code} and other information used,
for example, by the garbage collector.

The type name of a stub is `\minkey{stub}', and a pointer to a stub
has type `\verb|min::stub *|'.\LABEL{MIN::STUB}\footnote{We do
not use `{\tt const min::stub *}' types because such cannot be converted
to general values, since the latter have no way of distinguishing
{\tt const} and non-{\tt const} stubs.}

A \key{body} is a variable sized relocatable block of memory
attached to a particular stub.  A stub may have a single body attached to
it, in which case the stub value is a pointer to that body.
When certain functions are called,
any body can be moved and its corresponding stub value reset to
point at the new location of the body.
Functions with this property are called
`\key{relocating functions}'\label{RELOCATING-FUNCTIONS}
and are marked by {\REL} in documentation.  Included
are functions that allocate objects.
Obtaining a pointer into a body is an unprotected operation, because
the pointer must be maintained if a relocating function is called.

\ikey{Interrupts}{interrupt!and relocation} can relocate bodies.
Therefore interrupts are only allowed
at specific points in the code.  The inline function

\begin{center}\begin{tabular}{r@{}l}
\verb|bool min::| & \MINKEY{interrupt\REL}\verb| ( void )|
\LABEL{MIN::INTERRUPT} \\
\end{tabular}\end{center}%
\index{interrupt!relocating}

checks an interrupt
flag, and if that is set, calls an out-of-line function to process
the interrupt.  The function returns {\tt true} if and only if
there was actually an interrupt (this should be used only
for optimization).

A body may be \mkey{deallocated}{by moving}
by moving it to unimplemented memory.  When this is done the
stub \mkey{type code}{reset on deallocation}
is reset to the value \minkey{DEALLOCATED}\LABEL{MIN::DEALLOCATED},
which indicates the body is deallocated.
The function that deallocates a body is:

\begin{center}\begin{tabular}{r@{}l}
\verb|void min::| & \MINKEY{deallocate\REL}\verb| ( min::stub * s )|
\LABEL{DEALLOCATE} \\
\end{tabular}\end{center}%
\index{deallocate!relocating}

Deallocation is considered to be a variant of relocation.
Relocating functions, those marked marked by {\REL} in documentation,
may also deallocate objects.

The {\tt min::is\_deallocated} function described on
\pagref{MIN::IS_DEALLOCATED}
can be used to test whether the body of a stub has been deallocated.

Bodies are always some multiple
of 8 bytes long, and are allocated on 8 byte boundaries.

\ikey{Protected functions}{protected function!using {\tt assert}}
that take a stub pointer as argument use
\ttmkey{assert}{in protected function} statements to check
the \mkey{type code}{checked by {\tt assert}}
of the stub and various lengths.  Unprotected functions
contain no such checks.

Memory consisting of unrelocatable stubs pointing at relocatable
bodies is called a `\key{stub/\EOL body memory}'.
Thus MIN has a stub/body memory.
The main advantages of stub/body memory are that relocation of bodies
can happen independently of other program activity, and bodies can be
deallocated by program command at any time.\footnote{
Stub/body memories are certainly not new.  For example, Kyoto COMMONLISP
used a stub/body implementation of arrays, and the author has heard about
implementations that go back to the late 1950's or early 60's: see
p33 of the author's thesis, R-CODE, A Very Capable Virtual Computer.}


\subsection{General Values}
\label{GENERAL-VALUES}

A general value can store any of:

\begin{center}
\begin{tabular}{l}
a direct atom value \\
a pointer to a stub \\
an auxiliary pointer \\
an index \\
a control code
\end{tabular}
\end{center}

General values are used as attribute names and values in
objects and as function arguments and return values.

General values that represent numbers or character strings
are called \skey{atom}s, because they have no subcomponents.
There are two kinds of atoms: \skey{direct atom}s that
are stored completely in a general value, and
\skey{indirect atom}s that are stored in a stub or in
a body pointed at by a stub, with the stub being pointed
at by a general value.

Efficiency aside, it does not matter
whether a general value stores a direct atom value or a pointer
to a stub holding an indirect atom value,
as atom values are immutable and cannot be changed.  Of course not all
atom values will fit into a general value, and those that do not must
be stored in stubs or in bodies pointed at by stubs.

An \key{auxiliary pointer} is an integer that is used by a general value
stored inside an object body to point at some part, called an
\key{auxiliary},\label{AUXILIARY} of the same body.
There are several subtypes of auxiliary pointers storable in object bodies.
See~\pagref{OBJECT-BODY-AUXILIARY-POINTER}.

An \key{index} is an integer that is used to give the index of a variable
that is an element of a variable vector.
See~\pagref{VARIABLE-VECTORS}.

A \key{control code} is an integer that represents flags and codes
stored in a general value.  Control codes can have different
interpretations in different contexts.

There are two kinds of MIN implementation: `\key{compact}' and
`\key{loose}'.\label{COMPACT}\label{LOOSE}
A compact implementation uses 32-bit general values, while
a loose implementation uses 64-bit general values.
An implementation cannot use both 32-bit and 64-bit general values;
the implementation must use one or the other.

Some functions and constants are defined only for compact implementations,
and some only for loose implementations.  Those defined only for
compact implementations are marked with the
with the superscript {\COMPACT}\index{C@{\COMPACT}}
in this document.
Those defined only for
loose implementations are similarly marked with the
with the superscript {\LOOSE}\index{L@{\LOOSE}}.

The value of a compact implementation is that it uses less memory,
but there may be a speed penalty.
The value of a loose implementation is that it may run faster, but
there is a memory penalty.  It is not clear what the speed difference
between the two implementations really is, so both implementations
are offered in order to decide the issue by experiment.

Also compact implementations do not permit more than
about $2^{32}$ objects to exist in memory at one time, whereas
loose implementations permit up to about $2^{44}$ objects.

\subsubsection{General Value Subtypes}
\label{GENERAL-VALUE-SUBTYPES}

A \key{general value} has type \minkey{gen}\LABEL{MIN::GEN} and
is a 32 or 64 bit aligned value that can be of one of the following
subtypes

\begin{center}
\begin{tabular}{l}
a pointer to a stub \\
a 64-bit IEEE floating point direct number atom\LOOSE \\
a 28-bit direct integer atom\COMPACT \\
a 0-5 {\tt char} direct string atom\LOOSE \\
a 0-3 {\tt char} direct string atom\COMPACT \\
a 24-bit list auxiliary pointer \\
a 24-bit sublist auxiliary auxiliary pointer \\
a 24-bit indirect pair auxiliary pointer \\
a 24-bit indirect indexed auxiliary pointer \\
a 24-bit index \\
a 24-bit control code \\
a 40-bit control code\LOOSE
\end{tabular}
\end{center}

Here {\COMPACT} subtypes are only implemented by compact
implementations, and {\LOOSE} subtypes are only implemented by
loose implementations (\pagref{COMPACT}).

Numbers and character strings stored inside a \verb|min::gen| value are
called `\skey{direct atom}s'.  Numbers and character strings
stored in stubs or stub bodies which are pointed at by a
\verb|min::gen| value are called `\skey{indirect atom}s'.  An atom is
always stored in only one way by an implementation.  If a number will fit
into a direct atom, it is stored as a direct atom, and never as an
indirect atom.  Similarly if a character string will fit into a direct atom,
it is stored as a direct atom, and never as an indirect atom.

Analogously indirect atoms are stored in only one place in memory, so
two indirect numbers are equal if and only the \verb|min::gen| values
pointing at them point at the same place, and similarly
two indirect character strings are equal if and only
the \verb|min::gen| values pointing at them point at the same place.

Therefore two atoms are equal if and only if the \verb|min::gen| values
designating them are \verb|==| as 32-bit or 64-bit values.

General values that point at stubs can hold stub addresses, or they can hold 
`\skey{virtual stub number}s', \skey{VSN}{'s}, that map to stub addresses.
An implementation cannot use both stub addresses and VSN's in general values;
the implementation must use one or the other.

A VSN is typically mapped to a stub address by shifting it left by 4
bits\footnote{
Stubs are always a power of two in length, e.g. 16 bytes, so VSN's can be
translated to addresses by shifting left.} and possibly adding a base constant.
One effect of using VSN's
instead of addresses is to multiply by 16 the number of
stubs that may exist in memory without needing to use more than 32 bits
to hold the stub address, and the other effect is to increase program
execution time somewhat.

On machines that have 32 bit addresses (e.g.,
the IA32\footnote{Intel Architecture 32-bit, a.k.a, i386 machines.}
machines), stub addresses are normally used, as there is little to gain
by using VSN's.
The affect of using stub
addresses or VSN's on the approximate maximum number of stubs is as follows:

\begin{center}
{\bf Maximum Possible Number of Stubs} \\[1ex]
\begin{tabular}{lrr}
			&	Addresses	& VSN's \\[1ex]
32-bit general values	&	$2^{28}$	& $2^{32}$ \\[1ex]
64-bit general values	&	$2^{40}$	& $2^{44}$ \\[1ex]
\end{tabular}
\end{center}

A 32-bit general value direct integer consists of a high order 4-bit
subtype code and a low order 28-bit signed integer stored in offset form,
so the true integer can be derived from the {\tt min::gen} value by
subtracting the {\tt min::gen} representation of zero.
The range of such a direct integer is the same as the range of a 28-bit
two's complement integer: $-2^{27}$ to $2^{27}-1$, inclusive.

Similarly 32-bit general value auxiliary pointers consist of a high order
8-bit subtype code
and a low order 24-bit auxiliary pointer
(see~\pagref{OBJECT-BODY-AUXILIARY-POINTER}
and~\pagref{VARIABLE-VECTOR-AUXILIARY-POINTER}
for a definition of auxiliary pointers).
32-bit general value control codes consist of a high order
8-bit subtype code and a low order 24-bit unsigned integer that
contains flags and codes and has different interpretations in different
contexts.
And a 32-bit general value direct string consists of
an 8-bit subtype code and 24 bits that hold 0 to 3 8-bit {\tt char}'s.

For 64-bit general values that point at stubs, the high order 20 bits
are used as a subtype code.  For other 64-bit general values, the high
order 24 bits are the subtype code.
The values chosen for these subtype codes make stub pointers, direct strings,
auxiliary pointers, indices, and control codes -- that is, all non-number
{\tt min::gen} values --
into IEEE Nan (Not-a-Number)
values that are never generated by hardware instructions.

The {\tt min::gen} type has the alignment
properties of either {\tt min::uns32} or {\tt min::uns64},
and in many implementations is {\tt typedef}'ed to the appropriate one
of these two types.  Therefore a function that has only
{\tt min::gen} and non-{\tt min} (e.g. number and {\tt char *}) arguments
cannot be \ikey{overloaded}{overloading!rationale}\label{OVERLOADING-RATIONALE},
and must have a name beginning with `{\tt min::}'.

\subsubsection{General Value Compilation}
\label{GENERAL-VALUE-COMPILATION}

The decisions on whether an implementation is compact or loose and
whether the implementation uses addresses or VSN's in general values
that point at stubs must be made before C++ code is compiled.

The following macros are defined to describe these decisions:

\begin{center}
\begin{tabular}{ll}
\TTKEY{MIN\_IS\_COMPACT}	& 1 if compact implementation; 0 if loose
\LABEL{MIN_IS_COMPACT} \\
\TTKEY{MIN\_IS\_LOOSE}		& 1 if loose implementation; 0 if compact
\LABEL{MIN_IS_LOOSE}	 \\
\TTKEY{MIN\_SIZEOF\_GEN}	& 64 if loose implementation; 32 if compact
\LABEL{MIN_SIZEOF_GEN} \\
\TTKEY{MIN\_USES\_ADDRESSES}	& 1 if implementation uses addresses;
				  0 if it uses VSN's
\LABEL{MIN_USES_ADDRESSES} \\
\TTKEY{MIN\_USES\_VSNS}		& 1 if implementation uses VSN's;
				  0 if it uses addresses
\LABEL{MIN_USES_VSNS}	 \\
\end{tabular}
\end{center}

In addition the following macro can be set differently for any particular
piece of C++ code before it is compiled:

\begin{center}
\begin{tabular}{ll}
\TTKEY{MIN\_DEBUG}	& 1 if extra debugging checks are to be compiled;
			  0 if not
\LABEL{MIN_DEBUG} \\
\end{tabular}
\end{center}

\subsubsection{General Value Functions}
\label{GENERAL-VALUE-FUNCTIONS}

The following functions return {\tt 1} if a {\tt min::gen} datum is of the
indicated subtype and {\tt 0} otherwise:

\begin{center}\begin{tabular}{r@{}l}
\verb|bool min::| & \MINKEY{is\_stub}\verb| ( min::gen v )|
\LABEL{MIN::IS_STUB} \\
\verb|bool min::| & \MINKEY{is\_direct\_float\LOOSE}\verb| ( min::gen v )|
\LABEL{MIN::IS_DIRECT_FLOAT} \\
\verb|bool min::| & \MINKEY{is\_direct\_int\COMPACT}\verb| ( min::gen v )|
\LABEL{MIN::IS_DIRECT_INT} \\
\verb|bool min::| & \MINKEY{is\_direct\_str}\verb| ( min::gen v )|
\LABEL{MIN::IS_DIRECT_STR} \\
\verb|bool min::| & \MINKEY{is\_list\_aux}\verb| ( min::gen v )|
\LABEL{MIN::IS_LIST_AUX} \\
\verb|bool min::| & \MINKEY{is\_sublist\_aux}\verb| ( min::gen v )|
\LABEL{MIN::IS_SUBLIST_AUX} \\
\verb|bool min::| & \MINKEY{is\_indirect\_pair\_aux}\verb| ( min::gen v )|
\LABEL{MIN::IS_INDIRECT_PAIR_AUX} \\
\verb|bool min::| & \MINKEY{is\_indirect\_indexed\_aux}\verb| ( min::gen v )|
\LABEL{MIN::IS_INDIRECT_INDEXED_AUX} \\
\verb|bool min::| & \MINKEY{is\_index}\verb| ( min::gen v )|
\LABEL{MIN::IS_INDEX} \\
\verb|bool min::| & \MINKEY{is\_control\_code}\verb| ( min::gen v )|
\LABEL{MIN::IS_CONTROL_CODE} \\
\end{tabular}\end{center}

For a 32-bit general value {\tt is\_direct\_float\LOOSE} is unimplemented.
For a 64-bit general value {\tt is\_direct\_int\COMPACT} is unimplemented.

The following protected functions return the value appropriate for a given
subtype, after checking the subtype with an {\tt assert} statement:

\begin{center}\begin{tabular}{r@{}l}
\verb|min::stub * min::| & \MINKEY{stub\_of}\verb| ( min::gen v )|
\LABEL{MIN::STUB_OF} \\
\verb|min::float64 min::| &
    \MINKEY{direct\_float\_of\LOOSE}\verb| ( min::gen v )|
\LABEL{MIN::DIRECT_FLOAT_OF} \\
\verb|min::int32 min::| & \MINKEY{direct\_int\_of\COMPACT}\verb| ( min::gen v )|
\LABEL{MIN::DIRECT_INT_OF} \\
\verb|min::uns64 min::| & \MINKEY{direct\_str\_of}\verb| ( min::gen v )|
\LABEL{MIN::DIRECT_STR_OF} \\
\verb|unsigned min::| & \MINKEY{list\_aux\_of}\verb| ( min::gen v )|
\LABEL{MIN::LIST_AUX_OF} \\
\verb|unsigned min::| & \MINKEY{sublist\_aux\_of}\verb| ( min::gen v )|
\LABEL{MIN::SUBLIST_AUX_OF} \\
\verb|unsigned min::| &
    \MINKEY{indirect\_pair\_aux\_of}\verb| ( min::gen v )|
\LABEL{MIN::INDIRECT_PAIR_AUX_OF} \\
\verb|unsigned min::| &
    \MINKEY{indirect\_indexed\_aux\_of}\verb| ( min::gen v )|
\LABEL{MIN::INDIRECT_INDEXED_AUX_OF} \\
\verb|unsigned min::| & \MINKEY{index\_of}\verb| ( min::gen v )|
\LABEL{MIN::INDEX_OF} \\
\verb|unsigned min::| & \MINKEY{control\_code\_of}\verb| ( min::gen v )|
\LABEL{MIN::CONTROL_CODE_OF} \\
\verb|min::uns64 min::| &
	\MINKEY{long\_control\_code\_of\LOOSE}\verb| ( min::gen v )|
\LABEL{MIN::LONG_CONTROL_CODE_OF} \\
\end{tabular}\end{center}

Here the \verb|min::uns64| value returned by \minkey{direct\_str\_of}
should be overlaid by a union with a \verb|char[]| buffer, as in
the code:

\begin{indpar}\begin{verbatim}
union { min::uns64 str; char buf[6]; } u;
min::gen v;
. . . set v to a direct string value . . .
u.str = min::direct_str_of ( v );
cout << u.buf;
\end{verbatim}\end{indpar}

The {\tt min::direct\_str\_of} function merely copies the 3 or
5 {\tt char}'s of the {\tt min::gen} direct string value and
appends a NUL character.
It does this by writing an appropriate value into \verb|u.str|.

The \verb|min::|\ldots\verb|_aux_of| and \verb|min::index_of| functions
return a 24-bit unsigned integer for both 32-bit and 64-bit general values.
The extra bits available in 64-bit values are never needed or used.

The \verb|min::control_code_of| function only returns
a 24-bit unsigned integer for both 32-bit and 64-bit general values.
For 64-bit general values it returns only the low order 24 bits of the
code.
The \verb|min::long_control_code_of| function is only defined for 64-bit
general values, and returns a 40-bit unsigned integer.

The following unprotected functions return the value appropriate for a given
subtype, \underline{without} checking the subtype:

\begin{center}\begin{tabular}{r@{}l}
\verb|min::float64 MUP::| & \MUPKEY{direct\_float\_of}\verb| ( min::gen v )|
\LABEL{MUP::DIRECT_FLOAT_OF} \\
\verb|min::int32 MUP::| & \MUPKEY{direct\_int\_of}\verb| ( min::gen v )|
\LABEL{MUP::DIRECT_INT_OF} \\
\verb|min::uns64 MUP::| & \MUPKEY{direct\_str\_of}\verb| ( min::gen v )|
\LABEL{MUP::DIRECT_STR_OF} \\
\verb|min::stub * MUP::| & \MUPKEY{stub\_of}\verb| ( min::gen v )|
\LABEL{MUP::STUB_OF} \\
\verb|unsigned MUP::| & \MUPKEY{list\_aux\_of}\verb| ( min::gen v )|
\LABEL{MUP::LIST_AUX_OF} \\
\verb|unsigned MUP::| & \MUPKEY{sublist\_aux\_of}\verb| ( min::gen v )|
\LABEL{MUP::SUBLIST_AUX_OF} \\
\verb|unsigned MUP::| &
    \MUPKEY{indirect\_pair\_aux\_of}\verb| ( min::gen v )|
\LABEL{MUP::INDIRECT_PAIR_AUX_OF} \\
\verb|unsigned MUP::| &
    \MUPKEY{indirect\_indexed\_aux\_of}\verb| ( min::gen v )|
\LABEL{MUP::INDIRECT_INDEXED_AUX_OF} \\
\verb|unsigned MUP::| & \MUPKEY{index\_of}\verb| ( min::gen v )|
\LABEL{MUP::INDEX_OF} \\
\verb|unsigned MUP::| & \MUPKEY{control\_code\_of}\verb| ( min::gen v )|
\LABEL{MUP::CONTROL_CODE_OF} \\
\verb|min::uns64 MUP::| &
	\MUPKEY{long\_control\_code\_of\LOOSE}\verb| ( min::gen v )|
\LABEL{MUP::LONG_CONTROL_CODE_OF} \\
\end{tabular}\end{center}

New {\tt min::gen} values can be generated by the following protected
functions:

\begin{center}\begin{tabular}{r@{}l}
\verb|min::gen min::| & \MINKEY{new\_direct\_int\_gen}\verb| ( int v )|
\LABEL{MIN::NEW_DIRECT_INT_GEN} \\
\verb|min::gen min::| &
    \MINKEY{new\_direct\_float\_gen}\verb| ( min::float64 v )|
\LABEL{MIN::NEW_DIRECT_FLOAT_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_direct\_str\_gen}\verb| ( const char * p )|
\LABEL{MIN::NEW_DIRECT_STR_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_gen}\verb| ( min::stub * s )|
\LABEL{MIN::NEW_GEN_OF_STUB} \\
\verb|min::gen min::| & \MINKEY{new\_list\_aux\_gen}\verb| ( unsigned p )|
\LABEL{MIN::NEW_LIST_AUX_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_sublist\_aux\_gen}\verb| ( unsigned p )|
\LABEL{MIN::NEW_SUBLIST_AUX_GEN} \\
\verb|min::gen min::|
    & \MINKEY{new\_indirect\_pair\_aux\_gen}\verb| ( unsigned p )|
\LABEL{MIN::NEW_INDIRECT_PAIR_AUX_GEN} \\
\verb|min::gen min::| &
    \MINKEY{new\_indirect\_indexed\_aux\_gen}\verb| ( unsigned p )|
\LABEL{MIN::NEW_INDIRECT_INDEXED_AUX_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_index\_gen}\verb| ( unsigned a )|
\LABEL{MIN::NEW_INDEX_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_control\_code\_gen}\verb| ( unsigned c )|
\LABEL{MIN::NEW_CONTROL_CODE_GEN} \\
\verb|min::gen min::| &
    \MINKEY{new\_long\_control\_code\_gen\LOOSE}\verb| ( min::uns64 c )|
\LABEL{MIN::NEW_LONG_CONTROL_CODE_GEN} \\
\end{tabular}\end{center}

These protected functions check for argument range errors.  Stubs are
\underline{not} allocated by these functions, so an {\tt int}
argument must fit in 28 bits if {\tt min::gen} values
are 32-bits, and the {\tt const char *} strings must be short enough to
fit into a direct atom.
The {\tt int} argument will be converted to an IEEE 64-bit floating
point number if the \verb|min::gen| type is 64-bits.  The
{\tt min::float64} argument will always cause an argument range
error if used with 32-bit \verb|min::gen| values.
The {\tt unsigned} argument used to make auxiliary pointers must
fit within 24 bits if {\tt min::gen} values are 32-bits, and
within 40 bits if {\tt min::gen} values are 64-bits.\footnote{
In some implementations this argument cannot be more than 32-bits
because that is the size of the {\tt unsigned} argument value,
even if {\tt min::gen} values can accept 40-bit auxiliary pointers.}
The {\tt unsigned} argument used to make either indices
or control codes must fit within 24 bits regardless of the size of
{\tt min::gen} values.
The {\tt long\_control\_code\_gen\LOOSE} function is defined only if
{\tt min::gen} values are 64-bits, and takes an unsigned integer
that must fit within 40 bits.

The subtype codes used for 64-bit {\tt min::gen} direct string, stub pointer,
auxiliary pointer, and control code
values are chosen so they are not normally generated by the compiler,
run-time system, or program execution.  Therefore a {\tt min::float64}
input to {\tt min::new\_direct\_\EOL float\_\EOL gen} is assumed not to have
these subtype
codes, and no check is made for such, even by range-checking protected
functions.

The following unprotected functions are analogous but do not check for
range errors.

\begin{center}\begin{tabular}{r@{}l}
\verb|min::gen MUP::| & \MUPKEY{new\_direct\_int\_gen}\verb| ( int v )|
\LABEL{MUP::NEW_DIRECT_INT_GEN} \\
\verb|min::gen MUP::| &
    \MUPKEY{new\_direct\_float\_gen}\verb| ( min::float64 v )|
\LABEL{MUP::NEW_DIRECT_FLOAT_GEN} \\
\verb|min::gen MUP::| & \MUPKEY{new\_direct\_str\_gen}\verb| ( const char * p )|
\LABEL{MUP::NEW_DIRECT_STR_GEN} \\
\verb|min::gen MUP::| & \MUPKEY{new\_gen}\verb| ( min::stub * s )|
\LABEL{MUP::NEW_GEN_OF_STUB} \\
\verb|min::gen MUP::| & \MUPKEY{new\_list\_aux\_gen}\verb| ( unsigned p )|
\LABEL{MUP::NEW_LIST_AUX_GEN} \\
\verb|min::gen MUP::| & \MUPKEY{new\_sublist\_aux\_gen}\verb| ( unsigned p )|
\LABEL{MUP::NEW_SUBLIST_AUX_GEN} \\
\verb|min::gen MUP::| &
    \MUPKEY{new\_indirect\_pair\_aux\_gen}\verb| ( unsigned p )|
\LABEL{MUP::NEW_INDIRECT_PAIR_AUX_GEN} \\
\verb|min::gen MUP::| &
    \MUPKEY{new\_indirect\_indexed\_aux\_gen}\verb| ( unsigned p )|
\LABEL{MUP::NEW_INDIRECT_INDEXED_AUX_GEN} \\
\verb|min::gen MUP::| & \MUPKEY{new\_index\_gen}\verb| ( unsigned a )|
\LABEL{MUP::NEW_INDEX_GEN} \\
\verb|min::gen MUP::| & \MUPKEY{new\_control\_code\_gen}\verb| ( unsigned c )|
\LABEL{MUP::NEW_CONTROL_CODE_GEN} \\
\verb|min::gen MUP::| &
    \MUPKEY{new\_long\_control\_code\_gen\LOOSE}\verb| ( min::uns64 c )|
\LABEL{MUP::NEW_LONG_CONTROL_CODE_GEN} \\
\end{tabular}\end{center}

The actual direct atom, stub pointer, auxiliary pointer, and control code
{\tt min::gen} subtype codes
are implementation dependent.  The following constants equal these
subtype codes:

\begin{center}\begin{tabular}{r@{}l}
\verb|const unsigned min::| & \MINKEY{GEN\_DIRECT\_INT}
\LABEL{MIN::GEN_DIRECT_INT} \\
\verb|const unsigned min::| & \MINKEY{GEN\_DIRECT\_FLOAT}
\LABEL{MIN::GEN_DIRECT_FLOAT} \\
\verb|const unsigned min::| & \MINKEY{GEN\_DIRECT\_STR}
\LABEL{MIN::GEN_DIRECT_STR} \\
\verb|const unsigned min::| & \MINKEY{GEN\_STUB}
\LABEL{MIN::GEN_STUB} \\
\verb|const unsigned min::| & \MINKEY{GEN\_LIST\_AUX}
\LABEL{MIN::GEN_LIST_AUX} \\
\verb|const unsigned min::| & \MINKEY{GEN\_SUBLIST\_AUX}
\LABEL{MIN::GEN_SUBLIST_AUX} \\
\verb|const unsigned min::| & \MINKEY{GEN\_INDIRECT\_PAIR\_AUX}
\LABEL{MIN::GEN_INDIRECT_PAIR_AUX} \\
\verb|const unsigned min::| & \MINKEY{GEN\_INDIRECT\_INDEXED\_AUX}
\LABEL{MIN::GEN_INDIRECT_INDEXED_AUX} \\
\verb|const unsigned min::| & \MINKEY{GEN\_INDEX}
\LABEL{MIN::GEN_INDEX} \\
\verb|const unsigned min::| & \MINKEY{GEN\_CONTROL\_CODE}
\LABEL{MIN::GEN_CONTROL_CODE} \\
\verb|const unsigned min::| & \MINKEY{GEN\_ILLEGAL}
\LABEL{MIN::GEN_ILLEGAL} \\
\end{tabular}\end{center}

\verb|min::GEN_ILLEGAL| is actually illegal as a subtype code.
For 64-bit \verb|min::gen| values, {\tt MIN::\EOL GEN\_DIRECT\_INT} is defined
to be equal to \verb|min::GEN_ILLEGAL|,
and for 32-bit \verb|min::gen| values, \verb|MIN::GEN_DIRECT_FLOAT| is defined
to be equal to \verb|min::GEN_ILLEGAL|.

The following function may be used to retrieve the subtype code field:

\begin{center}\begin{tabular}{r@{}l}
\verb|unsigned min::| & \MINKEY{gen\_subtype\_of}\verb| ( min::gen v )|
\LABEL{MIN::GEN_SUBTYPE_OF} \\
\end{tabular}\end{center}

For 64-bit \verb|min::gen| values, this retrieves the high order
24 bits of the value, and then zeros any low order bits that are not
part of the subtype code.
For 32-bit \verb|min::gen| values, this retrieves
the high order 8 bits, and then zeros any low order bits that are not
part of the subtype code.
In any case, \verb|min::GEN_ILLEGAL| is not a possible value of this function.


\subsection{Body Pointers}
\label{BODY-POINTERS}

Body pointers are relocatable and require special handling to
ensure that they are up-to-date.  Because of this, functions
that obtain body pointers from stubs are unprotected, and
names of relocating functions, which might relocate bodies, are marked
with the superscript {\REL} in this document.


Relocation can only happen inside relocating functions
(\pagref{RELOCATING-FUNCTIONS}).  When it happens,
the `\key{relocated flag}\,'\label{RELOCATED-FLAG}
which is one of the execution flags
described in~\secref{EXECUTION-FLAGS}, is set.  Deallocation
(\pagref{DEALLOCATE}) can also happen inside relocating functions,
and is like relocation to non-existent memory, except that the
stub type code is reset to the value {\tt min::DEALLOCATED}.

Upon return from the call to any relocating function,
a caller who is using body pointers must check the relocated flag,
and if on, the caller must:

\begin{center}
\begin{tabular}{l}
check that object bodies have not been deallocated \\
recompute all local variables containing pointers into bodies \\
clear the relocated flag \\
remember it has cleared the relocated flag
\end{tabular}
\end{center}

When a function returns to its caller,
it must set the relocated flag if that flag was ever cleared by
the returning function.

Pointers into bodies are recomputed from body pointers stored in stubs,
which are updated by the relocating functions.

The code to do all this has the form:

\begin{indpar}\begin{verbatim}
... some_function ( ... )
{
    bool relocated = min::set_relocated_flag ( false );
    min::stub * s = a_pointer_to_some_stub_with_a_body;
    . . . . .
    assert ( . . . == type_of ( s ) );
    min::some_body_type * p =
        some_function_returning_a_body_pointer ( s );
    . . . . . use p . . . . .
    some_relocating_function ( ... );
    if ( min::set_relocated_flag( false ) )
    {
        relocated = true;
        assert_allocated ( s, MAX_SIZE_OF_BODY_OF_S );
        p = some_function_returning_a_body_pointer ( s );
    }
    . . . . . use p . . . . .
    min::set_relocated_flag ( relocated );
    return ...;
}
\end{verbatim}\end{indpar}

The following functions get and set the relocated flag:

\begin{center}\begin{tabular}{r@{}l}
\verb|bool min::| & \MINKEY{relocated\_flag}\verb| ( void )|
\LABEL{MIN::RELOCATED_FLAG} \\
\verb|bool min::| & \MINKEY{set\_relocated\_flag}\verb| ( bool )|
\LABEL{MIN::SET_RELOCATED_FLAG}
\end{tabular}\end{center}

The function to set the flag returns the flag's previous value.

A function that computes a pointer into an object body does not
check the type code of the object stub pointing at the body.  The type
code must be checked separately before the pointer is computed.  If the
pointer is being recomputed after possible relocation, the only check
required relates to the possibility that the object has been deallocated.
This check is most efficiently done by the {\tt assert\_allocated}
function (\pagref{ASSERT_ALLOCATED}).

To simplify code, the following is defined:

\begin{indpar}\begin{verbatim}
class min::relocated
{
public:
    bool relocated;
    min::relocated ( void )
    {
        relocated = min::set_relocated_flag ( false );
    }
    ~ min::relocated ( void )
    {
        min::set_relocated_flag ( relocated );
    }
    operator bool ()
    {
        if ( min::set_relocated_flag ( false ) )
            return relocated = true;
        else
            return false;
    }
}
\end{verbatim}\end{indpar}

which permits the example code given above to be rewritten more conveniently
as:

\begin{indpar}\begin{verbatim}
... some_function ( ... )
{
    min::relocated relocated;
    min::stub * s = a_pointer_to_some_stub_with_a_body;
    . . . . .
    assert ( . . . == type_of ( s ) );
    min::some_body_type * p =
        some_function_returning_a_body_pointer ( s );
    . . . . . use p . . . . .
    some_relocating_function ( ... );
    if ( relocated )
    {
        assert_allocated ( s, MAX_SIZE_OF_BODY_OF_S );
        p = some_function_returning_a_body_pointer ( s );
    }
    . . . . . use p . . . . .
    return ...;
    // relocated deconstructor sets relocated flag.
}
\end{verbatim}\end{indpar}

The operation of \ikey{deallocating a body}{deallocate!body}
is considered to be a relocation of the body.  The body pointer in the
stub is pointed at unimplemented virtual memory, and the type code in the stub
is set to {\tt min::DEALLOCATED} (\pagref{MIN::DEALLOCATED}).

The following function tests whether a stub with a body pointer
has a deallocated body:

\begin{center}\begin{tabular}{r@{}l}
\verb|bool min::| & \MINKEY{is\_deallocated}\verb| ( min::stub * s )|
\LABEL{MIN::IS_DEALLOCATED}
\end{tabular}\end{center}

This function just checks the stub type code to see if it equals
{\tt min::DEALLOCATED} (\pagref{MIN::DEALLOCATED}).

A check that an object body has not been deallocated may be needed before
a pointer into the body is recomputed after a relocating function has
been called.  Using a deallocated body is
considered to be a fatal programming error, so often no check is necessary,
as a program that uses a deallocated body simply
crashes when it tries to access the unimplemented
virtual memory.

However, there is a limit to the size of unimplemented
memory, so code using very large bodies should always recheck the type
code when reloading a possibly relocated body pointer.  This limit is
guaranteed to be at least the value of the macro:

\begin{center}\begin{tabular}{r@{}l}
(unsigned integer macro)~~ & \TTKEY{MIN\_DEALLOCATED\_LIMIT}
\LABEL{MIN_DEALLOCATED_LIMIT}
\end{tabular}\end{center}

which is used to optimize the inline function:

\begin{center}\begin{tabular}{r@{}l}
\verb|void | & \TTKEY{assert\_allocated}\verb| ( min::stub * s, unsigned size )|
\LABEL{ASSERT_ALLOCATED}
\end{tabular}\end{center}

which expands to the code:

\begin{indpar}\begin{verbatim}
if ( MIN_DEALLOCATED_LIMIT < size || MIN_DEBUG )
{
    assert ( ! min::is_deallocate ( s ) );
}
\end{verbatim}\end{indpar}

If {\tt size} is a constant (such as a {\tt size\_of} expression)
not greater than {\tt MIN\_DEALLOCATED\_\EOL LIMIT},
this code will normally be optimized away by the compiler.

However if {\tt MIN\_DEBUG} is set {\tt assert\_allocated} always
executes

\begin{indpar}\begin{verbatim}
assert ( ! min::is_deallocate ( s ) );
\end{verbatim}\end{indpar}

because this is useful for debugging improper accesses to deallocated
bodies.

\subsection{Stub Control}
\label{STUB-CONTROL}

A stub contains an 8 byte value and an 8 byte
\key{stub control}\index{control!of stub}.
If the stub control is viewed as a 64 bit integer, its high order byte
is the \mkey{type code}{high order byte!of stub control}.
The \mkey{high order bit}{of stub type code} of this, which is the high order
bit of the 64 bit control integer, is off if the stub is managed by
the garbage collector (gc), and on otherwise.  In the former case the
stub is said to be `\key{collectible}'.  In the latter case it is
said to be `\key{uncollectible}'.

If the stub is collectible,
the stub control is used exclusively by the garbage collector,
except for the type code, which is shared between the garbage collector
and the rest of the system.  A typical (but not required)
garbage collector organization of the stub control of a collectible stub is:

\begin{center}
\begin{tabular}{ll}
high order 8 bits:	& type code \\
next 12 bits:		& gc flags \\
low order 44 bits:	& chain pointer \\
\end{tabular}
\end{center}

The chain pointer is used to build lists of allocated stubs which
the garbage collector manages.

If a stub is uncollectible, its stub control can be organized in different
ways according to the type code value.  The standard way of organizing
an uncollectible stub control is:

\begin{center}
\begin{tabular}{ll}
high order 8 bits:	& type code \\
next 12 bits:		& subtype code \\
low order 44 bits:	& chain pointer \\
\end{tabular}
\end{center}

The main use of uncollectible stubs is as auxiliary stubs.
An `\key{auxiliary stub}' is an uncollectible stub attached to an object.
When the object is garbage collected, the auxiliary stub is freed.  Auxiliary
stubs are a means of adding memory to an object without relocating the object.
For example, if the object stores 64-bit IEEE floating point numbers,
a chain of auxiliary stubs
can be used to add memory for additional numbers to the
object.  Note that the auxiliary stub itself may not contain enough
information to tell the type of the value it stores; one may have to
trace the reference from the object pointing at the auxiliary stub
to determine this type.  See \secref{STUB-FUNCTIONS} for functions
that can read and write auxiliary stubs.

\subsection{Stub Type Codes}
\label{STUB-TYPE-CODES}

The type code of a stub may be returned by

\begin{center}\begin{tabular}{r@{}l}
\verb|int | & \TTKEY{type\_of}\verb| ( min::stub * s )|
\LABEL{TYPE_OF}
\end{tabular}\end{center}

A determination of whether or not a stub is collectible may be made
by applying the function

\begin{center}\begin{tabular}{r@{}l}
\verb|bool min::| & \MINKEY{is\_collectible}\verb| ( int type )|
\LABEL{MIN::IS_COLLECTIBLE}
\end{tabular}\end{center}

to the type code of the stub.  Notice that type codes are \underline{signed}
integers, so that negative type codes are uncollectible and positive type codes
are collectible.

A partial list of stub type codes is:

\begin{indpar}
\begin{list}{}{}
\item[{\tt const int min::NUMBER}]~\\
Stub value is an IEEE 64-bit floating point number.
\item[{\tt const int min::SHORT\_STR}]~\\
Stub value is 0-8 \verb|const char| string, NUL padded.
\item[{\tt const int min::LONG\_STR}]~\\
Stub value is a pointer at a body of type {\tt min::long\_\EOL string}
that contains a \verb|const char| vector and its size. 
\item[{\tt const int min::DEALLOCATED}]~\\
Stub has a deallocated body.
\end{list}
\end{indpar}

A full list of stub type codes complete with page references
is given on \pagref{STUB-TYPE-CODE-LIST}.

\subsection{Stub Values}
\label{STUB-VALUES}

A stub contains a 64-bit value whose type depends upon the stub
type code (\secref{STUB-TYPE-CODES}).  Many stubs are immutable
and their values cannot be written after the stub has been created;
nevertheless we describe unprotected functions below that
write these values.  Unprotected functions are also provided to obtain
body pointers from stubs when these are the values of the stubs.
This cannot be done by protected
functions as body pointers are relocatable and require special
programming be sure they are up-to-date (\secref{BODY-POINTERS}).

\subsection{Numbers}
\label{NUMBERS}

A \key{number stub} is collectible, has \minkey{NUMBER}\LABEL{MIN::NUMBER}
stub type code, and has
an immutable \verb|min::float64| value that can be read by

\begin{center}\begin{tabular}{r@{}l}
\verb|min::float64 | & \MINKEY{float\_of}\verb| ( min::stub * s )|
\LABEL{FLOAT_OF} \\
\verb|min::float64 MUP::| & \MUPKEY{float\_of}\verb| ( min::stub * s )|
\LABEL{MUP::FLOAT_OF}
\end{tabular}\end{center}

and written by

\begin{center}\begin{tabular}{r@{}l}
\verb|void MUP::| &
    \MUPKEY{set\_float\_of}\verb| ( min::stub * s, min::float64 f )|
\LABEL{MUP::SET_FLOAT_OF}
\end{tabular}\end{center}

Number stubs exist only in compact implementations;
in loose implementations number atoms are stored exclusively
in direct number general values.

General values that are numbers can be tested, created, and read
by the following protected functions:

\begin{center}\begin{tabular}{r@{}l}
\verb|int min::| & \MINKEY{is\_num}\verb| ( min::gen v )|
\LABEL{MIN::IS_NUM} \\[1ex]
\verb|min::gen min::| &
	\MINKEY{new\_gen\REL} \verb| ( int v )|
\LABEL{MIN::NEW_GEN_OF_INT} \\
\verb|min::gen min::| &
	\MINKEY{new\_gen\REL} \verb| ( min::float64 v )|
\LABEL{MIN::NEW_GEN_OF_FLOAT64} \\[1ex]
\verb|int min::| & \MINKEY{int\_of}\verb| ( min::gen v )|
\LABEL{MIN::INT_OF_GEN} \\
\verb|min::float64 min::| & \MINKEY{float\_of}\verb| ( min::gen v )|
\LABEL{MIN::FLOAT_OF_GEN} \\[1ex]
\verb|unsigned min::| & \MINKEY{numhash}\verb| ( min::gen v )|
\LABEL{MIN::NUMHASH_OF_GEN} \\
\end{tabular}\end{center}

The \verb|min::is_num| function for a 64-bit \verb|min::gen| argument
is just another name for the \verb|min::is_direct_float| function of the same
argument.  For a 32-bit argument the function returns
true if the argument is a direct integer or a stub pointer
pointing at a number stub.

The \verb|min::new_gen| function with \verb|min::float64| argument
and 64-bit \verb|min::gen| value
is just another name for {\tt min::new\_\EOL direct\_\EOL gen}, which
simply changes the type of its argument.
The \verb|min::new_gen| function with \verb|min::float64| argument
and 32-bit \verb|min::gen| value creates a direct integer
if the argument is an integer in the
require range; otherwise the function returns a \verb|min::gen| value
that is a pointer to a number stub.  If a pointer to a number stub is
to be returned and a number stub containing the argument value already exists,
a pointer to the existing stub is returned;
otherwise a new number stub is created and a pointer to it returned.
Therefore two 32-bit \verb|min::gen| values that represent equal numbers are
themselves \verb|==|.

The \verb|min::new_gen| function with an \verb|int| argument does the
same thing as it would with its argument converted to a \verb|min::float64|
value, but is more efficient in the case where \verb|min::gen| values
are 32 bits and the argument is in the range of a direct integer general
value.

The \verb|min::num_of| function for a 64-bit \verb|min::gen|
argument is just another name for the \verb|min::direct_float_of| function
of the same argument, which after checking the subtype of the argument,
simply changes the type of the argument.  For a 32-bit argument the
function returns any integer stored directly
in the argument converted to a 64-bit IEEE floating point number, or
returns the stub value for any number stub pointed at by the argument.
In this last case the stub type code is checked by an \verb|assert|
statement to be sure the stub is a number stub.

The \verb|min::int_of| function does the same thing as the
\verb|min::num_of| followed by conversion to an \verb|int| value,
except that \verb|min::int_of| includes a check that the result
is a pure integer, without any fractional part, and is within the
range of the \verb|int| type, and
\verb|min::int_of| is more efficient when given a 32-bit direct integer
\verb|min::gen| argument.

Lastly, the \verb|min::numhash| returns the hash value of a \verb|min::gen|
value that is a number.  This value is computed by considering the number
to be a string of 8 characters and using the algorithm
on \pagref{HASH-ALGORITHM} to compute the hash value of this string.

\begin{quote}
The Hash Table Implementation Note on \pagref{HASH-TABLE-IMPLEMENTATION-NOTE}
also applies to number stubs created by {\tt min::new\_gen}.
\end{quote}

\subsection{Strings}
\label{STRINGS}

In MIN all \verb|char| \skey{string}s\index{char strings@{\tt char} strings}
are NUL terminated UTF-8 encoded UNICODE character strings.
UTF-8 encodes 16 bit UNICODE characters in 1, 2, or 3 \verb|char|'s.

All ASCII characters are encoded as themselves in
the UTF-8 encoding.  This implies that
all ASCII character strings are UTF-8 encoded character
strings with the same characters as their ASCII representation indicates.%
\footnote{ASCII character codes range from 0 through 127.  UTF-8 extends
this by assigning meaning to codes from 128 to 255.}

It is possible for a \verb|char| string to be miscoded UTF-8.  None
of the functions given below, including the protected functions,
check for this.

There are two kinds of string stubs: short strings and long strings.
There are no protected functions directly accessing these.  In addition,
a string of up to 3 {\tt char}'s can be stored within a 32-bit
\verb|min::gen| value, and a string of up to 5 {\tt char}'s can be stored
within a 64-bit \verb|min::gen| value,
without using a stub (\secref{GENERAL-VALUE-SUBTYPES}).
Such strings are called \skey{direct string}s, while strings stored in
stubs or stub bodies which are pointed at by \verb|min::gen| values,
the short and long strings, are called \skey{indirect string}s.
There are protected functions accessing general values that denote
strings of any kind without distinction,
and these are described toward the end of this section, after
short and long strings and their unprotected access functions are
described.

A \key{short string stub}\label{SHORT-STRING-STUB} is collectible, has
\minkey{SHORT\_STR}\LABEL{MIN::SHORT_STR} stub type code, and has
an immutable {\tt min::\EOL uns64} value that holds a NUL padded
8 \verb|char| vector and can be read by


\begin{center}\begin{tabular}{r@{}l}
\verb|min::uns64 MUP::| &
	\MUPKEY{short\_str\_of}\verb| ( min::stub * s )|
\LABEL{MUP::SHORT_STR_OF}
\end{tabular}\end{center}

and written by

\begin{center}\begin{tabular}{r@{}l}
\verb|void MUP::| &
    \MUPKEY{set\_short\_str\_of}\verb| ( min::stub * s, min::uns64 str )|
\LABEL{MUP::SET_SHORT_STR_OF}
\end{tabular}\end{center}

Here the \verb|min::uns64| value returned by \MUPkey{short\_str\_of}
should be overlaid by a union with a \verb|char[ ]| buffer, as in

\begin{indpar}\begin{verbatim}
union { min::uns64 str; char buf[9]; } u;
min::stub * s1, * s2;
. . . set s1 and s2 to point at short string stubs . . .
u.str = MUP::short_str_of ( s1 );
u.buf[8] = 0;	// Be sure result is NUL terminated.
cout << u.buf;
. . . .
u.str = 0;	// Be sure all 8 bytes are NUL padded.
cin >> u.buf;   // Must not read more than 8 chars.
MUP::set_short_str_of ( s2 , u.str );
\end{verbatim}\end{indpar}

Short string values are NUL (zero) padded 0 to 8 \verb|char|
strings.  To be sure any value read is NUL terminated, a NUL (zero)
must be stored after the value read, as is done by \verb|u.buf[8] = 0|
in the example.  To be sure any value written is padded to 8 {\tt char}'s
by NUL, the 8 {\tt char} value should be zeroed before any string is
copied into it, as is done by \verb|u.str = 0| in the example.

A \key{long string stub}\label{LONG-STRING-STUB} is collectible, has
\minkey{LONG\_STR}\LABEL{MIN::LONG_STR} stub type code, and has
a value that is a pointer to a \minkey{long\_str} type body
which holds an arbitrary length NUL terminated \verb|char| string.

The following are unprotected functions to return a relocatable pointer to the
a long string body and relocatable pointers to the string itself,
and several protected functions to return parts of the body header.
\footnote{Of course these protected functions cannot be used
until the unprotected function has been used.  These protected functions
are protected only in the sense that they introduce no
\underline{additional} protection issues.}

\begin{center}\begin{tabular}{r@{}l}
\verb|min::long_str * MUP::| &
	\MUPKEY{long\_str\_of}\verb| ( min::stub * s )|
\LABEL{MUP::LONG_STR_OF} \\
\verb|const char * MUP::| & \MUPKEY{str\_of}\verb| ( min::long_str * str )|
\LABEL{MUP::STR_OF_LONG_STR} \\
\verb|char * MUP::| & \MUPKEY{writable\_str\_of}\verb| ( min::long_str * str )|
\LABEL{MUP::WRITABLE_STR_OF_LONG_STR} \\
\verb|unsigned | & \TTKEY{length\_of}\verb| ( min::long_str * str )|
\LABEL{LENGTH_OF_LONG_STR} \\
\verb|unsigned | & \TTKEY{hash\_of}\verb| ( min::long_str * str )|
\LABEL{HASH_OF_LONG_STR} \\
\verb|min::uns64 | & \TTKEY{signature\_of}\verb| ( min::long_str * str )|
\LABEL{SIGNATURE_OF_LONG_STR} \\
\end{tabular}\end{center}

These functions return a relocatable pointer to the string body,
relocatable pointers to the NUL terminated {\tt char} string itself,
the length of the string, a 32-bit non-zero \mkey{hash value}{of string}
computed from the string, and a 64-bit signature for the string.
A relocatable pointer to the {\tt char} string that permits only reading can be
obtained, or one that permits both reading and writing can be obtained.
If the hash value
has not been previously accessed, it is computed and saved in the
string by the function that returns it, causing that function to
take time proportional to the string length.  The 64-bit signature
contains the hash value and the string length.

A string hash value is computed according to the following machine
independent algorithm:\label{HASH-ALGORITHM}

\begin{indpar}\begin{verbatim}
hash = 0
n = length of string
for i = 1 through n:
    c = i'th char of string as unsigned 8 bit integer
    hash = ( hash * 65599 ) + c
if hash = 0, then hash = 2**32 - 1
\end{verbatim}\end{indpar}

where the final result is truncated to 32 bits.  The constant
is a prime such that multiplication by it is turned into
shifts and adds by compilers: $65599=2^{16}+2^6-1$.\footnote{Another good
constant that could be used is $33$.}  The hash value of a string
is never zero.

The low order bits of the hash value are random, so it can be
truncated to provide a random hash.

The long string body consists of a 64 bit signature containing
the 32-bit length and 32-bit hash value, followed by a \verb|char|
vector containing the string with the terminating NUL.  The
\verb|char| vector is padded to a multiple of 8 bytes with NUL
bytes, but the terminating NUL and the padding are not included
in the length.  If the hash has not been computed, it is
stored in the header as zero.

The following unprotected functions return the hash value as stored
in the body and set that value and the length.  The {\tt MUP::hash\_of}
function returns {\tt 0} if the hash value has not been computed,
unlike the protected {\tt hash\_of} function that computes any uncomputed
hash value.

\begin{center}\begin{tabular}{r@{}l}
\verb|unsigned MUP::| & \MUPKEY{hash\_of}\verb| ( min::long_str * str )|
\LABEL{MUP::HASH_OF_LONG_STR} \\
\verb|void MUP::| &
   \MUPKEY{set\_length\_of}\verb| ( min::long_str * str, unsigned length )|
\LABEL{MUP::SET_LENGTH_OF_LONG_STR} \\
\verb|void MUP::| &
   \MUPKEY{set\_hash\_of}\verb| ( min::long_str * str, unsigned hash )|
\LABEL{MUP::SET_HASH_OF_LONG_STR} \\
\end{tabular}\end{center}

The following are protected functions that operate on both short and long
strings.  Some of these functions have the same (overloaded) names
as standard C library string functions, and have the same definition
except that the string source is represented by a short or long string
stub.

The functions

\begin{center}\begin{tabular}{r@{}l}
\verb|unsigned | & \TTKEY{strlen}\verb| ( min::stub * s )|
\LABEL{STRLEN} \\
\verb|unsigned | & \TTKEY{strhash}\verb| ( min::stub * s )|
\LABEL{STRHASH} \\
\verb|min::uns64 | & \TTKEY{strsignature}\verb| ( min::stub * s )|
\LABEL{STRSIGNATURE} \\
\end{tabular}\end{center}

return the length of the string (excluding the terminating NUL),
the hash value of the string, and the signature of the string.
The signatures of two strings
are equal if the strings are equal, but there is a small chance
the signatures of unequal strings will be equal.\footnote{The chance
is much greater for the signature used by MIN than it would be
for an MD5 signature, which has the same length but is much slower
to compute.}

The functions

\begin{center}\begin{tabular}{r@{}l}
\verb|char * | & \TTKEY{strcpy}\verb| ( char * p, min::stub * s )|
\LABEL{STRCPY} \\
\verb|char * | &
	\TTKEY{strncpy}\verb| ( char * p, min::stub * s, unsigned n )|
\LABEL{STRNCPY} \\
\end{tabular}\end{center}

copy a string from a MIN short or long string to a buffer pointed at
by \verb|p|.  Copying stops when a NUL is copied or when the
\verb|strncpy| function copies the \verb|n|'th \verb|char|.  The value
of \verb|p| is returned.

The following are protected functions with same definitions as above but
with general value arguments.  The general values must hold a
direct string value or a pointer to a short or long string stub.

\begin{center}\begin{tabular}{r@{}l}
\verb|unsigned min::| & \MINKEY{strlen}\verb| ( min::gen v )|
\LABEL{MIN::STRLEN_OF_GEN} \\
\verb|unsigned min::| & \MINKEY{strhash}\verb| ( min::gen s )|
\LABEL{MIN::STRHASH_OF_GEN} \\
\verb|min::uns64 min::| & \MINKEY{strsignature}\verb| ( min::gen s )|
\LABEL{MIN::STRSIGNATURE_OF_GEN} \\
\verb|char * min::| & \MINKEY{strcpy}\verb| ( char * p, min::gen s )|
\LABEL{MIN::STRCPY_OF_GEN} \\
\verb|char * min::| &
	\MINKEY{strncpy}\verb| ( char * p, min::gen s, unsigned n )|
\LABEL{MIN::STRNCPY_OF_GEN} \\
\end{tabular}\end{center}

Some of these functions correspond to the standard C/C++
{\tt strlen}, {\tt strcpy}, and {\tt strncpy} functions, and differ
from these only in that instead of taking a {\tt char *} source string
argument, these functions take a {\tt min::gen} source argument.

A read-only pointer to the characters of a string general value can
be obtained using the following functions to create
a \key{string pointer}:

\begin{center}\begin{tabular}{r@{}l}
\verb|(constructor) MUP::| & \MUPKEY{str\_pointer}\verb| ( min::gen v )|
\LABEL{MUP::STR_POINTER_OF_GEN} \\
\verb|const char * | & \TTKEY{str\_of}\verb| ( MUP::str_pointer & sp )|
\LABEL{STR_OF_STR_POINTER} \\
\verb|void | & \TTKEY{relocate}\verb| ( MUP::str_pointer & sp )|
\LABEL{RELOCATE_OF_STR_POINTER} \\
\end{tabular}\end{center}

The constructor creates a string pointer pointing to the {\tt char}'s
of the string specified by the \verb|min::gen| argument.  This argument
must be a direct string or a pointer to a short or long string stub.
The {\tt str\_of} function returns this pointer, taking care to ensure
the vector of {\tt char}'s is NUL-terminated.  The {\tt relocate}
function resets the pointer after the relocated flag has been set,
in case this is necessary.
The value of {\tt str\_of} is not updated after the relocated flag has
been set \underline{until} the {\tt relocate} function is called on the
string pointer.

For direct and some short strings the string pointer, when it is created,
copies the string {\tt char}'s into a buffer internal to the string pointer,
in order to save the {\tt char}'s in a direct string value, or to
add a missing NUL to the end of the {\tt char} vector.  In other cases,
including all long string cases, no copying is done, making string pointers
a more efficient way of reading a string than {\tt strcpy}.

A typical use of string pointers that indicates how the {\tt relocate}
function works is:

\begin{indpar}\begin{verbatim}
... some_function ( ... )
{
    min::relocated relocated;
    min::gen g = some_string_value;
    MUP::str_pointer sp ( g );
    const char * p = str_of ( sp );
    . . . use and increment p . . .
    some_relocating_function ( ... );
    if ( relocated )
    {
        int displacement = p - str_of ( sp );
        relocate ( sp );
        p = str_of ( sp ) + displacement;
    }
    . . . . . use p . . . . .
    return ...;
    // relocated deconstructor sets relocated flag.
}
\end{verbatim}\end{indpar}


The following functions test general values to see if they are a string,
and create new general values.

\begin{center}\begin{tabular}{r@{}l}
\verb|int min::| & \MINKEY{is\_str}\verb| ( min::gen v )|
\LABEL{MIN::IS_STR_OF_GEN} \\[1ex]
\verb|min::gen min::| &
    \MINKEY{new\_gen\REL} \verb| ( const char * p )|
\LABEL{MIN::NEW_GEN_OF_STR} \\
\end{tabular}\end{center}

A general value is a string if it holds a string itself or if it
holds a stub pointer at a short or long string.  When a general value
is created, if the input string is short enough for the general value
to hold the string itself, a direct string general value is created.
Otherwise \verb|min::new_gen| searches to see if any equal string
exists.  If such a string exists, a pointer to the stub of the existing
string is returned in the new \verb|min::gen| value, and no new stub
is created.  Otherwise, if the input string is 8 or fewer {\tt char}'s,
a short string stub is created, and if the input string has more
than 8 {\tt char}'s, a long string stub is created.

Thus if two string \verb|min::gen| values are equal as
strings, they have \verb|==| \verb|min::gen| values.

\begin{quote}
\key{Hash Table Implementation Note}:\label{HASH-TABLE-IMPLEMENTATION-NOTE}
To ensure that no two string stubs have the same
\verb|char| string, a hash table is required.
This is integrated with the garbage
collector (GC).  The GC has to maintain a list of all allocated stubs,
which it does (normally) using the chain pointers in the stub.  For
the case of strings, the GC maintains this list as a hash table, which
uses a vector to hold the heads of lists threaded through the string stub
chain pointers.
\end{quote}


\subsection{Labels}
\label{LABELS}

Attribute labels are often atoms, i.e., single strings or numbers.
But they may be sequences of atoms.  Such sequences are represented by
\key{label} stubs.\footnote{Labels could also be represented by
sublists stored inside objects (\pagref{LIST-LEVEL}), but each label tends to
be reused by many objects, and storing it inside each using object
would be inefficient.  In addition labels are useful as function arguments.}

A label is essentially just a vector of atoms, with the special
property that no two distinct label stubs may have equal vectors of
atoms.  However, the vector may be stored in a chain of stubs,
and not in a body.  The exact manner in which the vector is stored is
hidden from the user.  Atoms which are elements of a label are represented
by \verb|min::gen| general values.

A \key{label stub}\label{LABEL-STUB} is collectible,
has \minkey{LABEL}\LABEL{MIN::LABEL} stub type code,
and has an immutable value.
The label value may be read by the protected functions:

\begin{center}\begin{tabular}{r@{}l}
\verb|unsigned | & \TTKEY{lab\_of}%
    \verb| ( min::gen * p, unsigned n, min::stub * s )|
\LABEL{LAB_OF} \\
\verb|unsigned min::| & \MINKEY{lab\_of}%
    \verb| ( min::gen * p, unsigned n, min::gen v )|
\LABEL{MIN::LAB_OF_GEN} \\
\end{tabular}\end{center}

These read an initial segment of the label vector into the location
addressed by {\tt p}.  If the label vector has {\tt n} or more elements,
the first {\tt n} elements are read.  Otherwise, as many elements as
the label vector has are read.  The number of elements read is returned
in any case.  The label can be denoted by either its stub address or
by a general value pointing at its stub address.

The length of a label is the number of elements (general values) in the label.
Usually this is found my just reading the label, as labels tend to be
short.  For example, a convention might (or might not) be adopted that
attribute labels have at most 10 elements.  Then providing output vectors
to the above functions with 11 elements would not only allow all legal
attribute labels, but would detect illegally long ones.

The length of a label may be read by the following functions:

\begin{center}\begin{tabular}{r@{}l}
\verb|unsigned | & \TTKEY{lablen}\verb| ( min::stub * s )|
\LABEL{LABLEN} \\
\verb|unsigned min::| & \MINKEY{lablen}\verb| ( min::gen v )|
\LABEL{MIN::LABLEN_OF_GEN} \\
\end{tabular}\end{center}

The hash value of a label may be computed by the following functions:

\begin{center}\begin{tabular}{r@{}l}
\verb|unsigned | & \TTKEY{labhash}\verb| ( min::stub * s )|
\LABEL{LABHASH} \\
\verb|unsigned min::| & \MINKEY{labhash}\verb| ( min::gen v )|
\LABEL{MIN::LABHASH_OF_GEN} \\
\verb|unsigned min::| & \MINKEY{labhash}%
    \verb| ( min::gen * const p, unsigned n )|
\LABEL{MIN::LABHASH_OF_GEN_VECTOR} \\
\end{tabular}\end{center}

The last function computes the hash value for a label that could be created
from the given vector {\tt p} of {\tt n} general values, where each
general value is an atom.  The hash of a label is computed by treating
each of its atoms
as a character string, concatenating all these strings in order, and applying
the algorithm on \pagref{HASH-ALGORITHM} to compute the hash value of
concatenated string.

A label may be created by the following protected function:

\begin{center}\begin{tabular}{r@{}l}
\verb|min::gen min::| & \MINKEY{new\_gen}%
    \verb| ( min::gen * const p, unsigned n )|
\LABEL{MIN::NEW_GEN_OF_GEN_VECTOR} \\
\end{tabular}\end{center}

Here {\tt p} must point to a vector of {\tt n} \verb|min::gen|
values that becomes the value vector of the label.  Each
\verb|min::gen| value must be an atom.
This function returns any existing label with elements equal to
those given by the function arguments, in preference to creating a new
label.

A label may be tested by the following protected function:

\begin{center}\begin{tabular}{r@{}l}
\verb|bool min::| & \MINKEY{is\_label}\verb| ( min::gen v )|
\LABEL{MIN::IS_LABEL_OF_GEN} \\
\end{tabular}\end{center}


\subsection{Objects}
\label{OBJECTS}

An \key{object} is conceptually a hash table that maps
\skey{attribute name}s to \skey{attribute value}s.
The part of the hash table that maps small
unsigned integer attribute names is actually a vector.

Each map of an attribute name to an attribute value represents an
arrow in the data base.
If the arrow is a double arrow,
a reverse direction label, called the \key{reverse attribute name}
is attached to the arrow.
There can be several arrows with the same attribute name.
There can be several double arrows with the same attribute name and
different reverse attribute names.

Several arrows can have the same attribute name, and can have both the
same name and the same value.  Several double arrows can have the same
attribute and reverse attribute names, or the same pair of names and the
same value.

Therefore an attribute name and reverse attribute name together name a
multi-set of values, where the reverse attribute name can be missing to
indicate that only single arrows are to be considered, and is present to
indicate that only double arrows are to be considered.
It is possible to add a value to this multi-set or delete a value from the
multi-set.  It is possible to delete the entire multi-set.
It is possible to treat the multi-set as a set, by adding a value
to it only if the value does not already occur in the multi-set.
When testing for value equality, {\tt ==} is used, as this tests for
equality of both atoms and objects.

Flags, called \key{attribute flags}, can be attached to an attribute name.
Note that flags are attached to object attribute names, and not to arrows.

An object has a body that consists of the following 5 parts in
the order given:

\begin{center}
\begin{tabular}{l}
header \\
hash table \\
attribute vector \\
unused area\\
auxiliary area
\end{tabular}
\end{center}

The header contains the sizes of the other 4 parts.
The \mkey{hash table}{of object}
stores attribute name/value pairs, for attributes whose names that are not
small unsigned integers.
The \key{attribute vector} stores attribute values for attributes whose
names begin with small positive integers.  The \key{auxiliary area}
stores various overflow data from the hash table and attribute vector.

The hash table is of fixed size; its size can only be changed by relocating
the object body.  The attribute vector
grows up from the end of the hash table into the unused
area, and the auxiliary storage grows down from the end of the body into
the unused area.

There are two kinds of objects: short and long.  A \key{short object}
has a header that stores 16 bit unsigned sizes.  A \key{long object}
has a header that stores 32 bit unsigned sizes.  Otherwise there is
no essential difference between a short and a long object.  The functions
that create attributes convert automatically from short to
long objects when required.  Conversion in either direction, and compaction
of objects, may occur whenever object bodies are relocated, as they
may be during garbage collection.

There are protected functions accessing general values that denote
objects of any kind without distinction,
and these are described toward the end of this section, after
short and long objects and their unprotected access functions are
described.

A \key{short object stub}\label{SHORT-OBJECT-STUB} is collectible, has
\minkey{SHORT\_OBJ}\LABEL{MIN::SHORT_OBJ} stub type code, and has
a value that is a pointer to a \minkey{short\_obj} type body
which holds the 5 parts of the object.
The header consists of 4 16-bit unsigned integers which are, in order:

\begin{center}
\begin{tabular}{lllllllll}
header size & + & hash table size \\
header size & + & hash table size & + & attribute vector size \\
header size & + & hash table size & + & attribute vector size
	& + & unused area size \\
header size & + & hash table size & + & attribute vector size
	& + & unused area size \\
        & + & auxiliary area size \\
	& = & header size & + & total size
\end{tabular}
\end{center}

The header may contain other implementation dependent information used
for optimization.

All sizes are in units of \verb|min::gen| values.  Aside from its header,
the object body is just a vector of \verb|min::gen| values.  The total
size does \underline{not} include the header.

A \key{long object stub}\label{LONG-OBJECT-STUB} is collectible, has
\minkey{LONG\_OBJ}\LABEL{MIN::LONG_OBJ} stub type code, and has
a value that is a pointer to a \minkey{long\_obj} type body
which holds the 5 parts of the object.  A long object body is
the same as a short object body except the 4 header integers
are 32-bit unsigned integers instead of 16-bit unsigned integers,
and extra implementation dependent information in the header may be
different.

A pointer to the body and the sizes can be obtained by the following
functions:

\begin{center}\begin{tabular}{r@{}l}
\verb|min::short_obj * MUP::| &
	\MUPKEY{short\_obj\_of}\verb| ( min::stub * s )|
\LABEL{MUP::SHORT_OBJ_OF} \\
\verb|min::long_obj * MUP::| &
	\MUPKEY{long\_obj\_of}\verb| ( min::stub * s )|
\LABEL{MUP::LONG_OBJ_OF} \\
\verb|unsigned | & \TTKEY{hash\_table\_size\_of}\verb| ( min::short_obj * so )|
\LABEL{HASH_TABLE_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned | & \TTKEY{hash\_table\_size\_of}\verb| ( min::long_obj * lo )|
\LABEL{HASH_TABLE_SIZE_OF_LONG_OBJ} \\
\verb|unsigned | &
    \TTKEY{attribute\_vector\_size\_of}\verb| ( min::short_obj * so )|
\LABEL{ATTRIBUTE_VECTOR_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned |
    & \TTKEY{attribute\_vector\_size\_of}\verb| ( min::long_obj * lo )|
\LABEL{ATTRIBUTE_VECTOR_SIZE_OF_LONG_OBJ} \\
\verb|unsigned |
    & \TTKEY{auxiliary\_area\_size\_of}\verb| ( min::short_obj * so )|
\LABEL{AUXILIARY_AREA_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned |
    & \TTKEY{auxiliary\_area\_size\_of}\verb| ( min::long_obj * lo )|
\LABEL{AUXILIARY_AREA_SIZE_OF_LONG_OBJ} \\
\verb|unsigned |
    & \TTKEY{unused\_area\_size\_of}\verb| ( min::short_obj * so )|
\LABEL{UNUSED_AREA_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned |
    & \TTKEY{unused\_area\_size\_of}\verb| ( min::long_obj * lo )|
\LABEL{UNUSED_AREA_SIZE_OF_LONG_OBJ} \\
\verb|unsigned | & \TTKEY{total\_size\_of}\verb| ( min::short_obj * so )|
\LABEL{TOTAL_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned | & \TTKEY{total\_size\_of}\verb| ( min::long_obj * lo )|
\LABEL{TOTAL_SIZE_OF_LONG_OBJ} \\
\end{tabular}\end{center}

Here the functions that return pointers do \underline{not} check the type
of the stub, and the total size is exactly the sum of the other four sizes.

The data structure of an object body can be viewed at any of three levels:
vector level (\secref{OBJECT-VECTOR-LEVEL}),
list level (\secref{OBJECT-LIST-LEVEL}),
and attribute level (\secref{OBJECT-ATTRIBUTE-LEVEL}).
Objects can also be
referenced indirectly using variable vectors (\secref{VARIABLE-VECTORS}).

\subsubsection{Object Vector Level}
\label{OBJECT-VECTOR-LEVEL}

At the \key{vector level}, the body is viewed as
a \key{body vector} of \verb|min::gen| values.  A pointer to the
body vector is returned by the following unprotected functions:

\begin{center}\begin{tabular}{r@{}l}
\verb|const min::gen * MUP::|
	& \MUPKEY{body\_vector\_of}\verb| ( min::short_obj * so )|
\LABEL{MUP::BODY_VECTOR_OF_SHORT_OBJ} \\
\verb|const min::gen * MUP::|
	& \MUPKEY{body\_vector\_of}\verb| ( min::long_obj * lo )|
\LABEL{MUP::BODY_VECTOR_OF_LONG_OBJ} \\
\verb|min::gen * MUP::|
	& \MUPKEY{writable\_body\_vector\_of}\verb| ( min::short_obj * so )|
\LABEL{MUP::WRITABLE_BODY_VECTOR_OF_SHORT_OBJ} \\
\verb|min::gen * MUP::|
	& \MUPKEY{writable\_body\_vector\_of}\verb| ( min::long_obj * lo )|
\LABEL{MUP::WRITABLE_BODY_VECTOR_OF_LONG_OBJ} \\
\end{tabular}\end{center}

The {\tt MUP::body\_vector\_of} function allows only reading of elements.
The {\tt MUP::\EOL writable\_\EOL body\_\EOL vector\_\EOL of}
function allows reading and writing of elements.

The body vector is divided into 5 parts,
which are, in order, the body header,
hash table, attribute vector,
unused area, and auxiliary area.
The header and unused area are not actually \verb|min::gen| values,
and should not be accessed using a body vector pointer.

The value of an \key{auxiliary pointer}\label{OBJECT-BODY-AUXILIARY-POINTER}
stored in an object body (or in an auxiliary stub attached to
the object: see~\secref{OBJECT-AUXILIARY-STUBS}) is an unsigned integer
that is the index of a \verb|min::gen|
value in the body vector.
Auxiliary pointers with zero value do not address a body vector
element, since they point into the header, and these are given
special meanings.

The indices of the beginning of the hash table and object vector
can be obtained by the following protected functions:

\begin{center}\begin{tabular}{r@{}l}
\verb|unsigned |
	& \TTKEY{hash\_table\_of}\verb| ( min::short_obj * so )|
\LABEL{HASH_TABLE_OF_SHORT_OBJ} \\
\verb|unsigned |
	& \TTKEY{hash\_table\_of}\verb| ( min::long_obj * lo )|
\LABEL{HASH_TABLE_OF_LONG_OBJ} \\
\verb|unsigned |
	& \TTKEY{attribute\_vector\_of}\verb| ( min::short_obj * so )|
\LABEL{ATTRIBUTE_VECTOR_OF_SHORT_OBJ} \\
\verb|unsigned |
	& \TTKEY{attribute\_vector\_of}\verb| ( min::long_obj * lo )|
\LABEL{ATTRIBUTE_VECTOR_OF_LONG_OBJ} \\
\end{tabular}\end{center}

\subsubsection{Object List Level}
\label{OBJECT-LIST-LEVEL}

At the \key{list level},\label{LIST-LEVEL}
the body consists of two vectors whose
elements are lists.  The two vectors are the hash table, and the
object vector.  The elements of the lists are non-auxiliary-pointer
\verb|min::gen| values (e.g., direct integers, direct strings, pointers
to stubs, and control codes)
and sublists.  The lists are constructed with
the help of the two kinds of auxiliary pointers:

\begin{indpar}
\key{list auxiliary pointer} ~~~
The list is continued at the target of the list pointer.

\key{sublist auxiliary pointer}	~~~
A sublist starts at the target of the sublist pointer.
\end{indpar}

and two constant values:

\begin{indpar}
\begin{list}{}{}
\item[{\tt const min::gen min::}\MINKEY{LIST\_END}]~\LABEL{MIN::LIST_END}\\
The list ends here.  This actually equals a list pointer with zero index.
\item[{\tt const min::gen min::}\MINKEY{EMPTY\_SUBLIST}]~%
	\LABEL{MIN::EMPTY_SUBLIST}\\
A list element value that represents an empty sublist.
This actually equals a sublist pointer with zero index.
\end{list}
\end{indpar}

Each hash table or attribute vector element is a \key{list head}.
Each list head is a \key{list continuation}, which is an element of the
body vector that has a particular interpretation.  However, not all
list continuations are list heads.

A list continuation represents a final segment of a list.
If it has the value \verb|min::LIST_END|, the list has
no more elements, and may be empty if it has no previous elements.
If the list continuation has a list pointer value,
that pointer points at another list continuation that continues the list.
Otherwise the list continuation represents an element of the list,
and is called a \key{list element}.

Given a list element, the rest of the list after the element begins with
a list continuation that has an index one greater than that of the list
element within the object body vector, unless the list element is a
list head, in which case there is no next element, and the list has only
one element.  All list heads lie in the hash table or attribute vector,
so testing whether a list element is a list head can be done if just the
index of the list element in the body vector is known.

A list element may be a non-auxiliary-pointer \verb|min::gen|
value, such as a direct number, direct string, control code, or
stub pointer.  None of these represent sublists.  A list element
that is an auxiliary sublist pointer or the value \verb|min::EMPTY_SUBLIST|
represents a sublist, and is the \key{sublist head} of that sublist.  A
sublist head is a list element of the list containing a sublist,
but cannot be a list element of the sublist.  If it is a sublist pointer,
it points at a list continuation of the sublist.  If it is the
value \verb|min::EMPTY_SUBLIST|, it represents an empty sublist.

Parts of lists may not be shared with other lists.  In other words,
there is only one way to reach any element of the auxiliary area.
Or more specifically,
auxiliary pointers must point at elements of the auxiliary area,
two auxiliary pointers are not permitted to point at the same auxiliary
area element, and an auxiliary area element that is preceded
in the auxiliary area by a list element may not be pointed at by
an auxiliary pointer.

Thus if the one way to reach an element of
the auxiliary area is deleted, the element may be put on a list of
free elements for the auxiliary area.  As an optimization,
an implementation may use the
free area to hold the head of a list of free elements of the auxiliary
area.

As an optimization, \skey{auxiliary stub}s can be used in place of object
auxiliary area elements.  When this is done, the description of this
section must be modified as explained in \secref{OBJECT-AUXILIARY-STUBS}.

\subsubsubsection{List Pointers}
\label{LIST-POINTERS}

A \MUPkey{list\_pointer} can be used to move around in a object at
the list level.  The functions for using a list pointer are:

\begin{center}\begin{tabular}{r@{}l}
(constructor)~\verb|MUP::|
	& \MUPKEY{list\_pointer}\verb| ( min::stub * s )|
\LABEL{MUP::LIST_POINTER_OF_STUB} \\
(constructor)~\verb|MUP::|
	& \MUPKEY{list\_pointer}\verb| ( min::gen obj )|
\LABEL{MUP::LIST_POINTER_OF_GEN} \\
\verb|min::gen |
	& \TTKEY{start\_hash}%
	  \verb| ( min::list_pointer & lp, unsigned index )|
\LABEL{START_HASH} \\
\verb|min::gen |
	& \TTKEY{start\_vector}%
	  \verb| ( min::list_pointer & lp, unsigned index )|
\LABEL{START_VECTOR} \\
\verb|min::gen |
	& \TTKEY{start\_copy}%
	  \begin{tabular}[t]{@{}l@{}}
	  \verb| ( min::list_pointer & lp,| \\
	  \verb|   min::list_pointer & lp2 )|
	  \end{tabular}
\LABEL{START_COPY} \\
\verb|min::gen |
	& \TTKEY{next}\verb| ( min::list_pointer & lp )|
\LABEL{NEXT_OF_LIST_POINTER} \\
\verb|min::gen |
	& \TTKEY{current}\verb| ( min::list_pointer & lp )|
\LABEL{CURRENT_OF_LIST_POINTER} \\
\verb|min::gen |
	& \TTKEY{start\_sublist}\verb| ( min::list_pointer & lp )|
\LABEL{START_SUBLIST} \\
\verb|bool min::|
	& \MINKEY{is\_list\_end}\verb| ( min::gen v )|
\LABEL{MIN::IS_LIST_END} \\
\verb|bool min::|
	& \MINKEY{is\_sublist}\verb| ( min::gen v )|
\LABEL{MIN::IS_SUBLIST} \\
\verb|void |
	& \TTKEY{insert\_before}\verb| ( min::list_pointer & lp, min::gen v )|
\LABEL{INSERT_BEFORE} \\
\verb|void |
	& \TTKEY{insert\_after}\verb| ( min::list_pointer & lp, min::gen v )|
\LABEL{INSERT_AFTER} \\
\end{tabular}\end{center}

A list pointer is created to move around in a particular object.
Once created it can be started on a new list by one of the
list \skey{start list function}s,
{\tt start\_hash}, {\tt start\_vector}, or {\tt start\_copy}
(note {\tt start\_sublist} is \underline{not} a start list function).
If the object is relocated,
the list pointer must be reinitialized by re-calling
the a start list function.  Relocating an object
can also reorganize the object, in which case body vector indices pointing
into the auxiliary area may change, invalidating positioning information
contained in any list pointer pointing into the object.

The {\tt start\_hash} function positions a list pointer at the beginning of a
list whose head is at the given index in the hash table, treating the
hash table as a vector.  This function returns the value of the first
element of the list, or returns {\tt min::LIST\_END} if the list is empty.

The {\tt start\_vector} function is analogous except it is given
an index in the object attribute vector and positions the list pointer
at the beginning of a list whose head is in that vector.

The {\tt start\_copy} function positions a list pointer to the same place
as another list pointer.  The two list pointers must have been
constructed to reference the same object.

The {\tt next} function moves the list pointer to the next list element of the
list the pointer points at, and returns the value of that
list element.  It returns {\tt min::LIST\_END} if there is
no list element because the end of the list has been reached.
After the end of a list has been reached, additional
calls to {\tt next} will do nothing but return {\tt min::LIST\_END}.

The {\tt current} function just returns the value of the list
element the list pointer currently points at, or returns {\tt min::LIST\_END}
if there is no such element because the pointer is at the end of a list.

The value of a list element can represent a sublist.  When a list pointer
points at a list element representing a sublist, the
{\tt start\_sublist} function can be called to position the
list pointer at the first element of the sublist.
This function returns the value of the first element of
the sublist, or returns {\tt min::LIST\_END} if the sublist is empty.

If {\tt start\_sublist} is called when the list pointer points at an
element E that is not a sublist, and is not the end of a list, then
the element is treated as a sublist with exactly one element, E.



Determining whether a list element value represents a sublist requires
the {\tt min::is\_sublist} function, which must check whether the
value is a sublist auxiliary pointer, is the value {\tt min::EMPTY\_SUBLIST},
or is a pointer to a sublist auxiliary stub as described in
\secref{OBJECT-AUXILIARY-STUBS}.

Determining whether a value represents the end of a list can be done by
simply checking whether the value equals {\tt min::LIST\_END},
or can be done with the {\tt min::is\_list\_end} function.

The {\tt insert\_before} function inserts a list element with a given
value just before the current position of a list pointer.
The {\tt insert\_after} function inserts a list element just after the
current position.  If the list pointer is at the end of list,
{\tt insert\_before} inserts the element at the end of the list, and
{\tt insert\_after} is an error.  The list pointer continues to point
at the list element it pointed at before the element was inserted.

If there are several list pointers,
and one is used to insert an element after a element of a list,
or to insert an element before the end of a list,
the other list pointers are not affected.  In particular, other
list pointers pointing at the end of the list will continue to point
at the end of the list.  In addition, other lists pointers pointing
into sublists of the list or superlists containing the list are not affected.

If there are several list pointers,
and one is used to insert an element X before a element Y of a list,
and Y is not the end of the list, all list pointers pointing at Y
will be re-pointed at X, and all other list pointers will not be affected.

\begin{quote}
\key{List Implementation Note}:\label{LIST-IMPLEMENTATION-NOTE}
Insertion in general replaces an element E by a list pointer that
points at a pair of elements, one of which is E, followed by
a list pointer back to the element originally after E in the list.
The special cases all concern pointers pointing at the end of a list;
these can be marked as being end pointers, and made to continue to point
at the end of the list no matter how the list is changed.
\end{quote}

\subsubsubsection{Object Auxiliary Stubs}
\label{OBJECT-AUXILIARY-STUBS}

As an optimization, \skey{object auxiliary stub}s\index{auxiliary stub!object}
can be used instead of object
auxiliary area elements.  Object auxiliary stubs are a way of adding elements to
an object whose unused area has been exhausted, without relocating the
object, and are considered to be \skey{extension}s of the object.
If the object is later relocated, it can be reorganized to
eliminate the use of object auxiliary stubs extending the object
by moving information from these into a new larger object auxiliary area.

The value of an object
auxiliary stub is treated as an auxiliary area element value.
The chain pointer of an object auxiliary stub is treated as the next auxiliary
area element after the value of the stub.  This chain pointer
has a value that is treated as a list pointer or as a
\verb|min::LIST_END| value.  A chain pointer that points at another
auxiliary stub is treated as a list pointer pointing at that stub.
A chain pointer can also hold an auxiliary pointer value that is
list pointer pointing back into
the auxiliary area of the object the auxiliary stub extends.

An object auxiliary stub has one of the following two uncollectible stub type
codes:

\begin{indpar}
\begin{list}{}{}
\item[{\tt const int min::}\MINKEY{LIST\_AUXILIARY}]~%
	\LABEL{MIN::LIST_AUXILIARY}\\
A \verb|min::gen| value pointing at this stub behaves like a list pointer.
\item[{\tt const int min::}\MINKEY{SUBLIST\_AUXILIARY}]~%
	\LABEL{MIN::SUBLIST_AUXILIARY}\\
A \verb|min::gen| value pointing at this stub behaves like a sublist pointer.
\end{list}
\end{indpar}

Stubs with the first type code are called
\skey{list auxiliary stub}s,\index{auxiliary stub!list}
and those with the second type code are called
\skey{sublist auxiliary stub}s.\index{auxiliary stub!sublist}

With these definitions, the description of the list level of an object
given in \secref{OBJECT-LIST-LEVEL} is modified as follows.
A \verb|min::gen| value that points at list auxiliary stub is
treated as a list pointer.
A \verb|min::gen| value that points at sublist auxiliary stub is
treated as a sublist pointer.

Therefore a \verb|min::gen| value pointing at a list auxiliary stub
cannot be a list element value, and
a \verb|min::gen| value pointing at a sublist auxiliary stub
is a list element value that represents a sublist.

If an object auxiliary stub is pointed at by a chain pointer in another
object auxiliary stub, the first stub must be a list auxiliary stub.

An object auxiliary stub can be pointed at by only one pointer stored in an
object or in some object auxiliary stub extending an object.
Thus object auxiliary
stubs can be freed as soon as the pointer to them is deleted.  This
mechanism, and not garbage collection, frees object auxiliary stubs.

The use of object auxiliary stubs by an implementation is hidden from
the user of MIN by object list level functions.  There are no functions
for dealing explicitly with object auxiliary stubs.  There are, however,
functions to read and write auxiliary stubs of all kinds in
\secref{STUB-FUNCTIONS}, though the only use of these functions on
object auxiliary stubs would be for debugging.

\subsubsection{Object Attribute Level}
\label{OBJECT-ATTRIBUTE-LEVEL}

At the \key{attribute level}, the object is a map from attribute names
to attribute flags and from attribute name/reverse-name pairs to
multi-sets of values.  This map is stored in a set of lists which
are entries in the hash table or attribute vector.  These lists have
the syntax:

\begin{center}
\begin{tabular}{l}
\emkey{hash-table-entry} ::= {\em map-sublist}
\\[1ex]
\emkey{attribute-vector-entry} ::= {\em segment-entry}
\\[1ex]
\emkey{map-sublist} ::= {\em map-pair}$^\star$
\\[1ex]
\emkey{map-pair} ::= {\em name-component } {\em segment-entry}
\\[1ex]
\emkey{name-component} ::= {\em atom }
\\[1ex]
\emkey{segment-entry} ::= {\em value} $|$ {\em segment-sublist}
\\[1ex]
\emkey{segment-sublist}
    \begin{tabular}[t]{@{}r@{~}l@{}}
    ::= & {\em flag-set}
	  {\em value}$^\star$ \\
    $|$ & {\em map-sublist}
	  {\em reverse-attribute-map-sublist-option}
	  {\em flag-set}
	  {\em value}$^\star$ \\
    \end{tabular}
\\[1ex]
\emkey{flag-set} ::= {\em control-code}$^\star$
\\[1ex]
\emkey{value} ::= {\em atom} $|$ {\em object} $|$ {\em label} $|$ {\em index}
\\[1ex]
\emkey{reverse-attribute-map-sublist} ::= {\em map-pair}$^\star$
\end{tabular}
\end{center}

Here the syntactic categories represent \verb|min::gen| values or lists
of \verb|min::gen| values in the sense of the object list level.

An {\em atom} is a \verb|min::gen| value representing a number or string,
a {\em control-code} is a \verb|min::gen| control code value,
an {\em object} is a \verb|min::gen| value pointing at an object stub,
a {\em label} is a \verb|min::gen| value pointing at a label stub,
and an {\em index} is a \verb|min::gen| index value.
All these are list elements but not lists.

An {\em X-list} is a list, in the sense of the object list level.

An {\em X-sublist} is a sublist, in the sense of the object list level, which
is to say it is a list that is an element of another list.

An {\em X-option} is an optional element of a list that is an {\em X} if
it is not omitted.

An object is represented by a map which maps attribute names to flags and
multisets of values and maps attribute name/reverse name pairs to multisets
of values.
This map is based on the following search algorithm, which starts from
an attribute name and an optional reverse attribute name, and returns
a set of flags and a set of values.  Note that if no reverse attribute
name is given, only values \underline{not}
associated with \underline{any} reverse attribute name are returned by
this search algorithm.

\begin{enumerate}

\item Let $N$ be the attribute name.

\item Let $C$ be the first {\em name-component} of $N$.

\item If $C$ is an integer from 1 through the size of the attribute
vector, inclusive, let $E$ be the attribute vector entry with index $C$
($E$ is a {\em segment-entry}) and go to step 6.

\item Otherwise let $H$ be the hash value of $C$ modulo the size of
the hash table.  Let $M$ be the hash table entry with index $H$.

\item $M$ is a {\em map-sublist}.  Look through the {\em map-pairs} in this
list for one whose {\em name-component} equals $C$.  If none is found,
the search fails.
If one is found, let $E$ be the {\em segment-entry} part of the {\em map-pair}.

\item $E$ is a {\em segment-entry}. If $E$ is a {\em value}, and not a sublist,
the search terminates as follows.
If $C$ is not the last name component of $N$, or $N$ is the attribute name
and the reverse attribute name has been given, then the search fails.
Otherwise the search returns no flags and returns $E$ as a single value.

\item $E$ is a {\em segment-sublist}.
If $C$ is the last component of $N$, and $N$ is the reverse attribute
name or no reverse attribute name was given, the search terminates.
Any sublists beginning $E$ are skipped over (these will be {\em map-sublists}
and {\em reverse-attribute-map-sublists}).  Any
{\em control-codes} next encountered are returned as flags.  Any {\em values}
following these are returned as the set of values.

\item
If $E$ does not begin with a sublist, or if $C$ is the
last component of the attribute name and $E$ does not begin with two sublists,
the search fails.

\item
If $C$ is not the last component of $N$, replace $C$ by the next
component of $N$, replace $M$ by the sublist beginning $E$, and go to step 5.

\item
If $C$ is the last component of $N$ (which must be the attribute
name) replace $N$ by the reverse attribute name, $C$ by the first component
of the reverse attribute name, $M$ by the second of the two sublists
beginning $E$, and go to step 5.

\end{enumerate}

\ikey{Attribute flags}{attribute flag!representation}\label{ATTRIBUTE-FLAGS}
are represented by a {\em flag-set} in an {\em segment-sublist}.
The {\em flag-set} is a sequence of \verb|min::gen|
control codes.

The flags are numbered 0, 1, 2, \ldots.  Flag $N$ corresponds to
the bit in the $I$'th control code
selected by the mask $2^K$ where $I=\mbox{floor}(N/B)+1$,
$K=N~\mbox{mod}~B$, and $B$ is the
number of bits in a control code integer.  $B$ is 24 if \verb|min::gen|
values are 32-bits, and 44 if \verb|min::gen| values are 64-bits.

A flag is set for an attribute name if and only if its corresponding
bit is present and set in the {\em flag-set} found by a search given
just the attribute name and no reverse attribute name.

A search that is given both an attribute name and a reverse attribute
name should never find a non-empty {\em flag-set} or return any flags.

\subsubsubsection{Attribute Functions}
\label{ATTRIBUTE-FUNCTIONS}

The following are the basic protected functions that access attributes:

\begin{center}\begin{tabular}{r@{}l}
\verb|unsigned min::| & \MINKEY{countg}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::gen obj,| \\
    \verb|   min::gen name, min::gen reverse_name )|
    \end{tabular}
\LABEL{MIN::COUNTG} \\
\verb|unsigned min::| & \MINKEY{getg}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::gen * out, unsigned n,| \\
    \verb|   min::gen obj,| \\
    \verb|   min::gen name, min::gen reverse_name )|
    \end{tabular}
\LABEL{MIN::GETG} \\
\verb|unsigned min::| & \MINKEY{get\_flagsg}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::uns32 * out, unsigned n,| \\
    \verb|   min::gen obj,| \\
    \verb|   min::gen name )|
    \end{tabular}
\LABEL{MIN::COUNT_FLAGSG} \\
\verb|void min::| & \MINKEY{setg\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( const min::gen * in, unsigned n,| \\
    \verb|   min::gen obj,| \\
    \verb|   min::gen name, min::gen reverse_name )|
    \end{tabular}
\LABEL{MIN::GET_FLAGSG} \\
\verb|unsigned min::| & \MINKEY{count\_flagsg}%
    \verb| ( min::gen obj, min::gen name )|
\LABEL{MIN::SETG} \\
\verb|void min::| & \MINKEY{set\_flagsg\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( const min::uns32 * in, unsigned n,| \\
    \verb|   min::gen obj,| \\
    \verb|   min::gen name )|
    \end{tabular}
\LABEL{MIN::SET_FLAGSG} \\
\end{tabular}\end{center}

The {\tt countg} function returns the number of values for a given
object, attribute name, and reverse attribute name.  Attribute names
and reverse attribute names can be atoms or attribute labels.  The
reverse attribute name can also be the special value {\tt min::MISSING},
in which case the count is returned of values with the attribute name
with no reverse attribute name, or the special value {\tt min::ANY},
in which case the count is returned of values with the attribute name
and \underline{any or no} reverse attribute name.

The {\tt getg} function gets the values which {\tt countg} counts.
The values are stored in the {\tt out} vector.  The number of values
stored is the function return value.  The argument {\tt n} is the
maximum number of values that may be returned, the length of {\tt out}.
If there are more then {\tt n} values, only {\tt n} values are returned.

The {\tt count\_flagsg} function returns the length of the smallest
\verb|min::uns32| vector required to store all the set flags for a given
object and attribute name.  It returns {\tt 0} if no flags are set.
The attribute name can be an atom or an attribute label.

The {\tt get\_flagsg} function returns flags in the \verb|min::uns32|
vector vector {\tt out} for a given object and attribute name.
The return value is the same as that of {\tt count\_flagsg} if this is
not greater than {\tt n}, or is {\tt n} otherwise, and is in any case
the number of elements of the vector {\tt out} written.
The argument {\tt n} is the maximum number of elements that
may be written, the length of {\tt out}.
In the {\tt out} vector, flag $N$ is the bit selected by mask $2^K$
in the vector element with index $I$, where $K=N~\mbox{mod}~32$ and
$I=\mbox{floor}(N/32)$.

The {\tt setg} function sets the values for a given
object, attribute name, and reverse attribute name.  All the previous
values are deleted.  The values are given in the {\tt in} vector, and
the number of values is given in {\tt n}.  If {\tt n} is zero, all
values are deleted.

If the reverse name argument to {\tt setg} is \verb|min::MISSING|,
the values deleted or set represent single arrows.

If the reverse name is not
\verb|min::MISSING|, the values deleted or set may have reverse attribute
names and represent double arrows.  In this case,
let the object be $O_1$, the attribute name be $N$, and the reverse
attribute name be $R$.  If a value $O_2$ is set (or deleted), the value
$O_1$ will also be set (or deleted) from the attribute named $R$ with
reverse attribute name $N$ of the object $O_2$.  That is, the other end of
the double arrow will also be set (or deleted).

If the reverse name argument to {\tt setg} is \verb|min::ANY|,
{\tt n} must be zero, and all values with the attribute name and any
or no reverse attribute name will be deleted.

The {\tt set\_flagsg} function sets the flags for a given
object and attribute name.  The flags are given in the {\tt in} vector which
has length {\tt n}.  All flags are zeroed before the new set of flags
is written.  If {\tt n} is zero, all flags are zeroed.

The following functions are more optimized versions of the above
functions for the special case that the attribute has, or should
have, only one value:

\begin{center}\begin{tabular}{r@{}l}
\verb|min::gen min::| & \MINKEY{getg}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::gen obj,| \\
    \verb|   min::gen name, min::gen reverse_name )|
    \end{tabular}
\LABEL{MIN::GETG1} \\
\verb|void min::| & \MINKEY{setg\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( const min::gen v,| \\
    \verb|   min::gen obj,| \\
    \verb|   min::gen name, min::gen reverse_name )|
    \end{tabular}
\LABEL{MIN::SETG1} \\
\end{tabular}\end{center}

This version of the {\tt getg} function returns the single value $V$ if
the set of values for object, attribute name, and reverse attribute name
consists of a single value $V$.  If the set is empty, the special value
\verb|min::MISSING| (\pagref{MIN::MISSING}) is returned,
and if the set has more than one value, the special value
\verb|min::MULTI_VALUED| (\pagref{MIN::MULTI_VALUED}) is returned.
The reverse attribute name can be \verb|min::MISSING| or \verb|min::ANY|.

This version of the {\tt setg} function deletes any previous values of
the object, attribute name, and reverse attribute name,
and makes the one value {\tt v} the only value of the object,
attribute name, and reverse attribute name.  But if {\tt v} is
\verb|min::MISSING|, all previous values are deleted and no values
are added.  The reverse attribute name cannot be \verb|min::ANY| unless
{\tt v} is \verb|min::MISSING|.


The following functions may be used to add one value to the set of values of an
object, attribute name, and reverse attribute name:

\begin{center}\begin{tabular}{r@{}l}
\verb|void min::| & \MINKEY{add\_to\_setg\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( const min::gen v,| \\
    \verb|   min::gen obj,| \\
    \verb|   min::gen name, min::gen reverse_name )|
    \end{tabular}
\LABEL{MIN::ADD_TO_SETG} \\
\verb|void min::| & \MINKEY{add\_to\_multisetg\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( const min::gen v,| \\
    \verb|   min::gen obj,| \\
    \verb|   min::gen name, min::gen reverse_name )|
    \end{tabular}
\LABEL{MIN::ADD_TO_MULTISETG} \\
\end{tabular}\end{center}

The {\tt add\_to\_set} function adds {\tt v} to the set of
values if and only if {\tt v} is not already in the set,
using {\tt ==} to compare values for equality.
The {\tt add\_to\_multiset} function adds {\tt v} even if the
value is already in the set.
The reverse attribute name can be \verb|min::MISSING|
but cannot be \verb|min::ANY|.

The following functions may be used to set, or clear, or flip
the flags turned on in the input vector:

\begin{center}\begin{tabular}{r@{}l}
\verb|void min::| & \MINKEY{set\_some\_flagsg\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( const min::uns32 * in, unsigned n,| \\
    \verb|   min::gen obj, min::gen name )|
    \end{tabular}
\LABEL{MIN::SET_SOME_FLAGSG} \\
\verb|void min::| & \MINKEY{clear\_some\_flagsg\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( const min::uns32 * in, unsigned n,| \\
    \verb|   min::gen obj, min::gen name )|
    \end{tabular}
\LABEL{MIN::CLEAR_SOME_FLAGSG} \\
\verb|void min::| & \MINKEY{flip\_some\_flagsg\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( const min::uns32 * in, unsigned n,| \\
    \verb|   min::gen obj, min::gen name )|
    \end{tabular}
\LABEL{MIN::FLIP_SOME_FLAGSG} \\
\end{tabular}\end{center}

The following functions may be used to test, set, or clear, or flip
individual flag number {\tt n}:

\begin{center}\begin{tabular}{r@{}l}
\verb|bool min::| & \MINKEY{test\_flagg\REL}%
    \verb| ( unsigned n, min::gen obj, min::gen name )|
\LABEL{MIN::TEST_FLAGG} \\
\verb|void min::| & \MINKEY{set\_flagg\REL}%
    \verb| ( unsigned n, min::gen obj, min::gen name )|
\LABEL{MIN::SET_FLAGG} \\
\verb|void min::| & \MINKEY{clear\_flagg\REL}%
    \verb| ( unsigned n, min::gen obj, min::gen name )|
\LABEL{MIN::CLEAR_FLAGG} \\
\verb|void min::| & \MINKEY{flip\_flagg\REL}%
    \verb| ( unsigned n, min::gen obj, min::gen name )|
\LABEL{MIN::FLIP_FLAGG} \\
\end{tabular}\end{center}

The following variants exist for functions of this section:

\begin{enumerate}

\item Functions
which have a \verb|min::gen| {\tt name} argument
have versions with a \verb|int| {\tt name} argument.  However,
the functions with \verb|min::gen| {\tt name} argument have function
names ending in `{\tt g}', whereas the functions with
\verb|int| {\tt name} argument have names that are the same except the
ending `{\tt g}' is replaced by `{\tt i}'.  Thus there are functions named
\minkey{counti},
\minkey{geti},
\minkey{count\_flagsi},
\minkey{get\_flagsi},
\minkey{seti},
\minkey{set\_\EOL flagsi},
\minkey{add\_\EOL to\_\EOL seti},
and
\minkey{add\_\EOL to\_\EOL multiseti}.\label{G_TO_I_VARIANTS}
This is done as in many
implementations \verb|int| may be implicitly convertible to \verb|min::gen|
by an improper conversion that gives the wrong result.\footnote{
For example, if the implementation defines {\tt min::gen} to be
{\tt min::uns64}.}

\item Functions\label{MIN::GEN_REPLACED_BY_MIN::STUB}
which have {\tt reverse\_name} as a last argument
have versions without this last argument, which act as
if the value \verb|min::MISSING| were given to this argument.

\item Functions\label{REVERSE_NAME_OMITTED}
which have a \verb|min::gen| {\tt obj} argument also have
versions with a \verb|min::stub *| {\tt obj} argument.

\end{enumerate}

\subsection{Variable Vectors}
\label{VARIABLE-VECTORS}

A variable vector is used to represent a set of objects whose structure
is fixed but whose attribute values are variable.  The vector elements
are variables.  By convention each vector has an associated set of constant
objects whose attribute values are indirect pointers to the variables in
the vector.

Thus a vector represents a labeled graph.  There is one variable for
each node of the graph.  That variable may point at an object that
defines the labeled arrows sourced at the node.  Or the variable may be
set to a number or string that is the value of a leaf node that sources
no arrows.  Or the variable may be set to the special value
\minkey{NULL} that indicates the node is not yet defined, and might
later become either a source of arrows or a leaf.

When a variable $X$
points at an object, and $N$ is the name of an attribute of the object,
values for attribute $N$ of the object
are the indeces of variables in the vector
that represent nodes one gets to when one starts at $X$ and follows
arrows labeled $N$.

Typically the vector variable with index {\tt 0} points at the object which
is the root of the labelled graph represented by a variable vector.

As the objects are constant, and the same objects
may be used with many different variable vectors.  Thus
one can think of the variable vector as a structure and the objects as the
type of the structure.

Variable vectors must be initialized with values for each variable.  If a
vector represents a graph some of whose nodes source no arrows and have
no string or number associated with them, the variables of these nodes are
given the initial value \minkey{NULL},
which signifies a node that is not defined
yet.  These variables can be set later to define their nodes.

A primary use of variable vectors is with graphs that are to be unified.
In the process of unification some graph nodes are set to indirect pointers
to other graph nodes, so every reference to nodes so set is forwarded to
the target of the indirect pointers.  Therefore, since variables represent
graph nodes, a variable in a variable
vector can store an indirect pointer at another variable in another variable
vector, so that all references to the variable storing the indirect pointer
are forwarded to the pointer's target variable.

Objects associated with a variable vector can have attribute values that
are not indices, but are instead numbers, strings, or pointers other
objects associated with the vector.  Such attribute values are
not variable and cannot be indirected by unification algorithms.

Thus in summary, a variable vector is a vector whose elements are variables,
and whose element indices are unsigned integers beginning at {\tt 0}.  Each
variable can store either a \verb|min::gen| value, or an indirect pointer
at some variable in some variable vector.

A variable vector is structured somewhat like an object (\secref{OBJECTS}).
It has a body that consists of the following 4 parts in the order given:

\begin{center}
\begin{tabular}{l}
header \\
variable vector \\
unused area\\
auxiliary area
\end{tabular}
\end{center}

The header contains the sizes of the other 3 parts.
The \key{variable vector} stores the variables.  The \key{auxiliary area}
stores overflow data from the variable vector.

The variable vector
grows up from the end of the header into the unused
area, and the auxiliary storage grows down from the end of the body into
the unused area.

The header of a variable vector stores 32 bit sizes; variable vectors are
all like long objects in this respect, and there is no variable vector
analogue of short objects.

A \key{variable vector stub}\label{VARIABLE-VECTOR-STUB} is collectible, has
\minkey{VARIABLE\_VECTOR}\LABEL{MIN::VARIABLE_VECTOR} stub type code, and has
a value that is a pointer to a \minkey{variable\_vector} type body
which holds the 4 parts of the object.
The header consists of 3 32-bit unsigned integers which are, in order:

\begin{center}
\begin{tabular}{lllllllll}
header size & + & variable vector size \\
header size & + & variable vector size
	& + & unused area size \\
header size & +  & variable vector size
	& + & unused area size \\
        & + & auxiliary area size \\
	& = & header size & + & total size
\end{tabular}
\end{center}

The header may contain other implementation dependent information used
for optimization.

All sizes are in units of \verb|min::gen| values.  Aside from its header,
the variable vector body is just a vector of \verb|min::gen| values.  The total
size does \underline{not} include the header.

A pointer to the body and the sizes can be obtained by the following
functions:

\begin{center}\begin{tabular}{r@{}l}
\verb|min::variable_vector * MUP::| &
	\MUPKEY{variable\_vector\_of}\verb| ( min::stub * s )|
\LABEL{MUP::VARIABLE_VECTOR_OF} \\
\verb|unsigned | &
    \TTKEY{variable\_vector\_size\_of} \\
    & \verb|    ( min::variable_vector * vv )|
\LABEL{VARIABLE_VECTOR_SIZE_OF_VARIABLE_VECTOR} \\
\verb|unsigned |
    & \TTKEY{auxiliary\_area\_size\_of} \\
    & \verb|    ( min::variable_vector * vv )|
\LABEL{AUXILIARY_AREA_SIZE_OF_VARIABLE_VECTOR} \\
\verb|unsigned |
    & \TTKEY{unused\_area\_size\_of} \\
    & \verb|    ( min::variable_vector * vv )|
\LABEL{UNUSED_AREA_SIZE_OF_VARIABLE_VECTOR} \\
\verb|unsigned | & \TTKEY{total\_size\_of} \\
    & \verb|    ( min::variable_vector * vv )|
\LABEL{TOTAL_SIZE_OF_VARIABLE_VECTOR} \\
\end{tabular}\end{center}

Here the function that returns a pointer does \underline{not} check the type
of the stub, and the total size is exactly the sum of the other three sizes.

The data structure of a variable vector body can be viewed at any of
two levels:
vector level (\secref{VARIABLE-VECTOR-VECTOR-LEVEL})
and variable level (\secref{VARIABLE-VECTOR-VARIABLE-LEVEL}).

\subsubsection{Variable Vector Vector Level}
\label{VARIABLE-VECTOR-VECTOR-LEVEL}

At the \key{vector level}\,, the variable vector body is viewed as
a \key{body vector} of \verb|min::gen| values.  A pointer to the
body vector is returned by the following unprotected functions:

\begin{center}\begin{tabular}{@{}r@{}l@{}}
\verb|const min::gen * MUP::|
	& \MUPKEY{body\_vector\_of}\verb| ( min::variable_vector * vv )|
\LABEL{MUP::BODY_VECTOR_OF_VARIABLE_VECTOR} \\
\verb|min::gen * MUP::|
	& \MUPKEY{writable\_body\_vector\_of}%
		\verb| ( min::variable_vector * vv )|
\LABEL{MUP::WRITABLE_BODY_VECTOR_OF_VARIABLE_VECTOR} \\
\end{tabular}\end{center}

The {\tt MUP::body\_vector\_of} function allows only reading of elements.
The {\tt MUP::\EOL writable\_\EOL body\_\EOL vector\_\EOL of}
function allows reading and writing of elements.

The body vector is divided into 4 parts,
which are, in order, the body header,
variable vector, unused area, and auxiliary area.
The header and unused area are not actually \verb|min::gen| values,
and should not be accessed using a body vector pointer.

The value of an auxiliary pointer
is an unsigned integer of which part is the index of a \verb|min::gen|
value in the body vector.  This is distinct from the use of
auxiliary pointers in objects, as in that case the entire auxiliary pointer
integer is the index.
Details are below in \secref{VARIABLE-VECTOR-VARIABLE-LEVEL}.

The index of the beginning of the variable vector part of a variable vector
can be obtained by the following protected function:

\begin{center}\begin{tabular}{r@{}l}
\verb|unsigned |
	& \TTKEY{variable\_vector\_of}\verb| ( min::variable_vector * vv )|
\LABEL{VARIABLE_VECTOR_OF_VARIABLE_VECTOR} \\
\end{tabular}\end{center}

\subsubsection{Variable Vector Variable Level}
\label{VARIABLE-VECTOR-VARIABLE-LEVEL}

At the \key{variable level},\label{VARIABLE-LEVEL}
the body of a variable vector consists of a vector of variables.
Each variable stores a \verb|min::gen| value, or an auxilarly pointer
that represents an indirect pointer to another variable in the same
variable vector or in some other variable vector.  An indirect pointer
is a pair consisting of a pointer to a variable vector and an index
of a variable in that vector.  Variable vectors use two kinds
\skey{auxiliary pointer}s to represent indirect pointers:%
\label{VARIABLE-VECTOR-AUXILIARY-POINTER}

\begin{indpar}
\key{indirect pair auxiliary pointer} ~~~
This is an auxiliary pointer that points at an \key{indirect pair},
which is a pair of \verb|min::gen| values the first of which points at
a variable vector and the second of which is an index \verb|min::gen| value
that is the index of a variable in the vector pointed at.
The indirect pair is stored in auxilarly memory, and the entire indirect
pair pointer integer value is the index in auxiliary memory
of the first \verb|min::gen| value of the indirect pair.

\key{indirect indexed auxiliary pointer} ~~~
The integer value of this auxiliary value is
split evenly into two parts.  For 32-bit general values each part is
12 bits, whereas for 64-bit general values each part is 20 bits.  The high
order part is the index in auxiliary memory of a \verb|min::gen| value that
is the pointer to the variable vector.  The low order part is the index of
a variable in that vector.  As a special case, if the high order part
is zero, the variable vector is that same as the variable vector containing
the auxiliary pointer.
\end{indpar}

Indirect indexed pointers are used when the integers that must be stored
will fit into them.  Otherwise indirect pair pointers are used.  An
implementation typically allocates enough auxiliary memory to a new variable
vector to permit every variable to efficiently store an indirect pointer.
After the variable vector has aged, it may be reorganized during garbage
collection to minimize use of auxiliary memory.

\subsubsubsection{Variable Pointers}
\label{VARIABLE-POINTERS}

Variable vectors are accessed at the variable letter
by using \skey{variable pointer}s.

A \MUPkey{variable\_pointer} is used to move around in objects at
the variable level, and get or set the values of variables.  A variable
pointer points at a variable in a variable vector.
The functions for using a variable pointer are:

\begin{indpar}\begin{tabular}{r@{}l}
(constructor)~\verb|MUP::|
	& \MUPKEY{variable\_pointer}\verb| ( )|
\LABEL{MUP::VARIABLE_POINTER} \\
\end{tabular}\end{indpar}
\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::gen min::| & \MINKEY{point}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::variable_pointer & vp,| \\
    \verb|   min::gen vector, unsigned index )|
    \end{tabular}
\LABEL{POINT_VARIABLE_POINTER} \\
\verb|void min::|
	& \TTKEY{clear}\verb| ( min::variable_pointer & vp )|
\LABEL{CLEAR_VARIABLE_POINTER} \\
\verb|void min::|
	& \TTKEY{relocate}\verb| ( min::variable_pointer & vp )|
\LABEL{RELOCATE_VARIABLE_POINTER} \\
\end{tabular}\end{indpar}
\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::gen min::|
	& \TTKEY{get}\verb| ( min::variable_pointer & vp )|
\LABEL{GET_VARIABLE_POINTER} \\
\verb|void min::|
	& \TTKEY{set}\verb| ( min::variable_pointer & vp, min::gen value )|
\LABEL{SET_VARIABLE_POINTER} \\
\verb|min::gen min::| & \MINKEY{indirect\REL}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::variable_pointer & vp1,| \\
    \verb|   min::variable_pointer & vp2 )|
    \end{tabular}
\LABEL{MIN::INDIRECT_VARIABLE_POINTER} \\
\end{tabular}\end{indpar}
\begin{indpar}\begin{tabular}{r@{}l}
\verb|min::gen min::| & \MINKEY{moveg}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::variable_pointer & vp,| \\
    \verb|   min::gen name )|
    \end{tabular}
\LABEL{MIN::MOVEG_VARIABLE_POINTER} \\
\verb|min::gen min::| & \MINKEY{move}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::variable_pointer & vp,| \\
    \verb|   unsigned index )|
    \end{tabular}
\LABEL{MOVE_VARIABLE_POINTER} \\
\verb|unsigned min::| & \MINKEY{countg}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::variable_pointer & vp,| \\
    \verb|   min::gen name, min::gen reverse_name )|
    \end{tabular}
\LABEL{MIN::COUNTG_OF_VARIABLE_POINTER} \\
\end{tabular}\end{indpar}
\begin{indpar}\begin{tabular}{r@{}l}
\verb|unsigned min::| & \MINKEY{getg}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::gen * out, unsigned n,| \\
    \verb|   min::variable_pointer & vp,| \\
    \verb|   min::gen name, min::gen reverse_name )|
    \end{tabular}
\LABEL{MIN::GETG_OF_VARIABLE_POINTER} \\
\verb|min::gen min::| & \MINKEY{getg}%
    \begin{tabular}[t]{@{}l@{}}
    \verb| ( min::variable_pointer & vp,| \\
    \verb|   min::gen name, min::gen reverse_name )|
    \end{tabular}
\LABEL{MIN::GETG1_OF_VARIABLE_POINTER} \\
\end{tabular}\end{indpar}

The {\tt point} function points a variable pointer at a particular
variable in a given variable vector.  The variable is determined by
its index as a vector element.

The {\tt clear} function clears a variable pointer so that it does
not point at any variable.  This is the state the pointer is in
just after it is constructed.
It is an undefined operation to access a variable pointer that
is cleared.

In order to optimize things,
a {\tt MUP::variable\_pointer} contains an internal pointer that points
directly at a variable in the body of a variable vector.  As this pointer
is relocatable, it must be adjusted if the relocated flag is raised
(\pagref{RELOCATED-FLAG}).  This is done by applying the {\tt relocate}
function to the pointer.  Because this is necessary, the constructor for
a variable pointer is unprotected.

The {\tt get} function returns the value of the variable pointed at,
after following all indirections.  That is, if the variable pointer
points at $X$ and the value of $X$ is an indirect pointer to another
variable $Y$, the {\tt get} function proceeds as if the variable pointer pointed
at $Y$.

The {\tt set} function sets the value of the variable pointed at,
after following all indirections.  That is, if the variable pointer
points at $X$ and the value of $X$ is an indirect pointer to
another variable $Y$, the {\tt set} function proceeds as if the variable pointer
pointed at $Y$.

The {\tt indirect} function sets the value of the variable pointed at by
the first variable pointer (\verb|vp1|),
after following all indirections,
to point indirectly at the variable pointed at by the second variable
pointer (\verb|vp2|).
If \verb|vp1| points at $X$ and the value of $X$ is an indirect pointer to
another variable $Y$, the {\tt indirect} function proceeds as if \verb|vp1|
pointed at $Y$.

The {\tt moveg} function works if {\tt get} returns a pointer to an object
stub.  In this case, {\tt moveg} finds the values of the attribute of the
object with the given attribute name
and no reverse attribute name, and proceeds as follows:
\begin{indpar}
If there are no values, \verb|min::MISSING| is returned and the variable
pointer is left unchanged.

If there is only one value and that is an index, the variable pointer is
re-pointed at the variable with that index in the variable vector the
variable pointer is currently pointing at, and \verb|min::SUCCESS|
is returned.

If there is only one value and that is \underline{not} an index,
that value is returned, and the variable pointer is left unchanged.

If there is more than one value, \verb|min::MULTI_VALUED|
is returned, and the variable pointer is left unchanged.
\end{indpar}

Note that the variable pointer is changed only if the attribute has
a single index value.

The {\tt countg} and {\tt getg} functions applied to a variable pointer
work the same way the would if they were applied to result of applying
{\tt get} to the variable pointer.  These functions will \underline{not}
change the variable pointer no matter what the attribute value is, and
will return any index attribute value as a \verb|min::gen| result.

The {\tt move} function can be used with any index value returned to
point the variable pointer at the variable referred to by the index,
without changing the variable vector referenced by the variable pointer.
Thus for an attribute with a single index value, {\tt moveg} is equivalent
to applying {\tt getg} to retrieve the index value, and then applying
{\tt move} to that value.

The {\tt moveg}, {\tt countg}, and {\tt getg} functions have associates
named \minmkey{movei}{of variable pointer},
\minmkey{counti}{of variable pointer},
and \minmkey{geti}{of variable pointer} that are identical except their
attribute name argument is of type {\tt int} instead of \verb|min::gen|.

The \key{variable forward optimization}\index{forward!variable optimization}
system control parameter effects
the operation of functions that trace indirect pointers stored in
variables.  If set, the optimization applies to the {\tt get}, {\tt set}, and
{\tt indirect} functions, and to other functions that implicitly use {\tt get}.
Whenever one of these functions discovers a variable $X$ that
points indirectly at a variable $Y$ that points indirectly at a variable $Z$,
the function resets $X$ to point at $Z$.  The
variable forward optimization control parameter can itself
be gotten or set by the functions:

\begin{center}\begin{tabular}{r@{}l}
\verb|bool min::|
	& \TTKEY{variable\_forward\_optimization}\verb| ( )|
\\
\verb|bool min::|
	& \TTKEY{variable\_forward\_optimization}\verb| ( bool value )|
\LABEL{VARIABLE_FORWARD_OPTIMIZATION} \\
\end{tabular}\end{center}

The {\tt variable\_forward\_optimization} function with no argument gets
the value of the control parameter, while the function with an argument
sets the value and returns the previous value.  By default the parameter
is on (value is {\tt true}), so optimizations are performed unless turned
off.



\subsection{Special Values}
\label{SPECIAL-VALUES}

Special values are \verb|min::gen| values that are unique
and not equal to any value that can be generated during
program execution.  An implementation can create them by
making objects during initialization, and making the special
values be pointers to these objects.  However, special values
are to be treated as C/C++ {\tt const} values, and are never
to be used unless documentation specifies a specific use.
They are commonly used as return or argument values by some
functions.

The special values are:

\begin{indpar}
\begin{list}{}{}
\item[{\tt const int min::}\MINKEY{MISSING}]~%
	\LABEL{MIN::MISSING}\\
Denotes a missing value or an empty set of values.
\item[{\tt const int min::}\MINKEY{ANY}]~%
	\LABEL{MIN::ANY}\\
Denotes any value from a set of values.
\item[{\tt const int min::}\MINKEY{MULTI\_VALUED}]~%
	\LABEL{MIN::MULTI_VALUED}\\
Indicates a set of values has more than one element.
\item[{\tt const int min::}\MINKEY{NULL}]~%
	\LABEL{MIN::NULL}\\
A value given to a variable vector variable (\secref{VARIABLE-VECTORS})
that has no value and can be indirected.
\item[{\tt const int min::}\MINKEY{SUCCESS}]~%
	\LABEL{MIN::SUCCESS}\\
A value returned to indicate a function has succeeded.
\end{list}
\end{indpar}

\subsection{Stub Functions}
\label{STUB-FUNCTIONS}

In this section we describe unprotected functions that can be used to read
or write stubs for purposes of debugging or of constructing other higher level
functions.  These functions do not check type codes of stubs.

The following functions read or write the value and control part of a
stub:

\begin{center}\begin{tabular}{r@{}l}
\verb|min::uns64 MUP::| & \MUPKEY{value\_of}\verb| ( min::stub * s )|
\LABEL{MUP::VALUE_OF} \\
\verb|min::float64 MUP::| & \MUPKEY{float\_of}\verb| ( min::stub * s )|
\\
\verb|min::uns64 MUP::| & \MUPKEY{control\_of}\verb| ( min::stub * s )|
\LABEL{MUP::CONTROL_OF} \\
\verb|void MUP::| &
    \MUPKEY{set\_value\_of}\verb| ( min::stub * s, min::uns64 v )|
\LABEL{MUP::SET_VALUE_OF} \\
\verb|void MUP::| &
    \MUPKEY{set\_float\_of}\verb| ( min::stub * s, min::float64 f )|
\\
\verb|void MUP::| &
    \MUPKEY{set\_control\_of}\verb| ( min::stub * s, min::uns64 v )|
\LABEL{MUP::SET_CONTROL_OF} \\
\end{tabular}\end{center}

Here the floating point functions are reading or writing the stub
value.  Thus the stub value can be taken to be either of type \verb|min::uns64|
or of type \verb|min::float64|.

These functions do \underline{not} check type codes, nor do they check
that values read or written are within legal range for a particular
stub.  Thus a stub value that is not a floating point number can be
read by \verb|MUP::float_of| with undefined results, and a stub control
that has its high order bit off indicating the stub will be collectible
can be written by \verb|MUP::set_control_of| even if the written
control datum is incompatible with the garbage collector implementation,
which will produce undefined results when the garbage collector
next executes.

The high order byte of any control written by \verb|MUP::set_control_of|
is the type code, and the high order bit is clear if the stub is collectible
and set if the stub is uncollectible (\secref{STUB-CONTROL}).

A stub control holds an 8-bit type code, 12-bits of flags, and 44 bits
of value or pointer.
The following functions can be used be used to compute or dissect stub
controls:

\begin{center}\begin{tabular}{r@{}l}
\verb|min::uns64 MUP::|
    & \MUPKEY{stub\_control} \\
    & \verb|    ( int type_code, unsigned flags, unsigned value )|
\LABEL{MUP::STUB_CONTROL} \\
\verb|min::uns64 MUP::|
    & \MUPKEY{stub\_control} \\
    & \verb|    ( int type_code, unsigned flags, min::stub * s )|
\\
\verb|int MUP::| & \MUPKEY{type\_of\_control}\verb| ( min::uns64 c )|
\LABEL{MUP::TYPE_OF_CONTROL} \\
\verb|unsigned MUP::| & \MUPKEY{flags\_of\_control}\verb| ( min::uns64 c )|
\LABEL{MUP::FLAGS_OF_CONTROL} \\
\verb|unsigned MUP::| & \MUPKEY{value\_of\_control}\verb| ( min::uns64 c )|
\LABEL{MUP::VALUE_OF_CONTROL} \\
\verb|min::stub * MUP::| & \MUPKEY{pointer\_of\_control}\verb| ( min::uns64 c )|
\LABEL{MUP::POINTER_OF_CONTROL} \\
\end{tabular}\end{center}

Here the 8-bit type code is represented as an {\tt int} in
the range from $-128$ through $127$, and the 12-bit flags are represented
as an {\tt unsigned} integer in the range from $0$ through $2^{12}-1$.
The {\tt MUP::stub\_control} function computes a control value that can be set
by {\tt MUP::set\_control\_of}, and the other functions dissect values read by
{\tt MUP::control\_of}.

\clearpage

\section{Code and Execution}

\subsection{Execution Flags}
\label{EXECUTION-FLAGS}

\section{TBD Implementation Ideas}


\subsection{Stack and not Ephemeral}

Instead of ephemeral, we use stack objects.  A stack stub is a stub that
is only reachable from pointers in the stack.   When a stack stub
pointer (as a general value) is stored in a non-stack object, the price
of tracing what it points at to make its target non-stack is paid.
This is a logical time to pay this cost.

\section{To Do}

Maybe not having \verb|min::| in names of functions with \verb|min::|
pointer arguments is not a good idea.

Interface to gc, including stack for protecting values.

\clearpage

\appendix

\centerline{\Large \bf Appendices}

\section{C/C++ Interface}
\label{C/C++-Interface}

The declarations here differ from legal C/C++ code in that
we write

\begin{indpar}\begin{verbatim}
struct min::stub;
bool min::is_collectible ( int type );
\end{verbatim}\end{indpar}

which is not legal C or C++ when what we mean is

\begin{indpar}\begin{verbatim}
struct min
{
    struct stub;
    bool is_collectible ( int type );
};
\end{verbatim}\end{indpar}

{
\renewcommand{\LABEL}[1]{\dotfill~\pagref{#1}}
\renewcommand{\TTKEY}[1]{{\tt ~~#1~~}}
\renewcommand{\MINKEY}[1]{{\tt ~~#1~~}}
\renewcommand{\MUPKEY}[1]{{\tt ~~#1~~}}
\newcommand{\ARGBREAK}{\\&{\tt ~~~~~}}
\newcommand{\INDEXHEADER}[1]{{\bf #1}:}

\INDEXHEADER{Compilation Macros}

\begin{indpar}[0.2in]

% The ...KEY macros must be preceeded by a \verb.
\verb||\TTKEY{MIN\_IS\_COMPACT}
\LABEL{MIN_IS_COMPACT} \\
\verb||\TTKEY{MIN\_IS\_LOOSE}
\LABEL{MIN_IS_LOOSE}	 \\
\verb||\TTKEY{MIN\_SIZEOF\_GEN}
\LABEL{MIN_SIZEOF_GEN} \\
\verb||\TTKEY{MIN\_USES\_ADDRESSES}
\LABEL{MIN_USES_ADDRESSES} \\
\verb||\TTKEY{MIN\_USES\_VSNS}
\LABEL{MIN_USES_VSNS} \\
\verb||\TTKEY{MIN\_DEBUG}
\LABEL{MIN_DEBUG}

\end{indpar}

\INDEXHEADER{Data Declarations}

\begin{indpar}[0.2in]

\verb|min::|\MINKEY{stub} \LABEL{MIN::STUB}
\\
\verb|min::|\MINKEY{gen} \LABEL{MIN::GEN}

\end{indpar}

\INDEXHEADER{Stub Type Codes}\label{STUB-TYPE-CODE-LIST}

\begin{indpar}[0.2in]

\verb|const int min::|\MINKEY{DEALLOCATED} \LABEL{MIN::DEALLOCATED}
\\
\verb|const int min::|\MINKEY{NUMBER} \LABEL{MIN::NUMBER}
\\
\verb|const int min::|\MINKEY{SHORT\_STR} \LABEL{MIN::SHORT_STR}
\\
\verb|const int min::|\MINKEY{LONG\_STR} \LABEL{MIN::LONG_STR}
\\
\verb|const int min::|\MINKEY{LABEL} \LABEL{MIN::LABEL}
\\
\verb|const int min::|\MINKEY{SHORT\_OBJ} \LABEL{MIN::SHORT_OBJ}
\\
\verb|const int min::|\MINKEY{LONG\_OBJ} \LABEL{MIN::LONG_OBJ}
\\
\verb|const int min::|\MINKEY{LIST\_AUXILIARY} \LABEL{MIN::LIST_AUXILIARY}
\\
\verb|const int min::|\MINKEY{SUBLIST\_AUXILIARY} \LABEL{MIN::SUBLIST_AUXILIARY}

\end{indpar}

\newpage

\INDEXHEADER{Stub Related Declarations}

\begin{indpar}[0.2in]

\begin{tabular}{@{}r@{}p{4.2in}}

\verb|int | & \TTKEY{type\_of}\verb| ( min::stub * s )|
\LABEL{TYPE_OF} \\[1ex]
\verb|bool min::| & \MINKEY{is\_collectible}\verb| ( int type )|
\LABEL{MIN::IS_COLLECTIBLE} \\[1ex]
(unsigned integer macro)~~ & \TTKEY{MIN\_DEALLOCATED\_LIMIT}
\LABEL{MIN_DEALLOCATED_LIMIT} \\
\verb|void | & \TTKEY{assert\_allocated}\ARGBREAK
               \verb| ( min::stub * s, unsigned size )|
\LABEL{ASSERT_ALLOCATED} \\
\verb|bool min::| & \MINKEY{relocated\_flag}\verb| ( void )|
\LABEL{MIN::RELOCATED_FLAG} \\
\verb|bool min::| & \MINKEY{set\_relocated\_flag}\verb| ( bool )|
\LABEL{MIN::SET_RELOCATED_FLAG} \\
\verb|void min::| & \MINKEY{interrupt\REL}\verb| ( void )|
\LABEL{MIN::INTERRUPT} \\
\verb|void min::| & \MINKEY{deallocate\REL}\verb| ( min::stub * s )|
\LABEL{DEALLOCATE} \\
\verb|bool min::| & \MINKEY{is\_deallocated}\verb| ( min::stub * s )|
\LABEL{MIN::IS_DEALLOCATED} \\

\end{tabular}

\end{indpar}

\INDEXHEADER{Gen Value Protected Declarations}

\begin{indpar}[0.2in]

\begin{tabular}{@{}r@{}p{4.5in}}

\verb|bool min::| & \MINKEY{is\_stub}\verb| ( min::gen v )|
\LABEL{MIN::IS_STUB} \\
\verb|bool min::| & \MINKEY{is\_direct\_float\LOOSE}\verb| ( min::gen v )|
\LABEL{MIN::IS_DIRECT_FLOAT} \\
\verb|bool min::| & \MINKEY{is\_direct\_int\COMPACT}\verb| ( min::gen v )|
\LABEL{MIN::IS_DIRECT_INT} \\
\verb|bool min::| & \MINKEY{is\_direct\_str}\verb| ( min::gen v )|
\LABEL{MIN::IS_DIRECT_STR} \\
\verb|bool min::| & \MINKEY{is\_list\_aux}\verb| ( min::gen v )|
\LABEL{MIN::IS_LIST_AUX} \\
\verb|bool min::| & \MINKEY{is\_sublist\_aux}\verb| ( min::gen v )|
\LABEL{MIN::IS_SUBLIST_AUX} \\
\verb|bool min::| & \MINKEY{is\_indirect\_pair\_aux}\verb| ( min::gen v )|
\LABEL{MIN::IS_INDIRECT_PAIR_AUX} \\
\verb|bool min::| & \MINKEY{is\_indirect\_indexed\_aux}\verb| ( min::gen v )|
\LABEL{MIN::IS_INDIRECT_INDEXED_AUX} \\
\verb|bool min::| & \MINKEY{is\_index}\verb| ( min::gen v )|
\LABEL{MIN::IS_INDEX} \\
\verb|bool min::| & \MINKEY{is\_control\_code}\verb| ( min::gen v )|
\LABEL{MIN::IS_CONTROL_CODE} \\[1ex]

\verb|min::stub * min::| & \MINKEY{stub\_of}\verb| ( min::gen v )|
\LABEL{MIN::STUB_OF} \\
\verb|min::float64 min::| &
    \MINKEY{direct\_float\_of\LOOSE}\verb| ( min::gen v )|
\LABEL{MIN::DIRECT_FLOAT_OF} \\
\verb|min::int32 min::| & \MINKEY{direct\_int\_of\COMPACT}\verb| ( min::gen v )|
\LABEL{MIN::DIRECT_INT_OF} \\
\verb|min::uns64 min::| & \MINKEY{direct\_str\_of}\verb| ( min::gen v )|
\LABEL{MIN::DIRECT_STR_OF} \\
\verb|unsigned min::| & \MINKEY{list\_aux\_of}\verb| ( min::gen v )|
\LABEL{MIN::LIST_AUX_OF} \\
\verb|unsigned min::| & \MINKEY{sublist\_aux\_of}\verb| ( min::gen v )|
\LABEL{MIN::SUBLIST_AUX_OF} \\
\verb|unsigned min::| &
    \MINKEY{indirect\_pair\_aux\_of}\verb| ( min::gen v )|
\LABEL{MIN::INDIRECT_PAIR_AUX_OF} \\
\verb|unsigned min::| &
    \MINKEY{indirect\_indexed\_aux\_of}\verb| ( min::gen v )|
\LABEL{MIN::INDIRECT_INDEXED_AUX_OF} \\
\verb|unsigned min::| & \MINKEY{index\_of}\verb| ( min::gen v )|
\LABEL{MIN::INDEX_OF} \\
\verb|unsigned min::| & \MINKEY{control\_code\_of}\verb| ( min::gen v )|
\LABEL{MIN::CONTROL_CODE_OF} \\
\verb|min::uns64 min::| &
	\MINKEY{long\_control\_code\_of\LOOSE}\verb| ( min::gen v )|
\LABEL{MIN::LONG_CONTROL_CODE_OF} \\[1ex]

\verb|min::gen min::| & \MINKEY{new\_direct\_int\_gen}\verb| ( int v )|
\LABEL{MIN::NEW_DIRECT_INT_GEN} \\
\verb|min::gen min::| &
    \MINKEY{new\_direct\_float\_gen}\verb| ( min::float64 v )|
\LABEL{MIN::NEW_DIRECT_FLOAT_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_direct\_str\_gen}\verb| ( const char * p )|
\LABEL{MIN::NEW_DIRECT_STR_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_gen}\verb| ( min::stub * s )|
\LABEL{MIN::NEW_GEN_OF_STUB} \\
\verb|min::gen min::| & \MINKEY{new\_list\_aux\_gen}\verb| ( unsigned p )|
\LABEL{MIN::NEW_LIST_AUX_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_sublist\_aux\_gen}\verb| ( unsigned p )|
\LABEL{MIN::NEW_SUBLIST_AUX_GEN} \\
\verb|min::gen min::| &
    \MINKEY{new\_indirect\_pair\_aux\_gen}\verb| ( unsigned p )|
\LABEL{MIN::NEW_INDIRECT_PAIR_AUX_GEN} \\
\verb|min::gen min::|
    & \MINKEY{new\_indirect\_indexed\_aux\_gen}\verb| ( unsigned p )|
\LABEL{MIN::NEW_INDIRECT_INDEXED_AUX_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_index\_gen}\verb| ( unsigned a )|
\LABEL{MIN::NEW_INDEX_GEN} \\
\verb|min::gen min::| & \MINKEY{new\_control\_code\_gen}\verb| ( unsigned c )|
\LABEL{MIN::NEW_CONTROL_CODE_GEN} \\
\verb|min::gen min::| &
    \MINKEY{new\_long\_control\_code\_gen\LOOSE}\verb| ( min::uns64 c )|
\LABEL{MIN::NEW_LONG_CONTROL_CODE_GEN} \\[1ex]

\verb|int min::| & \MINKEY{gen\_subtype\_of}\verb| ( min::gen v )|
\LABEL{MIN::GEN_SUBTYPE_OF} \\

\end{tabular}

\end{indpar}

\newpage

\INDEXHEADER{Gen Value Unprotected Declarations}

\begin{indpar}[0.2in]

\begin{tabular}{@{}r@{}p{4.5in}}

\verb|min::float64 MUP::| & \MUPKEY{direct\_float\_of}\verb| ( min::gen v )|
\LABEL{MUP::DIRECT_FLOAT_OF} \\
\verb|min::int32 MUP::| & \MUPKEY{direct\_int\_of}\verb| ( min::gen v )|
\LABEL{MUP::DIRECT_INT_OF} \\
\verb|min::uns64 MUP::| & \MUPKEY{direct\_str\_of}\verb| ( min::gen v )|
\LABEL{MUP::DIRECT_STR_OF} \\
\verb|min::stub * MUP::| & \MUPKEY{stub\_of}\verb| ( min::gen v )|
\LABEL{MUP::STUB_OF} \\
\verb|unsigned MUP::| & \MUPKEY{list\_aux\_of}\verb| ( min::gen v )|
\LABEL{MUP::LIST_AUX_OF} \\
\verb|unsigned MUP::| & \MUPKEY{sublist\_aux\_of}\verb| ( min::gen v )|
\LABEL{MUP::SUBLIST_AUX_OF} \\
\verb|unsigned MUP::| &
    \MUPKEY{indirect\_pair\_aux\_of}\verb| ( min::gen v )|
\LABEL{MUP::INDIRECT_PAIR_AUX_OF} \\
\verb|unsigned MUP::| &
    \MUPKEY{indirect\_indexed\_aux\_of}\verb| ( min::gen v )|
\LABEL{MUP::INDIRECT_INDEXED_AUX_OF} \\
\verb|unsigned MUP::| & \MUPKEY{index\_of}\verb| ( min::gen v )|
\LABEL{MUP::INDEX_OF} \\
\verb|unsigned MUP::| & \MUPKEY{control\_code\_of}\verb| ( min::gen v )|
\LABEL{MUP::CONTROL_CODE_OF} \\
\verb|min::uns64 MUP::| &
	\MUPKEY{long\_control\_code\_of\LOOSE}\verb| ( min::gen v )|
\LABEL{MUP::LONG_CONTROL_CODE_OF} \\[1ex]

\verb|min::gen MUP::| & \MUPKEY{new\_direct\_int\_gen}\verb| ( int v )|
\LABEL{MUP::NEW_DIRECT_INT_GEN} \\
\verb|min::gen MUP::| &
    \MUPKEY{new\_direct\_float\_gen}\verb| ( min::float64 v )|
\LABEL{MUP::NEW_DIRECT_FLOAT_GEN} \\
\verb|min::gen MUP::| & \MUPKEY{new\_direct\_str\_gen}\verb| ( const char * p )|
\LABEL{MUP::NEW_DIRECT_STR_GEN} \\
\verb|min::gen MUP::| & \MUPKEY{new\_gen}\verb| ( min::stub * s )|
\LABEL{MUP::NEW_GEN_OF_STUB} \\
\verb|min::gen MUP::| & \MUPKEY{new\_list\_aux\_gen}\verb| ( unsigned p )|
\LABEL{MUP::NEW_LIST_AUX_GEN} \\
\verb|min::gen MUP::| & \MUPKEY{new\_sublist\_aux\_gen}\verb| ( unsigned p )|
\LABEL{MUP::NEW_SUBLIST_AUX_GEN} \\
\verb|min::gen MUP::| &
    \MUPKEY{new\_indirect\_pair\_aux\_gen}\verb| ( unsigned p )|
\LABEL{MUP::NEW_INDIRECT_PAIR_AUX_GEN} \\
\verb|min::gen MUP::| &
    \MUPKEY{new\_indirect\_indexed\_aux\_gen}\verb| ( unsigned p )|
\LABEL{MUP::NEW_INDIRECT_INDEXED_AUX_GEN} \\
\verb|min::gen MUP::| & \MUPKEY{new\_index\_gen}\verb| ( unsigned a )|
\LABEL{MUP::NEW_INDEX_GEN} \\
\verb|min::gen MUP::| & \MUPKEY{new\_control\_code\_gen}\verb| ( unsigned c )|
\LABEL{MUP::NEW_CONTROL_CODE_GEN} \\
\verb|min::gen MUP::| &
    \MUPKEY{new\_long\_control\_code\_gen\LOOSE}\verb| ( min::uns64 c )|
\LABEL{MUP::NEW_LONG_CONTROL_CODE_GEN} \\

\end{tabular}

\end{indpar}

\INDEXHEADER{Gen Value Subtype Codes}

\begin{indpar}[0.2in]

\begin{tabular}{@{}r@{}p{4.0in}}

\verb|const unsigned min::| & \MINKEY{GEN\_DIRECT\_INT}
\LABEL{MIN::GEN_DIRECT_INT} \\
\verb|const unsigned min::| & \MINKEY{GEN\_DIRECT\_FLOAT}
\LABEL{MIN::GEN_DIRECT_FLOAT} \\
\verb|const unsigned min::| & \MINKEY{GEN\_DIRECT\_STR}
\LABEL{MIN::GEN_DIRECT_STR} \\
\verb|const unsigned min::| & \MINKEY{GEN\_STUB}
\LABEL{MIN::GEN_STUB} \\
\verb|const unsigned min::| & \MINKEY{GEN\_LIST\_AUX}
\LABEL{MIN::GEN_LIST_AUX} \\
\verb|const unsigned min::| & \MINKEY{GEN\_SUBLIST\_AUX}
\LABEL{MIN::GEN_SUBLIST_AUX} \\
\verb|const unsigned min::| & \MINKEY{GEN\_INDIRECT\_PAIR\_AUX}
\LABEL{MIN::GEN_INDIRECT_PAIR_AUX} \\
\verb|const unsigned min::| & \MINKEY{GEN\_INDIRECT\_INDEXED\_AUX}
\LABEL{MIN::GEN_INDIRECT_INDEXED_AUX} \\
\verb|const unsigned min::| & \MINKEY{GEN\_INDEX}
\LABEL{MIN::GEN_INDEX} \\
\verb|const unsigned min::| & \MINKEY{GEN\_CONTROL\_CODE}
\LABEL{MIN::GEN_CONTROL_CODE} \\
\verb|const unsigned min::| & \MINKEY{GEN\_ILLEGAL}
\LABEL{MIN::GEN_ILLEGAL} \\

\end{tabular}

\end{indpar}

\INDEXHEADER{Number Stub Protected Declarations}

\begin{indpar}[0.2in]

\begin{tabular}{@{}r@{}p{4.0in}}


\verb|min::float64 | & \MINKEY{float\_of}\verb| ( min::stub * s )|
\LABEL{FLOAT_OF} \\[1ex]

\verb|int min::| & \MINKEY{is\_num}\verb| ( min::gen v )|
\LABEL{MIN::IS_NUM} \\[1ex]
\verb|min::gen min::| &
	\MINKEY{new\_gen\REL} \verb| ( int v )|
\LABEL{MIN::NEW_GEN_OF_INT} \\
\verb|min::gen min::| &
	\MINKEY{new\_gen\REL} \verb| ( min::float64 v )|
\LABEL{MIN::NEW_GEN_OF_FLOAT64} \\[1ex]
\verb|int min::| & \MINKEY{int\_of}\verb| ( min::gen v )|
\LABEL{MIN::INT_OF_GEN} \\
\verb|min::float64 min::| & \MINKEY{float\_of}\verb| ( min::gen v )|
\LABEL{MIN::FLOAT_OF_GEN} \\[1ex]
\verb|unsigned min::| & \MINKEY{numhash}\verb| ( min::gen v )|
\LABEL{MIN::NUMHASH_OF_GEN} \\

\end{tabular}

\end{indpar}

\INDEXHEADER{Number Stub Unprotected Declarations}

\begin{indpar}[0.2in]

\begin{tabular}{@{}r@{}p{4.0in}}

\verb|min::float64 MUP::| & \MUPKEY{float\_of}\verb| ( min::stub * s )|
\LABEL{MUP::FLOAT_OF} \\
\verb|void MUP::| &
    \MUPKEY{set\_float\_of}\ARGBREAK\verb| ( min::stub * s, min::float64 f )|
\LABEL{MUP::SET_FLOAT_OF} \\[1ex]

\end{tabular}

\end{indpar}

\newpage

\INDEXHEADER{String Stub Protected Declarations}

\begin{indpar}[0.2in]

\begin{tabular}{@{}r@{}p{4.0in}}

\verb|unsigned | & \TTKEY{strlen}\verb| ( min::stub * s )|
\LABEL{STRLEN} \\
\verb|unsigned | & \TTKEY{strhash}\verb| ( min::stub * s )|
\LABEL{STRHASH} \\
\verb|min::uns64 | & \TTKEY{strsignature}\verb| ( min::stub * s )|
\LABEL{STRSIGNATURE} \\[1ex]

\verb|char * | & \TTKEY{strcpy}\verb| ( char * p, min::stub * s )|
\LABEL{STRCPY} \\
\verb|char * | & \TTKEY{strncpy}\ARGBREAK
	\verb| ( char * p,|\ARGBREAK
	\verb|   min::stub * s, unsigned n )|
\LABEL{STRNCPY} \\[1ex]

\verb|unsigned min::| & \MINKEY{strlen}\verb| ( min::gen v )|
\LABEL{MIN::STRLEN_OF_GEN} \\
\verb|unsigned min::| & \MINKEY{strhash}\verb| ( min::gen s )|
\LABEL{MIN::STRHASH_OF_GEN} \\
\verb|min::uns64 min::| & \MINKEY{strsignature}\verb| ( min::gen s )|
\LABEL{MIN::STRSIGNATURE_OF_GEN} \\
\verb|char * min::| & \MINKEY{strcpy}\verb| ( char * p, min::gen s )|
\LABEL{MIN::STRCPY_OF_GEN} \\
\verb|char * min::| & \MINKEY{strncpy}\ARGBREAK
                      \verb| ( char * p,|\ARGBREAK
		      \verb|   min::gen s, unsigned n )|
\LABEL{MIN::STRNCPY_OF_GEN} \\[1ex]

\verb|(constructor) MUP::| & \MUPKEY{str\_pointer}\verb| ( min::gen v )|
\LABEL{MUP::STR_POINTER_OF_GEN} \\
\verb|const char * | & \TTKEY{str\_of}\verb| ( MUP::str_pointer & sp )|
\LABEL{STR_OF_STR_POINTER} \\
\verb|void | & \TTKEY{relocate}\verb| ( MUP::str_pointer & sp )|
\LABEL{RELOCATE_OF_STR_POINTER} \\[1ex]

\verb|int min::| & \MINKEY{is\_str}\verb| ( min::gen v )|
\LABEL{MIN::IS_STR_OF_GEN}
\\[1ex]

\verb|min::gen min::| &
    \MINKEY{new\_gen\REL} \verb| ( const char * p )|
\LABEL{MIN::NEW_GEN_OF_STR} \\

\end{tabular}

\end{indpar}

\newpage

\INDEXHEADER{String Stub Unprotected Declarations}

\begin{indpar}[0.2in]

\begin{tabular}{@{}r@{}p{4.0in}}

\verb|min::uns64 MUP::| &
	\MUPKEY{short\_str\_of}\verb| ( min::stub * s )|
\LABEL{MUP::SHORT_STR_OF} \\[1ex]

\verb|void MUP::| &
    \MUPKEY{set\_short\_str\_of}\ARGBREAK
    \verb| ( min::stub * s, min::uns64 str )|
\LABEL{MUP::SET_SHORT_STR_OF} \\[1ex]

\verb|min::long_str * MUP::| &
	\MUPKEY{long\_str\_of}\verb| ( min::stub * s )|
\LABEL{MUP::LONG_STR_OF} \\
\verb|unsigned | & \TTKEY{length\_of}\verb| ( min::long_str * str )|
\LABEL{LENGTH_OF_LONG_STR} \\
\verb|unsigned | & \TTKEY{hash\_of}\verb| ( min::long_str * str )|
\LABEL{HASH_OF_LONG_STR} \\
\verb|min::uns64 | & \TTKEY{signature\_of}\verb| ( min::long_str * str )|
\LABEL{SIGNATURE_OF_LONG_STR} \\
\verb|const char * MUP::| & \MUPKEY{str\_of}\verb| ( min::long_str * str )|
\LABEL{MUP::STR_OF_LONG_STR} \\
\verb|char * MUP::| & \MUPKEY{writable\_str\_of}\verb| ( min::long_str * str )|
\LABEL{MUP::WRITABLE_STR_OF_LONG_STR} \\[1ex]

\verb|unsigned MUP::| & \MUPKEY{hash\_of}\verb| ( min::long_str * str )|
\LABEL{MUP::HASH_OF_LONG_STR} \\
\verb|void MUP::| &
   \MUPKEY{set\_length\_of}\ARGBREAK
   \verb| ( min::long_str * str,|\ARGBREAK\verb|   unsigned length )|
\LABEL{MUP::SET_LENGTH_OF_LONG_STR} \\
\verb|void MUP::| &
   \MUPKEY{set\_hash\_of}\ARGBREAK
    \verb| ( min::long_str * str,|\ARGBREAK\verb|   unsigned hash )|
\LABEL{MUP::SET_HASH_OF_LONG_STR} \\[1ex]

\end{tabular}

\end{indpar}

\newpage

\INDEXHEADER{Label Stub Declarations}

\begin{indpar}[0.2in]

\begin{tabular}{@{}r@{}p{4.0in}}

\verb|unsigned | & \TTKEY{lab\_of}\ARGBREAK
    \verb| ( min::gen * p, unsigned n,|\ARGBREAK\verb|   min::stub * s )|
\LABEL{LAB_OF} \\
\verb|unsigned min::| & \MINKEY{lab\_of}\ARGBREAK
    \verb| ( min::gen * p, unsigned n,|\ARGBREAK\verb|   min::gen v )|
\LABEL{MIN::LAB_OF_GEN} \\[1ex]

\verb|unsigned | & \TTKEY{lablen}\verb| ( min::stub * s )|
\LABEL{LABLEN} \\
\verb|unsigned min::| & \MINKEY{lablen}\verb| ( min::gen v )|
\LABEL{MIN::LABLEN_OF_GEN} \\[1ex]

\verb|unsigned | & \TTKEY{labhash}\verb| ( min::stub * s )|
\LABEL{LABHASH} \\
\verb|unsigned min::| & \MINKEY{labhash}\verb| ( min::gen v )|
\LABEL{MIN::LABHASH_OF_GEN} \\
\verb|unsigned min::| & \MINKEY{labhash}\ARGBREAK
    \verb| ( min::gen * const p, unsigned n )|
\LABEL{MIN::LABHASH_OF_GEN_VECTOR} \\[1ex]

\verb|min::gen min::| & \MINKEY{new\_gen}\ARGBREAK
    \verb| ( min::gen * const p, unsigned n )|
\LABEL{MIN::NEW_GEN_OF_GEN_VECTOR} \\[1ex]

\verb|bool min::| & \MINKEY{is\_label}\verb| ( min::gen v )|
\LABEL{MIN::IS_LABEL_OF_GEN} \\

\end{tabular}

\end{indpar}

\INDEXHEADER{Object Stub Declarations}

\begin{indpar}[0.2in]

\begin{tabular}{@{}r@{}p{4.0in}}

\verb|min::short_obj * MUP::| &
	\MUPKEY{short\_obj\_of}\verb| ( min::stub * s )|
\LABEL{MUP::SHORT_OBJ_OF} \\
\verb|min::long_obj * MUP::| &
	\MUPKEY{long\_obj\_of}\verb| ( min::stub * s )|
\LABEL{MUP::LONG_OBJ_OF} \\

\end{tabular}

\end{indpar}

\begin{indpar}[0.2in]

\begin{tabular}{@{}r@{}p{5.0in}}

\verb|unsigned | & \TTKEY{hash\_table\_size\_of}\verb| ( min::short_obj * so )|
\LABEL{HASH_TABLE_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned | & \TTKEY{hash\_table\_size\_of}\verb| ( min::long_obj * lo )|
\LABEL{HASH_TABLE_SIZE_OF_LONG_OBJ} \\
\verb|unsigned | &
    \TTKEY{attribute\_vector\_size\_of}\verb| ( min::short_obj * so )|
\LABEL{ATTRIBUTE_VECTOR_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned |
    & \TTKEY{attribute\_vector\_size\_of}\verb| ( min::long_obj * lo )|
\LABEL{ATTRIBUTE_VECTOR_SIZE_OF_LONG_OBJ} \\
\verb|unsigned |
    & \TTKEY{auxiliary\_area\_size\_of}\verb| ( min::short_obj * so )|
\LABEL{AUXILIARY_AREA_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned |
    & \TTKEY{auxiliary\_area\_size\_of}\verb| ( min::long_obj * lo )|
\LABEL{AUXILIARY_AREA_SIZE_OF_LONG_OBJ} \\
\verb|unsigned |
    & \TTKEY{unused\_area\_size\_of}\verb| ( min::short_obj * so )|
\LABEL{UNUSED_AREA_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned |
    & \TTKEY{unused\_area\_size\_of}\verb| ( min::long_obj * lo )|
\LABEL{UNUSED_AREA_SIZE_OF_LONG_OBJ} \\
\verb|unsigned | & \TTKEY{total\_size\_of}\verb| ( min::short_obj * so )|
\LABEL{TOTAL_SIZE_OF_SHORT_OBJ} \\
\verb|unsigned | & \TTKEY{total\_size\_of}\verb| ( min::long_obj * lo )|
\LABEL{TOTAL_SIZE_OF_LONG_OBJ} \\

\end{tabular}

\end{indpar}

\INDEXHEADER{Object Vector Level Declarations}

\begin{indpar}[0.2in]

\begin{tabular}{@{}r@{}p{3.5in}}

\verb|const min::gen * MUP::|
	& \MUPKEY{body\_vector\_of}\ARGBREAK
		\verb| ( min::short_obj * so )|
\LABEL{MUP::BODY_VECTOR_OF_SHORT_OBJ} \\
\verb|const min::gen * MUP::|
	& \MUPKEY{body\_vector\_of}\ARGBREAK
		\verb| ( min::long_obj * lo )|
\LABEL{MUP::BODY_VECTOR_OF_LONG_OBJ} \\
\verb|min::gen * MUP::|
	& \MUPKEY{writable\_body\_vector\_of}\ARGBREAK
		\verb| ( min::short_obj * so )|
\LABEL{MUP::WRITABLE_BODY_VECTOR_OF_SHORT_OBJ} \\
\verb|min::gen * MUP::|
	& \MUPKEY{writable\_body\_vector\_of}\ARGBREAK
		\verb| ( min::long_obj * lo )|
\LABEL{MUP::WRITABLE_BODY_VECTOR_OF_LONG_OBJ} \\

\end{tabular}

\bigskip

\begin{tabular}{@{}r@{}p{4.5in}}

\verb|unsigned |
	& \TTKEY{hash\_table\_of}\verb| ( min::short_obj * so )|
\LABEL{HASH_TABLE_OF_SHORT_OBJ} \\
\verb|unsigned |
	& \TTKEY{hash\_table\_of}\verb| ( min::long_obj * lo )|
\LABEL{HASH_TABLE_OF_LONG_OBJ} \\
\verb|unsigned |
	& \TTKEY{attribute\_vector\_of}\verb| ( min::short_obj * so )|
\LABEL{ATTRIBUTE_VECTOR_OF_SHORT_OBJ} \\
\verb|unsigned |
	& \TTKEY{attribute\_vector\_of}\verb| ( min::long_obj * lo )|
\LABEL{ATTRIBUTE_VECTOR_OF_LONG_OBJ} \\

\end{tabular}

\end{indpar}

\INDEXHEADER{Object List Level Declarations}

\begin{indpar}[0.2in]

\begin{tabular}{@{}r@{}p{4.0in}}

\verb|const min::gen min::| & \MINKEY{LIST\_END} \LABEL{MIN::LIST_END} \\
\verb|const min::gen min::| &
	\MINKEY{EMPTY\_SUBLIST} \LABEL{MIN::EMPTY_SUBLIST} \\

\end{tabular}

\end{indpar}

\begin{indpar}[0.2in]

\begin{tabular}{@{}r@{}p{4.0in}}

(constructor)~\verb|MUP::|
	& \MUPKEY{list\_pointer}\verb| ( min::stub * s )|
\LABEL{MUP::LIST_POINTER_OF_STUB} \\
(constructor)~\verb|MUP::|
	& \MUPKEY{list\_pointer}\verb| ( min::gen obj )|
\LABEL{MUP::LIST_POINTER_OF_GEN} \\

\end{tabular}

\begin{tabular}{@{}r@{}p{5.0in}}

\verb|min::gen |
	& \TTKEY{start\_hash}\ARGBREAK
	  \verb| ( min::list_pointer & lp, unsigned index )|
\LABEL{START_HASH} \\
\verb|min::gen |
	& \TTKEY{start\_vector}\ARGBREAK
	  \verb| ( min::list_pointer & lp, unsigned index )|
\LABEL{START_VECTOR} \\
\verb|min::gen |
	& \TTKEY{start\_copy}\ARGBREAK
	  \verb| ( min::list_pointer & lp,|\ARGBREAK
	  \verb|   min::list_pointer & lp2 )|
\LABEL{START_COPY} \\
\verb|unsigned |
	& \TTKEY{next}\verb| ( min::list_pointer & lp )|
\LABEL{NEXT_OF_LIST_POINTER} \\
\verb|unsigned |
	& \TTKEY{current}\verb| ( min::list_pointer & lp )|
\LABEL{CURRENT_OF_LIST_POINTER} \\
\verb|min::gen |
	& \TTKEY{start\_sublist}\verb| ( min::list_pointer & lp )|
\LABEL{START_SUBLIST} \\
\verb|bool min::|
	& \MINKEY{is\_list\_end}\verb| ( min::gen v )|
\LABEL{MIN::IS_LIST_END} \\
\verb|bool min::|
	& \MINKEY{is\_sublist}\verb| ( min::gen v )|
\LABEL{MIN::IS_SUBLIST} \\
\verb|void |
	& \TTKEY{insert\_before}\ARGBREAK
	  \verb| ( min::list_pointer & lp, min::gen v )|
\LABEL{INSERT_BEFORE} \\
\verb|void |
	& \TTKEY{insert\_after}\ARGBREAK
	  \verb| ( min::list_pointer & lp, min::gen v )|
\LABEL{INSERT_AFTER} \\

\end{tabular}

\end{indpar}

\INDEXHEADER{Object Attribute Level Declarations}

\begin{indpar}[0.2in]

\begin{tabular}{@{}r@{}p{4.8in}}
\verb|unsigned min::| & \MINKEY{countg}\ARGBREAK
    \verb| ( min::gen obj,|\ARGBREAK
    \verb|   min::gen name, min::gen reverse_name )|
\LABEL{MIN::COUNTG} \\
\verb|unsigned min::| & \MINKEY{getg}\ARGBREAK
    \verb| ( min::gen * out, unsigned n,|\ARGBREAK
    \verb|   min::gen obj,|\ARGBREAK
    \verb|   min::gen name, min::gen reverse_name )|
\LABEL{MIN::GETG} \\
\verb|unsigned min::| & \MINKEY{get\_flagsg}\ARGBREAK
    \verb| ( min::uns32 * out, unsigned n,|\ARGBREAK
    \verb|   min::gen obj,|\ARGBREAK
    \verb|   min::gen name )|
\LABEL{MIN::COUNT_FLAGSG} \\
\verb|void min::| & \MINKEY{setg\REL}\ARGBREAK
    \verb| ( const min::gen * in, unsigned n,|\ARGBREAK
    \verb|   min::gen obj,|\ARGBREAK
    \verb|   min::gen name, min::gen reverse_name )|
\LABEL{MIN::GET_FLAGSG} \\
\verb|unsigned min::| & \MINKEY{count\_flagsg}\ARGBREAK
    \verb| ( min::gen obj, min::gen name )|
\LABEL{MIN::SETG} \\
\verb|void min::| & \MINKEY{set\_flagsg\REL}\ARGBREAK
    \verb| ( const min::uns32 * in, unsigned n,|\ARGBREAK
    \verb|   min::gen obj,|\ARGBREAK
    \verb|   min::gen name )|
\LABEL{MIN::SET_FLAGSG} \\
\end{tabular}

\begin{tabular}{@{}r@{}p{4.8in}}
\verb|min::gen min::| & \MINKEY{getg}\ARGBREAK
    \verb| ( min::gen obj,|\ARGBREAK
    \verb|   min::gen name, min::gen reverse_name )|
\LABEL{MIN::GETG1} \\
\verb|void min::| & \MINKEY{setg\REL}\ARGBREAK
    \verb| ( const min::gen v,|\ARGBREAK
    \verb|   min::gen obj,|\ARGBREAK
    \verb|   min::gen name, min::gen reverse_name )|
\LABEL{MIN::SETG1} \\
\verb|void min::| & \MINKEY{add\_to\_setg\REL}\ARGBREAK
    \verb| ( const min::gen v,|\ARGBREAK
    \verb|   min::gen obj,|\ARGBREAK
    \verb|   min::gen name, min::gen reverse_name )|
\LABEL{MIN::ADD_TO_SETG} \\
\verb|void min::| & \MINKEY{add\_to\_multisetg\REL}\ARGBREAK
    \verb| ( const min::gen v,|\ARGBREAK
    \verb|   min::gen obj,|\ARGBREAK
    \verb|   min::gen name, min::gen reverse_name )|
\LABEL{MIN::ADD_TO_MULTISETG} \\
\end{tabular}

\begin{tabular}{@{}r@{}p{4.8in}}
\verb|void min::| & \MINKEY{set\_some\_flagsg\REL}\ARGBREAK
    \verb| ( const min::uns32 * in, unsigned n,|\ARGBREAK
    \verb|   min::gen obj, min::gen name )|
\LABEL{MIN::SET_SOME_FLAGSG} \\
\verb|void min::| & \MINKEY{clear\_some\_flagsg\REL}\ARGBREAK
    \verb| ( const min::uns32 * in, unsigned n,|\ARGBREAK
    \verb|   min::gen obj, min::gen name )|
\LABEL{MIN::CLEAR_SOME_FLAGSG} \\
\verb|void min::| & \MINKEY{flip\_some\_flagsg\REL}\ARGBREAK
    \verb| ( const min::uns32 * in, unsigned n,|\ARGBREAK
    \verb|   min::gen obj, min::gen name )|
\LABEL{MIN::FLIP_SOME_FLAGSG} \\
\end{tabular}

\begin{tabular}{@{}r@{}p{4.8in}}
\verb|bool min::| & \MINKEY{test\_flagg\REL}\ARGBREAK
    \verb| ( unsigned n, min::gen obj, min::gen name )|
\LABEL{MIN::TEST_FLAGG} \\
\verb|void min::| & \MINKEY{set\_flagg\REL}\ARGBREAK
    \verb| ( unsigned n, min::gen obj, min::gen name )|
\LABEL{MIN::SET_FLAGG} \\
\verb|void min::| & \MINKEY{clear\_flagg\REL}\ARGBREAK
    \verb| ( unsigned n, min::gen obj, min::gen name )|
\LABEL{MIN::CLEAR_FLAGG} \\
\verb|void min::| & \MINKEY{flip\_flagg\REL}\ARGBREAK
    \verb| ( unsigned n, min::gen obj, min::gen name )|
\LABEL{MIN::FLIP_FLAGG} \\
\end{tabular}

The Attribute Level functions also have variants with:

\begin{indpar}
\begin{tabular}{@{}p{5.0in}}
\verb|min::gen name| replaced by \verb|int name| \\
and name ending `{\tt g}' replaced by `{\tt i}' \\
~~~~~\begin{tabular}[b]{ll}
\verb|min::counti| & \verb|min::geti| \\
\verb|min::count_flagsi| & \verb|min::get_flagsi| \\
\verb|min::seti| & \verb|min::set_flagsi| \\
\verb|min::add_to_seti| & \verb|min::add_to_multiseti|
\end{tabular}
\LABEL{G_TO_I_VARIANTS} \\[1ex]
\verb|min::gen obj| replaced by \verb|min::stub * obj|
\LABEL{MIN::GEN_REPLACED_BY_MIN::STUB} \\[1ex]
\verb|min::gen reverse_name| omitted\\
(implicitly equal to \verb|min::MISSING|)
\LABEL{REVERSE_NAME_OMITTED}
\end{tabular}
\end{indpar}

\end{indpar}

\INDEXHEADER{Variable Vector Variable Level Declarations}

\begin{indpar}[0.2in]

\begin{tabular}{@{}r@{}p{4.5in}}
(constructor)~\verb|MUP::|
	& \MUPKEY{variable\_pointer}\verb| ( )|
\LABEL{MUP::VARIABLE_POINTER} \\
\verb|min::gen min::| & \MINKEY{point}\ARGBREAK
    \verb| ( min::variable_pointer & vp,|\ARGBREAK
    \verb|   min::gen vector, unsigned index )|
\LABEL{POINT_VARIABLE_POINTER} \\
\verb|void min::|
	& \TTKEY{clear}\verb| ( min::variable_pointer & vp )|
\LABEL{CLEAR_VARIABLE_POINTER} \\
\verb|void min::|
	& \TTKEY{relocate}\verb| ( min::variable_pointer & vp )|
\LABEL{RELOCATE_VARIABLE_POINTER} \\
\verb|min::gen min::|
	& \TTKEY{get}\verb| ( min::variable_pointer & vp )|
\LABEL{GET_VARIABLE_POINTER} \\
\verb|void min::|
	& \TTKEY{set}\ARGBREAK
    \verb| ( min::variable_pointer & vp,|\ARGBREAK
    \verb|   min::gen value )|
\LABEL{SET_VARIABLE_POINTER} \\
\verb|min::gen min::| & \MINKEY{indirect\REL}\ARGBREAK
    \verb| ( min::variable_pointer & vp1,|\ARGBREAK
    \verb|   min::variable_pointer & vp2 )|
\LABEL{MIN::INDIRECT_VARIABLE_POINTER} \\
\verb|min::gen min::| & \MINKEY{moveg}\ARGBREAK
    \verb| ( min::variable_pointer & vp,|\ARGBREAK
    \verb|   min::gen name )|
\LABEL{MIN::MOVEG_VARIABLE_POINTER} \\
\verb|min::gen min::| & \MINKEY{move}\ARGBREAK
    \verb| ( min::variable_pointer & vp,|\ARGBREAK
    \verb|   unsigned index )|
\LABEL{MOVE_VARIABLE_POINTER} \\
\verb|unsigned min::| & \MINKEY{countg}\ARGBREAK
    \verb| ( min::variable_pointer & vp,|\ARGBREAK
    \verb|   min::gen name, min::gen reverse_name )|
\LABEL{MIN::COUNTG_OF_VARIABLE_POINTER} \\
\verb|unsigned min::| & \MINKEY{getg}\ARGBREAK
    \verb| ( min::gen * out, unsigned n,|\ARGBREAK
    \verb|   min::variable_pointer & vp,|\ARGBREAK
    \verb|   min::gen name, min::gen reverse_name )|
\LABEL{MIN::GETG_OF_VARIABLE_POINTER} \\
\verb|min::gen min::| & \MINKEY{getg}\ARGBREAK
    \verb| ( min::variable_pointer & vp,|\ARGBREAK
    \verb|   min::gen name, min::gen reverse_name )|
\LABEL{MIN::GETG1_OF_VARIABLE_POINTER} \\
\end{tabular}

\begin{tabular}{@{}r@{}p{5.0in}}
\verb|bool min::|
	& \TTKEY{variable\_forward\_optimization}\verb| ( )|
\LABEL{VARIABLE_FORWARD_OPTIMIZATION} \\
\verb|bool min::|
	& \TTKEY{variable\_forward\_optimization}\verb| ( bool value )|
\LABEL{VARIABLE_FORWARD_OPTIMIZATION} \\
\end{tabular}

\end{indpar}

\INDEXHEADER{Special Values}

\begin{indpar}[0.2in]

\verb|min::|\MINKEY{MISSING} \LABEL{MIN::MISSING}
\\
\verb|min::|\MINKEY{ANY} \LABEL{MIN::ANY}
\\
\verb|min::|\MINKEY{MULTI\_VALUED} \LABEL{MIN::MULTI_VALUED}
\\
\verb|min::|\MINKEY{NULL} \LABEL{MIN::NULL}
\\
\verb|min::|\MINKEY{SUCCESS} \LABEL{MIN::SUCCESS}

\end{indpar}


} % end of renewcommand for \LABEL, \{TT,MIN,MUP}KEY.

\bibliographystyle{plain}
\bibliography{min}

\printindex

\end{document}



